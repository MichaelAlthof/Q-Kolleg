BERLIN

SFB 6 4 9 E C O N O M I C R I S K

SFB 649 Discussion Paper 2016-025
Forecasting Limit Order Book Liquidity Supply-Demand Curves
with Functional AutoRegressive Dynamics
Ying Chen* Wee Song Chua*≤ Wolfgang K. H‰rdle*≤
* National University of Singapore, Singapore *≤ Humboldt-Universit‰t zu Berlin, Germany
This research was supported by the Deutsche Forschungsgemeinschaft through the SFB 649 "Economic Risk".
http://sfb649.wiwi.hu-berlin.de ISSN 1860-5664
SFB 649, Humboldt-Universit‰t zu Berlin Spandauer Straﬂe 1, D-10178 Berlin

Forecasting Limit Order Book Liquidity Supply-Demand Curves with Functional
AutoRegressive Dynamics
Ying Chen1,3, Wee Song Chua1, and Wolfgang Karl Ha®rdle2
1Department of Statistics and Applied Probability, National University of Singapore, Singapore
2Ladislaus von Bortkiewicz Chair of Statistics, C.A.S.E.- Center for Applied Statistics & Economics, Humboldt-Universita®t zu Berlin, Spandauer Str. 1, 10178 Berlin, Germany; Sim Kee Boon Institute for Financial Economics, Singapore Management University, 50 Stamford
Road, 178899 Singapore, Singapore 3Risk Management Institute, National University of Singapore,
Singapore
Abstract
Limit order book contains comprehensive information of liquidity on bid and ask sides. We propose a Vector Functional AutoRegressive (VFAR) model to describe the dynamics of the limit order book and demand curves and utilize the fitted model to predict the joint evolution of the liquidity demand and supply curves. In the VFAR framework, we derive a closed-form maximum likelihood estimator under sieves and provide the asymptotic consistency of the estimator. In application to limit order book records of 12 stocks in NASDAQ Corresponding author: Wee Song Chua Email: a0054070@u.nus.edu Phone: +65-6516 3470 Fax: +65-6872 3919 This research was supported by the FRC grant at the National University of Singapore. Support from IRTG 1792 "High Dimensional Non Stationary Time Series", Humboldt-Universit®at zu Berlin, is gratefully acknowledged.
1

traded from 2 Jan 2015 to 6 Mar 2015, it shows the VAR model presents a strong predictability in liquidity curves, with R2 values as high as 98.5 percent for insample estimation and 98.2 percent in out-of-sample forecast experiments. It produces accurate 5-, 25- and 50-minute forecasts, with root mean squared error as low as 0.09 to 0.58 and mean absolute percentage error as low as 0.3 to 4.5 percent.
Keywords: Limit order book, Liquidity risk, multiple functional time series JEL Codes: C13, C32, C53
1 Introduction
Liquidity is a fundamental determinant of market quality. It is important for regulators, market makers and traders to understand the dynamics of liquidity. An imbalance in market liquidity creates challenges not just for market participants but also for the financing structure of the economy in long term. While regulators need to monitor market liquidity to ensure trade transparency and market stability, market participants are motivated to forecast liquidity for e.g. optimal execution strategies on order splitting and submissions.
Liquidity is traditionally measured by some single-valued statistics such as market tightness of bid-ask spread that is computed with the best bid (buy) and ask (sell) prices and market depth based on the volumes at the best quotes or related. As a comparison, Limit Order Book (LOB) contains much more comprehensive information on liquidity, which matches investors' orders on bid and ask sides based on the pricetime priority. LOB tells not only the bid-ask spread and the volumes at the best quotes, but also the queuing orders at various sizes and prices.
The information contained in LOB can be well represented by liquidity curves. The liquidity curves display accumulated volumes against quoted prices on both bid and ask sides. Figure 1 gives a graphical illustration, which displays the snapshots of the liquidity curves of two stocks, Sirius XM Holdings Inc. (SIRI) and Comcast Corporation (CMCSA), traded on March 4, 2015 at 14:45. The liquidity curves have V-shape that are monotonically decreasing on the bid side and monotonically increasing on the ask side. In most cases, there is no crossing of the curves and the gap at the center represents the bid-ask spread. The gradient of the liquidity curves reflects the market depth that the steeper the curves are, the less price impact there is for large orders, and thus the more liquidity is ready to be supplied or consumed
2

Log (Acummulated Volume) Log (Acummulated Volume)

15.5 15
14.5 14
13.5 13
12.5 12
11.5 11 2

bid and ask supply curve on 2015-3-4 at 14:45 for SIRI
2.5 3 3.5 4 4.5 5 5.5 Price

11.5 11
10.5 10 9.5 9 8.5 8 7.5 7 56

bid and ask supply curve on 2015-3-4 at 14:45 for CMCSA
57 58 59 60 61 62 63 Price

64

Figure 1: SIRI and CMCSA bid and ask supply curve at an arbitrary selected time point. SIRI and CMCSA are the most actively and least actively traded stock in our sample respectively.
VFARrandBidAskCurvePlot

in market. It observes that liquidity is concentrated on relatively few prices near the best bid and ask prices, while the tails are relatively flat. This flattening out of the tail, or the gentle gradient in the tails, implies low liquidity. If a trader buys or sells in large volumes at the extreme prices, a drastic change is triggered in the price.
Though with limited information, the single-valued liquidity measures are found to be serially dependent in e.g. Bid-ask spread (e.g. Benston and Hagerman, 1974; Stoll, 1978; Fleming and Remolona, 1999) and Exchange Liquidity Measure (XLM) (see Cooper, Groth and Avera, 1985; Gomber, Schweickert and Theissen, 2015). AutoRegressive models have been employed to describe the dynamics of the liquidity measures. Groﬂ-Kluﬂmann and Hautsch (2013) proposed a long memory AutoRegressive conditional Poisson model for the quoted bid-ask spreads. Huberman and Halka (2001) evidenced the serial dependence of bid-ask spread and depth in the AutoRegressive model. Ha®rdle, Hautsch and Mihoci (2015) proposed a local adaptive multiplicative error model to forecast the high-frequency series of one-minute cumulative trading volumes of several NASDAQ blue chip stocks.
Serial dependence also exists in limit order demand and supply, see Dierker, Kim, Lee and Morck (2014). Chordia, Sarkar and Subrahmanyam (2003) documented the cross-sectional dependence among multiple liquidity measures using a Vector AutoRegressive model for bid-ask spreads, depth, volatility, returns, and order flow in the stock and bond markets, where a liquidity measure not only depends on its own past

3

values, but also those of other measures. C∏ etin, Jarrow and Protter (2004) introduced liquidity supply curve for robust arbitrage pricing theory. Ha®rdle, Hautsch and Mihoci (2012) studied the de-seasonalized liquidity supply curves in a limit order book market using a dynamic semiparametric factor model.
To understand the dynamics of LOB, it is of high relevance to simultaneously consider the pending quantities deeply queuing on both sides, besides the lead-lag dependence among the single-valued liquidity measures of each curve separately. Public or private information can cause investors to switch from one side to the other, and simultaneously market-wide events can result in similar changes to both bid and ask sides of the limit order book. The joint serial dependence suggests richer dynamics in limit order book and should be utilized in liquidity analysis. In our study, we employ a Vector Functional AutoRegressive (VFAR) model to describe the dynamics of two liquidity curves ≠ demand and supply on bid and ask sides of an electronic open LOB ≠ simultaneously in a unified framework. We derive a closed-form maximum likelihood estimator under sieve and provide asymptotic consistency of the VFAR estimator. The proposed VFAR model is general and can be used for modeling other multiple functional time series.
We investigate the finite sample performance of the proposed forecast model. In the application to the LOB records of 12 stocks traded in NASDAQ from 2 Jan 2015 to 6 Mar 2015, we find the VFAR presents a strong predictability in liquidity curves, with R2 values as high as 98.5 percent for in-sample estimation and 98.2 percent in out-of-sample forecast experiments. It also produces accurate 5-, 25- and 50-minute forecasts, with root mean squared error as low as 0.09 to 0.58 and mean absolute percentage error as low as 0.3 to 4.5 percent.
This paper is structured as follows. In Section 2, we describe the LOB data. Section 3 presents the VFAR model including estimation and asymptotic property. Section 4 reports the analytical results for both in-sample and out-of-sample in real data analysis. Section 5 provides concluding remarks. All of the theoretical proofs are contained in the Appendix.
2 Data
We consider 12 stocks traded in the National Association of Securities Dealers Automated Quotations (NASDAQ) stock market from 2 Jan 2015 to 6 Mar 2015 (44 trading days). The limit order book (LOB) records were obtained from LOBSTER
4

through the Research Data Center of the Collaborative Research Center 649 (https: //sfb649.wiwi.hu-berlin.de/fedc/). NASDAQ is a continuous auction trading platform where the normal continuous trading hours are between 9:30 a.m. to 4:00 p.m. from Monday to Friday. During the normal trading, if an order cannot be executed immediately or completely, the remaining volumes are queued in the bid and ask sides according to a strict price-time priority order.
The 12 stocks are Apple Inc. (AAPL), Microsoft Corporation (MSFT), Intel Corporation (INTC), Cisco Systems, Inc. (CSCO), Sirius XM Holdings Inc. (SIRI), Applied Materials, Inc. (AMAT), Comcast Corporation (CMCSA), AEterna Zentaris Inc. (AEZS), eBay Inc. (EBAY), Micron Technology, Inc. (MU), Whole Foods Market, Inc. (WFM), and Starbucks Corporation (SBUX). These stocks cover a wide range in terms of market capitalization, liquidity tightness and depth. The market value of AAPL is USD737.41 billions the largest compared to USD35.38 millions for the smallest sample stock AEZS. The 5-minute queueing volume in the LOB ranges from 3.73 millions for the most active stock (SIRI) to 0.02 millions for the least active stock (CMCSA) on the bid side and 7.61 millions (SIRI) to 0.03 millions (SBUX) on the ask side. Moreover, the average value of the bid-ask spread varies from 0.0062(AEZS) to 0.0213 (SBUX), see Table 1.

Ticker Symbol
AAPL MSFT INTC CSCO SIRI AMAT CMCSA AEZS EBAY MU WFM SBUX

Mean spread (USD) 0.0125 0.0101 0.0102 0.0101 0.0101 0.0102 0.0106 0.0062 0.0110 0.0107 0.0153 0.0213

Bid vol min max 52,267 710,020 90,344 928,319 158,900 557,251 134,790 1,316,058 1,266,528 3,725,304 78,944 334,794 23,668 128,916 145,635 767,785 42,060 160,572 95,907 497,910 34,538 114,386 27,467 151,022

Ask vol min max 61,305 1,298,696 122,377 621,471 146,959 1,142,641 266,455 4,458,672 3,002,680 7,605,467 180,749 787,983 40,638 146,724 472,689 1,158,740 52,813 415,033 102,357 595,200 41,019 159,488 34,914 166,932

Table 1: Summary statistics on liquidity measures for the 12 stocks traded in NASDAQ. Sampling frequency is 5 minutes.

The LOB records contain the quoted prices and volumes up to 100 price levels on each side. All the quotes are timestamped with decimal precision up to nanoseconds
5

(= 10-9 seconds). In total, the (buy or sell) order book contains 400 values from the best ask price, best ask volume, best bid price, and best bid volume until the 100-th best ask (bid) price and corresponding volume. For unoccupied price levels, the variables are filled with 9999999999 for ask and -9999999999 for bid, with volumes being 0.
To remove the impact of microstructure noise, the sampling frequency is set to be 5 minutes for a good strike between bias and variance, see A®it-Sahalia, Mykland and Zhang (2005) and Zhang and A®it-Sahalia (2005). The first 15 minutes after opening and the last 5 minutes before closing are discarded to eliminate the market opening and closing effect. Moreover, the accumulated bid and ask volumes are log-transformed when constructing liquidity curves to reduce the impact of extraordinarily large volumes. After the data processing, there are 75 pairs of bid and ask liquidity curves for each stock on each trading day. Over the whole sample period of 44 trading days, it amounts to 3, 300 pairs of bid and ask supply curves for each stock.
The liquidity curves, containing the complete information in LOB, exhibit significant serial dependence. As an illustration, Figure 2 shows the sample cross correlations between the log-accumulated volumes at best bid and ask prices for 6 stocks including AAPL with the largest market value, AEZS with the smallest value and the smallest bid-ask spread on average, CMCSA the least active stock and three wellknown MSFT, INTL and EBAY. While the simultaneous dependence between the bid and ask sides is insignificant or negatively correlated, there is positive dependence on the lagged values of the opposite side. Similar features are observed in the other 6 stocks. The bid-ask cross dependency motivates analysing the two liquidity curves jointly.
3 Vector Functional AutoRegressive Model
In this section, we present the Vector Functional AutoRegressive (VFAR) setup that is directly applicable to multiple (e.g. bivariate) continuous curves over time. We show how to estimate the functional parameters, with the help of B-spline expansion and sieve, and provide the asymptotic consistency of the estimator. In functional domain, Bosq (2000) has proposed Functional AutoRegressive (FAR) model for univariate functional time series and developed Yule-Walker estimation (see also Besse, Cardot and Stephenson, 2000; Kim, Chaudhuri and Shin, 2015; Guillas, 2001; Antoniadis
6

Sample Cross Correlation

Sample Cross Correlation

Sample cross correlation function between log-accumulated volumes at best bid and best ask price for AAPL
0.08

0.06

0.04

0.02

0

-0.02

-0.04

-20 -15 -10

-5

0

5

Lag

10 15 20

Sample cross correlation function between log-accumulated volumes at best bid and best ask price for INTC
0.15

0.1

0.05

0

-0.05

-0.1

-20 -15 -10

-5

0

5

Lag

10 15 20

Sample cross correlation function between log-accumulated volumes at best bid and best ask price for AEZS
0.1

0.08

0.06

0.04

0.02

0

-0.02

-0.04

-20 -15 -10

-5

0

5

Lag

10 15 20

Sample Cross Correlation

Sample Cross Correlation

Sample Cross Correlation

Sample cross correlation function between log-accumulated volumes at best bid and best ask price for MSFT
0.3

0.25

0.2

0.15

0.1

0.05

0

-0.05

-20 -15 -10

-5

0

5

Lag

10 15 20

Sample cross correlation function between log-accumulated volumes at best bid and best ask price for CMCSA
0.15

0.1

0.05

0

-0.05

-0.1

-0.15

-0.2

-20 -15 -10

-5

0

5

Lag

10 15 20

Sample cross correlation function between log-accumulated volumes at best bid and best ask price for EBAY
0.3

0.25

0.2

0.15

0.1

0.05

0

-0.05

-20 -15 -10

-5

0

5

Lag

10 15 20

Sample Cross Correlation

Figure 2: Sample cross correlation function between log-accumulated volumes at best bid and ask price for AAPL, MSFT, INTC, CMCSA, AEZS, and EBAY
VFARcrossCorrPlot

7

and Sapatinas, 2003; Kokoszka and Zhang, 2010). Mourid and Bensmain (2006) proposed a maximum likelihood estimation with Fourier expansions. Chen and Li (2015) adopted an adaptive approach to extend the applicability of the FAR model in both stationary and non-stationary situations. It is worth noting that the proposed VFAR model is able to analyze multiple functional time series jointly. Furthermore, the maximum likelihood estimator is derived with B-spline expansions that provides more flexibility in fit than e.g. the Fourier expansion.

Our interest is to model the joint dynamic dependence of liquidity curves on the bid and ask sides. Let Xt(a)( ) and Xt(b)( ) for   [0, 1] be the two processes in the function space C[0,1] of real continuous functions on [0, 1]. The superscripts (b) and (a)
represent bid and ask respectively. Each pair of the liquidity curves can be thought as
a data object at time t = 1, ∑ ∑ ∑ , n, and together, they form a time series of n functional objects each on the bid and the ask sides. At each time t, the liquidity curves Xt(b) and Xt(a) are observed containing the quoted prices as well as the corresponding logaccumulated volumes. To handle the two continuous liquidity curves simultaneously,
we propose a Vector Functional AutoRegressive (VFAR) model:

Xt(a) - µa Xt(b) - µb

=

aa ba

ab bb

Xt(-a)1 - µa Xt(-b)1 - µb

+

(ta) t(b)

(1)

where (µa, µb) are the mean functions and the operators aa, ab, ba, and bb measure
the cross-dependence among the liquidity demand and supply curves on their lagged
values. The operators are bounded linear operator from H to H, a real separable Hilbert space endowed with its Borel -algebra BH. The innovations {(ta)}nt=1 and {t(b)}nt=1 are strong H-white noise, i.i.d. with zero mean and 0 < E 1(a) 2 = ∑ ∑ ∑ = E (na) 2 <  and 0 < E (1b) 2 = ∑ ∑ ∑ = E (nb) 2 < , where the norm ∑ is induced from the inner product ∑, ∑ of H. The innovation processes (ta) and t(b) need not be
cross-independent.

The operators  can be represented by a convolution kernel Hilbert-Schmidt operator, which gives

1
Xt(a)( ) - µa( ) = ab( - s) Xt(-b)1(s) - µb(s) ds
0
1
+ aa( - s) Xt(-a)1(s) - µa(s) ds + (ta)( )
0
1
Xt(b)( ) - µb( ) = bb( - s) Xt(-b)1(s) - µb(s) ds
0

8

1
+ ba( - s) Xt(-a)1(s) - µa(s) ds + (tb)( )
0

(2)

where the kernel function xy  L2([0, 1]) and xy 2 < 1 for xy = aa, ab, ba, and bb, where ∑ 2 denotes the L2 norm in C[0,1].

We expand the functional terms in (2) using B-spline basis function in L2([0, 1]):

Bj,m( )

=

 - wj wj+m-1 -

wj

Bj,m-1(

)

+

wj+m -  wj+m - wj+1

Bj+1,m-1(

),

m  2,

where m is the order, w1  ∑ ∑ ∑  wJ+m denote the sequence of knots, and



1 Bj,1( ) =

if wj   < wj+1,

0 otherwise.

We obtain:

Xt(a)( ) (ta)( ) aa( ) ab( )

=

 j=1

dat,j

Bj,m(

),

Xt(b)( )

=

 j=1

daj

((ta))Bj,m(

),

(tb)( )

=

 j=1

caj aBj,m(

),

bb( )

=

 j=1

cjabBj,m(

),

ba( )


= dtb,jBj,m( ),
j=1 
= djb((tb))Bj,m( ),
j=1 
= cjbbBj,m( ),
j=1 
= cbjaBj,m( ).
j=1

where dta,j and dtb,j are the B-spline coefficients for the observed functional data Xt(a) and Xt(b) respectively; daj (t(a)) and djb(t(b)) are the B-spline coefficients for the unknown innovations t(a) and (tb) respectively; and cjaa, cjab, cjba, and cbjb are the B-spline
coefficients for the unknown kernel functions aa, ab, ba, and bb respectively.

Plug-in the B-spline expansions to the VFAR model (2), and let pah be the coef-

ficients associated with the expansion of µa( ) -

1 0

ab(

-

s)µb(s)ds

-

1 0

aa(

-

s)µa(s)ds while phb be the coefficients for µb( ) -

1 0

bb(

-

s)µb(s)ds

-

1 0

ba(

-

s)µa(s)ds, we have:

1

Xt(a)( ) = phaBh,m( ) +

h=1

0


caj adta-1,iBj,m( - s)Bi,m(s) ds
j=1 i=1

9

1
+
0





caj bdtb-1,iBj,m( - s)Bi,m(s) ds + dja(t(a))Bj,m( )

j=1 i=1

j=1



= pahBh,m( )

h=1 
+
h=1 i=1

 j=1

wj+m - wj+1 - wj+m+1 - wj+2

wj+m - wj

wj+m+1 - wj+1

caj a - chaa

wi+m - m

wi

dta-1,iBh,m(

)


+
h=1 i=1

 j=1

wj+m - wj+1 - wj+m+1 - wj+2

wj+m - wj

wj+m+1 - wj+1

cjab - chab

wi+m - m

wi

dbt-1,iBh,m

(

)


+ daj ((ta))Bj,m( )

j=1

1

Xt(b)( ) = phb Bh,m( ) +

h=1

0


cbjbdbt-1,iBj,m( - s)Bi,m(s) ds
j=1 i=1

1
+
0





cjbadta-1,iBj,m( - s)Bi,m(s) ds + dbj((tb))Bj,m( )

j=1 i=1

j=1



= phb Bh,m( )

h=1 
+
h=1 i=1

 j=1

wj+m - wj+1 - wj+m+1 - wj+2

wj+m - wj

wj+m+1 - wj+1

cbjb - cbhb

wi+m - m

wi

dbt-1,iBh,m(

)


+
h=1 i=1

 j=1

wj+m - wj+1 - wj+m+1 - wj+2

wj+m - wj

wj+m+1 - wj+1

cjba - chba

wi+m - m

wi

dat-1,iBh,m

(

)


+ djb((tb))Bj,m( )

(3)

j=1

Rearranging the above equations, we obtain the relationship of the B-spline coefficients in the framework of VFAR:

dta,h = pah +

 i=1

- c - c d wj+m-wj+1
j=1 wj+m-wj

wj +m+1 -wj +2 wj +m+1 -wj +1

aa j

aa wi+m-wi a h m t-1,i

+

 i=1

- c - c d + d ( ) wj+m-wj+1
j=1 wj+m-wj

wj +m+1 -wj +2 wj +m+1 -wj +1

ab j

ab wi+m-wi b h m t-1,i

a (a) ht

dtb,h = phb +

 i=1

- c - c d wj+m-wj+1
j=1 wj+m-wj

wj +m+1 -wj +2 wj +m+1 -wj +1

bb j

bb wi+m-wi b h m t-1,i

+

 i=1

 wj+m-wj+1
- c - c d + d ( ) (4)j=1 wj+m-wj

wj +m+1 -wj +2 wj +m+1 -wj +1

ba j

ba wi+m-wi a h m t-1,i

b (b) ht

The original problem of estimating the functional parameters is converted to the

10

estimation of the B-spline coefficients. It is however impossible to estimate infinite coefficients given finite sample.

3.1 Sieve estimator

We introduce a sequence of subsets - a sieve for a parameter space , is denoted by {Jn} where Jn  Jn+1 and the union of subsets Jn is dense in the parameter space. While allowing the dimension of the subset to increase when sample size gets larger, we will estimate the unknown parameters on the finite subset of the parameter space. The sieve is defined as follows:

Jn
Jn = xy  L2 | xy( ) = clxyBl,m( ),
l=1

  [0, 1],

Jn
l2(clxy)2  vJn
l=1
(5)

where Jn  + as n  + and v is some known positive constant such that without any sacrifice of the growth rate of Jn, the constraint for clxy can be satisfied generally, see e.g. Grenander (1981) on the theory of sieves.

Under the sieve with Jn, Equation (4) can be represented in matrix form, which yields a form of Vector AutoRegressive (VAR) of order 1:

 dta,1 

 

...

 

 pa1 

 

...

 

 r1a,a1 ∑ ∑ ∑ r1a,aJn

 

...

...

...

r1a,b1 ∑ ∑ ∑ r1a,bJn   dta-1,1 

... . . .

...

 

...

 

 d1a((ta)) 

 

...

 

   

dat,Jn

 

=

pJan

 

+

rJana,1

 

dtb,1

 

 

p1b

 

 

r1ba,1

∑∑∑ ∑∑∑

raa
Jn,Jn
r1ba,Jn

rJanb ,1 r1bb,1

∑∑∑ ∑∑∑

rab
Jn,Jn
r1bb,Jn

    

 dat-1,Jn

 

dtb-1,1

    

+

 dJan

((ta))

 

db1((tb))

 

 

...

 

 

...

 

 

...

...

...

... . . .

...

 

...

 

 

...

 

   

  



dtb,Jn

pbJn

rJban,1

∑∑∑

rba
Jn,Jn

rJbbn,1

∑∑∑

rbb
Jn,Jn

dbt-1,Jn

dJb n ((tb))

(6)

where rhx,yi denotes

- c - c , for xy = aa,Jn wj+m-wj+1
j=1 wj+m-wj

wj +m+1 -wj +2 wj +m+1 -wj +1

xy j

xy wi+m-wi hm

ab, ba, and bb. Equation (6) can be also represented as:

yt = v + Cyt-1 + ut

(7)

where yt = dat,1, ∑ ∑ ∑ , dta,Jn, dbt,1, ∑ ∑ ∑ , dtb,Jn , v = p1a, ∑ ∑ ∑ , pJan, pb1, ∑ ∑ ∑ , pbJn , ut = d1a(t(a)), ∑ ∑ ∑ , daJn(t(a)), d1b (t(b)), ∑ ∑ ∑ , dJbn((tb)) , and C be the matrix with elements

11

rhx,yi in (6). Assuming the presample value y0 is available, define:

Y = (y1, ∑ ∑ ∑ , yn), B = (v, C),

1

Zt =

, yt

Z = (Z0, ∑ ∑ ∑ , Zn-1),

U = (u1, ∑ ∑ ∑ , un),

y = vec(Y ),

 = vec(B),

u = vec(U ),

K = 2Jn.

where vec is the column stacking operator. Using the notations, for t = 1, ∑ ∑ ∑ , n, we can write (7) compactly as the following:

Y = BZ + U

(8)

By applying vec operator to (8) yields

vec(Y ) = vec(BZ) + vec(U ) = (Z  IK)vec(B) + vec(U )

or equivalently,

y = (Z  IK) + u,

where  is the Kronecker product.

We impose an assumption that the B-spline coefficients daj (t(a)) are independently and identically Gaussian distributed with mean zero and constant variance j2,a. The same applies for djb(t(b)) with j2,b. Following Geman and Hwang (1982), we define the likelihood function for VFAR over the approximating subspace (5) of the original
parameter space. Assuming

u1 

u

=

vec(U )

=

 

...

 



N (0, In



u),

un

12

the probabilistic density of u is

fu(u) =

1 (2)Kn/2

In  u

-

1 2

exp

- 1u 2

(In  u-1)u

.

In addition,

0 IK

 -C 

 -C

...

u=  

... ...









(y

-

v)

+

 







0 ...



 

y0,





0  -C IK

0

where v = (v, ∑ ∑ ∑ , v)

is

a

(Kn ◊ 1)

vector.

Consequently,

u y

is a lower triangular

matrix with unit diagonal which has unit determinant. Therefore using u = y -

(Z  IK), the transition density is as follows:

g Xt(a), Xt(b), Xt(-a)1, Xt(-b)1, aa, ab, ba, bb

u = fy(y) = y fu(u)

=

1 (2)Kn/2

In  u

-

1 2

exp

1

- 2

y - (Z

 IK)

(In  u-1) y - (Z  IK)

.

The (approximated) log-likelihood function is:

X1(a), ∑ ∑ ∑ , Xn(a), X1(b), ∑ ∑ ∑ , Xn(b); aa, ab, ba, bb = (, u)

Kn n

1

=- 2

log 2 - log 2

u

- 2

y - (Z

 IK)

(In  -u 1) y - (Z  IK)

= -Kn log 2 - n log 22

u

-1 2

n

yt - v - Cyt-1

-u 1 yt - v - Cyt-1

t=1

= -Kn log 2 - n log 22

u

-1 2

n

yt - Cyt-1

u-1 yt - Cyt-1

t=1

n
+ v -u 1

yt - Cyt-1

- nv 2

u-1v

t=1

= -Kn log 2 - n log 22

u

- 1 tr 2

(Y - BZ) u-1(Y - BZ)

13

and the first order partial differentiations are as follows:

 

=

(Z



IK )(In



-u 1)

y - (Z

 IK)

= (Z  -u 1)y - (ZZ  -u 1)

 u

=

-

n 2

-u 1

+

1 2

u-1(Y

- BZ)(Y

- BZ)

-u 1

(9)

By equating the first order partial derivatives in (9) to zero, we obtain the maximum likelihood estimators:

 = (ZZ )-1Z  IK y, or equivalently,

B = (v, C) = Y Z (ZZ )-1

u

=

1 (Y
n

- BZ)(Y

- BZ)

(10)

The first column of Y Z (ZZ )-1 in (10) is the estimator for v = p1a, ∑ ∑ ∑ , pJan, pb1,

∑ ∑ ∑ , pJbn . To show the estimator for cjxy for xy = aa, ab, ba, bb as in (2), we further define the following notations:

m mm m

W = diag

,∑∑∑ ,

, ,∑∑∑ ,

w1+m - w1

wJn+m - wJn w1+m - w1

wJn+m - wJn

qj

=

wj+m - wj+1 wj+m - wj

-

wj+m+1 wj+m+1

- -

wj+2 , wj+1

1 = (c1aa, ∑ ∑ ∑ , caJan, cb1a, ∑ ∑ ∑ , cbJan) ,

2 = (ca1b, ∑ ∑ ∑ , caJbn, cb1b, ∑ ∑ ∑ , cbJbn) ,

 = (1, ∑ ∑ ∑ , 1, 2, ∑ ∑ ∑ , 2),

 q1 - 1 q2 ∑ ∑ ∑ qJn

0



 q1

  

...

q2 - 1 ∑ ∑ ∑ ... . . .

qJn ...

    



 Q=

q1







q2 ∑ ∑ ∑ qJn - 1

 ,

q1 - 1

q2

∑∑∑

qJn

 



   

q1 ...

q2 - 1 ∑ ∑ ∑ ... . . .

qJn ...

   

0

 q1 q2 ∑ ∑ ∑ qJn - 1

,

where  contains Jn columns of 1 and Jn columns of 2. Therefore we have the

14

estimator for cjxy for xy = aa, ab, ba, bb as follows:  = Q-1Y Z (ZZ )-1(02Jn◊1, I2Jn◊2Jn ) W

3.2 Asymptotic property

We now derive the consistency results of the sieve estimators. Let H(, ) denote the conditional entropy between a set of operators  = (aa, ab, ba, bb) and a given set of operators :

H(, ) = E log g(Xt(a), Xt(b), Xt(-a)1, Xt(-b)1, ) .

The growth of Jn is determined by the following two conditions:

C1: If there exists a sequence {Jn} such that Jn  Jnn and H(0|Jn , Jn) 

H(0|Jn , 0|Jn ), then

Jn -0|Jn

 0; meaning each
HS

xJny -x0|yJn


HS

0, for xy = aa, ab, ba, bb. Here 0|Jn denotes the projection of the set of true

operators 0 on the sieve Jn.

C2: There exists a sequence {Jn} described in C1 such that H(0|Jn , Jn)  H (0|Jn , 0|Jn ).

The norm ∑ S is a Hilbert-Schmidt norm for the convolution kernel operator. Recall that a linear operator  on a Hilbert space H with norm ∑ and inner product ∑, ∑ is
Hilbert-Schmidt if (∑) = j j ∑, ej fj, where {ej} and {fj} are orthonormal bases of H and {j} is a real sequence such that j 2j < . The convolution kernel operator satisfies the definition and its Hilbert-Schmidt norm is  S = ( j j2)1/2. The Hilbert-Schmidt norm is chosen for our study because of the fact that the convolution
kernel operator defined in our paper forms a class of operators embedded in the whole
space of Hilbert-Schmidt operators and for any convolution kernel operator , we have the Hilbert-Schmidt norm of  equal to the L2 norm of its kernel function, that is
 HS =  2.

Theorem 3.1 Assume {Jn} is chosen such that conditions C1 and C2 are in force. Suppose that for each  > 0, we can find subsets 1, 2, ∑ ∑ ∑ , lJn of Jn, Jn = 1, 2, ∑ ∑ ∑ such that

(i) DJn 

lJn k=1

k,

where

DJn

=

{



Jn |H(0|Jn , )



H(0|Jn ,

Jn )

-

}

for

every  > 0 and every Jn.

15

(ii)

+ n=1

lJn

(Jn

)n

<

+,

where

given

l

sets

1, ∑ ∑ ∑ , l

supk inft0 E0|Jn exp

t log g(Xt(a),Xt(b),Xt(-a)1,Xt(-b)1,k)
g(Xt(a),Xt(b),Xt(-a)1,Xt(-b)1,Jn )

.

in Jn, where Jn

=

Then we have supnMJnn n - 0|Jn HS  0 a.s.

Note that in Theorem 3.1, g(Xt(a), Xt(b), Xt(-a)1, Xt(-b)1, k) = supk g(Xt(a), Xt(b), Xt(-a)1, Xt(-b)1, ). We define the set of all ML estimators on Jn given the sample size n as MJnn = {  Jn| (X1(a), ∑ ∑ ∑ , Xn(a), X1(b), ∑ ∑ ∑ , Xn(b); ) = supJn (X1(a), ∑ ∑ ∑ , Xn(a), X1(b), ∑ ∑ ∑ , Xn(b); )}. The proof of Theorem 3.1 shows the convergence of the ML esti-
mator to 0|Jn , the projections of the true operators on sieve, see Appendix. Together with the convergence of 0|Jn to the true set of operators 0 as the sieve dimension grows, we prove that the ML estimator converges to the true set of operators 0.

Theorem 3.2 If Jn = O(n1/3-) for  > 0, then Jn - 0|Jn 2  0 a.s. when n  + and ∑ 2 is the L2 norm in C[0,1].
Jn = (aa,Jn, ab,Jn, ba,Jn, bb,Jn) is the set of sieve estimators on Jn and 0|Jn = (aa,0|Jn , ab,0|Jn , ba,0|Jn , bb,0|Jn ) is the projection of the set of true kernel functions 0 on Jn. Jn - 0|Jn 2  0 a.s. means that each xy,Jn - xy,0|Jn 2  0 a.s. for xy = aa, ab, ba, bb.

By checking the conditions of Theorem 3.1, we can achieve the proof of Theorem 3.2. The proof is detailed in the Appendix. As n, Jn  , we have 0|J  0 as xy,0|J in 0|J is just the B-spline truncation of the corresponding true kernel xy,0 in 0 on Jn. Finally we have the sieve estimator Jn converges to the true set of kernel functions 0.

4 Empirical applications of the VFAR model
In this section, we apply the VFAR model to estimate the joint dynamics of the liquidity demand and supply curves and investigate its in-sample and out-of-sample predictability.

4.1 In-sample estimation
We conduct in-sample estimation based on the liquidity demand and supply curves over 44 trading days from date 2 Jan 2015 to 6 Mar 2015. We employs B-spline
16

expansions with equally-spaced price percentile as nodes and Jn = 20 in the sieve. There are in total 20 coefficients for the bid and another 20 for the ask liquidity curves. Moreover, we perform estimation with the Random Walk (RW) model of no drift, where the liquidity curves are directly estimated by their most recent curves at the previous time point. Though simple, random walk provides a general good predictability and hard to beat under market efficiency.
We use three measures as indicators of predict performance, the root mean squared estimation error (RMSE) and the mean absolute percentage error (MAPE) for accuracy, and R2 for the explanatory power:

RMSE =

xy=a,b

n t=1

 Xt(xy)( ) - Xt(xy)( ) 2

N

M AP E =

xy=a,b

n Xt(xy)( )-Xt(xy)( )

t=1 

Xt(xy)( )

N

R2 = 1 -

n xy=a,b t=1 
n xy=a,b t=1

Xt(xy)( ) - Xt(xy)( )  Xt(xy)( ) - XØ 2

2

(11)

We calculate these measures for the estimated liquidity curves in the VFAR models and the alternative RW model.
Table 2 reports the R2, RMSE and MAPE of the estimated liquidity curves in the VFAR model. It shows that VFAR provides high explanatory power for all the stocks, with R2 ranging from 92 percent (AAPL) to 98 percent (AEZS), RMSE smaller than 0.34 (AAPL) and MAPE lower than 3.61 percent. On the right panel, the alternative RW model is compared with the VFAR model by calculating the ratio of each measure. In each column, the number in bold-face indicates the best relative performance of VFAR for each stock and performance measure.

Table 2 shows that, without exception, the VFAR model is always better than the RW model. In terms of R2, VFAR outperforms by up to 3 percent (AAPL and CMCSA). As for estimation accuracy, the relative performance reaches to 13 percent in MAPE (CSCO) and at least 9 percent (SIRI, the most active stock) and up to 45 percent (AEZS that has the smallest bid-ask spread on average).

To visualize the in-sample fit, Figure 3 depicts the estimated bid and ask supply curves vs. the observed ones at an arbitrarily selected date, 24 February 2015 at

17

Ticker Symbol
AAPL MSFT INTC CSCO SIRI AMAT CMCSA AEZS EBAY MU WFM SBUX

R2 92.03% 95.19% 94.79% 96.16% 98.29% 95.83% 93.39% 98.48% 94.88% 95.14% 95.52% 94.77%

VFAR RMSE
0.34 0.18 0.19 0.19 0.09 0.18 0.19 0.42 0.23 0.26 0.20 0.22

MAPE 3.61% 0.95% 0.92% 0.86% 0.29% 0.89% 1.20% 2.18% 1.55% 1.17% 1.57% 2.51%

RW vs VFAR R2 RMSE MAPE 0.97 1.18 1.05 0.98 1.16 1.07 0.98 1.15 1.07 0.99 1.13 1.06 1.00 1.09 1.00 0.99 1.15 1.09 0.97 1.18 1.13 0.98 1.45 1.05 0.98 1.15 1.06 0.98 1.16 1.08 0.98 1.16 1.01 0.98 1.17 1.05

Table 2: R2, RMSE, and MAPE for in-sample estimation of the 12 stocks

3p.m. for four stocks, AAPL, AMAT, AEZS and SIRI, representing heterogeneous stocks in terms of market capitalization and liquidity. The estimated curves display V-shape, and reasonably trace both the actual queuing orders displayed as discrete dots as well as the smoothed liquidity curves in grey colour. Moreover, the accuracy is stable in the middle around the best quotes and also the tails.

4.2 Forecast
We make an out-of-sample forecast for the liquidity curves starting from the 31st trading day onwards and predict 1-, 5- and 10-step ahead forecasts that correspond to 5-, 25- and 50-minute ahead liquidity curves respectively. The first pair of forecasted curves is for time t = 2251, based on the past 30 trading days of 30 ◊ 75 = 2250 functional objects. Each time, we move forward one period, i.e. 5 minutes at a time and perform re-estimation and forecast until reaching the end of the sample at t = 3300.
Figure 4 gives graphical illustrations of the forecasted liquidity curves for AAPL with the VFAR model. The forecasts closely trace the realized liquidity curves. What is dramatic is its capacity to catch the dynamic movements of the liquidity curves over the period from 17 February to 06 March 2015 for different forecast horizon from 5- to 50-minute.
Table 3 reports the forecast RMSE, MAPE and predict power for liquidity curves of the 12 stocks. Even if in the worst case, the VFAR approach in forecasting is
18

Log (Acummulated Volume)

VFAR Fitted bid and ask curve at t=2689 , on 2015-2-24 at 15:00 for AAPL 13
12
11
10
9
8
7
6 131 131.5 132 132.5 133 133.5 134
Price VFAR Fitted bid and ask curve at t=2689 , on 2015-2-24 at 15:00 for AEZS 14 13 12 11 10 9 8 7 6 0 0.5 1 1.5 2 2.5
Price

Log (Acummulated Volume)

Log (Acummulated Volume)

VFAR Fitted bid and ask curve at t=2689 , on 2015-2-24 at 15:00 for AMAT 13 12.5 12 11.5 11 10.5 10 9.5 9 8.5 8 22.5 23 23.5 24 24.5 25 25.5 26 26.5 27
Price
VFAR Fitted bid and ask curve at t=2689 , on 2015-2-24 at 15:00 for SIRI 15.5
15
14.5
14
13.5
13
12.5
12
11.5
11 1.5 2 2.5 3 3.5 4 4.5 5 5.5 Price

Figure 3: Estimated bid (and ask) supply curves vs. the actually observed VFARrandVfarPlot

Log (Acummulated Volume)

19

able to achieve high R2 ranging from 91.13 percent (1-step AAPL) to 83.74 percent (10-step AAPL), low RMSE of 0.48 (1-step AEZS) to 0.58 (10-step AEZS), and low MAPE of 3.61 percent (1-step AAPL) to 4.49 percent (10-step AAPL). In addition to the forecasts from the VFAR model, we also compute forecasts from the random walk model, see Table 4. Again, the VFAR model dominates the RW model across forecast horizons and forecast measures. Though the improvement in R2 is weak, the advantage is tremendous in terms of the reduction in the RMSE of the VFAR model reaches about 4 percent (1-step SIRI) in the worst case and 36 percent (1-step AEZS) and 40 percent (5-step AEZS) in the best case. Compared with the random walk model, the VFAR model does not always have an absolute advantage for the MAPE comparison. As for MAPE, only in 5 out of 36 instances, we have the RW performing better than VFAR. In the other 31 cases, VFAR outperforms the RW by up to 20 percent. The relative superior performance grows as the forecast horizon increases, indicating that the utilization of cross-dependence in liquidity curves helps to improve out-of-sample prediction.
To summarize, the proposed VFAR model is able to successfully predict the liquidity curves over various forecasting periods. These results can be applied to various financial and economics applications, for example, deriving an optimal trading strategy and forecasting of the demand and supply elasticities.
5 Conclusion
Predictions of future liquidity supply and demand in the limit order book (LOB) helps in analyzing optimal splitting strategies for large orders to reduce cost, see H®ardle et al. (2012). To capture not only the volume around the best bid and ask price in the LOB, but also the pending volumes more deeply in the book, it becomes a highdimensional problem. In addition, we see significant cross-dependency of the bid and ask side of the market in Section 3. We proposed a Vector Functional AutoRegressive (VFAR) model to model and forecast LOB liquidity supply-demand curves, taking into consideration of the bid-ask cross dependency.
The model is applied to 12 stocks in the National Association of Securities Dealers Automated Quotations (NASDAQ) stock market. It is shown that our model gives R2 values as high as 98.5 percent for in-sample estimation. In out-of-sample forecast experiments, it produces accurate 5-, 25- and 50-minutes forecasts, with mean absolute percentage error as low as 0.3 to 4.5 percent. Most important, the VFAR
20

Dynamics of VFAR one-step ahead forecast for AAPL

Log (Acummulated Volume)

12 10
8 6 4 2 0 124

129 Price

135

05-Mar-2015 02-Mar-2015 25-Feb-2015 20-Feb-2015 17-Feb-2015 Date

Dynamics of VFAR 5-step ahead forecast for AAPL

Log (Acummulated Volume)

12 10
8 6 4 2 0 124

129 Price

135

05-Mar-2015 02-Mar-2015 25-Feb-2015 20-Feb-2015 17-Feb-2015 Date

Dynamics of VFAR 10-step ahead forecast for AAPL

Log (Acummulated Volume)

12 10
8 6 4 2 0 124

129 Price

135

05-Mar-2015 02-Mar-2015 25-Feb-2015 20-Feb-2015 17-Feb-2015 Date

Figure 4: Dynamics of multi-step ahead forecast for AAPL. Top: 5-minute ahead forecast; Middle: 25-minute ahead forecast; Bottom: 50-minute ahead forecast.
VFARdynamicPlot 21

Ticker Symbol
AAPL MSFT INTC CSCO SIRI AMAT CMCSA AEZS EBAY MU WFM SBUX

1-step 91.13% 95.38% 94.02% 96.67% 98.14% 95.47% 92.80% 98.23% 94.64% 95.37% 95.18% 94.49%

R2 5-steps 85.64% 91.56% 89.44% 93.07% 96.23% 92.17% 89.22% 97.71% 91.54% 92.35% 92.24% 91.82%

10-steps 83.74% 89.65% 86.95% 90.35% 95.31% 89.99% 88.09% 97.43% 89.74% 90.60% 91.15% 90.63%

1-step 0.37 0.18 0.19 0.21 0.09 0.19 0.20 0.48 0.23 0.22 0.20 0.23

RMSE 5-steps 10-steps
0.48 0.51 0.24 0.27 0.26 0.28 0.31 0.36 0.13 0.14 0.25 0.29 0.24 0.25 0.55 0.58 0.29 0.32 0.28 0.31 0.26 0.27 0.28 0.30

1-step 3.61% 0.93% 0.95% 0.88% 0.30% 1.00% 1.15% 2.22% 1.31% 1.18% 1.25% 1.81%

MAPE 5-steps 10-steps 4.21% 4.49% 1.42% 1.63% 1.46% 1.74% 1.44% 1.76% 0.52% 0.62% 1.47% 1.72% 1.56% 1.69% 2.85% 3.14% 1.79% 2.03% 1.70% 1.99% 1.76% 1.94% 2.27% 2.48%

22

Table 3: R2, RMSE, MAPE for multi-step ahead VFAR forecast of the 12 stocks

Ticker Symbol
AAPL MSFT INTC CSCO SIRI AMAT CMCSA AEZS EBAY MU WFM SBUX

1-step 0.97 0.99 0.98 0.99 1.00 0.99 0.98 0.98 0.99 0.98 0.99 0.98

R2 5-steps
0.93 0.98 0.96 0.98 0.99 0.97 0.94 0.98 0.96 0.96 0.96 0.96

10-steps 0.90 0.97 0.94 0.97 0.99 0.96 0.91 0.98 0.94 0.95 0.94 0.94

1-step 1.15 1.10 1.12 1.09 1.04 1.11 1.14 1.36 1.12 1.15 1.13 1.15

RMSE 5-steps 10-steps
1.19 1.22 1.12 1.14 1.16 1.19 1.13 1.14 1.10 1.09 1.16 1.18 1.23 1.28 1.40 1.39 1.19 1.23 1.20 1.22 1.23 1.29 1.21 1.24

1-step 1.03 0.97 1.02 1.01 0.90 1.01 1.06 1.05 1.05 1.08 1.05 1.03

MAPE 5-steps 10-steps
1.11 1.13 0.98 1.02 1.05 1.07 1.01 1.05 0.90 0.90 1.05 1.09 1.13 1.19 1.12 1.12 1.11 1.16 1.12 1.15 1.12 1.20 1.11 1.15

23

Table 4: Ratio of R2, RMSE, MAPE for multi-step ahead RW forecast to VFAR forecast of the 12 stocks

model is general and can be used for other multiple functional time series modeling and forecasting.
24

A Appendix

A.1 Derivation of the B-spline coefficient relationship as shown in Section 3
First we show how the expansion was obtained in (3). We only show for the first integral in (3) as the expansion other integrals can be obtained similarly.

1 
cjaadta-1,iBj,m( - s)Bi,m(s) ds
0 j=1 i=1

1
= cjaa Bj,m( - s)
j=1 0


dat-1,iBi,m(s) ds
i=1


= cjaa
j=1

1 m



dat-1,i(wi+m - wi)Bj,m( - s)

i=1

s=1 s=0


+ cjaa
j=1

1 0

1 m



dat-1,i(wi+m - wi)

i=1

m wj+m -

wj

Bj,m-1(

-

s)

-

m wj+m+1 -

wj+1 Bj+1,m-1(

-

s)


=-



dta-1,i(wi+m m

-

wi) cjaaBj,m( )

j=1 i=1


+



dat-1,i(wi+m m

-

wi) caj a

j=1 i=1

  -1

m wj+m - wj Bj,m-1(z)

ds

-

m wj+m+1 -

wj+1 Bj+1,m-1(z)

dz


=-



dat-1,i(wi+m m

-

wi) cahaBh,m(

)

h=1 i=1


+
h=1 i=1 j=1

wj+m - wj+1 - wj+m+1 - wj+2

wj+m - wj

wj+m+1 - wj+1

cjaa

wi+m - m

wi

dta-1,iBh,m(

)


=
h=1 i=1

 j=1

wj+m - wj+1 - wj+m+1 - wj+2

wj+m - wj

wj+m+1 - wj+1

caj a - caha

wi+m - m

wi

dat-1,iBh,m(

)

The

second

equality

made

use

of

integration

by

parts,

with

d ds

Bj,m

(

-s)

=

-

m wj +m -wj

Bj,m-1(

-

s)

-

B (m
wj+m+1-wj+1 j+1,m-1

-

s)

and

 i=1

dta-1,iBi,m(s)ds

=

1 m

 i=1

25

dat-1,i(wi+m - wi). In the third equality, we made the substitution of z =  - s. For

the fourth equality, we made use of the formula:

 -

Bj,m(z)dz

=

wj +m+1 -wj +1 m+1

 h=1

Bh,m+1( ), and truncating the sum up till the J-th term. We also swapped the

notation j for the first summation with h in the fourth equality.

A.2 Proof of Theorem 3.1

Fix  > 0. We only need to show that

P (DJn  MJnn = ) = 0, because if (12) holds, then with probability 1

inf
MJnn

H (0|Jn

,

)



H (0|Jn

,

Jn )

-

,

for all n sufficiently large. Since  is arbitrary, and

H(0|Jn , Jn )  H(0|Jn , 0|Jn ), by condition C2 we deduce

lim

inf

inf
MJnn

H (0|Jn

,

)



H (0|Jn

,

0|Jn

)

a.s.

Combining with

we have,

H(0|Jn , )  H(0|Jn , 0|Jn ),

lim
n+

sup
MJnn

|H (0|Jn

,

)

-

H (0|Jn

,

0|Jn

)|

=

0

a.s.

Fix  > 0, and for each n choose n  MJnn such that d(0|Jn , n) > sup d(0|Jn , )) - .
1 + d(0|Jn , n) MJnn 1 + d(0|Jn , ))

(12) (13)

26

Condition C1 combined with (13) imply that

Hence,

d(0|Jn , n)  0 a.s. lim sup sup d(0|Jn , ))  .
MJnn 1 + d(0|Jn , ))

Since  is arbitrary, we deduce that MJnn  0|Jn , which is the desired result. Therefore, it suffices to prove (12).

For now, n and Jn are fixed. Then

(DJn  MJnn = )

 sup (X1(a), ∑ ∑ ∑ , Xn(a), X1(b), ∑ ∑ ∑ , Xn(b); )  (X1(a), ∑ ∑ ∑ , Xn(a), X1(b), ∑ ∑ ∑ , Xn(b); Jn)
DJn

lJn

k=1

n
sup g Xi(a), Xi(b), Xi(-a)1, Xi(-b)1, 
k i=1

n
 g Xi(a), Xi(b), Xi(-a)1, Xi(-b)1, Jn
i=1

lJn

k=1

n
g Xi(a), Xi(b), Xi(-a)1, Xi(-b)1, k
i=1

n
 g Xi(a), Xi(b), Xi(-a)1, Xi(-b)1, Jn
i=1

.

Next we bound the probability of this latter set and called it .

lJn
 P

nn

g Xi(a), Xi(b), Xi(-a)1, Xi(-b)1, k 

g Xi(a), Xi(b), Xi(-a)1, Xi(-b)1, Jn

k=1

i=1

i=1

lJn n
= P exp

k=1

i=1

tk

log

g(Xi(a), Xi(b), Xi(-a)1, Xi(-b)1, k) g(Xi(a), Xi(b), Xi(-a)1, Xi(-b)1, Jn )

1

lJn
 E0|Jn
k=1

exp

tk

log

g(Xt(a), Xt(b), Xt(-a)1, Xt(-b)1, k) g(Xt(a), Xt(b), Xt(-a)1, Xt(-b)1, Jn )

n

for any nonnegative arbitrary t1, ∑ ∑ ∑ , tk and conditionally to Xi(-a)1 and Xi(-b)1, the laws of the real r.v. g(Xi(a), Xi(b), Xi(-a)1, Xi(-b)1, k) and g(Xi(a), Xi(b), Xi(-a)1, Xi(-b)1, Jn) are
images of g by the translations of the laws i which are i.i.d. Hence, we get

  lJn(Jn)n.

27

Finally, result (12) is deduced by condition (ii) of Theorem 3.1 and by the BorelCantelli lemma.

A.3 Proof of consistency result in Theorem 3.2

Without loss of generality, we assume that pja and pjb are all zeros. For non-zero cases, the same consistency results can be obtained. We check the condition C1. We replace Jn by J in the remaining of this section for notational simplicity, and let all summation be from 1 to J. Using the definition of the entropy, we have

H(0|J , 0|J ) - H(0|J , J ) = H(0|J , 0|J ) - H(0|J , J )

=

-1 2

log

|u|

+

1 2

log

|u,J |

+

E

- 1x 2

-u 1x

+

1 2

xJ

-u,1J

xJ

,

where

dat,1 -







x = dat,J -

 

dbt,1

-







dbt,J -

i(

j

qj cjaa

-

c1aa)

wi+m-wi m

dta-1,i

-

...

i(

j

qj caj a

-

cJaa)

wi+m-wi m

dta-1,i

-

i(

j

qj cjba

-

c1ba)

wi+m-wi m

dta-1,i

-

...

i(

j

qj cbja

-

cbJa)

wi+m-wi m

dta-1,i

-

i(

j

qj cjab

-

ca1b)

wi+m -wi m

dtb-1,i







i( i(

j j

qj caj b qj cjbb

- -

caJb)

wi+m -wi m

dtb-1,i

  

cb1b

)

wi+m-wi m

dbt-1,i

 

,







i(

j

qj cbjb

-

cbJb)

wi+m-wi m

dbt-1,i

dta,1 -







xJ

=

dat,J

 

dtb,1

- -







dbt,J -

i(

j

qj cja,aJ

-

ca1,aJ

)

wi+m-wi m

dta-1,i

-

...

i(

j

qj cja,aJ

-

cJa,aJ

)

wi+m-wi m

dta-1,i

-

i(

j

qj cjb,aJ

-

cb1a,J

)

wi+m-wi m

dta-1,i

-

...

i(

j

qj cbj,aJ

-

cbJa,J

)

wi+m-wi m

dta-1,i

-

i(

j

qj cja,bJ

-

ca1,bJ

)

wi+m-wi m

dbt-1,i







i( i(

j j

qj cja,bJ qj cjb,bJ

- -

cJa,bJ

)

wi+m -wi m

 dbt-1,i

c1bb,J

)

wi+m-wi m

dbt-1,i

 

.







i(

j

qj cjb,bJ

-

cbJb,J

)

wi+m -wi m

dbt-1,i

Here u, caja, cajb, cjba, and cbjb denote the covariance matrix and B-spline coefficients for the kernel 0|J ; and u,J , cja,aJ , cja,bJ , cbj,aJ , and cbj,bJ denote the covariance matrix and B-spline coefficients for the kernel J . J is the set of kernel functions for J with J  J ; and 0|J is the projection of the set of true kernel functions 0 on J .

28

Assuming u = u,J , we have

H(0|J , 0|J ) - H(0|J , J ) = E

- 1x 2

-u 1x

+

1 2

xJ

u-1xJ

1 =
2

(u-1)r,sE (xJ )r(xJ )s - (x)r(x)s ,

r,s

where (-u 1)r,s is the r-th row, s-th column of -u 1, (xJ )r is the r-th element of xJ , and (x)r is the r-th element of x.
Since the only difference between (xJ )r(xJ )s and (x)r(x)s are the different Bspline coefficients, we can group the individual terms of the expansion of (xJ )r(xJ )s and the expansion (x)r(x)s together. After cancelling out the common terms not containing the B-spline coefficients, each of the grouped terms will contain a product of some common terms and the subtraction between the B-spline coefficients (of the same index) of the two kernels or the subtraction between the product of B-spline coefficients of one kernel and that of the other kernel (of the same combination of indices). Hence, if H(0|J , J )  H(0|J , 0|J ) as n, J  , we have cja,aJ  cjaa, caj,bJ  cjab, cbj,aJ  cbja, cjb,bJ  cjbb and consequently J  0|J .
For the condition C2 and (i) of Theorem 3.1, we follow similar arguments as in Mourid and Bensmain (2006). To verify Theorem 3.1 (ii), we define

(t) = E0|J

exp

t

log

g(Xt(a), Xt(b), g(Xt(a), Xt(b),

Xt(-a)1, Xt(-b)1, k) Xt(-a)1, Xt(-b)1, J )

,

where g(Xt(a), Xt(b), Xt(-a)1, Xt(-b)1, k) = supk g(Xt(a), Xt(b), Xt(-a)1, Xt(-b)1, ).

more, we have (0) = 1 and 

= E log .0|J

g(Xt(a) ,Xt(b) ,Xt(-a)1 ,Xt(-b)1 ,k ) g(Xt(a),Xt(b),Xt(-a)1,Xt(-b)1,J )

Further-

For a fixed   k, we have

A = E0|J log g(Xt(a), Xt(b), Xt(-a)1, Xt(-b)1, k) - E log g(Xt(a), Xt(b), Xt(-a)1, Xt(-b)1, )

=

E0|J

sup
k

log g(Xt(a), Xt(b), Xt(-a)1, Xt(-b)1, ) - log g(Xt(a), Xt(b), Xt(-a)1, Xt(-b)1, )

=

E0|J

sup
k

-

1 2

log

|u, |

+

1 2

log

|u,|

-

1 2

x

u-,1

x

+

1 2

x

-u,1

x

,

where x and x have the same form as xJ , with J replaced by  and  respectively. u,, cja,a, cja,b, cjb,a, and cjb,b denote the covariance matrix and B-spline coefficients for the kernel , while u,, caj,a, caj,b, cbj,a, and cjb,b denote that for the kernel .

29

Assuming u, = u, = u, we have

A

=

E0|J

sup
k

1 2

(u-1)r,s (x)r(x)s - (x)r(x)s

r,s

,

where (u-1)r,s is the r-th row, s-th column of -u 1, (x)r is the r-th element of x, and (x)r is the r-th element of x.

We follow the similar conditions and arguments in Mourid and Bensmain (2006)

and

obtain

A



,C1
J /2

where

C1

is

a

constant.

In

addition,

for



>

0,

 (0) = H(0|J , ) - H(0|J , J ) + A  C2J -/2 - .

Using Taylor expansion and the results from Hwang (1980) such that  (t) 

C3J 2,

we

have

(

1 J2

)



1

-

,
C4J 2

where

C2,

C3,

and

C4

are constants.

Since J

=

supk inft0 (t), we can deduce that for sufficiently large J, we have

lJ (J )n  CJ CJ1+

1-  CJ2

n,

which is summable if J = O(n1/3-) for  > 0 (see Hwang, 1980). Note that C is a constant. Finally, we can apply Theorem 3.1 to obtain the result that the ML estimator  obtained on Jn converges to the projected true set of kernel functions 0|J . As n, Jn  , 0|J  0 because each xy,0|J in 0|J is just the B-spline truncation of the corresponding true kernel xy,0 in 0 on Jn.

References
A®it-Sahalia, Y., Mykland, P. and Zhang, L. (2005). How often to sample a continuoustime process in the presence of market microstructure noise, Review of Financial Studies 18: 351≠416.
Antoniadis, A. and Sapatinas, T. (2003). Wavelet methods for continuous-time prediction using hilbert-valued autoregressive processes, Journal of Multivariate Analysis 87: 135≠158.
Benston, G. and Hagerman, R. (1974). Determinants of bid-asked spreads in the over-the-counter market, Journal of Financial Economics 1: 353≠364.

30

Besse, P., Cardot, H. and Stephenson, D. (2000). Autoregressive forecasting of some functional climatic variations, Scandinavian Journal of Statistics 27: 673≠687.
Bosq, D. (2000). Linear Processes in Function Spaces: Theory and Applications, Springer, New York.
C∏ etin, U., Jarrow, R. and Protter, P. (2004). Liquidity risk and arbitrage pricing theory, Finance and Stochastics 8: 311≠341.
Chen, Y. and Li, B. (2015). An adaptive functional autoregressive forecast model to predict electricity price curves, Journal of Business and Economic Statistics, (Accepted).
Chordia, T., Sarkar, A. and Subrahmanyam, A. (2003). An empirical analysis of stock and bond market liquidity, Federal Reserve Bank of New York Staff Reports 164.
Cooper, K., Groth, J. and Avera, W. (1985). Liquidity, exchange listing, and common stock performance, Journal of Economics and Business 37: 19≠33.
Dierker, M., Kim, J.-W., Lee, J. and Morck, R. (2014). Interacting limit order demand and supply curves, Alberta School of Business, working paper .
Fleming, M. and Remolona, E. (1999). Price formation and liquidity in the U.S. treasury market: The response to public information, Journal of Finance 54: 1901≠ 1915.
Geman, S. and Hwang, C.-R. (1982). Nonparametric maximum likelihood estimation by the method of sieves, Annals of Statistics 10: 401≠414.
Gomber, P., Schweickert, U. and Theissen, E. (2015). Liquidity dynamics in an electronic open limit order book: An event study approach, European Financial Management 21: 52≠78.
Grenander, U. (1981). Abstract inference, Wiley, New York.
Groﬂ-Kluﬂmann, A. and Hautsch, N. (2013). Predicting bid ask spreads using long-memory autoregressive conditional Poisson models, Journal of Forecasting 32(8): 724≠742.
Guillas, S. (2001). Rates of convergence of autocorrelation estimates for autoregressive hilbertian processes, Statistics & Probability Letters 55: 281≠291.
31

Ha®rdle, W., Hautsch, N. and Mihoci, A. (2012). Modelling and forecasting liquidity supply using semiparametric factor dynamics, Journal of Empirical Finance 19: 610≠625.
Ha®rdle, W., Hautsch, N. and Mihoci, A. (2015). Local adaptive multiplicative error models for high-frequency forecasts, Journal of Applied Econometrics 30(4): 529≠ 550.
Huberman, G. and Halka, D. (2001). Systematic liquidity, Journal of Financial Research 24: 161≠178.
Hwang, C. (1980). Gaussian measure of large balls in a hilbert space, Proceedings of the American Mathematical Society 78: 107≠110.
Kim, M., Chaudhuri, K. and Shin, Y. (2015). Forecasting distribution of inflation rates: A functional autoregressive approach, Journal of the Royal Statistical Society Series A, Statistics in Society, (Early online publication).
Kokoszka, P. and Zhang, X. (2010). Improved estimation of the kernel of the functional autore-gressive process, Technical report, Utah State University .
Mourid, T. and Bensmain, N. (2006). Sieves estimator of the operator of a functional autoregressive process, Statistics & Probability Letters 76: 93≠108.
Stoll, H. (1978). The pricing of security dealer services: An empirical study of nasdaq stocks, Journal of Finance 33: 1153≠1172.
Zhang, L., M. P. and A®it-Sahalia, Y. (2005). A tale of two time scales: Determining integrated volatility with noisy high-frequency data, Journal of the American Statistical Association 100(472): 1394≠1411.
32

SFB 649 Discussion Paper Series 2016
For a complete list of Discussion Papers published by the SFB 649, please visit http://sfb649.wiwi.hu-berlin.de.

001
002 003
004 005 006
007 008 009 010
011 012
013 014
015 016 017
018 019 020

"Downside risk and stock returns: An empirical analysis of the long-run and short-run dynamics from the G-7 Countries" by Cathy Yi-Hsuan Chen, Thomas C. Chiang and Wolfgang Karl H‰rdle, January 2016. "Uncertainty and Employment Dynamics in the Euro Area and the US" by Aleksei Netsunajev and Katharina Glass, January 2016. "College Admissions with Entrance Exams: Centralized versus Decentralized" by Isa E. Hafalir, Rustamdjan Hakimov, Dorothea K¸bler and Morimitsu Kurino, January 2016. "Leveraged ETF options implied volatility paradox: a statistical study" by Wolfgang Karl H‰rdle, Sergey Nasekin and Zhiwu Hong, February 2016. "The German Labor Market Miracle, 2003 -2015: An Assessment" by Michael C. Burda, February 2016. "What Derives the Bond Portfolio Value-at-Risk: Information Roles of Macroeconomic and Financial Stress Factors" by Anthony H. Tu and Cathy Yi-Hsuan Chen, February 2016. "Budget-neutral fiscal rules targeting inflation differentials" by Maren Brede, February 2016. "Measuring the benefit from reducing income inequality in terms of GDP" by Simon Voigts, February 2016. "Solving DSGE Portfolio Choice Models with Asymmetric Countries" by Grzegorz R. Dlugoszek, February 2016. "No Role for the Hartz Reforms? Demand and Supply Factors in the German Labor Market, 1993-2014" by Michael C. Burda and Stefanie Seele, February 2016. "Cognitive Load Increases Risk Aversion" by Holger Gerhardt, Guido P. Biele, Hauke R. Heekeren, and Harald Uhlig, March 2016. "Neighborhood Effects in Wind Farm Performance: An Econometric Approach" by Matthias Ritter, Simone Pieralli and Martin Odening, March 2016. "The importance of time-varying parameters in new Keynesian models with zero lower bound" by Julien Albertini and Hong Lan, March 2016. "Aggregate Employment, Job Polarization and Inequalities: A Transatlantic Perspective" by Julien Albertini and Jean Olivier Hairault, March 2016. "The Anchoring of Inflation Expectations in the Short and in the Long Run" by Dieter Nautz, Aleksei Netsunajev and Till Strohsal, March 2016. "Irrational Exuberance and Herding in Financial Markets" by Christopher Boortz, March 2016. "Calculating Joint Confidence Bands for Impulse Response Functions using Highest Density Regions" by Helmut L¸tkepohl, Anna StaszewskaBystrova and Peter Winker, March 2016. "Factorisable Sparse Tail Event Curves with Expectiles" by Wolfgang K. H‰rdle, Chen Huang and Shih-Kang Chao, March 2016. "International dynamics of inflation expectations" by Aleksei Netsunajev and Lars Winkelmann, May 2016. "Academic Ranking Scales in Economics: Prediction and Imdputation" by Alona Zharova, Andrija Mihoci and Wolfgang Karl H‰rdle, May 2016.

SFSBF6B4694, 9S,pSapnadnaduaeureSrtrSatﬂraeﬂ1e, 1D,-D10-1107187B8eBrleinrlin htthpt:t/p/:/s/fbs6fb4694.w9.iwwiiw.hiu.h-bue-brleinrl.idne.de
ThTishrisesreasercahrcwhawsassupsuppoprtoerdtebdybtyhethDeeDuetsucthseche ForFsocrhsuchnugnsgesgmeeminesicnhsachftatfht rtohuroguhgthhethSeFSBF6B4694"9Ec"oEnconmoimc RicisRki"s.k".

SFB 649 Discussion Paper Series 2016
For a complete list of Discussion Papers published by the SFB 649, please visit http://sfb649.wiwi.hu-berlin.de.
021 "CRIX or evaluating blockchain based currencies" by Simon Trimborn and Wolfgang Karl H‰rdle, May 2016.
022 "Towards a national indicator for urban green space provision and environmental inequalities in Germany: Method and findings" by Henry W¸stemann, Dennis Kalisch, June 2016.
023 "A Mortality Model for Multi-populations: A Semi-Parametric Approach" by Lei Fang, Wolfgang K. H‰rdle and Juhyun Park, June 2016.
024 "Simultaneous Inference for the Partially Linear Model with a Multivariate Unknown Function when the Covariates are Measured with Errors" by Kun Ho Kim, Shih-Kang Chao and Wolfgang K. H‰rdle, August 2016.
025 "Forecasting Limit Order Book Liquidity Supply-Demand Curves with Functional AutoRegressive Dynamics" by Ying Chen, Wee Song Chua and Wolfgang K. H‰rdle, August 2016.
SFSBF6B4694, 9S,pSapnadnaduaeureSrtrSatﬂraeﬂ1e, 1D,-D10-1107187B8eBrleinrlin htthpt:t/p/:/s/fbs6fb4694.w9.iwwiiw.hiu.h-bue-brleinrl.idne.de
ThTishrisesreasrecahrcwhawsassupsuppoprtoerdtebdybtyhethDeeDuetsucthseche ForFsocrhsuchnugnsgesgmeeminesicnhsachftatfht rtohuroguhgthhethSeFSBF6B4694"9Ec"oEnconmoimc RicisRki"s.k".

