BERLIN

SFB 6 4 9 E C O N O M I C R I S K

SFB 649 Discussion Paper 2011-083
Equilibrium Pricing in Incomplete Markets under
Translation Invariant Preferences
Patrick Cheridito* Ulrich Horst**
Michael Kupper** Traian A. Pirvu***
* Princeton University, USA ** Humboldt-Universität zu Berlin, Germany *** McMaster University Hamilton, Canada
This research was supported by the Deutsche Forschungsgemeinschaft through the SFB 649 "Economic Risk".
http://sfb649.wiwi.hu-berlin.de ISSN 1860-5664
SFB 649, Humboldt-Universität zu Berlin Spandauer Straße 1, D-10178 Berlin

Equilibrium Pricing in Incomplete Markets under Translation Invariant Preferences
Patrick Cheridito, Ulrich Horst, Michael Kupper§, Traian A. Pirvu¶
February, 2011
Abstract
We provide results on the existence and uniqueness of equilibrium in dynamically incomplete financial markets in discrete time. Our framework allows for heterogeneous agents, unspanned random endowments and convex trading constraints. In the special case where all agents have preferences of the same type and all random endowments are replicable by trading in the financial market we show that a one-fund theorem holds and give an explicit expression for the equilibrium pricing kernel. If the underlying noise is generated by finitely many Bernoulli random walks, the equilibrium dynamics can be described by a system of coupled backward stochastic difference equations, which in the continuous-time limit becomes a multi-dimensional backward stochastic differential equation. If the market is complete in equilibrium, the system of equations decouples, but if not, one needs to keep track of the prices and continuation values of all agents to solve it. As an example we simulate option prices in the presence of stochastic volatility, demand pressure and short-selling constraints.
JEL classification: C62, D52, D53
Keywords: Competitive equilibrium, incomplete markets, heterogenous agents, trading constraints, backward stochastic difference equations.
We thank Hansjoerg Albrecher, Philippe Artzner, Markus Brunnermeier, Freddy Delbaen, Ivar Ekeland, Damir Filipovi´c, Gregor Heyne, Julien Hugonnier, Christoph Mainberger, Roger Wets and Alexander Wugalter for fruitful discussions and helpful comments.
ORFE, Princeton University, Princeton, NJ 08544, USA. Financial support from NSF Grant DMS-0642361 is gratefully acknowledged
Humboldt-Universita¨t zu Berlin, Department of Mathematics, Unter den Linden 6, 10099 Berlin, Germany and Quantitative Products Laboratory, Alexanderstrasse 5, 10178 Berlin, Germany. Financial support from the SFB 649 Economic Risk is gratefully acknowledged.
§Humboldt-Universita¨t zu Berlin, Department of Mathematics, Unter den Linden 6, 10099 Berlin, Germany. Financial support from the Vienna Science and Technology Fund (WWTF) is gratefully acknowledged.
¶Department of Mathematics & Statistics, McMaster University, 1280 Main Street West, Hamilton, ON, Canada L8S 4K1. Financial support from NSERC 371653-09 is gratefully acknowledged.
1

1 Introduction
We consider an equilibrium framework to price financial securities in dynamically incomplete markets in discrete time. Our main interest is in equilibrium prices of derivatives or structured products with maturities T that are short compared to the time horizon of a typical life-time consumption-investment problem. So the risk of fluctuating interest rates does not play a big role, and we assume them to be exogenously given. We suppose our agents invest in the financial market with the goal of optimizing the utility of their wealth at time T . Our setup is flexible enough to accommodate heterogeneous agents, unspanned random endowments and convex trading constraints. In dynamic models with general preferences, several consumption goods and incomplete security markets an equilibrium does not always exist, and if there is one, it is typically not unique. For an overview of equilibria with incomplete markets we refer to the review articles by Geanakoplos (1990) and Magill and Shafer (1991) or the textbook by Magill and Quinzii (1996).
In this paper money is the only consumption good and all agents are assumed to have translation invariant preferences that are updated in a time-consistent way as new information is becoming available. This allows us to prove existence and uniqueness of an equilibrium under general assumptions by backward induction. Typical examples of translation invariant preferences are those induced by expected exponential utility, the monotone mean-variance preferences of Maccheroni et al. (2009), mean-risk type preferences where risk is measured with a convex risk measure, optimized certainty equivalents a` la Ben-Tal and Teboulle (1986, 1987) or the divergence utilities of Cherny and Kupper (2009). The assumption of translation invariant preferences is appropriate if, for instance, agents are understood as banks or insurance companies which evaluate investments in terms of expected values and risk capital, that is, buffer capital that needs to be held to make an investment acceptable from a risk management point of view. Recently, Ga^rleanu et al. (2009) have modelled option dealers as expected exponential utility maximizers to describe the effects of demand pressure on options prices, and in Carmona et al. (2010) equilibrium prices for emission certificates have been studied under linear preferences. We assume there exist two kinds of assets. The first type of assets are liquidly traded in large volumes and their prices are not affected by the actions of our agents. Their dynamics will be exogenously given. Assets of the second kind entitle their holders to an uncertain payoff at time T . We think of them as derivatives or structured products which can also depend on non-financial risk such as temperature, rain or political events. They exist in fixed supply and are only traded by our agents. The goal is to price them by matching demand and supply. The situation where there are no exogenous instruments and all assets are priced in equilibrium is a special case. If assets of the second kind are issued by our agents and not bought by anybody else, they exist in zero net supply. On the other hand, if they are originated outside of our group of traders, they are in positive net supply. An example would be CO2-emission certificates designed and issued but not traded by the European Union. Similarly, if there is demand for them from outside of our group of traders, they will be in negative net supply. An example will be discussed in Subsection 5.2 below where end users are buying put options from a group of option dealers.
The standard way to price derivatives is to compute the expectation of their discounted payoffs under an equivalent martingale measure Q, that is, Q has the same null sets as the reference measure P and the discounted price of the underlying is a martingale (or local martingale) with respect to Q. Binomial tree models and the standard Black­Scholes model are complete, and there is
2

exactly one equivalent martingale measure. But extensions such as trinomial tree, GARCH-type, stochastic volatility or jump-diffusion models are incomplete and admit infinitely many equivalent martingale measures. The question then is, which one should be used for pricing. In practice, models are often built directly under Q, then calibrated to market prices of liquidly traded options and used to value more exotic ones; see for instance, Lipton (2002) for an overview of popular stochastic volatility models. Some pricing measures that have been discussed in the literature are the minimal martingale measure of Fo¨llmer and Schweizer (1991), the Esscher transformed measure proposed by Gerber and Shiu (1994), the variance-optimal martingale measure studied in Schweizer (1995, 1996) and Delbaen and Schachermayer (1996) or the minimal entropy martingale measure of Frittelli (2000). Recently, several authors have applied utility indifference arguments to the valuation of complex financial products; see for instance, Henderson and Hobson (2009) for an overview. But utility indifference prices are personal, reflecting the risk preferences of a single agent. Our approach provides a way of deriving the pricing rule from equilibrium considerations. We will show that if at least one agent has differentiable preferences and open trading constraints, then our pricing method is given by a probability measure Q that is absolutely continuous with respect to P. If in addition, the agent's preference functional is strictly monotone, Q will be equivalent to P. On the other hand, if agents have closed trading constraints, equilibrium prices in our model are not necessarily given by a linear functional; see also Hugonnier (2010) and the references therein for equilibrium models with constraints and rational asset pricing bubbles or Avellaneda and Lipkin (2009) for a dynamic model of stock and option prices under short-selling constraints.
Our method to prove existence of an equilibrium is to recursively construct one-time-step representative agents with preferences over the space of financial gains realizable by investing in the financial market. In every step we take a Negishi approach similar to Borch (1984) and Filipovi´c and Kupper (2008), where (constrained) Pareto optimal allocations and their relation to equlibrium prices are studied in static models with uncertainty. Since we work with translation invariant preferences, our one-time-step representative agents can be constructed as simple supconvolutions of the preference functionals of the single agents. But due to market incompleteness and trading constraints, optimal allocations have to be found in suitably restricted subsets. The consumption sets in our framework are unbounded from below. To guarantee the existence of an equilibrium we assume that each agent either is sensitive to large losses or has conditionally compact trading constraints. Sensitivity to large losses means that a position which will be negative in some states of the world is becoming unacceptable if it is multiplied with a sufficiently large constant, irrespective of its upside potential (a precise definition is given in Subsection 2.3 below). Our argument is based on the fact that for an agent which is sensitive to large losses, it is sufficient to search for optimal one-time-step strategies in conditionally compact sets. For different conditions and concepts of compactness in equilibrium models with consumption sets that are unbounded from below, we refer to Werner (1987), Cheng (1991), Brown and Werner (1995), Dana et al. (1997, 1999) and the references therein. Duffie (1987) has shown the existence of an equilibrium in in a model with complete spot markets and an incomplete market of purely financial securities. The proof is based on a fixed point argument and in general, his equilibrium is not unique. In Cuoco and He (2001) a static representative agent is constructed in an economy with incomplete securities markets. But in that paper an equilibrium does not always exist and the construction of the representative agent involves a sup-convolution of the single agents with stochastic weights. Anthropelos and Zitkovi´c (2010) show existence and uniqueness in a setup
3

similar to ours. There are agents with translation invariant preferences who negotiate the price of a bundle of contingent claims while they can invest in an incomplete market of exogenously given financial securities. But in contrast to our model, they only consider static investments in the contingent claims. Jofre et al. (2010) provide results on the existence of equilibrium in general models with incomplete market and money.
If uncertainty is generated by a finite event tree, our arguments can be carried out with standard finite-dimensional convex duality arguments. In the case of a general probability space we are confronted with infinite-dimensional spaces and need conditional analysis results from Cheridito et al. (2011). If an equilibrium exists and in addition, at least one agent has differentiable preferences and open constraints, we show that equilibrium prices are unique. To show uniqueness of the agents' optimal trading gains one needs strict convexity assumptions on the preferences. In the special case where all agents have preferences of the same type, for instance, expected exponential utility with different risk aversions, and at the same time, all random endowments are spanned by attainable trading gains, we show that a one-fund theorem holds. Under an additional differentiability assumption on the preferences, the equilibrium pricing kernel can be given in explicit form. If there are exogenous assets, the pricing kernel contains optimal trading gains from investing in them. Otherwise, similar to the standard CAPM, it just consists of the gradient of the base preference functional at the point corresponding to the sum of aggregate endowment and total supply of the financial assets. As an example we study the effects of stochastic volatility, demand pressure and short-selling constraints on prices of options on single stocks and indexes.
If the underlying noise is generated by finitely many Bernoulli random walks we show how equilibrium prices and optimal strategies can be obtained by solving a system of coupled BSEs (backward stochastic difference equations). This part of our work is related to Dumas and Lyasoff (2009), where under the assumption that an incomplete-market equilibrium exists, a method is developed to recursively compute it from first order conditions. In the continuous-time limit our system of BSEs becomes a multi-dimensional BSDE (backward stochastic differential equation). If the market turns out to be complete in equilibrium, both our systems of BSEs and BSDEs decouple. Conditions that guarantee market completeness in equilibrium have been studied in various frameworks; see for instance, Magill and Shafer (1990), Horst and Mu¨ller (2007), Anderson and Raimondo (2009) or Horst et al. (2010). However, if the market is incomplete in equilibrium, our equations do not decouple, and to solve it one has to keep track of the prices and the continuation values of all agents.
The remainder of the paper is organized as follows. In Section 2 we introduce the ingredients for our model together with the notation. In Section 3 we give a convex dual characterization of equilibrium and use it to show existence. In Section 4 we prove uniqueness of equilibrium prices if preferences are differentiable and uniqueness of optimal wealth dynamics if they satisfy a strict convexity property. Section 5 provides a one-fund theorem for the special case where agents have preferences of the same type and random endowments are replicable by trading in the financial market. As an application we discuss the effects of stochastic volatility, demand pressure and short-selling constraints on option prices. In Section 6 we assume that the noise is generated by finitely many Bernoulli random walks and characterize the equilibrium dynamics in terms of a coupled system of BSEs. All proofs are given in the appendix.
4

2 Notation and setup
We consider a finite group of agents A who trade in a financial market. Time is discrete and runs through the set {0, 1, ..., T }. Uncertainty is modeled by a probability space (, F, P). The flow of information is described by a filtration (Ft)tT=0. We assume that at time t, all agents have access to the information represented by Ft and all events in F0 have probability 0 or 1. P is a reference probability measures that does not necessarily reflect the beliefs of our agents. But we assume they all agree that an event A  F is impossible if P[A] = 0. L0(Ft) denotes the set of all Ft-measurable random variables and L(Ft) the set of essentially bounded random variables, where random variables are identified if they are equal P-almost surely. Accordingly, all equalities and inequalities between random variables will be understood in the P-almost sure sense. Expectation with respect to P is denoted by E. Notation for expectations with respect to other probability measures will be introduced where it is needed. Each agent a  A is initially endowed with an uncertain payoff Ha  L0(FT ) that is bounded from below. In the special case where the sample space  is finite, all random variables are bounded and the filtration (Ft) can be thought of as an event tree.

2.1 The financial market

All agents can lend funds to and borrow from a money market account at the same exogenously

given interest rate and invest in a financial market consisting of J + K assets. We use the money

market as numeraire, that is, all prices will be expressed in terms of the value of one dollar invested

in the money market at time 0. The prices of the first J assets are exogenously given by a J-

dimensional bounded adapted process (Rt)tT=0. Our agents can buy and sell arbitrary quantities of them without influencing their prices. The prices of the other K assets will be determined

endogenously by supply and demand. The k-th of them exists in net supply nk  R and yields a payoff of Sk  L(FT ) per share at the final time T . Our goal is to find equilibrium price processes (Stk)tT=0 satisfying the terminal conditions STk = Sk together with optimal investment strategies for all agents a  A. By n  RK we denote the vector with components nk and (St) is the K-dimensional process with components (Stk). In the special case J = 0, the prices of all assets are determined by supply and demand. The possibility to include exogenously given

assets in the model is helpful for the study of derivatives and structured products. For instance a

weather derivative might only be traded by an insurance company and a few end users. They can

also invest in large cap stocks. But while their demands will determine the price of the weather

derivative, they are too small to influence the stock prices.

A trading strategy for agent a  A is given by an RJ+K-valued predictable stochastic process

(ta)Tt=1, that is, ta is measurable with respect to Ft-1. By at ,R we denote the first J components

of to

t.at .Tat ,hSeayrde etshceribreemhaoiwninmganKy

shares of the assets R1, . . . , RJ agent a components of ta and model agent a's

is holding from investments in

time t - 1 the assets

S1, . . . , SK. The part of agent a's time t - 1 wealth not invested in the financial assets is kept in

the money market account. Since all prices are expressed in discounted terms, investments in the

money market do not change their value, and investor a's investment gains from time t - 1 to t

are given by

at ,R · Rt + ta,S · St := J at ,R,j Rtj + K at ,S,kStk,

j=1 k=1

5

where we denote Rtj := Rtj - Rtj-1 and Stk := Stk - Stk-1. We suppose there is no consumption or infusion of funds at intermediate times. So a strategy (at )tT=1 leads to a time T wealth of

Ha + T at ,R · Rt + at ,S · St.
t=1

We assume that the R-assets satisfy the following no-arbitrage condition:

(NA) No arbitrage in the R-assets: For every predictable trading strategy (t)tT=1 in the Rassets one has that

T t · Rt  0 implies
t=1

T t · Rt = 0.
t=1

By the Dalang­Morton­Willinger theorem (see Dalang et al., 1990) this is equivalent to the existence of a probability measure Q equivalent to P such that Rtj = EQ RTj | Ft for all j and t.

2.2 Trading constraints

We suppose that our agents face trading constraints described by sets Cta+1 of admissible one-step

strategies t+1  L0(Ft)J+K satisfying the following two conditions:

(C1) (C2)

There exist strategies ¯at+1  Cta+1 t+1 + (1 - )t+1  Cta+1 for all

 L(Ft)J+K such that t+1, t+1  Cta+1 and 


aA

¯at+,S1

=

n

 L0(Ft) such that

0







1.

Condition (C1) guarantees that there exists at least one admissible trading strategy for each

agent such that aggregate demand is equal to supply. For example, condition (C1) is fulfilled if

the S-assets exist in zero net supply and for all agents it is admissible to just keep their funds

in the money market account. (C2) is a conditional convexity condition which will be needed

in our proof that an equilibrium exists. In the case Cta+1 = L0(Ft)J+K , we say that agent a is unconstrained at time t.

For x  L0(Ft)J+K , we set

J+K

1/2

||x||Ft =

(xi)2

i=1

and say Cta+1 is Ft-bounded if there exists an Ft-measurable random variable Y such that ||x||Ft  Y for all x  Cta+1. Similarly, we call Cta+1 Ft-open if for every x  Cta+1 there exists an Ftmeasurable random variable  > 0 such that x  Cta+1 for all x  L0(Ft)J+K satisfying ||x - x||Ft  . We say Cta+1 is sequentially closed if it contains every x that is an almost sure limit of a sequence of elements in Cta+1.1

2.3 Translation-invariant preferences
Agent a's goal at time t  {0, ..., T } is to invest in the financial market so as to optimize a preference functional
Uta : L0(FT )  L0(Ft),
1Note that sequentially closed sets are not complements of Ft-open sets.

6

where L0(Ft) denotes the set of all Ft-measurable random variables with values in R  {-}. Usually, preference functionals take values in R. But our agents update their preferences as they learn about information contained in Ft. So their utilities at time t are Ft-measurable, and allowing Uta to take values in L0(Ft) instead of L0(Ft) allows for more interesting examples; see Examples 2.1 below. We will also need the larger sets L¯0(Ft) of Ft-measurable random variables with values in R  {±}.
We assume that Uta has the following properties:

(N) Normalization: Uta(0) = 0

(M) Monotonicity: Uta(X)  Uta(Y ) for all X, Y  L0(FT ) such that X  Y

(C) Ft-Concavity: Uta(X + (1 - )Y )  Uta(X) + (1 - )Uta(Y ) for all X, Y  L0(FT ) and   L0(Ft) such that 0    1, where 0(-) is understood to be 0

(T) Translation property: Uta(X + Y ) = Uta(X) + Y for all X  L0(FT ) and Y  L0(Ft)
Every preference functional Ut : L0(FT )  L0(Ft) satisfying Ut(0)  L0(Ft) can be normalized without changing the preference order by passing to Ut(X)-Ut(0). So one can assume (N) without loss of generality as soon as Uta(X) > -. The monotonicity assumption (M) is standard. It just means that more is preferred to less. Condition (C) is an extension of ordinary concavity to a situation where agents make decisions based on the information contained in Ft.2 Condition (T) means that our preference orders are invariant under a shift of random payoffs by certain amounts of cash. We need this assumption in our proof that an equilibrium exists. It is for instance satisfied by the certainty equivalent of expected exponential utility or mean-risk type preferences, and it covers the case of professional investors which maximize expectation under constraints on the amount of risk they are allowed to take; specific cases of preference functionals with the translation property (T) are discussed in Example 2.1 below.
Note that it follows from condition (C) that Uta has the following local property:

1AUta(X) = 1AUta(Y ) for all X, Y  L0(FT ) and A  Ft such that 1AX = 1AY.

(2.1)

Indeed, due to (C), one has 1AUta(X) = 1AUta(1AY + 1AcX)  1AUta(Y ) and by symmetry, 1AUta(X)  1AUta(Y ). That is, in the event A, the utility Ut(X) only depends on values X can attain in states of the world contained in A.
In addition to (N), (M), (C) and (T) we also assume that the preferences are time-consistent
in the following sense:

(TC) Time-consistency: For all X, Y  L0(FT ) and t = 0, . . . , T - 1, Uta+1(X)  Uta+1(Y ) implies Uta(X)  Uta(Y ).

(2.2)

By (N) and (T) one has Uta+1(Uta+1(X)) = Uta+1(X) for all random variables X belonging to the

domain

dom

Uta+1

:=

 X



L0(FT

)

:

Uta+1 (X )



L0(Ft+1) .

2Convex preferences correspond to quasi-concave preference functionals. However, quasi-concavity and the translation property (T) imply concavity; see Lemma 2.1 in Cheridito and Kupper (2009).

7

Applying (2.2) to the random variable Y = Uta+1(X) shows that time-consistency implies the following recursive structure of the preference functionals:

Uta(X) = Uta(Uta+1(X)) for all t = 0, ..., T - 1 and X  dom Uta+1.

(2.3)

For some of the results in this paper we will also need the preferences to satisfy one or more of the following conditions:

(SL) Sensitivity to large losses: lim U0a(X) = - for all X  L0(FT ) with the property P[X < 0] > 0.
(SM) Strict monotonicity: U0a(X) > U0a(Y ) for all X, Y  dom U0a such that X  Y and P[X > Y ] > 0.
(SC) Strict concavity modulo translation: U0a (X + (1 - )Y ) > U0a(X) + (1 - )U0a(Y ) for all   R with 0 <  < 1 and X, Y  dom U0a such that X - Y is not constant.
For example, we will prove that an equilibrium exists if all agents have sequentially closed trading constraints and either are sensitive to large losses or at every time t, the their constraints are Ft-bounded. Furthermore, we will show that if the market is in equilibrium and at least one agent has Ft-open constraints and strictly monotone preferences, then there exists an equilibrium pricing measure Q equivalent to P. In Section 4 we show that equilibrium prices are unique if at least one agent has differentiable preferences and Ft-open trading constraints. Moreover, we show that in equilibrium the optimal trading gains of all agents satisfying (SC) are unique. Note that since the functionals U0a have the translation property (T), they cannot be strictly concave under translations by constants. But condition (SC) will be sufficient for our purposes.

Examples 2.1

1. Entropic preference functionals

The standard example of preference functionals satisfying (N), (M), (C), (T), (TC) is given by the

conditional certainty equivalents of expected exponential utility, also called entropic preference

functionals:

Uta (X )

=

-

1 

log

E

[exp(- X )

|

Ft]

for a constant  > 0.

(2.4)

They induce the same preferences as the conditional expected exponential utilities E [exp(-X) | Ft]. But only in the form (2.4) do they have the translation property (T). U0a also satisfies (SL), (SM) and (SC). (SL) and (SM) are obvious. (SC) follows from Theorem 5.3 in Cheridito and Li (2009).

2. Pasting together one-step preference functionals

A general method of constructing time-consistent preference functionals in discrete time is by pasting together one-step preference functionals. Assume, for instance, that

vt : L(Ft+1)  L(Ft), t = 0, . . . , T - 1,

are mappings with the properties (N), (M), (C) and (T) such that the extensions

Vt (X )

=

lim
n

lim
m-

vt((X



n)



m)

map

L0(Ft+1)

to

L0(Ft).

(2.5)

8

(general conditions for this to be true are given in Cheridito et al., 2006). In Example 5 below

we provide a wide class of functionals for which it can be shown directly that (2.5) holds. Then

the compositions

Ut(X) = Vt  · · ·  VT -1(X), X  L0(FT )

(2.6)

inherit (N), (M), (C), (T) and are automatically time-consistent.

In the sequel we give some specific examples of one-step preference functionals vt : L(Ft+1)  L(Ft).

3. Monotone mean-variance preferences

Standard conditional mean variance

MVt (X)

=

E

[X

|

Ft]

-

 2

Var(X

|

Ft)

fulfills (N), (C), (T) but not the monotonicity property (M); see for instance, Maccheroni et al.

(2009). This can be corrected by slightly modifying its dual representation. For X  L(F1),

MV0 (X) has a dual representation of the form



MV0 (X)

=

inf
E1

E

X + G() | Ft

,

where This extends to

E1

=

 



L1(F1)

:

E

[]

=

 1

and

G(x)

=

1 2

(x

-

1)2.



MVt (X )

=

ess inf
Et+1

E

X + G() | Ft

,

X  L(Ft+1),

(2.7)

where

Et+1

=

 



L1(Ft+1)

:

E

[

|

Ft]

=

 1

and ess inf denotes the largest lower bound of a family of random variables with respect to the

P-almost sure order; see for instance, Proposition VI.1.1 of Neveu (1975). If one modifies (2.7) to



vt (X )

=

ess inf
Dt+1

E

X + G() | Ft

,

(2.8)

for

Dt+1

=

 



L1(Ft+1)

:





0,

E

[

|

Ft]

=

 1

,

one obtains one-step preference functionals satisfying (N), (M), (C), (T). They belong to the class of divergence utilities, which are shown to satisfy condition (2.5) in Example 5 below.

4. Mean-risk preferences
Instead of modifying mean-variance as in (2.8), one can also replace the variance term by a convex risk measure and set

vt(X) = E [X | Ft] - (1 - )t(X),

(2.9)

9

where  is a number in (0, 1) and
t : L(Ft+1)  L(Ft)
a normalized conditional convex risk measure, that is, -t satisfies (N), (M), (C) and (T); see F¨ollmer and Schied (2004) for an introduction to convex risk measures in a static framework and Cheridito and Kupper (2009) for dynamic risk measures. Whether condition (2.5) holds depends on .

5. Divergence utilities

The monotone mean-variance preference functional (2.8) can be generalized by replacing the func-

tion G with a more general divergence function G : R+  R such that ess infDt+1 E [G() | Ft] =

0. Then

vt (X )

=

ess inf
Dt+1

E

[X 

+

G()

|

Ft]

,

(2.10)

has all the properties (N), (M), (C), (T). For suitable functions H : R  R, optimized certainty

equivalents

ess sup {s - E [H(s - X) | Ft]}
sR

(2.11)

are of this form (ess sup denotes the least upper bound of a family of random variables in the
P-almost sure order). For instance, if H is increasing and convex such that maxxR(x-H(x)) = 0, then (2.11) is of the form (2.10) with

G(y) = H(y) = sup {xy - H(x)} .
xR

E [G()] is an f-divergence after Csiszar (1967).

In the special case G(x) =

1 

x

log(x)

it

is

rela-

tive entropy and vt becomes the entropic preference functional of Example 2.1.1. Unconditional

functionals of the form (2.10) and (2.11) have, for instance, been studied in the papers Ben-Tal

and Teboulle (1987), Cheridito and Li (2009) or Cherny and Kupper (2009). It is shown in the

appendix that the extensions

and that

Vt (X )

=

lim
n

lim
m-

vt((X



n)



m)

satisfy (2.5)

U0 = V0  · · ·  VT -1 is sensitive to large losses.

(2.12) (2.13)

2.4 Definition of equilibrium

At every time t = 0, 1..., T - 1 the goal of each agent a  A is to invest in such a way that

the utility of final wealth becomes maximal. Having invested according to some trading strategy

1a, ..., at up to time t the agent's optimization problem is given by

 T



ess sup Uta Ha + sa,R · Rs + as,S · Ss .

saCsa , st+1

s=1

(2.14)

10

But

since

Uta

has

the

translation

property

(T),

Uta

 Ha

+

T
s=1

sa,R

·

Rs

+

sa,S

·

 Ss

can

be

written as

 T

 t

Uta Ha +

as,R · Rs + sa,S · Ss + as,R · Rs + sa,S · Ss.

s=t+1

s=1

So (2.14) is equivalent to

 T



ess sup Uta Ha +

sa,R · Rs + as,S · Ss .

saCsa , st+1

s=t+1

(2.15)

We say the market is in equilibrium if the following holds:

Definition 2.2 An isfying the terminal

ceoqnudiliitbiorinumSTco=nsSisttsogoefthaerbowuinthdeadd, mRiKss-ivbaleluterda,diandgapsttreadtepgrioecses(s^at()StT=t )1tT=f0orsaatl-l

agents a  A, such that the following two conditions hold:

(i) Individual optimality

 T



T



Uta Ha +

^as,R · Rs + ^sa,S · Ss  Uta Ha +

sa,R · Rs + sa,S · Ss

s=t+1

s=t+1

for all t = 0, . . . , T - 1 and admissible continuation strategies (as )Ts=t+1.

(ii) Market clearing


aA

^ta,S

=

n

for all

t = 1, . . . , T .

Remark 2.3 If U0a is strictly monotone, then individual optimality at all times t follows from

the time 0 optimality condition

U0a

 Ha

+

T ^as,R

·

Rs

+

^sa,S

·

 Ss



U0a

 Ha

+

T

sa,R

·

Rs

+

sa,S

·

 Ss

(2.16)

s=1 s=1

for all admissible strategies (as )Ts=1. Indeed, let us assume to the contrary that (2.16) holds but

there exist t  1 and an admissible continuation strategy (sa)sT=t+1 such that

 Uta Ha +

T

 ^sa,R · Rs + ^as,S · Ss < Uta Ha +

T

 sa,R · Rs + as,S · Ss

s=t+1

s=t+1

on an Ft-measurable set A with P[A] > 0. Then by time-consistency, one has

U0a

 Ha

+

T

^as,R

·

Rs

+

^as,S

·

 Ss

=

U0a

t

s=1
^as,R ·

Rs

+

^sa,S

·

Ss

+

Uta

 Ha

+

T

 ^as,R · Rs + ^as,S · Ss

<

U0a

s=t 1

^sa,R

·

Rs

+

^as,S

·

Ss

+

Uta

 Ha

+

s=t+1
T ~sa,R

·

Rs

+

~as,S

·

 Ss

=

U0a

s=1 Ha

+

t

^as,R

·

Rs

+

^sa,S

·

Ss

+

T

s=t+1
~sa,R ·

Rs

+

~sa,S

·

 Ss

s=1 s=t+1

11

for the admissible strategies ~as = 1Ac^sa + 1Asa, s = t + 1, . . . , T . But this contradicts (2.16).

3 Dual characterization and existence of equilibrium

In complete markets, competitive equilibria are Pareto optimal and every Pareto optimal al-

location can be supported as an equilibrium by constructing a suitable representative agent.

A standard way of proving existence of an equilibrium in complete markets is therefore via a

representative agent. The specific choice of the representative agent typically depends on the

equilibrium to be supported and the proof involves complex fixed-point arguments. However, for

translation invariant preferences the situation turns out to be simpler, and we will be able to

take a representative agent approach to construct an equilibrium step by step going backwards in

time even if markets are incomplete. Assume that equilibrium prices St+1, ..., ST and admissible trading strategies ^at+2, ..., ^aT for all agents a  A have already been determined such that the components of St+1, ..., ST are bounded. We then define the continuation value of agent a  A at time t + 1 by

 Hta+1 = Uta+1 Ha +

T

 ^as,R · Rs + ^sa,S · Ss

s=t+2

and HTa = Ha.

(3.1)

Since we assumed Ha to be bounded from below and there exist bounded admissible one-step

strategies ¯as , s = t + 2, . . . , T , there is a constant c  R such that

 T

  T



Hta+1 = Uta+1 Ha +

^as,R · Rs + ^as,S · Ss  Uta+1 Ha +

¯sa,R · Rs + ¯sa,S · Ss  c.

s=t+2

s=t+2

In particular, Hta+1 belongs to L0(Ft) and the following recursive relation holds:

Hta+1

=

 Uta+1 Uta+2 H a +

T

 ^sa,R · Rs + ^sa,S · Ss + ^at+,R2 · Rt+2 + ^at+,S2 · St+2

 s=t+3



= Uta+1 Hta+2 + ^at+,R2 · Rt+2 + ^ta+,S2 · St+2 .

The usual approach of defining a representative agent in a complete market framework would be to pool all available resources and redistribute them in a socially optimal manner. But in our model the agents cannot pool and redistribute resources arbitrarily. They can only exchange their risk exposures by trading the financial assets. In addition, they are subject to trading constraints. To account for that we construct a one-step representative agent at time t with preferences over one-step gains that can be realized by taking admissible positions in the financial market. This will allow us to construct equilibrium prices St, continuation values Hta and optimal strategies ^at+1 recursively from St+1 and Hta+1. Observe that agent a's time-t utility from investing according to an admissible one-step trading strategy ta+1  Cta+1 would be
Uta(Hta+1 + ta+,R1 · Rt+1 + at+,S1 · St+1).

12

We want to extend this to any ta+1  L0(Ft)J+K by setting it equal to - for those    where the trading constraints are violated. This can be done in an Ft-measurable way by defining

 u~at (at+1) :=

Uta(Hta+1 + ta+,R1 · Rt+1 + ta+,S1 · St+1) -

on on

the the

set set

ccttaa((taat++11))

= =

 1 0

,

(3.2)

where cta(ta+1) is the Ft-measurable function cat (at+1) = ess supt+1Cta+1 1{t+1=at+1}. However, at this point, St is not known yet. So we replace the increment St+1 in (3.2) by St+1 and define the mapping uat : L0(Ft)J+K  L0(Ft) by

uat (at+1)

:=



Uta(Hta+1 + at+,R1

· Rt+1 + at+,S1 -

· St+1)

on on

the the

set set

cctata((atat++11))

= =

 1 0

.

(3.3)

The role of the one-step representative agent at time t will be played by the conditional sup-

convolution

u^t(x) =

ess sup

ta+1aAL0at(+,FS1t

)J =

+K
x

 uta at+1 ,
aA

x  L0(Ft)K .

(3.4)

Note that if time-t equilibrium prices St exist, the replacement of (3.2) by (3.3) just results in a shift of u^t(x) by x · St, which changes the marginal utilities of the representative agent by St. If  -  is understood as -, the mapping u^t : L0(Ft)K  L¯0(Ft) is Ft-concave. Moreover, since the preference functionals of all agents have the local property (2.1), one has

1Au^t(x) = 1Au^t(y) for all x, y  L0(Ft)K and A  Ft such that 1Ax = 1Ay.

We define the conditional concave conjugate u^t : L0(Ft)K  L0(Ft) by

u^t(y)

=

ess inf
xL0(Ft)K

{x

·

y

-

u^t(x)}

and call a random vector y  L0(Ft)K a conditional supergradient of u^t at x  L0(Ft)K if

u^t(x)  L0(Ft) and u^t(x + z) - u^t(x)  z · y for all z  L0(Ft)K .

The conditional superdifferential u^t(x) is the set of all conditional supergradients of u^t at x. As in standard convex analysis, one has

u^t(x) + u^t (y)  x · y for all x, y  L0(Ft)K
with equality if and only if y  u^t(x). With this notation we now are ready to give a dual characterization of equilibrium:

Theorem admissible

3.1 A trading

bounded RK-valued adapted process strategies (^at )tT=1 for all agents a 

(St)tT=0 A form

satisfying ST = S together with an equilibrium if and only if for

all times t = 0, . . . , T - 1 the following three conditions hold:

(i) St  u^t(n)

(ii)


aA

Uta(Hta+1

+

^ta+,R1

·

Rt+1

+

^ta+,S1

·

St+1)

=

u^t(n)

13

(iii)


aA

^ta+,S1

= n.

In particular, if (i)­(iii) hold and u^t(n) = {St} for all t = 0, . . . , T - 1, then (St)tT=0 is the unique equilibrium price process.

The characterization of equilibrium in Theorem 3.1 is reminiscent of the complete market case: equilibrium prices correspond to marginal utilities of the representative agent. However, the representative agent u^t is only defined in directions spanned by attainable one-step trading gains, and optimal trading strategies are only constrained Pareto optimal.
The following proposition shows that there exists an equilibrium pricing measure if at least one of the agents has strictly monotone preferences and open trading constraints.

Proposition 3.2 If the market is in equilibrium and there exists at least one agent a  A such that U0a is strictly monotone and Cta+1 is Ft-open for all t  T - 1, then there exists a probability measure Q on (, F) equivalent to P such that

Rt = EQ [RT | Ft] and St = EQ [ST | Ft] for all t = 0, . . . , T .

(3.5)

To ensure existence of an equilibrium one needs assumptions on the preferences and trading constraints which guarantee that at every time t, the one-step representative agent's utility is finite and attained. To motivate these assumptions, we give a simple example where an equilibrium does not exist.

Example 3.3 Assume the probability space contains only finitely many elements {1, . . . , N }, the time horizon is 1 and the preferences of the agents are given by expectations U0a(.) = Ea[.] corresponding to probability measures Pa, a  A. If there exist agents a, b  A with no trading constraints and a payoff Sk such that Ea[Sk] = Eb[Sk], an equilibrium price for this payoff cannot exist. Indeed, no matter how one chooses the initial price S0k  R, at least one of the expectations Ea[Sk], Eb[Sk] is different from S0k. If for instance, Ea[Sk] = S0k, then

sup
a RJ +K

U0a (H a

+

a,R

·

R1

+

a,S

·

S1)



Ea [H a ]

+

sup
R

Ea [S1k ]

=

,

and there exists no optimal trading strategy for agent a.

Of course, if in Example3.3,all agents have preferences given measure Q and R0j = EQ R1j for all j = 1, . . . , J , then S0k

by =

EEQQ[.]Sfokr,thke

same = 1,

probability . . . , K, are

equilibrium prices for the S-assets, and one has

sup

EQ

 H

a

+

a,R

·

R1

+

a,S

·

 S1

=

EQ

 H

a

+

¯a,R

·

R1

+

¯a,S

·

 S1

=

EQ

[H a ]

a RJ +K

for all a  A. That is, every trading strategy leads to the same utility, and all of them are optimal.

Another extreme case is when the agents have general preferences but for every agent a there

exists only one admissible trading strategy components together with (^at )tT=1 = (¯ta)tT=1,

(¯ta)Tt=1. Then any process a  A, forms an equilibrium.

(St)tT=0

with

bounded

In the following theorem we give a general existence result. We say that the trading constraints

Cta+1 factorize if they are of the form

Cta+1 = Dta+,11 × · · · × Da,J × Eta+,11 × · · · × Eta+,K1

for non-empty Ft-convex subsets Dta+,11, . . . , Dta+,J1, Eta+,11, . . . , Eta+,K1 of L0(Ft).

14

Theorem 3.4 Assume that for all a  A and t  T - 1, Cta+1 factorizes and is sequentially closed. If there exists a (possibly empty) subset A  A such that (i) U0a is sensitive to large losses for all a  A and (ii) Cta+1 is Ft-bounded for all a  A \ A and t  T - 1, then an equilibrium exists.

Condition (ii) in Theorem 3.4 amounts to a conditional compactness assumption. Similarly,

it can be deduced from condition (i) that it is enough for agents to optimize over conditionally

compact sets in the strategy space. A full proof of the theorem is technical. We give it in the

appendix using conditional analysis results from Cheridito et al. (2011). Here we shortly sketch

the Ha
u^0 :

aR=rg0umaRenndt{Ci±naais}siaims nptholenen-tewmgoivp-petyenribcolydosmedodinetl:erAvaslsuinmeRTsu=ch1,thJat=n0,K=a1A,

and Ca.

for all a  A, The mapping

u^0(x) = sup U0a(aS)

a
a

 a

Ca =x

 for x  Ca
a

(3.6)

and  u^0(x) = - for x / Ca.

a

If

it

can

be

shown

that

for

all

x




a

C

a,

the

supremum

in

(3.6)

is

attained,

u^0

is

a

concave

function from R to R  {-} and conditions (i)­(iii) of Theorem 3.1 hold. So an equilibrium

exists. But and only if

since for all

axllU0a ahaCvae,

the the

translation supremum

property

(T),

the

supremum

in

(3.6)

is

attained

if

sup U0a(a(S - E [S]))

a
a

 a

Ca =

x

(3.7)

is attained. In the special case S = E [S], this holds trivially. Otherwise, both sets {S - E [S] > 0} and {S - E [S] < 0} have positive probability. So if for each a  A, either U0a is sensitive to large losses or Ca is bounded, then (3.7) is equal to

sup U0a(a(S - E [S]))

aaa

Ia =

x

(3.8)

for suitable compact intervals Ia  R. Since S is bounded, the mapping a  U0a(a(S - E [S])) is continuous for every a  A, and it follows that the supremum (3.8) is attained.

4 Differentiable preferences and uniqueness of equilibrium
In this section we introduce a differentiability condition on the preferences and give conditions that guarantee uniqueness of equilibrium prices and optimal wealth dynamics. Condition (D) in the following definition is a conditional version of Ga^teaux-differentiability.

15

Definition 4.1 We say that a preference functional Ut : L0(FT )  L0(Ft) satisfies the differ-

entiability condition (D) if for all X  dom Ut there exists a random variable Z  L1(FT ) such

that

lim
m

Ut(X

+

Y /m) 1/m

-

Ut (X )

=

E [Y

Z

|

Ft]

for all

Y  L(FT ).

(4.1)

If such a random variable Z exists, it has to be unique and we denote it by Ut(X). If for X  dom Ut  L0(Ft+1), there exists a Z  L1(Ft+1) such that (4.1) holds for all Y  L(Ft+1), it is also unique and we denote it by ~ Ut(X).

If for some random variable X  L0(Ft+1) the gradient Ut(X) exists, then so does ~ Ut(X), and it is equal to
~ Ut(X) = E [Ut(X) | Ft+1] .

On the other hand, if U0, ..., UT -1 is a time-consistent family of preference functionals and there is an X  L0(FT ) such that ~ Ut(Ut+1(X)) exists for all t  T - 1, then Ut(X) exists too and

can be written as

T-1 Ut(X) = ~ Us(Us+1(X)).

(4.2)

s=t

Proposition 4.2 Assume that for at least one agent a  A, the preference functionals Uta satisfy

(D) and the sets Cta+1 are Ft-open for all t  T - 1. Then there exists at most one equilibrium

price process (St)tT=0. Moreover, if the market is in equilibrium,

dQta dP

=

 Uta Ha

+

T ^as,R
s=1

· Rs

+ ^sa,S

 · Ss

(4.3)

defines a probability measure Qta on (, F ) such that Qta |Ft= P |Ft and

Rt = EQta [RT | Ft] , St = EQta [ST | Ft] .

(4.4)

If in addition, U0a is strictly monotone, then Qa := Qa0 is equivalent to P and one has,

Rt = EQa [RT | Ft] and St = EQa [ST | Ft] for all t.

(4.5)

Remark 4.3 If under the assumptions of Proposition 4.2 an equilibrium exists but the preference functional U0a is not strictly monotone, one can still write

Rt = EQa [RT | Ft] and St = EQa [ST | Ft] Qa-almost surely.

(4.6)

But Qa might not be equivalent to P and it can happen that there exists an event A  Ft such that P[A] > 0 and Q[A] = 0. (4.6) then does not give any information about Rt and St in the event A. So (4.6) is weaker than (4.4). On the other hand, if Qa is equivalent to P, then (4.4) and (4.6) are equivalent.

Since we made no assumptions on non-redundancy of the financial assets, we cannot say anything about the uniqueness of optimal trading strategies (^at ). If for instance, Rt1 = Rt2 for all t, then any investment in R1 can arbitrarily be replaced by one in R2. However, if equilibrium
prices are unique and U0a is strictly concave modulo translation, it can be shown that the optimal one-step trading gains of the corresponding agent are unique.

16

Proposition 4.4 If there exists a unique equilibrium price process (St)tT=0 and U0a is strictly concave modulo translation for some agent a  A, then the optimal one-step trading gains
^ta,R · Rt + ^at ,S · St, t = 1, . . . , T, are unique.

5 Base preferences and attainable initial endowments
In this section we consider the case where all agents have preferences of the same type and all endowments can be attained by trading in the financial market. Then after hedging the endowment, every agent invests in the same portfolio. If preferences are differentiable, the equilibrium pricing kernel can be given in explicit form. In Subsection 5.1 we show our one-fund theorem. In Subsection 5.2 we discuss option prices under stochastic volatility, demand pressure and short-selling constraints.

5.1 One-fund theorem
Note that mean-variance preferences of the form MV(X) = E[X] - Var(X)

for a parameter  > 0 can be written as

MV (X)

=

1 

MV(X)

for the functional MV = MV1. If the preferences of our agents are related in the same way to a base preference functional and all initial endowments are attainable by trading, the following holds:

Theorem 5.1 (One fund theorem) Assume there exists an equilibrium such that (St)tT=0 as well as all optimal one-step trading gains
^ta,R · Rt + ^at ,S · St

are unique and the initial endowments are of the form

Ha = ca + T ta,R · Rt + ta,S · St,
t=1
for constants ca  R and trading strategies (ta)Tt=1, a  A. Moreover, suppose there exist base preference functionals

Ut : L0(FT )  L0(Ft), and non-empty subsets Ct+1  L0(Ft)J+K , t = 0, . . . , T - 1, such that the preferences and trading constraints of agent a  A are given by

Uta (X )

=

1 a

Ut(a

X

)

and

Cta+1

=

1 a

Ct+1

- ta+1

(5.1)

17

for parameters a > 0, a  A. Denote



=

 
aA

-1 1 a

and tS =  ta,S.
aA

Then there exists a J-dimensional trading strategy (^tR)tT=1 which for all t  T - 1, maximizes

 T



Ut sR · Rs + (n + sS) · Ss

(5.2)

s=t+1

over

all

(Rs )Ts=t+1

satisfying

Rs

,



 n

+

sS





Cs,

s

=

t

+

1, . . . , T ,

and

agent

a's

optimal

one-step trading gains are of the form

 



1 a

^Rt

-

ta,R

· Rt +

 a

(n

+

tS

)

-

ta,S

· St,

t = 1, . . . , T.

(5.3)

If, in addition, Ut satisfies the differentiability condition (D) and Ct+1 is Ft-open for all t  T -1,

then

dQt dP

=

Ut T ^sR · Rs
s=1

 + (n + sS) · Ss

defines probability measures satisfying Qt |Ft= P |Ft such that

Rt = EQt [RT | Ft] and St = EQt [ST | Ft] for all t  T - 1.

If moreover, U0 is strictly monotone, then Q := Q0 is equivalent to P, and one has

Rt = EQ [RT | Ft] as well as St = EQ [ST | Ft] for all t.

Remark 5.2 If under the assumptions of Theorem 5.1, there are no R-assets (J = 0) and the endowments are of the form Ha = ca + a,S · S for deterministic vectors a,S  RK , one can write

T Ha = ca + a,S · S0 + a,SSt.
t=1

So it follows from Theorem 5.1 that agent a'a optimal one-step trading gains are of the form



 a

(n

+

S

)

-

a,S

· St,

t = 1, . . . , T.

That is, after hedging the endowment, every agent, like in a one-time-step CAPM, takes a static
position in the market portfolio. Moreover, if U0 is strictly monotone and has the differentiability property (D), the equilibrium pricing kernel simplifies to

dQ dP

=

U0

 (n

+

S)

·

 S,

 where S = a,S.
aA

Thus, the equilibrium pricing measure only depends on aggregate endowment and supply and not on the distribution of wealth among the agents. Moreover, the introduction of new assets in zero-net supply does not change existing security prices. Of course, the situation is different when agents are truly heterogeneous or endowments are unspanned.

18

Example 5.3 If the agents have entropic utility functionals

Uta (X )

=

-

1 a

log

E

[exp(- a X )

|

Ft]

for constants a > 0,

a  A,

one can write Uta(X) = Ut(aX)/a for the base preference functionals

Ut(X) = - log E [exp(-X) | Ft] , t = 0, . . . , T.

We know from Example 2.1 that they have the properties (M), (T), (C), (TC) and U0 satisfies (SL), (SM), (SC). Moreover, Ut has the differentiability property (D) with

Ut (X )

=

exp(-X ) E [exp(-X) |

Ft] .

So if all agents are unconstrained and have endowments of the form

Ha = ca + T ta,R · Rt + ta,S · St,
t=1

one obtains from Theorem 3.4 that an equilibrium exists. By Propositions 4.2 and 4.4, the

equilibrium 5.1 that for

prices =

(andaoAp(tiam)-al1)o-n1e-astnedp

ttSrad=ing gaaiAns taa,Sre,

unique, and there exists

it a

follows from Theorem J-dimensional trading

strategy (^tR)tT=1 such that (5.2)­(5.3) hold. Moreover,

dQ dP

=

U0

T ^sR
s=1

·

Rs

+

(n

+

sS )

·

 Ss

=

E

eexxpp--Ts=sT=11^^Rs Rs ·

Rs + (n + sS) · · Rs + (n + sS)

 Ss
 · Ss

(5.4)

defines a probability measure Q equivalent to P for which

Rt = EQ [RT | Ft] and St = EQ [ST | Ft] for all t = 0, . . . , T.

For the special case where there are no R-assets (J = 0) and endowments are of the form Ha =

ca + a,S · S for deterministic vectors a,S  RK , the pricing kernel simplifies to

dQ dP

=

exp

 -(n

+

S

)

·

ST



E [exp (-(n + S) · ST )]

 for S = a,S.
aA

5.2 Simulation of option prices in a discrete Heston model
As an application of Theorem 5.1 we calculate equilibrium prices of equity options and study the effects of stochastic volatility, demand pressure and short-selling constraints. It has been observed that implied volatility smiles of index options and options on single stocks look differently even though the underlying distributions are similar. Typically, index options appear to be more expensive and their smiles are steeper. A possible explanation for this difference is that there usually is positive aggregate demand for out-the-money put index options by end users. If option dealers sell these options to end users and cannot fully hedge themselves, they expose themselves

19

to the risk of a decline of the index. To compensate for that they are asking higher prices;
see Bakshi et al. (2003), Bollen and Whaley (2004), Ga^rleanu et al. (2009) and the references therein. We follow Ga^rleanu et al. (2009) and assume our agents A are option dealers with expected exponential utility preferences with absolute risk aversions a > 0, a  A. They have no endowments and trade in the underlying and the options. On the other side there are end users
such as for instance, pension funds who buy put options to insure their investment portfolios.
We assume that end users demand a fixed portfolio of put options and pay the price at which it is offered by the dealers. For our simulations we suppose they demand m  0 put options with discounted strike K0 = 92 and maturity T . The net supply among the dealers is n = -m  0. We assume the dealers do not influence the price of the underlying R but determine the option
prices. Suppose the underlying moves according to a discretized Heston model

Rt+h vt+h

= =

|Rt + µRt |vt + (m

h-+vt)hvt+Rtbv1t+th|b,t2+hR|,0

= 100 v0 =

0.04.

The absolute values are here to guarantee that Rt and vt stay above zero. We choose maturity

T = 0.5 years and make 100 steps of size h = 0.005. The other parameters are µ = 0.1,  = 0.2,

m = 0.04, increments

= that

0.3. have

d(bisn1thr)ib1n0=u00tioanndP[(bn2bith )=n10=±00 ahre]

=tw1o/2BaernndoucollrirerlaantdioonmEwalkb1tswbit2th=in-d0ep.3ehn.dWenet

shall be interested in the prices of put options on R. The discounted time-T payoff corresponding

to discounted strike K and maturity T is S = (K - RT )+. While for the simulation of (Rt) we

make steps of size h = 0.005, we assume the trading dates to be a subset T of T = {0, h, . . . , T }

containing {0, T }. If T is coarse, option dealers can rebalance their portfolios less frequently, and

the model becomes more incomplete. We think of situations where transaction costs are high or there are trading constraints. Denote by RT the set of all investment strategies in the underlying that are constant on the intervals [ti-1, ti), where T = {t0 = 0, t1, . . . , T }. By formula (5.4), the equilibrium pricing kernel takes the form

E

eexxpp--t^TRt ^Rt RtR-t

 nP
- nP



,

where



=

 ( aA

(

a)-1)-1

,

P

=

(K0

- RT )+

and

(^tR)



RT

is

the

maximizer

of

the

expected

utility

 



-EP exp - Rt Rt - nP

over the set TR.

In the following we calculate implied volatilities of put options with discounted strikes between 85 and 115 for different choices of n and T. We first assume n = 0 (no demand pressure) and think of R as the price of a single stock. The first of the two figures below shows implied volatilities for the case n = 0 and T = T (option dealers rebalance their portfolios frequently). The second figure shows the situation for n = 0 and T = {0, T } (option dealers have to form their portfolios at time 0 and keep them constant until T ).

20

0.24 0.24

Implied volatility

Implied volatility

0.22 0.22

0.2 0.2

0.18
85 90 95 100 105 110 115 Discounted strike

0.18
85 90 95 100 105 110 115 Discounted strike

For n = 0, trading restrictions increase implied volatilities, and therefore option prices, only slightly because option dealers do not have to hedge the options. The only difference between frequent and less frequent trading is the quality of the dealers' investment strategy in the underlying R.
Now assume that net demand by end users for put options with discounted strike K0 is positive and correspondingly, n < 0. This is typical for index options (see Ga^rleanu et al. (2009)). The first of the following two figures shows implied volatilities for the case n < 0 (positive demand) and T = T (dealers rebalance frequently). The second one is for n < 0 (positive demand) and T = {0, T } (dealers have to invest statically).

0.35 0.35

Implied volatility

Implied volatility

0.3 0.3

0.25 0.25

0.2
85 90 95 100 105 110 115 Discounted strike

0.2
85 90 95 100 105 110 115 Discounted strike

It can be seen that net demand for put options with discounted strike K0 = 92 increases prices of put options of all strikes, but especially those corresponding to low strikes. Also, trading
restrictions have more of an influence on prices than in the case n = 0. As a limit case, the next figure shows results for n < 0 and T = . That is, there is positive
demand by end users for put options with discounted strike K0. But option dealers are not allowed to trade the underlying. This can be interpreted as short-selling constraints. If dealers are short
in put options, they would like to hedge by shorting the underlying. But under short-selling
constraints, the best they can do is to have a zero position in the underlying. This increases
prices of put options further compared to the case of demand pressure and few trading dates.

21

0.35

Implied volatility

0.3

0.25

0.2
85 90 95 100 105 110 115 Discounted strike
See also Avellaneda and Lipkin (2009) for a continuous-time model for hard-to-borrow stocks and the valuation of options on them.

6 Random walks and BSEs

We here consider the case where the noise is generated by d independent Bernoulli random walks

but in contrast to Subsection 5.2, agents can be heterogenous and random endowments unspanned.

Then equilibrium prices (St)tT=0 and continuation values (Hta)Tt=0 can be obtained as solution to a system of coupled BSEs (backward stochastic difference equations). For notational convenience

we restrict ourselves to the case J = K = 1, that is, R and S are both one-dimensional. The S-

asset is in net supply n  R. We assume throughout this section that all agents are unconstrained, U0a is sensitive to large losses for all a  A, and Uta satisfies the differentiability condition (D) for all a  A and t  T - 1. We let the time between two successive trading periods be given by some step size h > 0. The set of trading dates is T = {0, h, . . . , T }, where T = N h for some N  N. Let bi = (bit)tT, i = 1, ..., d, be random walks starting at 0 such that the increments bit+h = bit+h - bit are independent for different i and t with distribution

P[bit+h

=

 ± h]

=

1/2.

Let (Ft)tT be the filtration generated by (bit), i = 1, . . . , d. Note that Ft is generated by 2dt/h atoms. In particular, L0(Ft) just contains bounded random variables and can be identified with Rdt/h.

6.1 The predictable representation property

It is well-known that for d = 1, the random walk b has the predictable representation property

 x

+

zbt+h

:

x,

z



L0(Ft)

=

L0(Ft+h)

for all t  T - h.

(6.1)

On the other hand,

 d



x + zibit+h : x  L0(Ft), z  L0(Ft)d  L0(Ft+h)

i=1

if d  2.

22

However, the following result shows how the predictable representation property can be obtained for d  2 by adding enough orthogonal Bernoulli random walks.3.

Lemma 6.1 There exist (Ft)-adapted random walks bd+1, . . . , bD for D = 2d - 1 such that 
bi0 = 0 and P[bit+h = ± h | Ft] = 1/2 for i = d + 1, . . . , D, 
E bit+hblt+h | Ft = 0 for all 1  i = l  D

and

 x

+

z

·

bt+h

:

x



L0(Ft),

z



L0 (Ft )D 

=

L0(Ft+h),

where b is the D-dimensional random walk with components bi, i = 1, . . . , D.

It follows from Lemma 6.1 that every X  L0(Ft+h) can be written as X = E[X | Ft] + t(X) · bt+h

for

ti (X )

=

1 h

E

 X

bti+h

|

 Ft ,

i = 1, . . . , D.

So one obtains from the translation property of the mappings Uta that

Uta(X) = Uta (E [X|Ft] + t(X) · bt+h) = E [X | Ft] - fta(t(X))h,

where fta : L0(Ft)D  L0(Ft) is the Ft-convex function given by

fta(z)

:=

-

1 h

Uta(z

·

bt+h).

Since Uta satisfies the differentiability condition (D), one has for all z, z  L0(Ft)D,

lim
m

fta(z

+

z/m) 1/m

-

fta(z)

=

-

1 h

E

 z



·

bt+hUta(z

·

bt+h)

|

 Ft

=

z

·

1 h

E

[-bt+hUta(z

·

bt+h)

|

Ft]

.

That is,

lim
m

fta(z

+

z/m) 1/m

-

fta(z)

=

z

·

fta(z)

for the random vector

(6.2)

fta(z) = E [-bt+hUta(z · bt+h) | Ft]  L0(Ft)D.
3Since the newly introduced random walks are adapted to the original filtration, they do not change the information structure of the economy

23

6.2 First order conditions and equilibrium dynamics

We know from Theorem 3.4 that an equilibrium exists, and by Proposition 4.2, the equilibrium price process (St)tT is unique. Introduce the random vectors ZtR+h := t(Rt+h), ZtS+h := t(St+h), Zta+h := t(Hta+h), Zt+h := ZtR+h, ZtS+h, (Zta+h)aA .

In terms of these quantities, Hta can be written as



Hta

=

Uta 

Hta+h + ^ta+,RhRt+h + ^ta+,ShSt+h







= E Hta+h + ^at+,RhRt+h + ^at+,ShSt+h | Ft - fta Zta+h + ^ta+,RhZtR+h + ^ta+,ShZtS+h h.

So optimal trading strategies ^at+h have to satisfy the following first order conditions:



E [Rt+h | Ft]

=

ZtR+h

·

fta

Zta+h 

+

^at+,RhZtR+h

+

^at+,Sh

ZtS+h 

h

E [St+h | Ft] = ZtS+h · fta Zta+h + ^ta+,RhZtR+h + ^ta+,ShZtS+h h,

(6.3) (6.4)

and the mapping u^t : L0(Ft)  L0(Ft) is of the form





u^t(x) = E

Hta+h + xSt+h | Ft - ft(xZtS+h, Zt+h)h

a

(6.5)

for the function ft : L0(Ft)(3+|A|)D  L0(Ft) given by the convolution

ft(v, Zt+h) =

min aaAL0a(,2F=t)20

 fta
aA

 v |A|

+

Zta+h

+

a,1ZtR+h

+

 a,2ZtS+h

-

a,1 E

[Rt+h h

|

Ft] .

(6.6)

Furthermore, one has the following result:

Proposition 6.2 ft is conditionally differentiable in v at v = nZtS+h with

vft(nZtS+h, Zt+h)

=

1 |A|

 fta Zta+h
aA

+ ^ta+,RhZtR+h

 + ^ta+,ShZtS+h .

(6.7)

As a consequence one obtains from (6.3)­(6.4) the two equations

E [Rt+h | Ft] E [St+h | Ft]

= =

ZtR+h ZtS+h

· ·

v ft v ft

nnZZttSS++hh,,

 Zt+h Zt+h

h h.

(6.8) (6.9)

24

Since vft also depends on Zta+h, a  A, one needs the dynamics of the processes (Hta), a  A, to obtain a full characterization of equilibrium:



Hta = Uta Hta+h + ^at+,RhRt+h + ^ta+,ShSt+h

=

E

Hta+h

|

 Ft

+

^at+,RhE [Rt+h

|

Ft]+

^at+,ShE

[St+h

|

Ft]

-fta Zta+h + ^ta+,RhZtR+h + ^at+,ShZtS+h h

=

E

Hta+h

|

 Ft

+

^ta+,RhE [Rt+h

|

Ft]+

^ta+,ShZtS+h

·

v ft (nZtS+h ,

Zt+h)h

=

-fta Zta+h +

E

Hta+h

|

 Ft

^at+,RhZtR+h + ^at+,ShZtS+h - gta(Zt+h)h,

h

(6.10)

where

gta(Zt+h)

=

min
L0(Ft)2

fta

Zta+h

+

1ZtR+h

+

2ZtS+h-1

E

[Rt+h h

|

Ft] -2ZtS+h·vft(nZtS+h,

Zt+h).

Since

St+h = E [St+h | Ft] + ZtS+h · bt+h

and

Hta+h

=

E

Hta+h

|

 Ft

+

Zta+h

·

bt+h,

equations (6.9) and (6.10) yield the following result:

Theorem 6.3 The processes (St) and (Hta) satisfy the following coupled system of BSEs:

St+h

=

ZtS+h

·

v ft (nZtS+h ,

Zt+h)h

+

 bt+h

,

ST = S

(6.11)

Hta+h = gta (Zt+h) h + Zta+h · bt+h, HTa = Ha.

(6.12)

Remark 6.4 If in equilibrium the market becomes complete, the system of BSEs (6.11)­(6.12)

decouples. Indeed, if the market is complete, there exist one-step trading strategies (ta+h) such

that

Hta+h

-

E

Hta+h

|

 Ft

=

ta+,Rh(Rt+h

-

E

[Rt+h

|

Ft])

+

ta+,Sh(St+h

-

E [St+h

|

Ft]),

and it follows that ft can be written as

ft(v, Zt+h) = min
aaAL0a(,2F=t)20


aA

fta



v |A|

+

(ta+,Rh

+

a,1)ZtR+h

+

(ta+,Sh

+

 a,2)ZtS+h

-

a,1

E

[Rt+h h

|

Ft] .

In particular, vft(nZtS+h, Zt+h) does not depend on Zta+h, a  A, and equation (6.11) decouples from (6.12).
We refer to Horst and Mu¨ller (2007) and Horst et al. (2010) for sufficient conditions for
market completeness in continuous-time and characterization of equilibrium by BSDEs (backward
stochastic differential equations). Results on market completeness in more general equilibrium
models can be found in Magill and Shafer (1990) and Anderson and Raimondo (2009).

25

6.3 Example with entropic preferences
We now study a concrete example where the agents have entropic preferences. For small time steps h, one can approximate fta with quadratic drivers, and (6.11)­(6.12) becomes a coupled system of BSEs with drivers of quadratic growth. We first derive explicit expressions for the approximate equilibrium dynamics in discrete time. Then we give a formal discussion of the continuous-time limit h  0.

6.3.1 Approximate dynamics in discrete time

Assume (Rt) evolves according to

Rt+h = Rt(µh + b1t+h), R0  R+,

(6.13)

where

b1 is

the

first

component

of

the

random

walk

b

and

µ, 

are

constants

such

that

 - h

<

µh <  h. Then (Rt) satisfies the no-arbitrage condition (NA) from above. The random vec-

tor ZtR is given by ZtR = (Rt, 0, . . . , 0) and cannot vanish. Suppose the agents have entropic

preferences of the form

Uta (X )

=

-

1 a

log

E

[exp(- a X )

|

Ft]

for constants

a > 0,

a  A.

The functions fta are then given by

fta(z)

=

1 ha

log E [exp(-az

·

bt+h)] .

This expression is not very convenient for calculations. But for small time steps h, it can be approximated by a quadratic function. The idea is to ignore the orthogonal random walks bd+1, ..., bD and approximate fta by a polynomial in z. To do that, let us write z  L0(Ft)D as z = (z¯, z~) for z¯  L0(Ft)d and z~  L0(Ft)D-d. For X  L0(FT ) and small h > 0,

X = E [X] +  t(X) · bt+h  E [X] +  ¯t(X) · ¯bt+h

t<T t<T

is

a

good

approximation

which

in

the

limit

h



0

becomes

X

=

E

[X ]

+

T
0

Zt

·

dBt

for

a

d-

dimensional Brownian motion (Bt)0tT and a predictable process (Zt)0tT . We therefore ne-

glect the components bd+1, . . . , bD and approximate fta(z) as follows:

fta(z)



1 ha

log

E

 exp

-az¯

·

¯bt+h

=

1 ha

d

log

cosh

 h

 azi



a 2

||z¯||22.

i=1

(6.14)

Denote ztR+h = Z¯tR+h,

ztS+h = Z¯tS+h,

zta+h = Z¯ta+h,

zt+h = (ztR+h, ztS+h, (zta+h)aA) and



ztA+h =

zta+h.

a

To identify the equilibrium drift

gtS

=

E [St+h h

|

Ft] ,

26

note that using approximation (6.14), the first order conditions (6.3)­(6.4) become



E [Rt+h | Ft]

=

aztR+h

·

zta+h 

+

^at+,RhztR+h

+

^ta+,Sh

ztS+h 

h

E [St+h | Ft] = aztS+h · zta+h + ^ta+,RhztR+h + ^ta+,ShztS+h h.

(6.15) (6.16)

Substituting µRth for E [Rt+h | Ft] and summing over a gives



µRt

=

ztR+h

·

ztA+h 

+

^tA+,Rh ztR+h

+

nztS+h 

gtS (zt+h) = ztS+h · ztA+h + ^At+,Rh ztR+h + nztS+h

for

^At+,Rh

=


a

^ta+,Rh

.

It

follows

from

(6.17)

that

^tA+,Rh Rt

=

µ 

-

(ztA+,1h

+

nztS+,1h).

(6.17) (6.18)

So one obtains from (6.18)



gtS (zt+h) = ztS+h ·

µ/ (ztA+,lh + nztS+,lh)

,

where ztA+,lh and ztS+,lh are the vectors consisting of the last d - 1 components of ztA+h and ztS+h, respectively.
With the approximation (6.14) the drivers gta take the form

gta(zt+h)

=

min
L0(Ft)2

a 2

zta+h

+

1ztR+h

+

2ztS+h22

-

1µRt

-

2gtS (zt+h),

(6.19)

and the approximate equilibrium prices and continuation values can be obtained from the coupled system of BSEs

St+h = gtS(zt+h)h + ztS+h · ¯bt+h, ST = S Hta = gta(zt+h)h + zta+h · ¯bt+h, HTa = Ha.

(6.20) (6.21)

In particular, they can be computed recursively by solving the following equations:

St = E[St+h | Ft] - gtS(zt+h)h, ST = S Hta = E[Hta+h | Ft] - gta(zt+h)h, HTa = Ha.

(6.22) (6.23)

Optimal strategies have to minimize (6.19). The corresponding first order conditions are

 cRt+Rh ctR+Sh

cRt+Sh ctS+Sh



^ta+,Rh ^at+,Sh

 =

1 a

µRt - actR+ah gtS (zt+h) - actS+ah

 ,

(6.24)

where

cRt+Rh := ztR+h · ztR+h,

There are two possible cases:

ctR+Sh := ztR+h · ztS+h,

cSt+ah := ztS+h · zta+h,

etc.

27

Case 1: cRt+RhctS+Sh - cRt+ShctR+Sh > 0. This condition means that from t to t + h the two assets

are non-redundant. So ^tR+,ah and ^St+,ah are uniquely given by (6.24):



^ta+,Rh ^ta+,Sh

 =

 1 a(ctS+ShctR+Rh - cRt+ShctR+Sh)

ctS+ShµRt - ctR+ShgtS (zt+h) + a(ctR+ShctS+ah - cSt+ShctR+ah) ctR+RhgtS (zt+h) - ctR+ShµRt + a(cRt+ShctR+ah - ctR+RhcSt+ah)



Case 2: cRt+RhctS+Sh -ctR+ShctR+Sh = 0. In this case one of the two assets is redundant in equilibrium, the optimal trading strategies are not unique and one can, for instance, choose

^ta+,Rh

=

1  a cRt+Rh

 µRt

-

 a ctR+ah

-

nctR+Sh

and

^at+,Sh

=

n a

.

To realistically simulate the system (6.22)­(6.23) is a non-trivial numerical task and left for future research.

6.3.2 Continuous-time limit

Let (Bt)0tT be a d-dimensional Brownian motion and denote by (Ft) the augmented filtration generated by (Bt). Let (Rt) be a financial asset whose price is exogenously given by

dRt = Rt(µdt + dBt1), R0  R+,

where µ, , r0 are positive constants and B1 is the first component of the Brownian motion B. Additionally, there exists an instrument with final payoff S  L(FT ) that is traded by agents a  A with initial endowments Ha  L(FT ) and preferences of the form

Uta (X )

=

-

1 a

log

E

[exp(- a X )

|

Ft]

,

a > 0.

The continuous-time analog of the discrete-time equations (6.20)­(6.21) is the following coupled system of BSDEs:

dSt = gtS(Zt)dt + ZtS · dBt, ST = S

dHta = gta(Zt)dt + Zta · dBt, HTa = Ha

for

ZtR

=

(Rt,

0, .

.

.

,

0),

ZtA

=


a

Zta,

Zt

=

(ZtR, ZtS, (Zta)aA),



gtS(Zt) = ZtS ·

µ/ (ZtA,l + nZtS,l)

,

(6.25) (6.26)

where ZtA,l and ZtS,l are the vectors consisting of the last d - 1 components of ZtA and ZtS, respectively, and

gta(Zt)

=

min
L0(Ft)2

a 2

Zta

+

1ZtR

+

2ZtS 22

-

1µRt

-

2 gtS (Zt ).

(6.27)

As in discrete time, optimal strategies (^at ,R, ^at ,S) must minimize (6.27) for all t. At this time there exists no general result which guarantees existence or uniqueness of solutions
to the coupled system of BSDEs (6.25)­(6.26). So it is currently a conjecture that there exist processes (St), (Hta), (Zt) solving (6.25)­(6.26) and that (St) is an equilibrium price.

28

A Proofs of Section 2

Proof of (2.12) Let X  L0(Ft+1) and introduce the Ft-measurable sets

A0 = {P[X  0 | Ft] > 0} , Al = {P[X  l | Ft] > 0 and P[X  l - 1 | Ft] = 0} for l  1.

Since  is the disjoint union of the sets A0, A1, . . . , the random variable



=


lN

1Al

1{X l} P[X  l | Ft]

is in Dt+1, and one has 
E [([X  n]  m) + G() | Ft]  1Al (l + E [G() | Ft]) < 
lN
for all n  N and m  -N. This shows (2.12).



Proof of (2.13)

Let X  L0(Ft+1) such that P[X < 0] > 0. We first show that for every n  N, there exists a

constant t  1 such that

P[Vt(tX)  -n] > 0.

(A.1)

To do that, we introduce the Ft-measurable set A = {P[X < 0 | Ft] > 0} and the conditional

density



=

1A

1{X <0} P[X < 0 |

Ft

]

+

1Ac



Dt+1.

The claim (A.1) now follows from the fact that

1AVt(tX)  1A (E [tX + G() | Ft])  -1A as t  . So one obtains that for every n  N there exist constants t-1, t  1 such that
P[Vt-1 (t-1Vt(tX))  -n] > 0.

By concavity of Vt, one has and it follows that

Vt(t-1tX)  t-1Vt (tX) ,

P [Vt-1(t-1tX)  -n]  P [Vt-1(t-1Vt(tX))  -n] > 0

for all t-1 and t sufficiently large. Iterating this argument yields (2.13).



29

B Proofs of Section 3

Proof of Theorem 3.1 Let us first assume that the bounded adapted process (St)Tt=0 and the strategies (^at )tT=1, a  A, form an equilibrium. Then condition (iii) holds by definition. Moreover, the associated continu-
ation value processes (Hta) are bounded from below and one obtains

-u^t(St) = ess sup {u^t(x) - x · St}

xL0(Ft)K
= ess sup



uat

(a)

-

a,S

·

 St

=

eass Lsu0 (pFt)J +KUataAHta+1

+

a,R

·

Rt+1

+

a,S

·

 St+1

=

aCta+1aA Uta Hta+1

+

^ta+,R1

·

Rt+1

+

^at+,S1

·

 St+1

=

aA

Uta

 Hta+1

+

^at+,R1

·

Rt+1

+

^at+,S1

·

 St+1

-

n

·

St

aA

 u^t(n) - n · St.

(B.1)

Since u^t(n) + u^t(St)  n · St, the inequality in (B.1) must be an equality, and it follows that

St  u^t(n) as well as



Uta

 Hta+1

+

^at+,R1

·

Rt+1

+

^at+,S1

·

 St+1

=

u^t(n),

a

which shows that conditions (i) and (ii) hold.

For the reverse implication, assume that (i)­(iii) are satisfied. Then the market clearing

condition holds, and one has for all admissible trading strategies (at )tT=1, a  A,

 Uta(Hta+1 + at+,R1 · Rt+1 + ta+,S1 · St+1)

= aA Uta(Hta+1 + at+,R1 · Rt+1 + ta+,S1 · St+1) - at+,S1 · St

aA



 u^t  ta+,S1 -  ta+,S1 · St

aA

aA

 =

-u^tU(tSa(tH) =ta+1u^t+(n^)at-+,R1n·

· St Rt+1

+

^at+,S1

·

St+1).

aA

From here it follows by backwards induction that (^ta)tT=1 is an optimal strategy for each agent

a  A.



Proof of Proposition 3.2
Suppose there exists no probability measure Q equivalent to P which satisfies (3.5). Then it follows from the Dalang­Morton­Willinger theorem (Dalang et al. 1990) that there exists a t  T - 1

30

and a one-step trading strategy t+1  L0(Ft)J+K such that Rt+1 · Rt+1 + tS+1 · St+1 is nonnegative and strictly positive with positive probability. The same is true for t(Rt+1 · Rt+1 + tS+1 · St+1) for arbitrary Ft-measurable t > 0. But this means that there can exist no optimal trading strategies for the agents with strictly monotone preference functionals and open trading

constraints, a contradiction to the assumption that the market is in equilibrium.



Proof of Theorem 3.4

Set ST = S and HTa = Ha, a  A. Then existence of an equilibrium follows from Theorem 3.1 if we can show that for every t  T - 1, St+1  L(Ft+1)K and bounded from below Hta+1  L0(Ft+1), a  A, the following hold: (a) there exist one-step strategies ^at+1  Cta+1, a  A, such that

 ^ta+,S1 = n and  Uta(Hta+1 + ^ta+,R1 · Rt+1 + ^at+,S1 · St+1) = u^t(n)

aR

aA

(b) there exists St  u^t(n)  L(Ft)K .
(a) follows from Lemma B.1 below and (b) will be shown in Lemma B.2. To prove Lemmas B.1 and B.2, we need the following concepts from Cheridito et al. (2011):
We call a subset C of L0(F )d F -linear if

x + y  C

for all x, y  L0(F )d and   L0(F ). We call C F -convex if

x + (1 - )y  C

for all x, y  L0(F )d and   L0(F ) such that 0    1. We say C is F -polyhedral if it is of the

form

 C = x  L0(F )d : x · ai  i, i = 1, . . . , I

for random vectors a1, . . . , aI  L0(F )d and 1, . . . , I  L0(F ). A mapping f : L0(F )d  L0(F )m is F -linear if
f (x + y) = f (x) + f (y)

for all x, y  L0(F )d and   L0(F ). If m = 1, we say f is F -convex (F -concave) if

f (x + (1 - )y)  ()f (x) + (1 - )f (y)

for all x, y  L0(F )d and   L0(F ) satisfying 0    1. By N(F ) we denote the set of all F -

measurable random and M  N(F), we

variables define xM

taking values in N = {1, := mN 1{M=m}xm.

2,

...}.

For

a

sequence

(xm)mN

in

L0(F )d

Lemma B.1 Let t  T - 1, St+1  L(Ft+1)K and Hta+1  L0(Ft+1), a  A, all bounded from below. Assume the sets Cta+1, a  A, factorize and are sequentially closed. If there exists a (possibly empty) subset A  A such that (i) U0a is sensitive to large losses for all a  A and

31

(ii) Cta+1 is Ft-bounded for all a  A \ A, then u^t(x) <  for all x  L0(Ft)K , the set



=

 x



L0(F )K

:

u^t(x)



L0(Ft)

is Ft-polyhedral, and for all x  , there exist one-step trading strategies at+1  Cta+1, a  A,

such that

 at+,S1 = x and



Uta

 Hta+1

+

at+,R1

·

Rt+1

+

ta+,S1

·

 St+1

=

u^t(x).

(B.2)

aR aA

In particular, u^t(n)  L0(Ft) and there exist one-step trading strategies ^at+1  Cta+1, a  A, such

that

 ^at+,S1 = n and



Uta

 Hta+1

+

^at+,R1

·

Rt+1

+

^ta+,S1

·

 St+1

=

u^t(n).

aR

aA

Proof. It is clear that

 f(

Cta+1)



~

:=

 x



L0(F )K

:

u^t(x)

>

 -

,

aA

where f : L0(Ft)|A|(J+K)  L0(Ft)K is the Ft-linear mapping given by
 f ((a)aA) = a,S.
aA

On the other hand, it follows from the definition of u^t that for every x  ~ , there exists a sequence An, n  N, of Ft-measurable events together with random vectors an  Cta+1 such that An   almost surely and

 an,S = x
aA

on the set An \ An-1,

where A0 = .

Since the sets Cta+1 are Ft-convex and sequentially closed, the strategy



a =

1An\An-1 an

nN

belongs to Cta+1 for all a  A,

and

one

has


aA

a,S

=

x.

This

shows

that

f

 ( aA

Cta+1

)

=

~ .

Since


aA

Cta+1

is

Ft-

polyhedral, it follows from Cheridito et al. (2011) that ~ is again Ft-polyhedral. By condition

(C1), n belongs to ~ . So if we can show (B.2) for all x  ~ , it follows that ~ = , and the lemma

is proved. To do this, fix x  ~ . Since the price process (Rt)Tt=0 satisfies (NA), one obtains from the
Dalang­Morton­Willinger theorem (Dalang et al. 1990) that there exists an equivalent martingale
measure Q  P such that Rt = EQ [Rt+1 | Ft]. Set W = St+1 -EQ [St+1 | Ft]. There exist one-step strategies at+1  Cta+1, a  A, satisfying (B.2) if and only if the conditional optimization problem

ess sup g()
B

(B.3)

32

has an optimal solution, where g : L0(Ft)|A|(J+K)  L0(Ft) is the Ft-concave mapping given by

g()

=



Uta

Hta+1

+

a,R

·

Rt+1

+

a,S

·

 W

aA

and B is the Ft-polyhedral set





B :=  = (a)aA  Cta+1 :

a,S = x .

aA

aA

Introduce the Ft-linear set 
E :=   L0(Ft)(J+K) : R · Rt+1 + S · W = 0

and denote by  the Ft-conditional projection from L0(Ft)|A|(J+K) to (E)|A| ×L0(Ft)|A\A|(J+K).

Since Fix 

B 

isaFAt-pCota+ly1hseudcrhal,thitatfolloawAs

from Cheridito a,S = x. Then

et al. (2011) that the Ft-convex set

(B)

is

Ft-polyhedral

too.

C := {  (B) : g()  g()}

is sequentially closed, and (B.3) has an optimal solution if and only if

ess sup g()
C

has one. Next we show that C is Ft-bounded. If C contains only elements  = (a)aA such that a = 0 for all a  A, then this is a direct consequence of the assumption that Cta+1 is Ft-bounded for all a  A \ A. On the other hand, if C contains an element  = (a)aA such that a = 0 for some a  A, then there exists a set A  Ft with P[A] > 0 and a non-empty subset A of A such
that P[a,R · Rt+1 + a,S · W = 0 | Ft] > 0 on A for all a  A

and a,R · Rt+1 + a,S · W = 0 on A for all a  A \ A

Since Rt+1 and W satisfy the no-arbitrage condition (NA), P[a,R · Rt+1 + a,S · W < 0 | Ft]

must be strictly positive on A for all a  A. So it follows from the sensitivity to large losses of

the functionals U0a that

lim
m

Uta

Hta+1

+

m

a,R

·

Rt+1

+

a,S

·

 W



-

almost surely on A

for all a  A.

(B.4)

Indeed, assume to the contrary that there exists a  A, A  Ft with A  A and P[A] > 0 such

that

lim sup
l ml

Uta

Hta+1

+

m

a,R

·

Rt+1

+

a,S

·

 W

>

-

almost surely on A.

Then there exist c  R and A  Ft with A  A and P[A] > 0 such that

lim sup
l ml

Uta

Hta+1

+

m a,R

·

Rt+1

+

a,S

·

 W



c

almost surely on A .

33

It follows that there exists a sequence (Ml)lN in N(Ft) such that Ml+1  Ml  l for all l  N

and

Uta

Hta+1

+

Ml

a,R

·

Rt+1

+

a,S

·

 W



c

-

1

on A.

But since Uta is Ft-concave, this implies

Uta

Hta+1

+

l

a,R

·

Rt+1

+

a,S

·

 W



c

-

1

on A  {l  M1} for all l  N.

(B.5)

Choose l0  N such that P[A] > 0 for A = A  {l0  M1}. Since Hta+1 is bounded from below, there exists m  N such that

P[1A ((Hta+1)+ + m(a,R · Rt+1 + a,S · W )) < 0] > 0.

So for l  m,



U0a U0a

1mAl 1 (AHta+(1H+ta+l(1)+a,R+·m(Rta+,R1

+ a,S · W · Rt+1 +

 )) a,S

·

W

 )



-

as l  .

and hence,

=

U0a U0a

 

Uta

1A

(H1Ata+1(H+ta+l(1+a,Rl(·a,RR t·+1 R+t+a1,S+·Wa,S))·W))- 

for l  .

But this contradicts (B.5). So (B.4) must be true. Since g()  L0(Ft), it follows that there exists an m  N such that m / C. Hence, we obtain from Cheridito et al. (2011) that C is Ft-bounded and there exists a   C such that

g() = ess sup g().
C



Lemma B.2 Under the assumptions of Lemma B.1 there exists a random vector St in u^t(n)  L(Ft)K .

Proof. It follows from Lemma B.1 that u^t(n)  L0(Ft). In the next step we show that

u^t(n + x) - u^t(n)  L||x||Ft for all x  L0(Ft)K ,

(B.6)

where

L

=

K
k=1

||Stk+1||21/2.

To

do

that

let

x



L0(Ft)K

such

that

u^t(n + x)

>

-

(inequal-

ity (B.6) holds trivially on the event {u^t(n + x) = -}). By Lemma B.1, there exist one-step

strategies ta+1  Cta+1, a  A, such that

 ta+,S1 = n + x and



Uta

 Hta+1

+

ta+,R1

·

Rt+1

+

ta+,S1

·

 St+1

=

u^t(n

+

x).

aA

aA

Since the sets Cta+1 factorize and there exist one-step strategies ^at+1  Cta+1, a  A, satisfying

 ^at+,S1 = n and



Uta

 Hta+1

+

^ta+,R1

·

Rt+1

+

^ta+,S1

·

 St+1

=

u^t(n),

aA

aA

34

there exist one-step strategies ta+1  Cta+1 such that for all a  A,
ta+,R1 = ta+,R1, sign(at+,S1,k - ta+,S1,k) = sign(xk) for every k = 1, . . . , K, and  ta+,S1 = n.
aR

It follows that

u^t(n)





Uta

 Hta+1

+

ta+,R1

·

Rt+1

+

ta+,S1

·

 St+1

aA





Uta

 Hta+1

+

ta+,R1

·

Rt+1

+

ta+,S1

·

 St+1

-

K

|xk |||Stk+1 ||

aA

k=1

K

1/2

 u^t(n + x) - ||x||Ft

||Stk+1||2

,

k=1

and one obtains (B.6). Now define for every x  L0(Ft)K ,

p(x) = sup m[u^t(n + x/m) - u^t(n)].
mN

It follows from (B.6) and Ft-concavity that

L||x||Ft  p(x)  u^t(n + x) - u^t(n).

In particular, p maps L0(Ft)K to L0(Ft) and it is enough to show that there exists y  L(Ft)K

such that

x · y  p(x) for all x  L0(Ft)K .

(B.7)

Note that p satisfies

p(x) = p(x) for all x  L0(Ft)K and   L+0 (Ft) p(x + z)  p(x) + p(z) for all x, z  L0(Ft)K.

(B.8) (B.9)

In particular,

p(1Ax) = 1Ap(x) for all A  Ft and x  L0(Ft)K

(B.10)

and

0  p(x) + p(-x) for all x  L0(Ft)K .

(B.11)

Denote

 = ess sup p(x)  L.
xL0(Ft)K , ||x||Ft =1

It follows from (B.10) that there exists a sequence (xm)mN in L0(Ft)K such that ||xm||Ft = 1 and p(xm)   almost surely. It follows from Cheridito et al. (2011) that there exists a sequence (Mm)mN in N(Ft) such that Mm+1  Mm  m for all m  N and xMm  z almost surely for some z  L0(Ft)K with ||z||Ft = 1. One deduces from the fact that  is Ft-polyhedral that
p(z) = . So z is a direction of steepest ascent for the function p at 0. The random vector

y = +z

35

satisfies ||y||Ft  L. It remains to show that it fulfills (B.7). It clearly does so on the set {  0}. So to finish the proof, we can assume that P[ > 0] = 1. The subset

E

=

 z

:





L0

 (Ft)



L0(Ft)K

is Ft-linear and Ft-closed. So it follows from Cheridito et al. (2011) that L0(Ft)K = E + E and E  E = {0}

for the conditional orthogonal complement

E

=

 x



L0(Ft)K

:

x

·

v

=

0

for

all

v



 E

.

If we can show that

p(z + x)  p(z) for all   L0(Ft) and x  E,

(B.12)

it follows that

p(z + x)    (z + x) · y for all   L0(Ft) and x  E,

and the proof is complete. By (B.8) and (B.10), inequality (B.12) follows if we can show it for the three special cases  = 0,  = 1 and  = -1. If  = 0, it is enough to show that

p(x)  0 for all x  E such that ||x||Ft = 1.

(B.13)

Assume by way of contraction that there exists an x  E such that ||x||Ft = 1 and P[p(x) > 0] > 0. Then on the set {p(x) > 0}, one has







p z + 1 - 2x  p(z) + 1 - 2p(x) > p(z)

for the random variable



=

p2(z) p2(z) + p2

(x)

.

 But since ||z + 1 - 2x||Ft = 1, this contradicts the fact that z is a direction of steepest ascent of p at 0. So (B.13) must be true. Next, note that for all x  E,



p(z

+

x)

-

p(z)



lim
m

p(z

+

x/m) 1/m

-

p(z)



lim
m

1

+

||x||2Ft /m2 1/m

-

1

p(z)

=

0,

and therefore,

p(z + x)  p(z).

Finally, assume there exists an x  E such that P[p(-z + x) > -p(z)] > 0. Then one has

p(x/2)



p(-z

+

x) + p(z) 2

>

0

on the set {p(-z + x) > -p(z)}. But this contradicts (B.13). So (B.12) is proved.



36

C Proofs of Section 4

Proof of Proposition 4.2

Suppose (^at )tT=1,

there exists a  A. Let

an a

equilibrium price process (St)tT=0 A such that Uta satisfies (D) and

and equilibrium Cta+1 is Ft-open

trading for all t

strategies  T - 1.

^ta+1 maximizes

Uta

Hta+1

+

Rt+1

·

Rt+1

+

tS+1

·

 St+1

over all t+1  Cta+1. Fix j  {1, . . . , J} and choose an Ft-measurable random variable  > 0 such that ^ta+1 + ej  Cta+1, where ej is the j-th standard vector in RJ+K . Then one obtains
 E Rtj+1~ Uta(Hta+1 + ^ta+,R1 · Rt+1 + ^ta+,S1 · St+1) | Ft

=

lim
m

Uta(Hta+1

+

^at+,R1

·

Rt+1

+

^ta+,S1

·

St+1

+

Rtj+1/m) 1/m

-

Uta(Hta+1

+

^ta+,R1

·

Rt+1

+

^at+,S1

·

St+1)

= 0.

This shows that 
Rtj = E Rtj+1~ Uta(Hta+1 + ^ta+,R1 · Rt+1 + ^at+,S1 · St+1) | Ft ,

and one obtains by backwards induction that

Rtj

=

E

 RTj

T-1

~ Usa(Hsa+1

+

^sa+,R1

·

Rs+1

+

^sa+,S1

·

Ss+1)

|

 Ft

=

E

 RTj

s=t
T-1

~ Usa

 Usa+1

 Ha

+

T

  ^ar,R · Rr + ^ar,S · Sr | Ft

=

E

 RTj

s=t
T-1

~ Usa

 Usa+1

 Ha

+

r=s+1
T ^ar,R

·

Rr

+

^ar ,S

·

 Sr

|

 Ft

=

E

 RTj

s=t
Uta

 Ha

+

T

^ra,R

·

r=1
Rr +

^ra,S

·

 Sr

|

 Ft

.

r=1

The second equality is a consequence of the definition of the process (Hta)tT=0, the third holds because Usa and Usa+1 have the translation property (T), and the fourth one follows from formula (4.2). Analogously, one obtains

Stk

=

 E STk Uta

 Ha

+

T ^ra,R

·

Rr

+

^ra,S

·

 Sr

|

 Ft

r=1

for all k.

That

dQat dP

=

 Uta Ha

+

T ^sa,R
s=1

· Rs

+ ^sa,S

 · Ss

37

defines a probability measure Qa follows from the fact that Uta has the properties (M) and (T). If U0a is strictly monotone, one has

 T



U0a Ha + ^ar,R · Rr + ^ar,S · Sr > 0.

r=1

So Qa = Q0a is equivalent to P and one obtains (4.5).



Proof of Proposition 4.4

Assume there exist two optimal admissible trading strategies (^at )Tt=1 and (ta)Tt=1 for agent a and

a time s such that

^sa,R · Rs + ^as,S · Ss = as,R · Rs + as,S · Ss.

(C.1)

Then it follows by backwards induction that the strategy (~at )Tt=1 given by

~ta

 =

^at ta

if t = s if t = s

is again optimal. The two sides of (C.1) cannot differ only by a constant, for otherwise one of the

two strategies would be better than the other one. Therefore, strict concavity modulo translation

implies

 U0a Ha

T +

^at ,R

+ ~ta,R 2

· Rt

+

^at ,R

+ ~ta,S 2

 · St

>

 U0a Ha

+ T ^at ,R

· Rt

+ ^ta,S

 · St ,

t=1 t=1

a contradiction to the optimality of (^at )tT=1.



D Proofs of Section 5 and 6

Proof of Theorem 5.1 By assumption, there exist optimal admissible trading strategies (^ta)Tt=1 for all agents a  A, and the optimal one-step trading gains

^at ,R · Rt + ^ta,S · St, t  1,

are unique. Since Cta+1 = Ct+1/a - ta+1, the strategy ~at+1 := a(^ta+1 + ta+1) belongs to Ct+1 for all a  A and t  T - 1. Moreover, since Ut(X) = aUta(X/a), one has

 T

  T



Ut ~as,R · Rs + ~sa,S · Ss = ess supsCs Ut sR · Rs + sS · Ss

s=t+1

s=t+1

and ~ta,R · Rt + ~ta,S · St = ~tb,R · Rt + ~bt,S · St for all a, b  A and t  1.

It follows that the strategy



(^Rt ,

^tS )

=


aA

 a

(~ta,R,

~ta,S )

=



 ^at ,R + ta,R, n + tS+1
aA

,

t  1,

38

satisfies

 Ut

T

^sR

·

Rs

+

^sS

·

 Ss

=

ess supsCs Ut



T

 sR · Rs + sS · Ss

s=t+1

s=t+1

for all t  1. This shows (5.2) and (5.3) because Ut is of the form Ut(X) = aUta(X/a). The rest of the theorem follows from Proposition 4.2 by noting that if Ut satisfies (D) for all
t  T - 1, then

Ut

T

^Rs

·

Rs

+



 n

+

tS 

·

 Ss

=

Uta

s=T1 (^sa,R

+

sa)

·

Rs

+

(^sa,S

+

sa,S )

·

 Ss

s=1 T



= Uta Ha + ^as,R · Rs + ^as,S · Ss

s=1

for all a  A.



Proof of Proposition 6.1

It is enough to show that for every t  T -h, there exist random increments bit+h, i = d+1, . . . , D

such that

P[bit+h

=

 ±h

|

Ft] = 

1/2

for

i = d + 1, . . . , D,

(D.1)

E bit+hblt+h | Ft = 0 for all 1  i = l  D,

(D.2)

and

 x

+

z

·

bt+h

:

x



L0(Ft),

z



L0 (Ft )D 

=

L0(Ft+h).

(D.3)

By conditioning on Ft, one can assume t = 0. Set

Xi

=

1 h

bih,

i = 1, . . . , d.

The -algebra (X1, . . . , Xd) is generated by denote them by A1, . . . , A2d. There are D = 2d

the -1

2d

atoms

 X

1

=

random variables

±1, . . of the

. , Xd form



= ±1
iI

. X

Let us i, where

I is a non-empty subset of {1, . . . , d}. X1, . . . , Xd are d of them. Let us denote the remaining

ones by Xd+1, . . . , XD. Each Xi can only take the values ±1, and one obtains by symmetry that

P[Xi = ±1] = 1/2 for all i = 1, . . . , D.

(D.4)

Moreover,

E [XmXn] = 0 for all m = n.

(D.5)

This

holds

because

Xm

=


iI

Xi

and

Xn

=


jJ

Xj,

where

I

and

J

are

two

different

non-

empty subsets of {1, . . . , d}. Therefore, there exists an i which is in I but not in J or the other

way around. It then follows by independence that

E

[X m X n ]

=

E

 X

i



E

 X

mX

n /X i 

=

0.

39

(D.4) and all (X1, .

(.D. ,.X5)ds)h-moweatshuarta1b,leXr1a,n.d. o. ,mXvDaraiarebloersthogo2i=nd 1al.i

So they span 1Ai :   R2d

th. eIf2do-ndeimseetnssiobniha=l spahceXoif,

i = d + 1, . . . , D, then (D.1)­(D.3) are satisfied.



Proof of Proposition 6.2 For every Y  L0(Ft)D and m  N, one has

 -aft(AnfZtatSf+tahm+ZY|AtYa+|/hm++,ZZ^tatat+++,Rhhh+Z) -tR+^hatf+,tR+(hnZ^ZtRta+t+S,+Shhh+Z, tZS+^thta++,Shh),ZtS+h
aA

and therefore,



lim sup

m

Y

·

1 |A|

m ft(nZtS+h + Y
 fta Zta+h +
aA

/m, Zt+h) ^at+,RhZtR+h

- +

ft(nZtS+h,

 Zt+h)

 ^ta+,ShZtS+h .

But since ft is conditionally convex in v, the lim sup is a lim and the inequality an equality. This

shows that vft(nZtS+h, Zt+h) exists and is equal to (6.7).



References
Anderson, R.M., Raimondo, R.C. (2009). Equilibrium in continuous-time financial markets: endogenously dynamically complete markets. Econometrica 76(4), 841­907.
Anthropelos, M., Zitkovi´c, G. (2010). Partial Equilibria with convex capital requirements: existence, uniqueness and stability. Annals of Finance 6(1) 107­135.
Avellaneda, M., Lipkin, M. (2009). A dynamic model for hard-to-borrow stocks. Risk Magazine.
Bakshi, G.N., Kapadia, N., Madan, D. (2003). Stock return characteristics, skew laws, and the differential pricing of individual equity options. Review of Financial Studies 16, 101­143.
Ben-Tal, A., Teboulle, M. (1986). Expected utility, penalty functions, and duality in stochastic nonlinear programming. Man. Science. 32(11), 1445­1466.
Ben-Tal, A., Teboulle, M. (1987). Penalty functions and duality in stochastic programming via -divergence functionals. Math. Oper. Research 12, 224­240.
Black, F., Scholes, M. (1973). The pricing of options and corporate liabilities. J. Pol. Econ. 81, 637­654.
Bollen, N.P., Whaley, R.E. (2004). Does net buying pressure affect the shape of implied volatility functions? Journal of Finance, 59, 711­753.

40

Borch K. (1984). Equilibrium in an insurance market. Journal of Risk and Insurance 51(3), 468­ 476.
Brown, D.J., Werner, J. (1995). Arbitrage and the existence of equilibrium in infinite asset markets. Review of Economic Studies, 62, 101­114.
Carmona, R., Fehr, M., Hinz, J., Porchet, A. (2010). Market design for emission trading schemes, SIAM Rev. 52(3), 403­452.
Cheng, H. (1991). Asset market equilibrium in infinite dimensional complete markets, J. Math. Econ. 20, 137­152.
Cheridito, P., Delbaen F., Kupper M. (2005). Coherent and convex monetary risk measures for unbounded c`adl`ag processes. Finance and Stochastics 9(3), 369­387.
Cheridito, P., Li, T. (2009). Risk measures on Orlicz hearts. Mathematical Finance 19(2), 189­214.
Cheridito, P., Kupper, M., Vogelpoth, N. (2011). Conditional analyis on Rd. Preprint.
Cherny, A.S., Kupper, M. (2009). Divergence utilities. Preprint.
Csiszar, I. (1967). On topological properties of f-divergence. Studia Sci. Math. Hungarica 2, 329­ 339.
Cuoco, D., He, H. (2001). Dynamic aggregation and computation of equilibria in finite-dimensional economies with incomplete financial markets. Annals of Economics and Finance 2, 265-296.
Dalang, R.C., Morton, A., Willinger, W. (1990). Equivalent martingale measures and no-arbitrage in stochastic securities market model. Stochastics and Stochastic Reports 29, 185­201.
Dana, R.A., Le Van, C., Magnien, F. (1997). General equilibrium in asset markets with or without short-selling. Journal of Mathematical Analysis and Its Applications 206, 567­588.
Dana, R.A., Le Van, C., Magnien, F. (1999). On different notions of arbitrage and existence of equilibrium. Journal of Economic Theory 87, 169­193.
Delbaen F., Schachermayer M. (1996). The variance-optimal martingale measure for continuous processes. Bernoulli 2, 81­105.
Duffie, D. (1987). Stochastic equilibria with incomplete financial markets. Journal of Economic Theory 41, 405­416.
Dumas, B., Lyasoff, A. (2009). Incomplete-market equilibria solved recursively on an event tree. Preprint.
Filipovi´c, D., Kupper, M. (2008). Equilibrium prices for monetary utility functions. International Journal of Theoretical and Applied Finance 11, 325­343.
Fo¨llmer, H., Schied, A. (2004). Stochastic Finance, An Introduction in Discrete Time. de Gruyter Studies in Mathematics 27. Second Edition.
41

F¨ollmer, H., Schweizer, M. (1991). Hedging of contingent claims under incomplete information. in: M. H. A. Davis and R. J. Elliott (eds.). Applied Stochastic Analysis, Stochastics Monographs, Vol. 5, Gordon and Breach, London/New York 389­414.
Frittelli M. (2000). The minimal entropy martingale measure and the valuation problem in incomplete markets. Mathematical Finance 10, 39­52.
Ga^rleanu, N., Pedersen, L.H. and Poteshman, A.M. (2009). Demand-based option pricing. The Review of Financial Studies 22, 4259­4299.
Geanakoplos, J. (1990). An introduction to general equilibrium with incomplete asset markets. Journal of Mathematical Economics 19, 1­38.
Gerber, H.U., Shiu, E.S.W. (1994). Option pricing by Esscher transforms. Transactions of the Society of Actuaries XLVI, 99­191.
Henderson, V., Hobson, D. (2009). Utility indifference pricing - an overview. In Volume on Idifference Pricing, (ed. R. Carmona), Princeton University Press.
Horst, U., Mu¨ller, M. (2007). On the spanning property of risk bonds priced by equilibrium. Math. Oper. Res. 32(4), 784­807.
Horst, U., Pirvu, T., dos Reis, G. (2010). On securitization, market completion and equilibrium risk transfer. Math. Fin. Econ. 2(4), 211­252.
Hugonnier, J. (2010). Rational asset pricing bubbles and portfolio constraints. Preprint.
Jofre, A., Rockafellar, R.T. Wets, R.J.B. (2010). General economic equilibrium with incomplete markets and money. Preprint.
Lipton, A. (2002). The vol smile problem. Risk Magazine 15(2), 61­65.
Maccheroni, F., Marinacci, M., and Rustichini, A., Taboga, M. (2009). Portfolio selection with monotone mean-variance preferences. Mathematical Finance 19, 587­521.
Magill, M., Shafer, W. (1990). Characterization of Generically Complete Real Asset Structures. Journal of Mathematical Economics, 19, 167­194.
Magill, M., Shafer, W. (1991). Magill, M., Shafer, W. 1991. Incomplete markets. In: Hildebrand, W. and H. Sonnenschein (eds.), Handbook of Mathematical Economics, vol. IV, Elsevier, New York
Magill, M., Quinzii, M. (1996). Magill, M. and M. Quinzii. Theory of Incomplete Markets, Vol. 1. MIT Press, Cambridge.
Neveu, J. (1975). Discrete-Parameter Martingales. North-Holland Publishing CompanyAmsterdam, Oxford.
Schweizer M. (1995). Variance-optimal hedging in discrete time. Math. Oper. Res. 20, 1­32.
42

Schweizer M. (1996). Approximation pricing and the variance-optimal martingale measure. Annals of Probability 24, 206­236.
Werner, J. (1987). Arbitrage and the existence of competitive equilibrium. Econometrica 55, 1403­1418.
43

SFB 649 Discussion Paper Series 2011
For a complete list of Discussion Papers published by the SFB 649, please visit http://sfb649.wiwi.hu-berlin.de.
001 "Localising temperature risk" by Wolfgang Karl Härdle, Brenda López Cabrera, Ostap Okhrin and Weining Wang, January 2011.
002 "A Confidence Corridor for Sparse Longitudinal Data Curves" by Shuzhuan Zheng, Lijian Yang and Wolfgang Karl Härdle, January 2011.
003 "Mean Volatility Regressions" by Lu Lin, Feng Li, Lixing Zhu and Wolfgang Karl Härdle, January 2011.
004 "A Confidence Corridor for Expectile Functions" by Esra Akdeniz Duran, Mengmeng Guo and Wolfgang Karl Härdle, January 2011.
005 "Local Quantile Regression" by Wolfgang Karl Härdle, Vladimir Spokoiny and Weining Wang, January 2011.
006 "Sticky Information and Determinacy" by Alexander Meyer-Gohde, January 2011.
007 "Mean-Variance Cointegration and the Expectations Hypothesis" by Till Strohsal and Enzo Weber, February 2011.
008 "Monetary Policy, Trend Inflation and Inflation Persistence" by Fang Yao, February 2011.
009 "Exclusion in the All-Pay Auction: An Experimental Investigation" by Dietmar Fehr and Julia Schmid, February 2011.
010 "Unwillingness to Pay for Privacy: A Field Experiment" by Alastair R. Beresford, Dorothea Kübler and Sören Preibusch, February 2011.
011 "Human Capital Formation on Skill-Specific Labor Markets" by Runli Xie, February 2011.
012 "A strategic mediator who is biased into the same direction as the expert can improve information transmission" by Lydia Mechtenberg and Johannes Münster, March 2011.
013 "Spatial Risk Premium on Weather Derivatives and Hedging Weather Exposure in Electricity" by Wolfgang Karl Härdle and Maria Osipenko, March 2011.
014 "Difference based Ridge and Liu type Estimators in Semiparametric Regression Models" by Esra Akdeniz Duran, Wolfgang Karl Härdle and Maria Osipenko, March 2011.
015 "Short-Term Herding of Institutional Traders: New Evidence from the German Stock Market" by Stephanie Kremer and Dieter Nautz, March 2011.
016 "Oracally Efficient Two-Step Estimation of Generalized Additive Model" by Rong Liu, Lijian Yang and Wolfgang Karl Härdle, March 2011.
017 "The Law of Attraction: Bilateral Search and Horizontal Heterogeneity" by Dirk Hofmann and Salmai Qari, March 2011.
018 "Can crop yield risk be globally diversified?" by Xiaoliang Liu, Wei Xu and Martin Odening, March 2011.
019 "What Drives the Relationship Between Inflation and Price Dispersion? Market Power vs. Price Rigidity" by Sascha Becker, March 2011.
020 "How Computational Statistics Became the Backbone of Modern Data Science" by James E. Gentle, Wolfgang Härdle and Yuichi Mori, May 2011.
021 "Customer Reactions in Out-of-Stock Situations ­ Do promotion-induced phantom positions alleviate the similarity substitution hypothesis?" by Jana Luisa Diels and Nicole Wiebach, May 2011.
SFB 649, Spandauer Str. 1, D-10178 Berlin http://sfb649.wiwi.hu-berlin.de
This research was supported by the Deutsche Forschungsgemeinschaft through the SFB 649 "Economic Risk".

SFB 649 Discussion Paper Series 2011
For a complete list of Discussion Papers published by the SFB 649, please visit http://sfb649.wiwi.hu-berlin.de.
022 "Extreme value models in a conditional duration intensity framework" by Rodrigo Herrera and Bernhard Schipp, May 2011.
023 "Forecasting Corporate Distress in the Asian and Pacific Region" by Russ Moro, Wolfgang Härdle, Saeideh Aliakbari and Linda Hoffmann, May 2011.
024 "Identifying the Effect of Temporal Work Flexibility on Parental Time with Children" by Juliane Scheffel, May 2011.
025 "How do Unusual Working Schedules Affect Social Life?" by Juliane Scheffel, May 2011.
026 "Compensation of Unusual Working Schedules" by Juliane Scheffel, May 2011.
027 "Estimation of the characteristics of a Lévy process observed at arbitrary frequency" by Johanna Kappus and Markus Reiß, May 2011.
028 "Asymptotic equivalence and sufficiency for volatility estimation under microstructure noise" by Markus Reiß, May 2011.
029 "Pointwise adaptive estimation for quantile regression" by Markus Reiß, Yves Rozenholc and Charles A. Cuenod, May 2011.
030 "Developing web-based tools for the teaching of statistics: Our Wikis and the German Wikipedia" by Sigbert Klinke, May 2011.
031 "What Explains the German Labor Market Miracle in the Great Recession?" by Michael C. Burda and Jennifer Hunt, June 2011.
032 "The information content of central bank interest rate projections: Evidence from New Zealand" by Gunda-Alexandra Detmers and Dieter Nautz, June 2011.
033 "Asymptotics of Asynchronicity" by Markus Bibinger, June 2011. 034 "An estimator for the quadratic covariation of asynchronously observed
Itô processes with noise: Asymptotic distribution theory" by Markus Bibinger, June 2011. 035 "The economics of TARGET2 balances" by Ulrich Bindseil and Philipp Johann König, June 2011. 036 "An Indicator for National Systems of Innovation - Methodology and Application to 17 Industrialized Countries" by Heike Belitz, Marius Clemens, Christian von Hirschhausen, Jens Schmidt-Ehmcke, Axel Werwatz and Petra Zloczysti, June 2011. 037 "Neurobiology of value integration: When value impacts valuation" by Soyoung Q. Park, Thorsten Kahnt, Jörg Rieskamp and Hauke R. Heekeren, June 2011. 038 "The Neural Basis of Following Advice" by Guido Biele, Jörg Rieskamp, Lea K. Krugel and Hauke R. Heekeren, June 2011. 039 "The Persistence of "Bad" Precedents and the Need for Communication: A Coordination Experiment" by Dietmar Fehr, June 2011. 040 "News-driven Business Cycles in SVARs" by Patrick Bunk, July 2011. 041 "The Basel III framework for liquidity standards and monetary policy implementation" by Ulrich Bindseil and Jeroen Lamoot, July 2011. 042 "Pollution permits, Strategic Trading and Dynamic Technology Adoption" by Santiago Moreno-Bromberg and Luca Taschini, July 2011. 043 "CRRA Utility Maximization under Risk Constraints" by Santiago MorenoBromberg, Traian A. Pirvu and Anthony Réveillac, July 2011.
SFB 649, Spandauer Str. 1, D-10178 Berlin http://sfb649.wiwi.hu-berlin.de
This research was supported by the Deutsche Forschungsgemeinschaft through the SFB 649 "Economic Risk".

SFB 649 Discussion Paper Series 2011
For a complete list of Discussion Papers published by the SFB 649, please visit http://sfb649.wiwi.hu-berlin.de.
044 "Predicting Bid-Ask Spreads Using Long Memory Autoregressive Conditional Poisson Models" by Axel Groß-Klußmann and Nikolaus Hautsch, July 2011.
045 "Bayesian Networks and Sex-related Homicides" by Stephan Stahlschmidt, Helmut Tausendteufel and Wolfgang K. Härdle, July 2011.
046 "The Regulation of Interdependent Markets", by Raffaele Fiocco and Carlo Scarpa, July 2011.
047 "Bargaining and Collusion in a Regulatory Model", by Raffaele Fiocco and Mario Gilli, July 2011.
048 "Large Vector Auto Regressions", by Song Song and Peter J. Bickel, August 2011.
049 "Monetary Policy, Determinacy, and the Natural Rate Hypothesis", by Alexander Meyer-Gohde, August 2011.
050 "The impact of context and promotion on consumer responses and preferences in out-of-stock situations", by Nicole Wiebach and Jana L. Diels, August 2011.
051 "A Network Model of Financial System Resilience", by Kartik Anand, Prasanna Gai, Sujit Kapadia, Simon Brennan and Matthew Willison, August 2011.
052 "Rollover risk, network structure and systemic financial crises", by Kartik Anand, Prasanna Gai and Matteo Marsili, August 2011.
053 "When to Cross the Spread: Curve Following with Singular Control" by Felix Naujokat and Ulrich Horst, August 2011.
054 "TVICA - Time Varying Independent Component Analysis and Its Application to Financial Data" by Ray-Bing Chen, Ying Chen and Wolfgang K. Härdle, August 2011.
055 "Pricing Chinese rain: a multi-site multi-period equilibrium pricing model for rainfall derivatives" by Wolfgang K. Härdle and Maria Osipenko, August 2011.
056 "Limit Order Flow, Market Impact and Optimal Order Sizes: Evidence from NASDAQ TotalView-ITCH Data" by Nikolaus Hautsch and Ruihong Huang, August 2011.
057 "Optimal Display of Iceberg Orders" by Gökhan Cebirolu and Ulrich Horst, August 2011.
058 "Optimal liquidation in dark pools" by Peter Kratz and Torsten Schöneborn, September 2011.
059 "The Merit of High-Frequency Data in Portfolio Allocation" by Nikolaus Hautsch, Lada M. Kyj and Peter Malec, September 2011.
060 "On the Continuation of the Great Moderation: New evidence from G7 Countries" by Wenjuan Chen, September 2011.
061 "Forward-backward systems for expected utility maximization" by Ulrich Horst, Ying Hu, Peter Imkeller, Anthony Réveillac and Jianing Zhang.
062 "On heterogeneous latent class models with applications to the analysis of rating scores" by Aurélie Bertrand and Christian M. Hafner, October 2011.
063 "Multivariate Volatility Modeling of Electricity Futures" by Luc Bauwens, Christian Hafner and Diane Pierret, October 2011.
SFB 649, Spandauer Str. 1, D-10178 Berlin http://sfb649.wiwi.hu-berlin.de
This research was supported by the Deutsche Forschungsgemeinschaft through the SFB 649 "Economic Risk".

SFB 649 Discussion Paper Series 2011
For a complete list of Discussion Papers published by the SFB 649, please visit http://sfb649.wiwi.hu-berlin.de.
064 "Semiparametric Estimation with Generated Covariates" by Enno Mammen, Christoph Rothe and Melanie Schienle, October 2011.
065 "Linking corporate reputation and shareholder value using the publication of reputation rankings" by Sven Tischer and Lutz Hildebrandt, October 2011.
066 "Monitoring, Information Technology and the Labor Share" by Dorothee Schneider, October 2011.
067 "Minimal Supersolutions of BSDEs with Lower Semicontinuous Generators" by Gregor Heyne, Michael Kupper and Christoph Mainberger, October 2011.
068 "Bargaining, Openness, and the Labor Share" by Dorothee Schneider, October 2011.
069 "The Labor Share: A Review of Theory and Evidence" by Dorothee Schneider, October 2011.
070 "The Power of Sunspots: An Experimental Analysis" by Dietmar Fehr, Frank Heinemann and Aniol Llorente-Saguer, October 2011.
071 "Econometric analysis of volatile art markets" by Fabian Y. R. P. Bocart and Christian M. Hafner, October 2011.
072 "Financial Network Systemic Risk Contributions" by Nikolaus Hautsch, Julia Schaumburg and Melanie Schienle, October 2011.
073 "Calibration of self-decomposable Lévy models" by Mathias Trabs, November 2011.
074 "Time-Varying Occupational Contents: An Additional Link between Occupational Task Profiles and Individual Wages" by Alexandra Fedorets, November 2011.
075 "Changes in Occupational Demand Structure and their Impact on Individual Wages" by Alexandra Fedorets, November 2011.
076 "Nonparametric Nonstationary Regression with Many Covariates" by Melanie Schienle, November 2011.
077 "Increasing Weather Risk: Fact or Fiction?" by Weining Wang, Ihtiyor Bobojonov, Wolfgang Karl Härdle and Martin Odening, November 2011.
078 "Spatially Adaptive Density Estimation by Localised Haar Projections" by Florian Gach, Richard Nickl and Vladimir Spokoiny, November 2011.
079 "Martingale approach in pricing and hedging European options under regime-switching" by Grigori N. Milstein and Vladimir Spokoiny, November 2011.
080 "Sparse Non Gaussian Component Analysis by Semidefinite Programming" by Elmar Diederichs, Anatoli Juditsky, Arkadi Nemirovski and Vladimir Spokoiny, November 2011.
081 "Parametric estimation. Finite sample theory" by Vladimir Spokoiny, November 2011.
082 "Continuous Equilibrium under Base Preferences and Attainable Initial Endowments" by Ulrich Horst, Michael Kupper, Andrea Macrinay and Christoph Mainberger, November 2011.
083 "Equilibrium Pricing in Incomplete Markets under Translation Invariant Preferences" by Patrick Cheridito, Ulrich Horst, Michael Kupper and Traian A. Pirvu, November 2011.
SFB 649, Spandauer Str. 1, D-10178 Berlin http://sfb649.wiwi.hu-berlin.de
This research was supported by the Deutsche Forschungsgemeinschaft through the SFB 649 "Economic Risk".

