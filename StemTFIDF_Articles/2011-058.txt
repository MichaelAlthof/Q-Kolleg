BERLIN

SFB 6 4 9 E C O N O M I C R I S K

SFB 649 Discussion Paper 2011-058
Optimal liquidation in dark pools
Peter Kratz* Torsten Schöneborn**
* Humboldt-Universität zu Berlin, Germany ** Deutsche Bank AG, London, UK
This research was supported by the Deutsche Forschungsgemeinschaft through the SFB 649 "Economic Risk".
http://sfb649.wiwi.hu-berlin.de ISSN 1860-5664
SFB 649, Humboldt-Universität zu Berlin Spandauer Straße 1, D-10178 Berlin

Optimal liquidation in dark pools$
Peter Kratz
Humboldt Universität zu Berlin, Unter den Linden 6, 10099 Berlin, Germany
Torsten Schöneborn
Deutsche Bank AG, London, UK

Abstract
We consider a large trader seeking to liquidate a portfolio using both a transparent trading venue and a dark pool. Our model captures the price impact of trading in transparent traditional venues as well as the execution uncertainty of trading in a dark pool. The unique optimal execution strategy uses both venues continuously. The order size in the dark pool can over- or underrepresent the portfolio size depending on adverse selection and the correlation structure of the assets in the portfolio. Introduction a dark pool results in delayed trading at the traditional venue. The appeal of the dark pool is increased by liquidity but reduced by adverse selection. By pushing up prices at the traditional venue and parallel selling in the dark pool, a trader might generate profits; we provide sufficient conditions to rule out such profitable price manipulation strategies.
Keywords: Dark pools, Optimal liquidation, Adverse selection, Market microstructure, Illiquid markets JEL: C02, C61, G11

1. Introduction
In the last years, equity trading has been transformed by the advent of so called dark pools. These alternative trading venues differ significantly from classical exchanges. Especially in the US equities market dark pools have gained a significant market share. Although dark pools vary in a number of properties such as ownership, crossing procedure and accessibility (see Mittal (2008) and Degryse et al. (2009b) for further details and a typology of dark pools), they generally share the following two stylized facts. First, dark pools are dark. The liquidity available is not quoted, making trade execution uncertain and unpredictable. Second, dark pools do not determine prices. Instead, they monitor the prices determined by the classical exchanges and settle trades in the dark pool only if possible at these prices. Thus, trades in the dark pool have no or less price impact.1 In this paper, we analyze trade execution when trading is possible both at the classical exchange as well as in the dark pool. We first propose a model that captures the stylized facts above for trading in such a market. Then we determine the optimal trade execution strategy in a discrete time framework.
Our model for trading and price formation at the classical exchange is a general price impact model. Trade execution can be enforced by selling aggressively, which however results in higher execution costs due to a stronger price impact. The dark pool in our model provides a limited and previously unknown amount of liquidity that can be used for trade execution without price impact. Trades in the dark pool are executed until the liquidity is exhausted, and there is no way to achieve trade execution in the dark pool for larger orders. The split of orders between dark pool and exchange is thus driven by the trade-off between execution uncertainty and price impact costs. While there is no feedback from the dark pool to the price determined at the exchange, the two venues can be connected since liquidity in the dark pool and price movements at the

$We wish to thank Swagato Acharjee, Christoph Baumgarten, Sebastian Jaimungal, Ulrich Horst, Werner Kratz, Daniel Nehren and Mark van Achter for useful discussions and comments. We are also grateful to seminar participants at the University of Bonn, the EFA Meeting 2009, the DGF Meeting 2009, the Princeton-Humboldt Workshop 2009, the CFF Research Conference 2010, the GOCPS 2010 and the SIAM Conference on Financial Mathematics & Engeneering 2010. This research was supported by Deutsche Bank through Quantitative Products Laboratory and the SFB 649 Economic Risk.
Email addresses: kratz@math.hu-berlin.de (Peter Kratz), schoeneborn@math.tu-berlin.de (Torsten Schöneborn) 1For empirical evidence for lower transaction costs or price impact of dark pools compared to classical exchanges see, e.g., Conrad et al. (2003) and Fong et al. (2004).

Preprint submitted to SSRN

August 31, 2011

primary exchange can be dependent. For example, liquidity on the bid side of the dark pool might be unusually high exactly when prices move up. By allowing for such dependencies in our model, we can incorporate and analyze adverse selection in the dark pool.
In our model, we prove the existence and uniqueness of optimal execution strategies that trade simultaneously at the primary exchange and in the dark pool. Subsequently, we consider a specific multi asset market model with linear price impact. The model can be specified by a small set of parameters which can be directly estimated from trade execution data. In this market model, we obtain a linear solution of the optimal trade execution problem which can be computed recursively. This recursive scheme makes the model tractable for practicable applications and allows us to investigate several examples. When liquidating a position in a single asset, the current asset position is at all times being offered in the dark pool, while it is liquidated in parallel at the primary exchange. The opportunity to trade in the dark pool leads to a slower liquidation at the primary exchange compared to a market without a dark pool. Traders hence need to fundamentally adjust their trade execution algorithms when a dark pool is introduced. It is not sufficient to use an algorithm that was optimal for execution at the exchange and to add a component that also places trades in the dark pool; instead, trading at the exchange needs to be adjusted during the entire trade execution time interval. Adverse selection in the dark pool results in higher effective trading costs, which leads to reduced order sizes in the dark pool and can trigger a complete avoidance of the dark pool. In order to keep their trading venue attractive, dark pool operators hence need to balance attracting liquidity while limiting adverse selection.2
While in a single asset setting the entire asset position is placed in the dark pool, this is not true if a multi-asset portfolio is to be liquidated. If the portfolio is balanced and thus only exposed to little market risk, then a complete liquidation of the position in one of the assets is unfavorable and thus only a fraction of the entire portfolio should be placed in the dark pool. This highlights again that overly simple adjustments to existing trade execution algorithms are exposed to potential pitfalls. For dark pools, the reluctance of traders to place balanced portfolios in a dark pool is an incentive to offer balanced executions in order to attract more liquidity.
Whenever traders have an influence on market prices, the question of price manipulation arises. The co-existence of two trading venues opens up new opportunities in this regard: A trader could for example continuously buy an asset at the exchange, thus pushing its price up, and could thereafter sell the asset at the elevated price in the dark pool. We find that such strategies can indeed be profitable, but can be ruled out in our model if either trades do not have an impact on dark pool transaction prices or if liquidity in the dark pool is limited and exposed to sufficiently high adverse selection.
Our paper is connected to three lines of theoretical research. First, it builds on research on optimal trade execution strategies for a single trader in models with exogenously given liquidity effects. Several such models have been proposed for classical trading venues, e.g., Bertsimas and Lo (1998), Almgren and Chriss (2001), Almgren (2003), Obizhaeva and Wang (2006), Schied and Schöneborn (2009), Alfonsi et al. (2010a) and Schied et al. (2010). All of these models are limited to trading on one venue. Since the advantages and disadvantages of these models are still a topic of ongoing research, we propose a discrete-time market model for the primary trading venue that generalizes all of these models. Furthermore we introduce a dark pool which can be used in parallel. After establishing existence and uniqueness of the optimal trading strategy in this general model, we subsequently follow Almgren and Chriss (2001) and assume a more specific linear temporary price impact model for the primary venue. This choice yields a tractable model which nevertheless captures price impact effects and can be calibrated to data. Linear price impact models have become the basis of several theoretical studies, e.g., Rogers and Singh (2010), Almgren and Lorenz (2007), Carlin et al. (2007) and Schöneborn and Schied (2009). Furthermore, they demonstrated reasonable properties in real world applications and serve as the basis of many optimal execution algorithms run by practitioners (see e.g., Kissell and Glantz (2003), Schack (2004), Abramowitz (2006) and Leinweber (2007)).
A second line of theoretical research connected to our paper focuses on the underlying mechanisms for illiquidity effects. Early examples include Kyle (1985), Glosten and Milgrom (1985) and Grossman and Miller (1988). In these models, price impact arises endogenously through the interplay of market participants. More recently, such models have been proposed to analyze the competition between classical trading venues and dark pools. Hendershott and Mendelson (2000) analyze the interaction of dealer markets and a crossing network3 in a static one period framework, where each investor buys or sells a single share. Their findings include that trading in a crossing network is cheaper than in dealer markets since the trader saves
2Often applied measures include tightly controlling access to the dark pool as well as implementing an anti-gaming logic. 3Crossing networks are specific types of dark pools that offer periodic matching of buy and sell orders.
2

half the spread, but trade execution is uncertain in the crossing network. Additionally the authors find that cost savings in the crossing network are possibly decreased by adverse selection due to information asymmetry. In a similar setting, Dönges and Heinemann (2006) focus on game-theoretic refinements in order to remove the multiplicity of equilibria in Hendershott and Mendelson (2000). Degryse et al. (2009a) introduce a dynamic multi-period framework and compare the effect of different levels of transparency of the dark pool. Contrary to these endogenous trading models, we exogenously specify the liquidity properties. This offers a large degree of freedom to calibrate the model to the complex quantitative relationships of price impact and adverse selection in financial markets. Additionally, by focusing on a single large trader we can allow this trader to split her orders over time as well as between the two trading venues. While executing her order over time, she can dynamically react to the existence or absence of liquidity in the dark pool and adjust her trading strategy accordingly. Furthermore we can take a multi-asset perspective and investigate how the composition of basket portfolios influences optimal trade execution strategies.
Price manipulation is a third area of theoretical research relevant to our paper. Through price impact the large trader can influence the prices at which she can trade at a later point in time. If this is strategically exploited it can be possible for the large trader to obtain a profit from a round trip trading strategy. Several papers have derived necessary and sufficient conditions for the absence of price manipulation, for example Huberman and Stanzl (2004), Gatheral (2010) and Alfonsi et al. (2010b). Parallel trading on two different trading venues opens up new opportunities for such market abuse. We propose a new definition of price manipulation in this context and consider a strategy to be manipulative if the trader is buying at one venue and at the same point in time selling at the other venue. We provide sufficient conditions for the absence of such price manipulation. Klöck et al. (2011) have subsequently derived complementary results in a similar model.
An increasing number of empirical papers analyzes the effects of dark pools on transaction costs. Conrad et al. (2003) analyze transaction costs of traditional and alternative trading systems. With respect to crossing networks they find that realized execution costs are lower than in broker filled orders. Fong et al. (2004) examine price impact of block trades across the upstairs market, a crossing network and the limit order book. Their findings include that crossing networks provide lower price impact for block trades than the consolidated limit order book. Using the same data set Næs and Ødegaard (2006) and Næs and Skjeltorp (2003) analyze the effect of adverse selection due to private information on transaction costs. While Næs and Ødegaard (2006) find that lower transaction costs for crossing networks are possibly mitigated by adverse selection, Næs and Skjeltorp (2003) argue that differences in liquidity of stocks that were crossed and stocks that were not are systematic and thus not due to private information. Ready (2010) analyzes determinants of volume in dark pools and shows that the volume share of dark pools is negatively correlated to consolidated volume.
The remainder of this paper is structured as follows. In Section 2, we introduce the market model. This consists of a model for the primary trading venue (Section 2.1) and for the dark pool (Section 2.2). Furthermore, we describe the trader's objective function (Section 2.3). Existence and uniqueness of optimal trade execution strategies are established in Section 3. In Section 4, we propose a specific tractable market model and analyze its properties. We discuss adverse selection in Section 5 and practical trading restrictions in Section 6. We conclude with an investigation of price manipulation in Section 7. Appendix Appendix A provides a discussion of the risk criterion we consider. Explicit recursions and closed form solutions for the optimal trading strategies and cost functionals of Section 4 and 5 are collected in Appendix Appendix B and Appendix Appendix C, respectively. All proofs are presented in Appendix Appendix D.

2. Model description

The market we consider consists of a risk-free asset and n risky assets. For simplicity of exposition, we assume that the
risk-free asset does not generate interest. Large transactions are usually executed within a few hours or at most a few days; the effect of discounting is therefore marginal, and we will not consider it in this paper. We analyze a discrete-time model, i.e., we assume that trades can be executed at the (not necessarily equidistant4) time points

0 = t0 < · · · < tN = T.

(1)

4For example, the distance can be taken in volume time to adjust for the U-shaped intraday pattern of market volatility and liquidity.

3

At each of these time points, we assume that the seller as well as a number of noise traders execute orders. We denote the orders of the seller at time ti at the primary venue by

x(ti) = (x1(ti), . . . , xn(ti))  Rn

(2)

and in the dark pool by

y(ti) = (y1(ti), . . . , yn(ti))  Rn.

(3)

Positive entries denote sell orders and negative entries denote buy orders. We allow for dynamic liquidation strategies that
can react to changes in market prices and to liquidity in the dark pool. To this end we assume that the orders x and y are adapted stochastic processes relative to a stochastic basis (, F , F = (F(ti))i0,...,N, P). In the following Sections 2.1 and 2.2 we describe the different effects of the orders x(ti) and y(ti). The execution of the order x(ti) at the primary venue is guaranteed but has an adverse effect on the market price. The execution of the order yi in the dark pool is uncertain but has no price impact (irrespective of whether it is executed or not). In Section 2.3 we define the trading objective of the investor and specify
the set of admissible strategies.

2.1. Transaction price and impact of primary venue orders

We assume that the transaction price P(ti)  Rn at the primary venue at time ti can be decomposed into the price impact of

the primary venue trades (x(t j)) j=0,...,i of the large trader and the "fundamental" asset price P~(ti)  Rn that would have occurred

in the absence of large trades. We model the fundamental asset price P~(ti) as a stochastic process with independent increments

(ti)  Rn:

P~ (ti+1) = P~ (ti) + (ti+1).

(4)

To avoid technical difficulties, we assume that the underlying probability space  is finite and all its elements have positive probability.5 We do not make assumptions on the distributions of the (ti). In particular, they can have different distributions. The random price changes (ti) reflect the noise traders' actions as well as all external events, e.g., news. The assumption of independence of the (ti) implies that the random price changes do not exhibit autocorrelation. The results we derive are sensitive to this assumption; autocorrelation will in principle have an effect on the proceeds of any dynamic trading strategy. Including autocorrelation in the market model however shifts the focus from optimal liquidation to optimal investment: even
without any initial asset position, the mathematical model will recommend high-frequency trading to exploit the autocorrelation. But this effect is not related to the original question of optimal execution. Furthermore, many investors do not have an explicit view on autocorrelation and thus choose an execution algorithm that is optimal under the assumption of independence of price increments. Finally, for realistic parameters the effect of autocorrelation on the optimal execution strategy and the resulting execution cost is marginal as was demonstrated by Almgren and Chriss (2001). For these reasons, we do not include
autocorrelation in our market model.
It has long been documented that trades have an impact on subsequent market prices, see for example Kraus and Stoll (1972). Several explanations of this effect have been suggested, for example limited liquidity (see, e.g., Grossman and Miller (1988) and Duffie (2010)) and private information (see, e.g., Kyle (1985) and Glosten and Milgrom (1985)). We do not seek to explicitly model the underlying mechanisms resulting in price impact, but instead assume an exogenously given relationship.
This allows the model to capture a wide range of complex price impact dynamics which are usually not explicable by tractable full equilibrium models. We allow a general form of the impact of the trades6 x(t0), . . . , x(ti) on the transaction price P(ti):

P(ti) = P~(ti) - fi(x(t0), . . . , x(ti)), 

"Fundamental"

Price impact

asset price

of seller

(5)

5The results of this paper also hold for infinite  if the price increments (ti) satisfy suitable conditions and the set of admissible strategies is chosen
appropriately. 6In reality, the trade x(ti) is often not executed as one instantaneous order at time ti, but rather as a sequence of smaller orders over the time interval
[ti, ti+1). For the purposes of this paper, we do not specify when and how exactly the trade x(ti) is executed but only assume that the transaction price is given by P(ti) as in Equation (5).

4

where fi : Rn×(i+1)  Rn. By allowing fi to depend on x(ti), we allow the order x(ti) to influence its own execution price (in the form of a temporary price impact). Adverse selection effects at the primary venue can be captured in the model through
this price impact formulation. We define the price impact costs of trading as

N
x(ti) fi(x(t0), . . . , x(ti)).
i=0
Assumption 2.1. The price impact costs fulfill the following two conditions.
N
(i) x(ti) fi(x(t0), . . . , x(ti)) is strictly convex in (x(t0), . . . , x(tN)).
i=0 N
(ii) x(ti) fi(x(t0), . . . , x(ti)) grows superlinearly, i.e.,
i=0

(6)

N

x(ti) fi(x(t0), . . . , x(ti))

lim i=0

= .

(x(t0),...,x(tN )) 

(x(t0), . . . , x(tN))

(7)

This framework generalizes many of the existing market impact models of liquidity. For example, the model suggested by Almgren and Chriss (2001) is equivalent to assuming that the (ti) are identically normally distributed and

i-1
fi(x(t0), . . . , x(ti)) = TempImp(x(ti)) + PermImp(x(t j)).
j=0

(8)

Here, PermImp, TempImp : Rn  Rn are functions describing the permanent and temporary market impact of a trade. If

these functions are linear, we have

i-1

fi(x(t0), . . . , x(ti)) = x(ti) +  x(t j)

(9)

j=0

for symmetric matrices ,   Rn×n (i = 0, . . . , N, j = 0, . . . , i - 1) and hence obtain the price impact costs

N
x(ti)
i=0

fi(x(t0), . . . ,

x(ti))

=

1 2

N
x(ti)
i=0

NN
 x(ti) + x(ti)
i=0 i=0

-

1 2

x(ti).

(10)

In

particular,

Assumption

2.1

is

fulfilled

if



is

nonnegative

definite

and



-

1 2



is

positive

definite.

The latter is usually

motivated by the observation that the temporary impact includes the effect of "sliding up the supply curve" and hence should

be at least as large as half the permanent impact.

Our framework also includes the limit order book model introduced by Obizhaeva and Wang (2006) as a single asset

example if we again assume that the (ti) are identically normally distributed and that the price impact is given by

fi(x(t0), . . . , x(ti)) = 

i-1

x(t j)

+

x(ti) 2

+

i-1

e-(ti-tj) x(t j) +

x(ti) 2

j=0 j=0

(11)

for constants   0,  > 0 and  > 0.

2.2. Trade execution in the dark pool

The overall liquidity traded in dark pools is strongly fragmented. Aggregation of dark pool liquidity is a major issue for

practitioners (see Butler (2007)). Ganchev et al. (2010) and Laruelle et al. (2009) establish learning algorithms to achieve

optimal order splitting between dark pools. Instead of considering the simultaneous use of several dark pools, we consider

such an "aggregated" dark pool in our model, which we call "the dark pool" in this paper.

Contrary to the primary venue, the dark pool does not guarantee trade execution, since it only provides limited liquidity.

We introduce the random variables

a(ti), b(ti)  [0, ]n

(12)

5

that model the liquidity which can be drawn upon in the time-interval [ti-1, ti) for buy (ask side) and sell (bid side) orders,

respectively. The amount

z(ti) = (z1(ti), . . . , zn(ti))  Rn

(13)

which is executed in the dark pool between time ti and ti+1 is given by

zk(ti)

=

min(yk(ti), bk(ti+1)) - min(-yk(ti), ak(ti+1))

if yk(ti)  0 if yk(ti) < 0,

(14)

where yk(ti) is the order7 in the dark pool for the kth asset at time ti. While matching rules vary significantly between dark pools, our model seeks to capture their joint key characteristic: unknown and (possibly) limited liquidity.8 Note that in our model dark pool liquidity is given exogenously. In Hendershott and Mendelson (2000), Dönges and Heinemann (2006) and Degryse et al. (2009a), buyers and sellers are chosen randomly according to some probability distribution. The liquidity in the dark pool (and therefore the probability of dark pool execution) is then solely dependent on the chosen traders' decisions of where to trade (in a traditional market or in a dark pool) and is thus given endogenously.
We will make the following assumption regarding the liquidity (a(ti), b(ti)) available in the dark pool.
Assumption 2.2. The dark pool liquidity fulfills the following three conditions.
(i) For i = 1, . . . , N + 1, a(ti) and b(ti) are independent of previous liquidity in the dark pool a(t1), . . . , a(ti-1), b(t1), . . . , b(ti-1) and of previous price moves (t1), . . . , (ti-1).
(ii) Dark pool execution is not guaranteed, i.e., for i = 1, . . . , N + 1, k = 1, . . . , n,

P[ak(ti) = 0] > 0, P[bk(ti) = 0] > 0. (iii) For all i = 1, . . . , N + 1, k = 1, . . . , n, p > q  0 with

(15)

P[ak(ti) = p], P[ak(ti) = q] > 0 respectively P[bk(ti) = p], P[bk(ti) = q] > 0,

(16)

we have

0  E[ k(ti)|ak(ti) = q]  E[ k(ti)|ak(ti) = p], 0  E[ k(ti)|bk(ti) = q]  E[ k(ti)|bk(ti) = p].

(17) (18)

(iv) For all i = 1, . . . , N +1, k = 1, . . . , n and every collection a1, . . . , an, b1, . . . , bn with ak, bk > 0, there exists a nonnegative real number pa1,...,ak-1,ak+1,...,an,b1,...,bk-1,bk+1,...,bn independent of ak and bk such that

P[ak(ti) = ak|a1(ti) = a1, . . . , ak-1(ti) = ak-1, ak+1(ti) = ak+1, . . . , an(ti) = an, b1(ti) = b1, . . . , bk-1(ti) = bk-1, bk+1(ti) = bk+1, . . . , bn(ti) = bn]
= P[ak(ti) = ak] · pa1,...,ak-1,ak+1,...,an,b1,...,bk-1,bk+1,...,bn P[bk(ti) = bk|a1(ti) = a1, . . . , ak-1(ti) = ak-1, ak+1(ti) = ak+1, . . . , an(ti) = an,
b1(ti) = b1, . . . , bk-1(ti) = bk-1, bk+1(ti) = bk+1, . . . , bn(ti) = bn] = P[bk(ti) = bk] · p .a1,...,ak-1,ak+1,...,an,b1,...,bk-1,bk+1,...,bn

(19) (20)

Assumption 2.2 allows for a dependence of the liquidity parameters a(ti) and b(ti) and the price move (ti+1). This enables us to incorporate the simultaneous occurrence of price jumps and liquidity in the dark pool which can lead to adverse selection
(see Section 5). Assumption 2.2 (iii) is needed in order to ensure uniqueness of the optimal strategy. Economically, it means

7The large trader can only be either selling or buying in the dark pool during [ti, ti+1), but not both. She can however trade in opposite directions in the dark pool and on the primary venue; see Section 7 for a discussion.
8Alternative matching rules can lead to different optimal trading strategies. For example a pro rata matching rule provides an incentive to submit orders to the dark pool exceeding the size of the desired trade. Trade execution in the dark pool that is delayed (in excess of the time discretization of our model) vis-a-vis the primary venue results in a proactive, accelerated adjustment of dark pool order sizes to counteract the effect of the delay. While our results are sensitive to such model changes, we expect the key features of optimal strategies in our model to be relevant for a wide range of matching rules.
6

that price moves in the market are monotone with respect to dark pool liquidity, i.e., the stronger the demand in the dark pool, the stronger the price at the primary venue is expected to move upwards, and the stronger the supply in the dark pool, the stronger the price is expected to move downwards. In other words: a large amount of liquidity in the dark pool could be a sign for an impending favorable price move. The case of strict inequality in Inequalities (17) or (18) for some p > q  0 can lead to adverse selection and is studied in detail in Section 5. Assumption 2.2 (iv) limits the dependence of the dark pools in the various assets. Whether or not there is liquidity for asset l in the dark pool can have an influence on the likelihood of liquidity for asset k, but it cannot change the relative likelihood of large liquidity versus small liquidity.
While the dark pool has no impact on prices at the primary venue, it is less clear to which extent the price impact fi of the primary venue is reflected in the trade price of the dark pool. If for example the price impact fi is realized predominantly in the form of a widening spread, then the impact on dark pools that monitor the mid quote can be much smaller than fi. In Sections 3 to 6, we will make the simplifying assumption that trades in the dark pool are not influenced by the price impact fi at all, i.e., that they are executed at the fundamental price P~(ti). If trading in the dark pool reflects the price impact fi, then market manipulating strategies can become profitable. We investigate this phenomenon in Section 7.

2.3. The liquidation problem For fixed i = 0, . . . , N, we consider an investor who has executed trades

x(t0), . . . , x(ti-1)  Rn

(21)

at times t0, . . . , ti-1 and needs to liquidate a portfolio

X(ti) = (X1(ti), . . . , Xn(ti))  Rn

(22)

of n assets within a finite time-horizon [ti, T ]. For Xk(ti) > 0, this implies liquidating a long position in asset k (selling), whereas Xk(ti) < 0 implies liquidating a short position in asset k (buying). In both cases, we speak of "liquidation" or "sale". We require that at all times t j  ti the investor's orders x(t j), y(t j) depend only on past information ( (t1), . . . , (t j), a(t1), . . . , a(t j) and b(t1), . . . , b(t j)) and thus assume that the filtration F is given by

F (t j) =  (tl), a(tl), b(tl), l = 1, . . . , j .9

(23)

This includes deterministic (also called static) strategies, i.e., strategies that do not depend on any (tl), a(tl) or b(tl). Definition 2.3. Let i = 0, . . . , N and X(ti)  Rn be the portfolio position at time ti. We call a sequence of F-adapted orders

(x, y) = (x(t j), y(t j)) j=i,...,N

(24)

an admissible liquidation strategy if it fulfills the following conditions.

(i) The portfolio is liquidated by time tN:

N
x(t j) + z(t j) = X(ti) for all   .
j=i

(ii) For j = i, . . . , N, k = 1, . . . , n,

yk(t j) 

-

max


ak(t j+1,

),

max


bk(t j+1,

)

.

We denote the set of admissible liquidation strategies by A(ti, X(ti)).

Let us shortly comment on Definition 2.3. We recursively define for j  i + 1,

(25) (26)

X(t j+1) := X(t j) - x(t j) - z(t j).

(27)

9In reality, the investor does not know the exact dark pool liquidity (a(t j), b(t j) at time t j but only the executed fraction z(t j-1). Economically, the filtration should therefore be given by F (t j) =  (tl), z(tl-1), l = 1, . . . , j . Because of the independence of (a(tl), b(tl))l this is mathematically irrelevant.
7

By abuse of notation, the liquidation constraint in (i) is then equivalent to

X(tN+1) = 0.

(28)

By Assumption 2.2 (ii), all admissible liquidation strategies must satisfy

x(tN) = X(tN), y(tN) = z(tN) = 0.

(29)

Definition 2.3 (ii) ensures that admissible strategies only place dark pool orders which have a chance of being fully executed.
This consideration is required in order to ensure uniqueness of the optimal strategy. Due to order submission fees, the
assumption is natural in practice; orders not satisfying Definition 2.3 (ii) cannot generate additional value (compared to
strategies that do satisfy Definition 2.3 (ii)). Note also that we assume implicitly that the maxima of ak(t j+1) and bk(t j+1) are known to the investor at time t j.
For an admissible strategy (x, y)  A(ti, X(ti)) the trader's cost of execution is given by the implementation shortfall (see Perold (1988)):

R(ti) := R(ti, x(t0), . . . , x(ti-1), X(ti); (x, y))
N
:= X(ti) P~(ti) - x(t j) P(t j) + z(t j) P~(t j)
j=i
N
= x(t j) P~(ti) - P~(t j) + f j(x(t0), . . . , x(t j)) + z(t j) (P~(ti) - P~(t j)) .
j=i

(30) (31)
(32)

The trade-off between expected proceeds and risk is an important driver of optimal liquidation and has been the focus of several investigations including Almgren and Chriss (2001), Almgren and Lorenz (2007), Schied and Schöneborn (2009) and Schied et al. (2010). In this paper we assume that the investor wants to minimize the following function of execution cost:

J(ti, x(t0), . . . , x(ti-1), X(ti); (x, y)) := E R(ti, x(t0), . . . , x(ti-1), X(ti); (x, y)) + E

N
X(t j) (t j+1)X(t j) ,
j=i

(33)

where   0 is the coefficient of risk-aversion and (t j) is the covariance matrix of the increments k(t j). The risk costs

N
 X(t j) (t j+1)X(t j)
j=i

(34)

reflect the market risk of the portfolio and thus penalize slow execution and poorly diversified portfolios. In the setting

of Almgren and Chriss (2001) for optimal liquidation without dark pools, this is equivalent to minimizing the mean-variance

functional

E R(ti) +  Var R(ti)

(35)

over all deterministic strategies. Schied et al. (2010) show that this in turn is equivalent to maximizing the utility of investors with constant absolute risk-aversion.
The value function of the optimization problem is thus given by

v(ti,

x(t0),

.

.

.

,

x(ti-1),

X(ti))

:=

inf
( x,y)A(ti ,X (ti ))

J(ti,

x(t0),

.

.

.

,

x(ti-1),

X(ti);

(x,

y)).

(OPT)

We call a strategy (x, y)  A(ti, X(ti)) optimal if it realizes the minimum in Equation (OPT) and denote optimal strategies

by

(x, y)

(36)

for the remainder of the paper. The amount executed in the dark pool in [ti, ti+1) associated with the optimal order y(ti) is

denoted by

z(ti).

(37)

8

Note that our optimization criterion penalizes risk due to market moves (t j), but not the risk due to execution uncertainty in the dark pool. Since the market risk usually outweighs the liquidity risk, disregarding the latter should not lead to significantly different results while at the same time simplifying the analysis considerably. "Selective risk aversion" focusing only on market risk and disregarding liquidity risk has been applied before by Walia (2006) and Rogers and Singh (2010) in the contexts of stochastic liquidity and hedging. We discuss the effect of this choice in more detail in Appendix Appendix A.

3. Optimal liquidation

The following theorem establishes the existence and uniqueness of an optimal trading strategy that exploits both the trading opportunities at the primary exchange and the dark pool.
Theorem 3.1. Let i = 0, . . . , N - 1, x(t0), . . . , x(ti-1)  Rn be the previous trades of the investor and X(ti)  Rn be the portfolio position at time ti. Then there exists a unique optimal strategy (x, y)  A(ti, X(ti)) realizing the minimum in Equation (OPT).
The theorem is a direct consequence of the following propositions.
Proposition 3.2. Let i = 0, . . . , N - 1, x(t0), . . . , x(ti-1)  Rn be the previous trades of the investors and X(ti)  Rn be the portfolio position at time ti. Then there exists an optimal strategy (x, y)  A(ti, X(ti)) realizing the minimum in Equation (OPT).
Proposition 3.3. Let i = 0, . . . , N - 1, x(t0), . . . , x(ti-1)  Rn be the previous trades of the investor and X(ti)  Rn be the portfolio position at time ti. Then:
(i) The function

i-1
Hi(x(t0), . . . , x(ti-1), X(ti)) := v(ti, x(t0), . . . , x(ti-1), X(ti)) + x(t j) f j(x(t0), . . . , x(t j))
j=0

(38)

is strictly convex in (x(t0), . . . , x(ti-1), X(ti))  Rn×(i+1). (ii) The optimal trading strategy (x, y)  A(ti, X(ti)) realizing the minimum in Equation (OPT) is unique.

4. Linear price impact
In the previous section we established an existence and uniqueness result for a general market model. In order to obtain additional insight into the structure of the optimal liquidation strategy we now consider the case of linear temporary price impact, which can be solved in explicit form. In Section 4.1 we specify the model in terms of its price impact functions fi, the fundamental price process P~ and the liquidity in the dark pool a(t0), b(t0), ..., a(tN), b(tN). In Section 4.2 the value function v and the optimal orders x(ti), y(ti) at times ti are proven to be of quadratic respectively linear form and shown to satisfy a backward recursion. In Sections 4.3 and 4.4 we study the effects of dark pools for liquidation of a single asset position and a two asset portfolio, respectively.

4.1. Model specification
In this section we assume that price impact is linear and purely temporary. We specify the precise form of the impact costs, the distributions of the fundamental asset price P~ and the dark pool liquidity (a, b) in the following way.

Assumption 4.1. (i) For i = 0, . . . , N,

fi(x(ti)) := fi(x(t0), . . . , x(ti)) := x(ti)

for a positive definite matrix   Rn×n. (ii) P~ is an F-martingale with constant covariance matrix of the increments

(39)

(ti) = (t j) =:  for all i, j = 0, . . . , N.

(40)

9

(iii) Dark pool orders are executed fully or not at all, i.e., for i = 1, . . . , N + 1, k = 1, . . . , n,

ak(ti), bk(ti)  {0, }.

(41)

Furthermore, (a(ti), b(ti)) i=1,...,N+1 is identically distributed and (a(ti), b(ti)) and (ti) are independent. (iv) For i = 1, . . . , N + 1, k = 1, . . . , n,

P ak(ti) = |a1(ti), . . . , ak-1(ti), ak+1(ti), . . . , an(ti), b1(ti), . . . , bk-1(ti), bk+1(ti), . . . , bn(ti) = P bk(ti) = |a1(ti), . . . , ak-1(ti), ak+1(ti), . . . , an(ti), b1(ti), . . . , bk-1(ti), bk+1(ti), . . . , bn(ti) .

(42)

Let us briefly comment on Assumption 4.1. Assumption 4.1 (i) implies convexity and superlinear growth of the price impact costs, so that Assumption 2.1 is satisfied. We call the matrix  the price impact matrix and say that the price impact is linear and temporary10 since the function fi only depends on the trade x(ti) at time ti and not on past trades x(t0), ..., x(ti-1). A special case are diagonal price impact matrices with strictly positive entries, which correspond to markets without cross asset price impact. As a direct consequence of Assumption 4.1 (i), v(ti, x(t0), . . . , x(ti-1), X(ti)) is independent of x(t0), . . . , x(ti-1).
As the time-horizon for portfolio liquidation is usually short, i.e., several hours or a few days, the martingale property in
Assumption 4.1 (ii) does not constitute a major divergence from reality. In combination with the independence of future price
moves of dark pool liquidity (Assumption 4.1 (iii)) and the liquidation constraint (Definition 2.3 (i)) this property implies

N
E (x(t j) + z(t j)) P~(ti) - P~(t j) = 0.
j=i

(43)

Combining the above observations, the Optimization Problem (OPT) becomes

v(ti, X(ti)) := v(ti, x(t0), . . . , x(ti-1), X(ti))

N

= inf E
( x,y)A(ti ,X (ti ))

x(t j) x(t j) + E
j=i

N
X(t j) X(t j)
j=i

.

(OPT-LPI)

By Assumption 4.1 (iv), Assumption 2.2 (iv) is satisfied. Additionally the assumption implies that supply and demand in the dark pool are distributed symmetrically.

4.2. Optimal liquidation
The following theorem establishes that the value function v(ti, ·) of the Optimization Problem (OPT-LPI) is quadratic and that the optimal orders x(ti) placed at the primary venue and y(ti) placed in the dark pool are linear functions of the portfolio X(ti) at any time ti.

Theorem 4.2. For i = 0, . . . , N there exist matrices A(ti), B(ti), C(ti)  Rn×n such that for any portfolio X(ti)  Rn the unique optimal strategy (x, y)  A(ti, X(ti)) fulfills

x(ti) = A(ti)X(ti), y(ti) = B(ti)X(ti),

(44) (45)

and the value function is given by

v(ti, X(ti)) = X(ti) C(ti)X(ti)

with positive definite C(ti). An explicit recursion for A(ti), B(ti) and C(ti) is given in Appendix Appendix B.

(46)

10Many market models dissect price impact into a temporary and a permanent component, for example Almgren and Chriss (2001) and Obizhaeva and Wang (2006). In this section we omit the permanent impact component for two reasons. First, permanent price impact complicates the mathematics (most notably requires to keep track of the already accumulated permanent impact over time) without significantly changing the qualitative features of the optimal strategy. Second, it appears reasonable that permanent price impact also influences trade prices in the dark pool, since otherwise a permanent divergence between trade prices at the primary venue and in the dark pool would be created. Allowing for such a spillover effect on dark pool prices can lead to price manipulation as we will see in Section 7.

10

4.3. Liquidating a single-asset position

The most transparent case to analyze is the liquidation of a position X(t0) in a single asset (n = 1), for which we derive a closed form solution. Some of the most interesting effects of using dark pools can be observed in this case, and we therefore

study it in more depth in this section.

Let

p := P[a(ti) = ] = P[b(ti) = ]

(47)

be the probability of order execution in the dark pool. For a given p  [0, 1), we denote the matrices (now real numbers)

A(ti), B(ti) and C(ti) introduced in Theorem 4.2 by A(ti, p), B(ti, p) and C(ti, p) in order to highlight their dependence on p.

For the remainder of the section, we let

X(t0) > 0.

(48)

The results are symmetric in the sign of X(t0) and can be easily transfered to negative initial asset positions X(t0).

Closed form solutions for the value function and the optimal strategy
The following proposition gives closed form solutions for the optimal strategy and the value function. This result is a generalization of the corresponding result in Almgren and Chriss (2001) for optimal liquidation without dark pools (p = 0).

Proposition 4.3. Let

(p) := arcosh

Then the optimal orders at time ti are given by

1- p 2

 

+1+

1 1- p

.

(49)

x(ti) = A(ti, p)X(ti) and y(ti) = B(ti, p)X(ti)

(50)

with

A(ti, p) = 1 -

sinh((p)(N - i))

,

1 - p sinh((p)(N + 1 - i))

B(ti, p) = 1 - A(ti, p) =

sinh((p)(N - i))

< 1.

1 - p sinh((p)(N + 1 - i))

(51) (52)

In particular,

0 < x(ti), y(ti) < X(ti) and x(ti) + y(ti) = X(ti)

for i N. The value function is given by

v(ti, X(ti)) = C(ti, p)X(ti)2

with

C(ti,

p)

=

 1- p

1 - p sinh((p)(N + 2 - i)) sinh((p)(N + 1 - i)) - 1 .

We can also express X(ti), x(ti) and y(ti) as functions of X(t0).

(53) (54) (55)

Corollary 4.4. Let i = 0, . . . , N and assume that no dark pool order has been executed until time ti. We recursively define

Xne(t0, p) := X(t0), Xne(t j, p) := Xne(t j-1, p) - x(t j-1).

(56)

Then

X(ti) = Xne(ti, p) =

1 1-

pi

sinh((p)(N + 1 sinh((p)(N +

- i)) 1))

X(t0),

and the optimal orders at time ti are given by

xne(ti, p) := x(ti) = A(ti, p)X(ti)

(57) (58)

11

=

1 1 - pi+1

1 - p sinh((p)(N + 1 - i)) - sinh((p)(N - i))

sinh((p)(N + 1))

X(t0),

yne(ti, p) := y(ti) = B(ti, p)X(ti) = Xne(ti, p) - x(ti, p)

=

1

1 -

pi+1

sinh(( p)(N sinh(( p)(N

- i)) + 1))

X(t0).

If a dark pool order has been executed before time ti, then X(ti) = x(ti) = y(ti) = 0.

(59) (60) (61)

Properties of the optimal strategy Proposition 4.3 answers the question of how to use a dark pool optimally for n = 1. It is always optimal to place the
remainder of the asset position (minus the optimal order in the primary venue) in the dark pool as the investor pays no price impact there. Consequently, the liquidation task is finished as soon as the dark pool order is executed by Assumption 4.1 (iii).
Using the dark pool also changes optimal trading in the primary exchange. Intuitively, the trader should slow down the trading speed in the primary venue as she wants as much as possible to be executed in the dark pool. If the position is not yet executed towards the end, she has to speed up in order to finish the liquidation until time T .
The first part of the following proposition confirms this intuition. The second part states that the expected asset positions for trading with dark pool are smaller than without dark pool, although trading at the primary exchange is slower.

Proposition 4.5. Let i = 1, ..., N - 1. (i) Xne(ti, p) is strictly increasing in p. In particular
Xne(ti, p) > Xne(ti, 0)

for all p > 0.

(62)

(ii) Let Ep[X(ti)] be the expected asset position at time ti if the probability of execution in the dark pool is p and the optimal

strategy is applied:

Ep X(ti) = (1 - p)iXne(ti, p) =

1 - pi sinh((p)(N + 1 - i))

sinh((p)(N + 1))

X(t0).

(63)

Then Ep[X(ti)] is strictly decreasing in p, in particular

Ep X(ti) < E0 X(ti) for all p > 0.

(64)

Figures 1 and 2 illustrate how the dark pool changes the optimal strategy in the primary venue. In all pictures the optimal strategy without using the dark pool is displayed by the thin line. When the dark pool is used, then the portfolio evolution is stochastic and depends on the liquidity found in the dark pool. We illustrate the stochastic portfolio evolution with three lines. The solid line shows the evolution of the asset position when liquidity is found in the dark pool at time . If there is no liquidity found in the dark pool during the entire trading horizon, the trader follows the dotted line until time T . The figures illustrate how the trading speed is slowed down by the introduction of the dark pool. The dashed lines denote the expected asset position over time if the dark pool is used.

Properties of the value function The costs of an admissible liquidation strategy (x, y) are composed of the impact costs of trading at the primary venue

N
 · E x(ti)2
i=0

(65)

and the risk costs

N
 · E X(ti)2 .
i=0

(66)

Intuitively, using a dark pool reduces the overall costs. However, this does not necessarily apply to both components of the

costs. It is possible that the dark pool reduces one component, while the other one is increased. The following proposition

shows that both the total costs and the impact costs of the optimal trading strategy are strictly decreasing in the probability of execution p. On the other hand, the risk costs are not decreasing in p  (0, 1) in general. In particular, it is generally not true

that the risk costs of using a dark pool are smaller than the risk costs of not using a dark pool.

12

Size of asset position X (t0 )

Size of asset position X (t0 )

Time T

Time T

Figure 1: Comparison of the portfolio evolution for the optimal strategies of a risk-neutral trader ( = 0) of a stock with large (left) and small (right)

probability of execution p in the dark pool. The task of the trader is to liquidate a position X(t0) = 1 in N + 1 = 501 trading times. Furthermore,  = 500

and p (left 

= =

3 500

(left

graph),

p

=

150, right  = 350).

D101o0t0te(driglihntesgrraepfehr).toThtheesooplitdimthailcsktrlainteegsyshXonwe(ttih)einsctehneasrcioenwarhieorewahetrraedneoindathrke

dark pool

pool is executed in the th trading period liquidity is found and dashed lines to the

expected asset position Ep[X(ti)] over all scenarios. Solid thin lines refer to the optimal strategy without dark pool.

Size of asset position X (t0 )

Size of asset position X (t0 )

Time T



Figure

2:

The

same liquidation

problems

as in

Figure

1

but for

a

risk-averse trader (

=

4, 

=

1 500

).

Time T

Proposition 4.6. Let (x(ti), y(ti))i=0,...,N be the optimal strategy and define X(ti) recursively by X(ti) = X(ti+1) - x(ti) - z(ti)

(67)

as before.

(i) For i = 1, ..., N - 1, C(ti, p) is strictly decreasing in p for p  (0, 1).
(ii) The impact costs
N
 · E x(ti)2
i=0

are strictly decreasing for p  (0, 1).

(iii) If  > 0, then the risk costs

N
 · E X(ti)2
i=0

are

strictly

increasing

for

p



(0,

 +

)

and

strictly

decreasing

for

p



(

 +

,

1).

(68) (69)

We illustrate the dependence of the two components of the costs of the optimal strategy on p in Figure 3. The left graph shows that the impact costs are decreasing in p on the whole interval (0, 1) while the risk costs are increasing for small p (right graph). Overall, the reduction of the impact costs outweighs the increase of the risk costs for small p.

13

Impact costs 1.15

Risk costs 1.05

0 p 1.01 p

0

0.3

0

 +

= 0.01

0.1

Figure 3: Impact costs (left graph) and risk costs (right graph) of the optimal strategy dependent on the probability of execution in the dark pool p. For

p



(0,

 +

),

the

risk

costs

are

increasing

whereas

the

impact

costs

are

strictly

decreasing

on

the

whole

interval

(0, 1).

The

parameters

are

the

same

as

in

Figure 4.

Figure 4 illustrates the costs of different trading strategies dependent on the probability of execution p. The dotted line denotes the costs of not using a dark pool (which is obviously independent of p). The solid line represents the costs of the optimal strategy and the dashed line represents the costs of the following naïve strategy:
Use the optimal strategy without dark pools for the primary venue and place the remainder of the position in the dark pool!
This strategy is cheaper than not using dark pools, as both impact costs and risk costs are saved if an order in the dark pool is executed before time T . However, it is significantly more expensive than the optimal strategy, which unlocks additional cost saving potential by deferring execution at the primary venue.

Costs 2.2

0p 0 0.3

Figure 4: Costs of the optimal strategy (solid line), the optimal strategy without dark pool (dotted line) and the naïve strategy (dashed line) dependent on p.

N

=

15, 

=

15, 

=

1 15

,



=

4.

Sensitivity with respect to p For the performance of the optimal trading strategy, it is essential to estimate the parameters , , and p appropriately.
Especially for the probability of execution this is difficult: As orders are not reported openly in dark pools, it is hard to obtain useful data.
Let us assume that we have estimated the average number of executions in [0, T ] to be N · q. We have seen already that applying the optimal strategy (x(ti, q), y(ti, q))i reduces liquidation costs significantly, provided that q equals the real-world probability of execution p. If we have underestimated p, i.e, q < p, the strategy (x(ti, q), y(ti, q))i is still cheaper than the optimal strategy without using dark pools. On the other hand, overestimating p can make the strategy (x(ti, q), y(ti, q))i more expensive than the optimal strategy without using dark pools. Figure 5 illustrates the costs of (x(ti, q), y(ti, q))i dependent on p.
14

Costs

0 p~ q

p 0.5

Figure 5: The dotted line represents the costs without dark pool, the solid line the costs of the optimal strategy dependent on p and the dashed line the costs
of the strategy (xi(q), yi(q))i (dependent of the real world probability p); p~ denotes the minimal value of the real world probability p such that trading with dark pool does not become more expensive than without. The estimate is q = 0.1. The parameters are as in Figure 4.

4.4. Liquidating a portfolio of two assets
If a risk-averse investor has to liquidate a portfolio of multiple assets (n  2), then correlation between the assets comes into play. It might no longer be optimal to always place the remaining portfolio into the dark pool. For example, a trader liquidating a well diversified portfolio consisting of two assets will most likely not want to risk losing her balanced position by being executed in only one of the two assets. In Subsection 4.3 we introduced the naïve strategy of applying the optimal strategy without dark pools in the primary venue and placing the remainder of the position in the dark pool. Although suboptimal, this strategy performed strictly better than the best strategy without dark pool in the case n = 1. A simple numerical example confirms that this is no longer the case for n  2.11 This highlights that it is not advisable to apply the naïve strategy for a portfolio of more than one asset. In this section we will investigate the dependence of the optimal strategy on the model parameters, especially on the correlation of the assets.
Intuitively, we expect the optimal order placement to depend on the correlation of the n assets in the following sense. If the portfolio is well diversified at the beginning, the orders in the dark pool should be much smaller than the current portfolio as the trader does not want to risk entering an undiversified position. The trading speed in the primary venue should be almost constant since the portfolio position bears little risk and a constant trading speed minimizes the price impact cost (cf. the thin lines in Figure 1). If the portfolio is poorly diversified, the orders should initially be comparatively large both in the primary venue and in the dark pool. They might even be larger than the current portfolio for risk mitigating reasons as the execution of the dark pool order for one of the assets can lead to a less risky overall position.
We illustrate the above intuitions by numerical examples. First, we want to compare the expected portfolio evolution using the optimal strategies with and without dark pools. To this end, we consider different portfolios of two highly correlated stocks

11Consider a risk-averse investor ( = 1), who aims to liquidate a portfolio (X0 = (1, -1) ) of two highly correlated stocks with

=

1 0.9

0.9 1

(70)

in a single trading period (N = 1). Assume that the first stock is less liquid in the primary venue (i.e., trading in the stock yields less price impact costs) and in the dark pool (we assume that there is no liquidity in the dark pool for the first stock):

=

3 0

0 1

,

(71)

P[No

dark

pool

execution]

=

1 2

,

P[Dark pool execution of first asset only] =0,

(72) (73)

P[Dark

pool

execution

of

second

asset

only]

=

1 2

.

(74)

Using Theorem 4.2 we can compute the costs of the optimal strategy without dark pools and the naïve strategy. The former is less costly than the latter (2.98 versus 3.22).

15

with

=

1 ·
500

1 0.9

0.9 1

.

(75)

We model the second stock as being more liquid. This is reflected by both a smaller price impact and a higher execution probability in the dark pool12 compared to the first asset:

 =500 ·

3 0

P[No

dark

pool

execution]

=

993 1000

,

P[Dark

pool

execution

of

first

asset

only]

=

1 1000

,

P[Dark

pool

execution

of

second

asset

only]

=

6 1000

,

P[Dark pool execution of both assets] =0.

0 0.2

,

(76)
(77) (78) (79) (80)

We consider the following two portfolios in more depth: (i) Long positions in both stocks, i.e., a poorly diversified portfolio:

X(t0) =

1 1

.

(81)

(ii) A long position in the first and a short position in the second stock, i.e., a well diversified portfolio:

X(t0) =

1 -1

.

(82)

Figure 6 shows the evolution of the two portfolios if a risk-averse investor ( = 4) applies the optimal strategy. The left picture corresponds to the first case, the right one to the second. In both pictures thin lines are used for the first stock and thick lines for the second. Dotted lines correspond to trading without the dark pool, dashed lines correspond to the expected position in the assets if the dark pool is used and the solid lines correspond to a realization of the liquidation process using the dark pool, where the dark pool orders for the second stock are executed at times 1, 2, 3 and for the first stock only at time 4, i.e., dark pool orders for the more liquid stock are executed several times before any execution in the less liquid stock takes place.
For the poorly diversified portfolio, the trader tries to improve her risky position by trading out of the second stock. For this stock, trading in the primary venue is less expensive and being executed in the dark pool is more probable. If the trader uses the dark pool, this process on average evolves significantly faster than without the dark pool.
For the well diversified portfolio, the portfolio position is decreasing almost linearly in time in all cases. We expect to trade only slightly faster if we use the dark pool. Note that this corresponds to the intuition given at the beginning of the section: It is most profitable to trade out of the position almost evenly.
Additionally, orders in the dark pool are very large for the poorly diversified portfolio and comparatively small for the well diversified portfolio. The reason can be observed in Figure 7. The solid lines in the two pictures represent the evolution of portfolio risk X(ti) X(ti) over time corresponding to the realized liquidation paths in Figure 6. The dotted lines represent the evolution of risk if the optimal strategy without the dark pool is used and the dashed lines represent the expected evolution of risk.
As long as the portfolio is poorly diversified, the risk is relatively large and is significantly decreased by a large execution in the dark pool (left picture). However, if it is well diversified as in the right picture, each execution in the dark pool increases the risk. Therefore, the dark pool saves price impact costs but potentially increases risk costs in this case. Note also

12Intuitively, we expect a close connection between liquidity costs in the primary venue and probability of execution in the dark pool. However, we are not aware of any empirical work supporting this.

16

Position in stocks X1 (t0 ), X2 (t0 )
1

Position in stocks X1 (t0 )
2 3 4 Time 1 T

2 3 4 Time T

X2 (t0 )
Figure 6: Evolution of a portfolio consisting of two highly correlated stocks over time. The left figure illustrates the poorly diversified portfolio, the right figure the well diversified portfolio. In both pictures thin lines are used for the less liquid first stock and thick lines for the more liquid second stock. Dotted lines correspond to trading without the dark pool, dashed lines correspond to the expected position in the assets if the dark pool is used and solid lines correspond to a realization of the liquidation process using the dark pool, where dark pool orders for the second stock are executed at times 1, 2, 3 and for the first stock only at time 4.

Risk of portfolio 3.8

Risk of portfolio 0.2

Time

Time

1

2 3 4 T

1

2 3 4 T

Figure 7: Evolution of risk X(ti) X(ti) over time for the liquidation paths in Figure 6. The dashed line denotes the expected evolution of risk. Note the different scales in the left and the right graph.

that in the case of an initially well diversified portfolio, the expected risk can be larger than the risk without using the dark pool.

Our model allows for dependencies between the liquidities of the assets in the dark pool. In the preceding example we assumed that the probability of simultaneous execution in the dark pools is zero. This is not necessarily the case in reality. Intuitively, we expect the optimal orders in the dark pool to depend strongly on the correlation of the liquidities. For a well diversified portfolio, a large probability of simultaneous execution decreases the risk of losing the balanced position by a dark pool execution. Therefore, we expect the absolute value of the optimal orders in the dark pool to increase in the probability of simultaneous execution. For a poorly diversified portfolio, a large probability of simultaneous execution decreases the likelihood of reaching a more balanced position by a dark pool execution for only one of the two assets, and we therefore expect the optimal orders to decrease in the probability of simultaneous execution. Again, we illustrate these intuitions by a numerical example.
Let us consider the same stocks as before but this time

p

:=

P[Dark

pool

execution

of

both

assets]

[0,

1 1000

],

P[Dark

pool

execution

of

first

asset

only]

=

1 1000

-

p,

(83) (84)

17

P[Dark

pool

execution

of

second

asset

only]

=

6 1000

-

p,

P[No

dark

pool

execution]

=

993 1000

+

p.

Note that the marginal probabilities of execution are independent of p, for example for the first asset:

(85) (86)

P[Dark pool execution of first asset] = P[Dark pool execution of first asset only] + P[Dark pool execution of both assets] = 1. 1000

(87) (88)

The left picture of Figure 8 shows the optimal orders at time t0 in the dark pool dependent on p for a poorly diversified portfolio (X(t0) = (1, 1) ) and the right picture shows the absolute value of the optimal orders for a well diversified portfolio (X(t0) = (1, -1) ). In both pictures the solid line represents the first (illiquid) asset and the dashed line the second (liquid)
asset. Thus, the intuitions preceding the example are supported.

Optimal orders in the dark pools at time t0 1.71

Absolute value of the optimal orders in the dark pools at time t0
0.85

1.14

0.28

0 p0 p

1/1000

1/1000

Figure 8: Dependence of the (absolute value of the) optimal orders in the dark pool on the probability of simultaneous execution. The left picture shows the optimal orders at time t0 for a poorly diversified portfolio (X(t0) = (1, 1) ) and the right picture for a well diversified portfolio (X(t0) = (1, -1) ). In both pictures the solid line represents the first (illiquid) asset and the dashed line the second (liquid) asset.

Figure 8 also illustrates that the optimal strategy depends strongly on the relative liquidity of the two stocks. Risk mitigation plays a minor role for the illiquid stock as impact costs outweigh risk. Therefore, both in the poorly and in the well diversified case, the orders in the dark pool for the illiquid stock are relatively close to the remainder of the position in the stock, whereas this is not the case for the liquid stock.

5. Adverse selection
In Section 4 we assumed that the price increments (ti) and the liquidity variables a(ti), b(ti) are independent. This assumption is not always satisfied in reality. For example, several large traders might be using the dark pool and the exchange in parallel to execute trades. We can split these traders into a group of buyers and a group of sellers. Traders in the larger of these two groups face increased competition in the dark pool (and hence a reduced probability of execution in the dark pool) as well as adverse price movements at the exchange reflecting the net price impact of the large traders. Those traders in the smaller group find unusually high liquidity in the dark pool (and thus an increased likelihood of execution) while prices move in their favor at the exchange. All that the individual trader observes directly is that price changes (ti) at the primary venue and liquidity a(ti), b(ti) in the dark pool are correlated. Liquidity seeking traders find that their trades in the dark pool are usually executed just before a favorable price move, i.e., exactly when they do not want them to be executed since they miss out on the price improvement. In advance of adverse price movements, they observe that they rarely find liquidity in the dark pool. We call such a phenomenon "adverse selection". There are several different mechanism through which adverse selection can be created.

18

Adverse selection in dark pools is an important issue for practitioners. A detailed discussion from a practical point of view can be found in Mittal (2008), who states that information leakage, e.g., due to dark pool pinging, is a possible reason for adverse selection. Pinging refers to the attempt to obtain information about liquidity by placing small orders in the dark pool.
In their equilibrium model, Hendershott and Mendelson (2000) find that adverse selection occurs endogenously due to information asymmetry in the market, i.e., traders with less information about future price moves risk to be adversely selected in the dark pool by well-informed traders. Zhu (2011) analyzes the combined effect of correlated competition for liquidity and information asymmetry and finds that traders who are expecting stronger adverse selection in the dark pool (informed traders in his model) shift their trades away from the dark pool and onto the classical exchange.13 Næs and Ødegaard (2006) analyze transaction costs of crossing networks empirically and find that potential savings are possibly mitigated by adverse selection. Using the same data set, Næs and Skjeltorp (2003) find alternative explanations for these effects and confirm that in spite of possible adverse selection, transaction costs in crossing networks are lower than in the primary market.
In Section 5.1 we propose to model adverse selection through a dependence of dark pool liquidity (a, b) on price moves . In this way we can incorporate adverse selection in the general framework of Section 2. In order to obtain tractable results, we focus on a single asset modification of the linear price impact model introduced in Section 4. In Section 5.2 we analyze adverse selection for risk-neutral investors. The solution for risk-averse investors is more subtle and is covered in Section 5.3.

5.1. Model specification
As in Section 4, we assume the linear form of price impact fi described in Assumption 4.1 (i) and the Poisson type execution in the dark pool (a(ti), b(ti)  {0, }, cf. the first part of Assumption 4.1 (iii)). We only remove the assumption that future price moves are independent of current dark pool liquidity and replace it in the following way.

Assumption 5.1. We assume that Assumption 4.1 (i), (ii) and (iv) hold and replace (iii) by the following modification: (iii) Dark pool orders are executed fully or not at all, i.e., for i = 1, . . . , N + 1,

a(ti), b(ti)  {0, }. Furthermore, (a(ti), b(ti)) i=1,...,N+1 is identically distributed and
E[ (ti)|a(ti) = ] = -, E[ (ti)|b(ti) = ] = 

(89) (90)

for a positive constant .

As in the single asset setting without adverse selection (Section 4.3) we write

p := P[a(ti) = ] = P[b(ti) = ]

(91)

for the probability of dark pool execution. The model of this section is covered by the general market model of Section 2 and thus a unique optimal liquidation
strategy exists by Theorem 3.1. Furthermore, it is a generalization of the model in Section 4 for the case n = 1. On the other hand, the model of Section 4 generalizes the case  = 0 of this model for general n  N.
The martingale property, the dependence of future price moves on dark pool liquidity (Assumption 5.1 (iii)), Equation (91) and the liquidation constraint (Definition 2.3 (i)) imply

NN
E (x(t j) + z(t j)) P~(ti) - P~(t j) = E p|y(t j)| .
j=i j=i

(92)

13This result is consistent with the results of our model. Since we only model one large trader explicitly, we can regard the exogenously specified market model (including adverse selection) as specific to her rather than as necessarily applicable to all market participants. Two different large traders might be experiencing different levels of adverse selection due to for example different timing of their trades, even though both of them are trading the same asset in the same market. As we will see in Proposition 5.5, traders expecting a higher level of adverse selection will shift their trading from the dark pool to the
classical exchange.

19

The Optimization Problem (OPT) thus becomes

NN

v(ti, X(ti)) = inf E

x(t j)2 + p|y(t j)| + E X(t j)2 .

( x,y)A(ti ,X (ti ))

j=i

j=i

(OPT-ADV)

Adverse selection is irrelevant for trading without dark pools (or equivalently p = 0), so we can assume p > 0 from now on. Furthermore we assume that the investor has to liquidate a positive position

X(ti) > 0.

(93)

The results are symmetric and can be transferred to negative positions easily. In the following, we compare optimal strategies

for varying asset positions and hence adopt the following notation: the (unique) optimal strategy at time ti for asset position X

is denoted by

(x(ti, X), y(ti, X))  R × R.

(94)

5.2. Risk-neutral investors We first consider the case of a risk-neutral investor

 = 0.

(95)

The following Theorem provides a characterization of the optimal trading strategy and the value function of the Optimization Problem (OPT-ADV).

Theorem 5.2. Let  = 0. For i = 0, . . . , N and asset position X(ti) at time ti, the value function and the optimal strategy are given by

v(ti,

X(ti))

=

C(ti, C(ti,

0)X(ti)2 p)X(ti)2

= +

 N+1-i

X(ti)2

C2(ti)X(ti) +

C3(ti)

if

X(ti)



(N+1-i) 2

else,

x(ti,

X(ti))

=

A(ti, A(ti,

0)X(ti) p)X(ti)

= +

1 N+1-i

X(ti)

A2(ti)

if

X(ti)



(N+1-i) 2

else,

y(ti,

X(ti))

=

0 B(ti,

p)X(ti)

+

B2(ti)

if X(ti)



(N+1-i) 2

else,

(96) (97) (98)

where A(ti, p), B(ti, p), C(ti, p) are as in Equations (51), (52) and (55), respectively. A2(ti), B2(ti), C2(ti) and C3(ti) are given in closed form in Appendix Appendix C. In particular,

for

X(ti)

>

(N+1-i) 2

.

X(ti) - x(ti, X(ti))

>

(N-i) 2

,

X(ti)

-

x(ti, X(ti)) - y(ti, X(ti))

=

(N-i) 2

(99) (100)

5.2.1. Properties of the optimal strategy and the value function By Theorem 5.2, there exits a time-dependent boundary

(N + 1 - i) 2
which separates the set of possible asset positions into two regions. For positions

(101)

X(ti)



(N

+1 2

-

i) ,

(102)

20

the dark pool is not used and the optimal strategy is the same as the optimal liquidation strategy for risk-neutral investors without dark pool. In particular, it is optimal to liquidate the position at a constant rate. This intuition is reflected by practitioners' rules of thumb which often do not use dark pools for orders smaller than a certain threshold. For asset positions

X(ti)

>

(N

+1- 2

i)

(103)

the optimal strategy is affine linear and the value function is a quadratic polynomial. The dark pool is used at each point until

the order is executed. However, the optimal order in the dark pool is smaller than the total remainder of the position, and

after the execution of her order, the investor still owns a part of her position, which is then liquidated at a constant rate in the

primary venue only. Note that adverse selection results in larger trades at the primary venue for all asset positions.

Theorem 5.2 therefore confirms the intuition that adverse selection reduces the attractiveness of the dark pool compared

to the primary venue, and hence a larger proportion of the position should be liquidated in the primary venue. The investor

keeps a time-dependent part of her position in order to profit from favorable price moves.

It is worth noting that adverse selection only has a second order impact on the optimal strategy and the value function for

very large

X(ti)

>>

(N

+1 2

-

i) .

(104)

We illustrate these properties by Figure 9. The left picture shows the optimal trading strategy if adverse selection is

expected for a small asset position X(t0) = 0.6 < (N + 1)/2 and a larger asset position X(t0) = 1.8 > (N + 1)/2 (solid lines). The boundary (N + 1 - i)/2 is displayed by the dashed line. In the case of the small position, the trading rate in

the primary venue is constant (as for optimal liquidation without dark pool, cf. Figure 1) and the dark pool is not used. For

the larger asset position the dark pool is used and the order is executed at time  in the displayed scenario; after execution the

dark pool is not used anymore and the trading rate in the primary venue is constant (and on the boundary (N + 1 - i)/2).

We display the same scenarios in the left picture for optimal liquidation with dark pool and without adverse selection (solid

thick lines) respectively without dark pool (solid thin lines). By comparing the two pictures, it can be observed that adverse

selection speeds up trading and that the optimal strategy coincides with the one without dark pool for the smaller position.

Size of asset position 1.8

Size of asset position 1.8

(N+1) 2
0.6

0.6

Time

Time

 T T

Figure 9: The left picture shows the optimal strategies for a small asset position X(t0) = 0.6 < (N + 1)/(2) and a larger asset position X(t0) = 1.8 > (N + 1)/(2) if the trader is risk-neutral and adverse selection is expected (solid lines); in the displayed scenario, the dark pool order is executed at time .

The boundary (N + 1 - i)/2 is displayed by the dashed line. The right picture shows the same scenarios if adverse selection is not expected (solid thick

lines) respectively if the dark pool is not used (solid thin lines). In both pictures, dotted lines denote the optimal asset positions if the dark pool orders are

never

executed.

N

=

100,



=

100,

p

=

6 100

,



=

0,



=

2.

5.3. Risk-averse investors We now consider risk-averse investors and assume that

 > 0.

(105)

The following theorem provides closed form solutions for the cost functional and the optimal strategy. The structure of both of these is significantly more complex than for risk-neutral investors. However, the main property that the dark pool is only used for positions larger than a certain threshold is maintained.

21

Theorem 5.3. Let  > 0. The value function v(ti, ·) of the Optimization Problem (OPT-ADV) is a piecewise quadratic polynomial and the optimal strategy (x(ti, ·), y(ti, ·)) at time ti is piecewise affine linear.
More precisely, let X(ti) be the asset position at time ti. Then there exist

0 =: X¯ (ti, ti) < · · · < X¯ (ti, tN+1) := 

(106)

such that for

X(ti)  [X¯ (ti, t j), X¯ (ti, t j+1)),

the unique optimal strategy and the value function are given by

(107)

x(ti, X(ti)) = A1(ti, t j)X(ti) + A2(ti, t j), y(ti, X(ti)) = B1(ti, t j)X(ti) + B2(ti, t j), v(ti, X(ti)) = C1(ti, t j)X(ti)2 + C2(ti, t j)X(ti) + C3(ti, t j).
The boundaries X¯ and the coefficients A1, . . . , C3 are given in closed form in Appendix Appendix C.

(108) (109) (110)

5.3.1. Properties of the optimal strategy and the value function The following properties of the optimal strategy and the value function are an immediate consequence of the proof of
Theorem 5.3.

Proposition 5.4. Let  > 0 and i = 0, . . . , N - 1. (i) If X(ti)  X¯ (ti, ti+1), then
y(ti, X(ti)) = 0, x(ti, X(ti)) = A(ti, 0)X(ti), v(ti, X(ti)) = C(ti, 0)X(ti)2

(111) (112) (113)

and (ii) If X(ti)  X¯ (ti, tN), then

X(ti) - x(ti, X(ti))  X¯ (ti+1, ti+2).

(114)

A1(ti, tN) = A(ti, p), B1(ti, tN) = B(ti, p), C1(ti, tN) = C(ti, p);

(115) (116) (117)

recall that A(ti, p), B(ti, p) and C(ti, p) are the coefficients of the optimal strategy respectively the value function for optimal liquidation without adverse selection (cf. Equations (51) - (55)). (iii) If j = i + 1, . . . , N and X(ti)  (X¯ (ti, t j), X¯ (ti, t j+1)), then

x(ti, X(ti)), y(ti, X(ti)) and X(ti) - x(ti, X(ti))

(118)

are increasing in X(ti) and

X(ti)

-

x(ti,

X(ti))

-

y(ti, X(ti))

=

 2C(ti+1, 0)

<

X¯ (ti+1, ti+2),

X(ti) - x(ti, X(ti))  (X¯ (ti+1, t j), X¯ (ti+1, t j+1)).

(119) (120)

(iv) For j = i + 2, . . . , N,

X¯ (ti, t j) = min X  X¯ (ti, t j-1) | X - x(ti, X) = X¯ (ti+1, t j) .

(v) For j = i, ..., N - 1,

C1(ti, t j), C2(ti, t j)  0 and C3(ti, t j)  0.

C1(ti, ·) and C3(ti, ·) are decreasing, and C2(ti, ·) is increasing.

(121) (122)

22

(vi) For j = i, ..., N - 1,

A1(ti, t j), A2(ti, t j), B1(ti, t j)  0 and B2(ti, t j)  0.

(123)

A1(ti, ·) and B2(ti, ·) are decreasing, and A2(ti, ·) and B1(ti, ·) are increasing. In particular, x(ti, ·) is concave and y(ti, ·) is convex.

In contrast to the case of a risk-neutral investor in Section 5.2, we obtain N + 1 - i instead of two trading regions separated

by the boundaries X¯ (ti, t j). Theorem 5.3 and Proposition 5.4 (i) stress the importance of the time-dependent boundary X¯ (ti, ti+1)

for the optimal strategy. Note that the formula for X¯ (ti, ti+1) given in Appendix Appendix C coincides with the corresponding

boundary

for

risk-neutral

investors,

(N+1-i) 2

,

if

we

set



=

0.

Again,

the

dark

pool

is

only

used

at

time

ti

if

the

asset

position

X(ti) is above X¯ (ti, ti+1). If

X(ti) < X¯ (ti, ti+1),

(124)

it is optimal to place no order in the dark pool and the optimal strategy in the primary venue is the same as the one without

dark pool. Even for asset positions

X(ti) > X¯ (ti, ti+1),

(125)

it is no longer optimal to place the full remainder of the position in the dark pool (cf. Section 4.3) by Proposition 5.4 (iii).
As before, the trader wishes to keep a part of her position in order not to miss out completely on a possible favorable price
move. However, a dark pool execution at time t j will cause the position to cross the boundary for the next trading interval X¯ (t j+1, t j+2), and consequently it is optimal to not use the dark pool afterwards (cf. Proposition 5.4 (iii) again). If

X(ti)  (X¯ (ti, t j), X¯ (ti, t j+1))

(126)

for some j = i + 1, . . . , N, the dark pool is only used at times ti, . . . , t j-1 or until execution, whatever the earlier. From time t j respectively after execution, the dark pool is not used anymore as X(t j) < X¯ (t j, t j+1) (cf. Proposition 5.4 (iii)). Only if

X(ti) > X¯ (ti, tN)

(127)

and the orders in the dark pool are never executed, then the optimal asset position stays above the boundary X¯ (t j, t j+1) throughout the whole time horizon [0, T ], and in this case it is optimal to use the dark pool at all trading times ti, . . . , tN-1. Similarly
as in Section 5.2, Proposition 5.4 (ii) implies that for very large

X(ti) >> X¯ (ti, tN),

(128)

adverse selection only has a second order impact on the optimal strategy and the value function. In this case the optimal orders
in the primary venue and the dark pool have the same linear dependence on the position X(ti) that they would have in absence of adverse selection. We illustrate these properties in Figure 10. The left picture shows the optimal strategies for two initial asset positions: a larger one (X(t0) = 1.8) which lies above X¯ (t0, tN) = X¯ (t0, t100) = 1.27 and a smaller one (X(t0) = 0.6) which lies between X¯ (t0, t12) and X¯ (t0, t13). Consequently, the larger asset position crosses the boundary X¯ (ti, ti+1) (dashed line) only if the order in the dark pool is executed (which happens at time 2 in the displayed scenario). The smaller one crosses the boundary after the twelfth trading period (at time 1) if no order in the dark pool is executed before. Compared to the optimal strategies if no adverse selection is expected (right picture, solid lines), the trading speed in the primary venue is initially faster
but still slower than the trading speed of the optimal strategy without dark pool (thin lines). Additionally, the order in the dark
pool is smaller than the remainder of the position, and after execution in the dark pool the investor trades out of the rest solely
in the primary venue. The reason for both properties is the fact that trading in the dark pool is not entirely free anymore and
thus (in relation to it) trading is cheaper in the primary venue.
Figure 11 illustrates the dependence of the optimal strategy on the size of the initial asset position. As stated in Proposi-
tion 5.4 (vi), the optimal order in the dark pool is convex in the asset position while the optimal order in the primary venue is
concave in the asset position.

5.3.2. Dependence on the adverse selection parameter
In Section 4.3 we showed that a high probability of execution in the dark pool slows down trading in the primary venue initially. Intuitively, adverse selection should have the opposite effect: higher adverse selection should speed up trading in the primary venue as trading in the dark pool is relatively more expensive and thus waiting for execution is less attractive (cf. also Figure 10 and the corresponding discussion). The following proposition confirms that this intuition is correct.

23

Size of asset position 1.8
X¯ 0,100

Size of asset position 1.8

0.6 0.6

1 2

Time T

2

Time T

Figure 10: The left picture shows the optimal strategies for a smaller and a larger asset position if adverse selection is expected. The right picture shows the

respective strategies if adverse selection is not expected. In all cases we consider the scenario where the order in the dark pool is executed at time 2. The

solid lines denote the optimal strategies for this scenario, the dotted those for the scenario where orders in the dark pool are never executed. The dashed line

in the left picture reflects the boundary X¯ (ti, ti+1) below which the optimal order in the dark pool is zero. The thin lines in the right pictures denote the optimal

strategies

without

dark

pools.

N

=

100,



=

100,



=

1 100

,

p

=

6 100

,



=

4,



=

2.

Order size

X¯0,1 X¯0,2

Asset position

Figure 11: Optimal order sizes in the dark pool and the primary venue at time t0 depending on the asset position X(t0). The solid line denotes the optimal

order size in the primary venue

x(t0, X(t0)), the dashed line the optimal order size in the dark pool y(t0, X(t0)).

N

=

2, 

=

10,



=

1 2

,

p

=

0.6, 

=

4,

 = 10.

In order to stress the dependence of the value function and the optimal strategy on the parameter , we first introduce the following notation: for a setting with adverse selection   0, we denote the optimal strategy at time ti by

(x(ti, X(ti), ), y(ti, X(ti), )).

(129)

In a similar fashion we characterize optimal trajectories, value functions etc. Similarly as in Corollary 4.4, we define Xne(t j, ) ( j = i, . . . , N) recursively by

Xne(ti, ) = X(ti) and Xne(t j, ) = Xne(t j-1, ) - x(t j, Xne(t j-1, ), ) for j > i.

(130)

Proposition 5.5. Let i = 0, . . . , N - 1 and X(ti) > 0 as before. We define

0

:=

2C(ti+1, 0) C(ti+1, 0) + 

X(ti

).

(i) For j = i + 1, . . . , N, X¯ (ti, t j, ·) is strictly increasing for   0.
(ii) v(ti, X(ti), ·) is strictly increasing for  < 0 and constant for   0. (iii) x(ti, X(ti), ·) is strictly increasing for  < 0 and constant for   0. (iv) y(ti, X(ti), ·) is strictly decreasing for  < 0 and constantly zero for   0. (v) For j = i + 1, . . . , N, Xne(t j, ·) is strictly decreasing for  < 0 and constant for   0.

(131)

24

Order size 1.24

Order size 0.64

 15

p 1

Figure 12: Dependence of the optimal order size in the primary venue (solid lines) and in the dark pool (dashed lines) on adverse selection (left picture) and

on

the

probability

of execution

in

the

dark

pool

(right

picture),

respectively.

X(t0)

=

1.5,

N

=

2,



=

10,



=

1 2

,



=

4;

p

=

0.6

in

the

left

picture,



=

10

in

the right picture.

Figure 12 illustrates the dependence of the trading speed in the primary venue on adverse selection (left picture) and on the probability of execution (right picture). As we have shown in Proposition 5.5, large adverse selection speeds up trading in the primary venue and decreases the optimal order size in the dark pool. On the other hand, high execution probability in the dark pools slows down trading in the primary venue and increases the optimal order size in the dark pool. The sensitivity of dark pool trading on adverse selection implies that dark pool operators need to ensure minimal adverse selection. Several measures have been implemented by dark pools for this purpose, including tight control over the participants in the dark pool and anti-gaming logic to prevent for example pinging in the dark pool.

6. Trading restrictions

Traders liquidating a portfolio for a client often face trading restrictions. For example, traders might not be allowed to short any of the stocks in the portfolio. Additionally, they are often bound to the trading direction intended by the client at all points in time: if the client wants to sell stock A and buy stock B, then the trader must not submit intermediate buy orders for stock A or sell orders for stock B, even if they might appear attractive from a risk mitigation perspective as described in Section 4.4. In particular, trading strategies as in the left picture of Figure 6 are not admissible.
In this section, we will allow for general trading restrictions on trades x(ti), y(ti) and intermediate portfolio positions X(ti). For each point in time ti and asset k, we assume that there are bounds xk,min(ti), xk,max(ti), yk,min(ti), yk,max(ti) for trading and Xk,min(ti), Xk,max(ti) for the portfolio position. We then define the set of admissible strategies as

A (ti, X(ti)) = (x, y)  A(ti, X(ti)) | xk,min(t j)  xk(t j)  xk,max(t j), yk,min(t j)  yk(t j)  yk,max(t j), Xk,min(t j)  Xk(t j)  Xk,max(t j),  j  i, k = 1, . . . , n .

(132)

Since the set of admissible strategies is convex, the proof of Theorem 3.1 also establishes the following theorem:

Theorem 6.1. There is a unique optimal strategy under trading constraints, i.e., there exists a unique

(x, y)  A (ti, X(ti))

(133)

realizing the minimum in

v

(ti,

x(t0),

.

.

.

,

x(ti-1),

X(ti))

:=

min
(x,y)A (ti,X(ti))

 E

[R(ti)]

+



·

E

 

N j=i

X(t j)

 (t j+1)X(t j) .

(134)

Let us turn back to the case of the trading direction restriction. This is equivalent to

xk,min(ti)

:=

yk,min(ti)

:=

0 -

if Xk(t0)  0 otherwise,

xk,max(ti)

:=

yk,max(ti)

:=

 0

if Xk(t0) > 0 otherwise.

(135)

25

Under the assumptions of Section 4, the optimal strategy in the single asset case (n = 1) without a trading constraint does not violate condition (135) (see (52)) and is hence also optimal within A . As already discussed, the optimal strategy within A in the multiple asset case (n  2) might violate condition (135). Unfortunately, the value function v is not of a quadratic form like v and is thus harder to analyze analytically.
We illustrate the effects of restriction (135) by a simple one-period example. The left graph of Figure 13 shows the unrestricted optimal strategy for the liquidation of a poorly diversified portfolio by a risk-averse trader ( = 4), i.e., long positions in two strongly correlated stocks:

= 1· 2

1 0.9

0.9 1

,

X(t0) =

1 1

.

(136)

We consider the second stock to be more liquid than the first one with probabilities of execution in the dark pool 1/4 and 1/20, respectively (and probability 0 for simultaneous execution) and price impact matrix

=

6 0

0 2

.

(137)

The three lines represent the three possible scenarios: Either none of the orders in the dark pool is executed (solid line) or
exactly one of the orders in the dark pool is executed (dashed line for the first stock and dotted line for the second stock). If we restrict short-selling the picture differs significantly. In the specific one-period example outlined above it is easy to
see that the optimal strategy has to fulfill X(t0) = x(t0) + y(t0), i.e., the whole portfolio is split into orders in the primary venue and orders in the dark pools. Using this restriction it is easy to compute x(t0) and y(t0). While the orders in the primary venue are very similar to the ones of the unrestricted optimal strategy, the orders in the dark pools are significantly smaller.

X2 X2

1

X (t0 )

1

X (t0 )

X(t0) - x(t0) -(0, y2(t0))

X(t0) - x(t0) 0,3

X(t0) - x(t0) - (0, y2(t0))

X(t0)- x(t0) 0,3

-0,07

0,42

X1 1

X(t0) - x(t0) - (y1(t0), 0)

0,41

X1 1

-0,19

X(t0) - x(t0) - (y1(t0), 0)

Figure 13: Change of the optimal strategy for the liquidation of a portfolio in a one-period model, if short-selling is not allowed (left graph).

7. Trading prices in the dark pool
So far we have assumed that trades in the dark pool are executed at the unaffected price P~. Within this section we assume instead that dark pool orders are executed at the exchange quoted price P, which includes the temporary market impact of the orders x(ti). As indicated in Section 2.2, this might be a more appropriate assumption for some dark pools. However, this results in profitable market manipulating strategies unless the model parameters are chosen with great care as we shall show in this section. For simplicity, we assume the single asset model described in Section 4.3 and furthermore assume that the investor is risk-neutral ( = 0) in this section.
Market manipulation is a concern in all market models where a large trader's orders have a feedback effect on the execution price of her own orders. Huberman and Stanzl (2004) and Gatheral (2010) derive necessary conditions for market models that
26

exclude profitable market manipulation at a primary exchange. Both papers disregard trading opportunities in dark pools. For the primary exchange, the market model introduced in Section 4 fulfills the requirements established in these papers, i.e., it is not possible to generate profits from market manipulation by trading only at the primary exchange. However, it might be possible to generate profits from market manipulation if orders are placed cleverly in parallel in the dark pool. It is unclear whether such profitable market manipulation strategies exist in reality; given that such strategies were used and had to be forbidden (see Gatheral (2010) for an exposition), such opportunities seem to be available at least sometimes. Nevertheless, we agree with Huberman and Stanzl (2004), Gatheral (2010), Alfonsi and Schied (2010) and Alfonsi et al. (2010b) that an appropriate mathematical market model should exclude profitable market manipulation.
For the purposes of this section, we define market manipulation strategies in the following way.

Definition 7.1. Let i = 0, . . . , N and X(ti)  R. We call a strategy (x(ti), y(ti)) a market manipulation strategy if

sgn(X(ti)) sgn(x(ti)) or sgn(X(ti)) sgn(y(ti)).

(138)

As we saw in Section 4.4, such orders can be attractive as risk mitigation tools in a multi asset setting. In the single asset

setting of this section this justification does not apply, and we saw in Section 4.3 that if trades are executed in the dark pool at

fundamental prices, then market manipulation as defined here is never optimal.

In the following we consider in particular a market manipulation strategy similar to the classical `pump and dump' strat-

egy14. In our market model, selling the stock at the primary exchange after artificially elevating its price (`pumping') cannot

generate profits due to the associated price reaction. A liquidation in the dark pool however does not face such a price penalty.

Consider the following strategy:

Assume that the initial asset position is zero and that the number of trading time points N + 1 is divisible by four. From

t0 until t(N+1)/4 the investor buys a stock quantity X at each point in time at the primary exchange. Simultaneously, she seeks

to

dump

shares

by

placing

a

sell

order

for

(N+1)X 2

in

the

dark

pool

until

the

order

gets

executed

(if

at

all).

At

time

t(N+1)/4

the

investor

either

holds

a

long

or

short

position

of

(N+1)X 4

in

the

asset,

which

she

liquidates

at

a

constant

rate

over

the

remaining

time points t(N+1)/4, . . . , tN. The expected trading proceeds are then

N NN
E (x(ti) + z(ti))P(ti) = E (x(ti) + z(ti))P~(ti) -E (x(ti) + z(ti))x(ti)
i=0 i=0 i=0

(139)

=0

=  - (N + 1)( 1 + 3 1 )X2 + (1 - (1 - p)(N+1)/4) (N + 1)X2

4 49

2

= (N + 1)

1 (1 - p)(N+1)/4 -

X2.

62

(140) (141)

The last expression is positive if the number of trading time points N + 1 is large enough. Furthermore, the expected proceeds grow in the position sizing factor X: the larger the bets, the larger the expected proceeds. The following proposition summarizes the issues we found.

Proposition 7.2. Assume that trades in the dark pool are executed at the market price P. If

N + 1  4 log(1/3)/ log(1 - p) + 1,

(142)

then profitable market manipulation strategies exist and optimal strategies do not exist.
In Section 4.3 we assumed both infinite liquidity in the dark pool if trading is possible (a(ti), b(ti)  {0, }) and no adverse selection ( (ti+1) independent of a(ti), b(ti)). We replace Assumption 4.1 (iii) by the following assumption.
Assumption 7.3. Let i = 1, . . . , N + 1.

14"`Pump and dump' schemes, also known as `hype and dump manipulation', involve the touting of a company's stock [...] . After pumping the stock, fraudsters make huge profits by selling their cheap stock into the market." (From http://www.sec.gov/answers/pumpdump.htm)

27

(i) Liquidity in the dark pool is bounded:

a(ti), b(ti)  {0, L}

for some L  (0, ). (ii) Dark pool execution suffers from adverse selection:

(143)

E[ (ti)|a(ti) = L] = -, E[ (ti)|b(ti) = L] = 

(144)

with  > 0.

By limiting dark pool liquidity, market manipulating strategies with very large trades cannot be profitable. On the other hand, adverse selection makes market manipulation by small trades unprofitable. The following proposition shows that if Assumption 4.1 (iii) is replaced by Assumption 7.3 and adverse selection is sufficiently large, then the undesirable properties outlined in Proposition 7.2 disappear.

Proposition 7.4. Let i = 0, . . . , N. Assume that trades in the dark pool are executed at the market price P(t j), j = i, . . . , N. We consider the following optimization problem:

N

v¯(ti,

X(ti))

:=

inf
( x,y)A(ti ,X (ti ))

E

j=i

x(t j) + z(t j)

P~(ti) - P(t j) .

(145)

If  > L,
then there exist optimal strategies realizing the minimum in Equation (145) and these are not market manipulating.

(146)

The assumptions of Proposition 7.4 are strong; we leave it for future research (such as Klöck et al. (2011)) to determine tighter necessary and sufficient conditions for the exclusion of profitable market manipulation in markets with dark pools. We only want to remark that our assumptions in Proposition 7.2 are not too restrictive for dark pool usage in general: for large initial asset positions X(t0), the optimal strategy places orders in the dark pool in a non-market manipulating fashion.

8. Conclusion
In this article we establish a model for optimal trade execution in dark pools. We take the position of a single risk-averse trader who has to liquidate a portfolio of n assets within a finite time horizon [0, T ]. We assume that the trader can place orders at fixed trading times 0 = t0 < · · · < tN = T both at a traditional exchange and in a dark pool. She must trade off paying price impact costs at the traditional exchange against the prospect of uncertain execution in the dark pools. By design, our model is a partial equilibrium model where price impact and dark pool liquidity are assumed to be exogenously given. To our knowledge our market model is the first mathematical framework for trade execution in dark pools. We establish existence and uniqueness of optimal liquidation strategies in this general model.
In order to obtain explicit solutions for the optimal liquidation strategy, we analyze a more specific version of our general model. We assume that the price impact at the primary venue is temporary and linear in the order size and that orders in the dark pools are executed fully or not at all. We obtain explicit recursions and numerical solutions to the resulting quadratic optimization problem. In the single-asset setting it is always optimal to place the entire asset position in the dark pool and slow down trading at the primary venue. This is no longer true if the trader aims to liquidate a portfolio. If the portfolio is balanced and thus only exposed to little market risk, then a complete liquidation of the position in one of the assets is unfavorable and thus only a fraction of the entire portfolio is placed in the dark pool. On the other hand it can be optimal to place orders larger then the asset position in the dark pools for some of the stocks if the portfolio is unbalanced. This highlights that overly simple adjustments to existing trade execution algorithms are exposed to potential pitfalls.
In practice, adverse selection can play a major role for traders using dark pools: An execution in the dark pool might be a sign for an impending favorable price movement in the primary venue. We can incorporate this effect in our model and obtain closed form solutions for the optimal liquidation strategy in the single-asset setting. Adverse selection changes the optimal strategy significantly: It is no longer optimal to place the entire remainder of the position in the dark pool and it can even be optimal to not use the dark pool at all. Furthermore, adverse selection speeds up trading in the primary venue and increases expected trading costs.

28

In our model, trades in the dark pool occur at the fundamental price of the asset which is not influenced by the trades of the large investor. If we relax this assumption and allow trading in the primary venue to have an impact on the transaction price in the dark pool, then market manipulation strategies can potentially generate infinite gains and optimal strategies might not exist. These undesirable effects can be avoided if liquidity in the dark pool is bounded and adverse selection is sufficiently strong.
Appendix A. Market and liquidity risk
As noted in Section 2.3, our model setup penalizes the variance introduced by market risk, but does not consider any uncertainty of liquidation proceeds introduced by liquidity risk. In this appendix we investigate the impact of this model choice by analyzing the single asset case with linear price impact (see Section 4.2). Figure A.14 illustrates the distribution of the implementation shortfall R realized by the optimal strategy for two different parameter choices of the model that we propose in Section 2.2.
p(R) p(R)

µ¯ - 2 µ¯ µ¯ + 2

R

µ¯ - 2 µ¯ µ¯ + 2

R

Figure A.14: Distribution of implementation shortfall R (thick solid line) and approximation by Gaussian mixture distribution with common mean (thin solid line) and Gaussian distribution (dashed line). X(t0) = 1,  = 0, N = 1000,  = 0.1, p = 0.0023 and  = 1000 (left graph),  = 100000 (right graph).

If the price impact is small compared to the exogenous volatility of the asset price, then R follows a unimodal distribution

that is driven by market risk (left hand side of Figure A.14). If the price impact is large compared to the volatility, then R

follows a bimodal distribution where the two modes correspond to the cases of presence and absence of liquidity in the dark

pool (right hand side of Figure A.14).

The distribution of R is a Gaussian mixture distribution. Liquidity in the dark pool is found at time i  0, . . . , N - 1 for the

first time with probability15 wi := p(1 - p)i. In this event the trades (x(t j))0 ji and remaining position (X(t j))0 ji until time i

are equal to (xne(t j))0 ji and (Xne(t j))0 ji and are zero thereafter (see Corollary 4.4). The implementation shortfall is hence

normally distributed with mean µi :=

i j=0

(xnje)2

and

variance

i2

:=

i j=0

(Xnj e)2.

Mixing

these

normal

distributions

with

weights wi gives the distribution of R.

In Figure A.14 the exact distribution (thick solid line) is compared to two reference distributions. The first one (illustrated

by the thin solid line in Figure A.14) is another mixture distribution of N + 1 Gaussian distributions, with the same weights wi

and the same variances i2 as in the exact distribution of R. The means of the normal distributions however are changed from

µi to µ¯ :=

N j=0

wiµi,

i.e.,

the

same

mean

is

applied

to

all

underlying

Gaussian

distributions.

The

resulting

mixture

distribution

captures the market risk component that is being penalized in our model but does not include the liquidity risk component.

As shown in Figure A.14, the thick solid line (exact distribution) and the thin solid line are similar if the temporary price

impact is small compared to the variance, but they are notably different if the temporary price impact is large. In the first

15The case i = N corresponds to not finding any liquidity in the dark pool and occurs with probability (1 - p)N .
29

case the variance of the exact distribution is only marginally larger than the market risk component, but in the latter case it is several orders of magnitude larger. In theory our model might hence be missing an important component of overall variance. In reality however price impact is almost always significantly smaller than market volatility. This is reflected for example in the difficulty of measuring market impact and evaluating the performance of trade execution algorithms; see for example Almgren et al. (2005), Sofianos and Jeria (2008a) and Sofianos and Jeria (2008b). Under such circumstances our model appears to capture the primary risk component.
The exact distribution of R is a Gaussian mixture distribution and hence not normal. The deviation from normality is obvious in the case of the bimodal distribution for large price impact. However also in the case of the unimodal distribution for small price impact, the distribution is significantly non-normal. For comparison Figure A.14 displays a normal distribution with the same mean and variance as the exact distribution (dashed line). It should be noted that this feature is created by the existence of the dark pool; in the absence of a dark pool, i.e. in the model of Almgren and Chriss (2001), the distribution of implementation shortfall is normal. Investors might be concerned about risk features beyond the variance of the distribution. While all of these yield the same set of optimal strategies in Almgren and Chriss (2001), this is not necessarily the case any more in our model. In particular tail risk aversion might lead to different optimal trading strategies.

Appendix B. Recursions for the optimal strategy and the cost functional in Section 4

Before we state the recursions, we need to introduce the following notation: In each time-interval [ti, ti+1) there are 2n

possible "combinations" or "scenarios" with respect to joint execution and non-execution of the order y(ti)  Rn in the dark

pool (note that due to Assumption 4.1 (iv), we can assume that execution of an order yk(ti) is "independent" of the sign of

yk(ti)). Each of these scenarios occurs with a fixed probability, which we denote by pl for the lth scenario, determined by the

distributions of the random variables a(ti+1) and b(ti+1). We denote the amount executed in the dark pool at time i in scenario

l by z(l, ti), i.e.,

zk(l,

ti)

:=

yk(ti) 0

if in the lth scenario the order in the kth asset in the dark pool is executed otherwise.

(B.1)

There exists a diagonal matrix Zl  Rn×n (with 1's and 0's on the diagonal) such that

z(l, ti) = Zly(ti).

(B.2)

We define the diagonal matrix P^ = (p^k,m)k,m=1,...,n by

P^ := plZl,
l

(B.3)

i.e., p^k,k is the probability that an order for the kth asset is executed in the dark pool in [ti, ti+1). We re-order the assets in such

a way that for k0  {0, . . . , n},

p^k,k = 0 if and only if k > k0,

(B.4)

i.e., k0 = 0 refers to the case where the dark pool is not used at all and k0 = n to the case where there is liquidity with positive
probability for all assets in the dark pool. Finally, for a positive definite matrix M  Rn×n, we define

M = (m i, j)i, j=1,...,n := plZl MZl.
l

(B.5)

Note that both M = (m k,m)k,m=1,...,n and P^ are positive definite for k0 = n but not for k0 < n. In the latter case, m k,m = 0 for k > k0 or m > k0 and p^k,k = 0 for k > k0. However, the matrices M := (m k,m)k,m=1,...,k0  Rk0×k0 and P^ := (p^k,m)k,m=1,...,k0  Rk0×k0 are positive definite. We therefore use generalized inverses of matrices. We denote the Moore-Penrose Inverse of a matrix M by M. For regular M, we have M-1 = M (see, e.g., the book by Ben-Israel and Greville (2003)).
The matrices A(ti), B(ti) and C(ti) in Theorem 4.2 are given recursively by AN = I, BN = 0, CN =  +  and A(tN) = I, B(tN) = 0, C(tN) =  +  and

A(ti) =  + D(ti+1) D(ti+1),

(B.6)

30

where

B(ti) = C(ti+1)P^C(ti+1) I - A(ti) , C(ti) =  + D(ti+1) - D(ti+1)  + D(ti+1) D(ti+1),
D(ti+1) := C(ti+1) - C(ti+1)P^C(ti+1)P^C(ti+1).

Appendix C. Closed form solutions for the optimal strategy and the cost functional in Section 5

Appendix C.1. Risk-neutral investors The coefficients are given by
and for i = 0, . . . , N - 1,

A2(tN ) = B2(tN ) = C2(tN ) = C3(tN ) = 0

A2(ti)

=

-

A(ti,

p)(N + 2

1

-

i)

-



,

B2(ti)

=

-

B(ti,

p)(N 2

+

1

-

i)

,

C2(ti) =

A2(ti)

C(ti, p)(1 - p) +  1- p

,

N-1
C3(ti) = (1 - p)k-iD(tk+1),

k=i

2

where

D(tk)

:=

2 -

p(N + 1 4

-

k)

-

C2(tk)(1 - 4(C(tk, p)(1

p) -

+ p)

p + )

.

Appendix C.2. Risk-averse investors For i = 0, . . . , N - 1, j = i, . . . , N,

X¯ (ti, t j)

=

2(1

-

1 p) sinh((p))

· 2 d(t j) sinh(( j - i)(p)) 1 - p j-i+1 - e(t j) sinh(( j - i - 1)(p)) 1 - p j-i+2

+ p 1 - p j-i-1 sinh(( j - i)(p)) - 1 - p j-i sinh(( j - i - 1)(p)) - sinh((p)) ,

where for j < N and

d(t j)

:=

(C(t j, 0) + ) , 2C(t j, 0)

e(t j)

:=

 2C(t j, 0)

d(tN) := e(tN) := 0.

In particular,

X¯ (ti, ti+1)

=

(C(ti+1, 0) + ) 2C(ti+1, 0)

for i = 0, . . . , N - 1, where C(ti+1, 0) is as in Equation (55). For i = 0, . . . , N - 1, j = i + 1, . . . , N - 1 we define by abuse of notation

X¯ (ti+1, ti+1)

:=

 2C(ti+2, 0)

0.

(B.7) (B.8) (B.9)
(C.1) (C.2) (C.3) (C.4) (C.5) (C.6)
(C.7) (C.8) (C.9) (C.10)
(C.11)

31

Then

A1(ti, t j)

=

1

-

X¯ (ti+1, X¯ (ti,

t j+1) t j+1)

- -

X¯ (ti+1, t X¯ (ti, t j)

j)

,

A2(ti, t j)

=

X¯

(ti+1

,

t

j+1)X¯ (ti X¯ (ti,

, t

t j) - X¯ (ti+1 j+1) - X¯ (ti,

, t

t j)X¯ (ti j)

,

t

j+1)

,

B1(ti, t j) = 1 - A1(ti, t j),

B2(ti, t j)

=

-A2(ti,

tj)

-

 2C(ti+1,

, 0)

C1(ti, t j)

=

1

 -

p

X¯ (ti-1, X¯ (ti,

t j+1) t j+1)

- -

X¯ (ti-1, t j) X¯ (ti, t j)

-

1

,

C2(ti, t j)

=

X¯ (ti, t j+1)(2X¯ (ti-1, t j) - p) - X¯ (ti, t j)(2X¯ (ti-1, t j+1) (1 - p)(X¯ (ti, t j+1) - X¯ (ti, t j))

- p) ,

where X¯ is given as in Equation (C.7). Furthermore, for i = 0, . . . , N - 1,

A1(ti, tN) = A(ti, p),

A2(ti, tN) = B(ti, p)X¯ (ti, tN) - X¯ (ti+1, tN),

B1(ti, tN) = B(ti, p),

B2(ti, tN )

=

-A2(ti, tN )

-

 2C(ti+1,

, 0)

C1(ti, tN) = C(ti, p),

C2(ti, tN )

=

A2(ti-1, tN )

C(ti, p)(1 - 1- p

p) + 

.

Finally, for i = 0, . . . , N - 1, j = i + 1, . . . , N, we have

j-1

C3(ti, t j) = (1 - p)k-iD(tk+1, t j),

k=i

2

where

D(tk,

t

j)

:=

-

2 p 4C(tk,

0)

-

C2(tk, t j)(1 - p) + p .
4(C1(tk, t j)(1 - p) + )

(C.12) (C.13) (C.14) (C.15) (C.16) (C.17)
(C.18) (C.19) (C.20) (C.21) (C.22) (C.23)
(C.24)
(C.25)

Appendix D. Proofs

Proof of Proposition 3.2. Instead of describing a strategy (x, y)  A(ti, X(ti)) as a stochastic process, we can alternatively

describe it as a vector. Let therefore

 = {1, . . . , M}.

(D.1)

By abuse of notation, we write

w = x(ti, 1), . . . , x(ti, M), x(ti+1, 1), . . . , x(ti+1, M), . . . , x(tN, 1), . . . , x(tN, M),
=:wx
y(ti, 1), . . . , y(tN , M)  Rn×2×M×(N+1-i).
=:wy

The objective function

C(w) := J(ti, x(t0), . . . , x(ti-1), X(ti); w)

(D.2) (D.3)

32

is continuous in the strategy w  Rn×2×M×(N+1-i), and the set of admissible strategies corresponds to a closed subset of

Rn×2×M×(N+1-i). We show that

lim C(w) = ,
w 

(D.4)

where · is the maximum norm on Rn×2×M×(N+1-i). This allows us to restrict w to a bounded set, and so the existence of an optimal strategy follows from continuity of C.
It is sufficient to prove Equation (D.4) for  = 0, for which we obtain

NN
C(w) = E x(t j) f j(x(t0), . . . , x(t j)) + E x(t j) (P~(ti) - P~(t j))
j=i j=i
N
+ E z(t j) (P~(ti) - P~(t j))
j=i
=: C1(w) + C2(w) + C3(w).

(D.5) (D.6)

Note that C2 and C3 are not necessarily bounded from below and that C1(w) > 0 for wx large enough. Therefore, we have to

show that C1 grows faster in w than |C2| and |C3|.

It follows from Assumption 2.1 (ii) that

lim C1(w) = . wx  wx

(D.7)

Since  is finite, the price process P~ is bounded, and thus there exists a constant C~ such that for all wx 0,

|C2(w)|  1 wx wx

N
E |x(t j) (P~(ti) - P~(t j))|
j=i

C~ 
wx

NMn
|xk(t j, l)|P[l]
j=i l=1 k=1

 C~ · n · (N + 1 - i).

(D.8)
(D.9) (D.10)

If the liquidity in the dark pool is bounded for all assets, then wy and |C3(w)| are bounded and thus

lim |C3(w)| = 0. w  w

(D.11)

If not, we obtain similarly as before for wy 0 (recall that |z|  |y|),

|C3(w)|  C~ · n · (N + 1 - i). wy

(D.12)

Finally, a large order in the dark pool at a given point in time requires large orders in the primary venue with positive probability since by Definition 2.3 (ii), full execution of the dark pool order is possible, while on the other hand future dark pool orders have positive probability of non-execution (cf. Assumption 2.2 (ii)). Thus, there exists a constant C such that

lim wx > C. wy  wy Equation (D.4) now follows directly from (D.7), (D.10), (D.12) and (D.13).

(D.13)

Proof of Proposition 3.3. We proceed by backward induction on i. For i = N, the validity of the theorem follows since the only admissible strategy is x(tN) = X(tN), y(tN) = 0 due to Assumption 2.2 (ii), and the convexity of HN defined by Equation (38) follows directly from the convexity of the price impact cost of trading (Assumption 2.1 (i)) as

N-1
HN(x(t0), . . . , x(tN-1), X(tN)) = X(tN) fN(x(t0), . . . , x(tN)) + x(t j) f j(x(t0), . . . , x(t j)).
j=0

(D.14)

33

For the induction step we consider two points

(x(t0), . . . , x(ti-1), X(ti)) and (x~(t0), . . . , x~(ti-1), X~ (ti)).

(D.15)

For these points, optimal orders

(x(ti), y(ti)) := (x(ti), y(ti)) respectively (x~(ti), y~(ti)) := (x~(ti), y~(ti))

(D.16)

exist by Proposition 3.2. We define continuous functions

x(t j, ·), y(t j, ·), X(ti, ·) : [0, 1] - Rn, 0  j  i,

(D.17)

such that

x(t j, 0) = x(t j), y(t j, 0) = y(t j), X(ti, 0) = X(ti), x(t j, 1) = x~(t j), y(t j, 1) = y~(t j), X(ti, 1) = X~ (ti), 0  j  i.

(D.18) (D.19)

Then by the dynamic programming principle,

v(ti, x(t0, s), . . . , x(ti-1, s), X(ti, s))  x(ti, s) fi(x(t0, s), . . . , x(ti, s)) + X(ti, s) (ti+1)X(ti, s) + (X(ti, s) - x(ti, s)) E[P~(ti) - P~(ti+1)] - E[z(ti, s) (P~(ti) - P~(ti+1))] + E[v(ti+1, x(t0, s), . . . , x(ti, s), X(ti, s) - x(ti, s) - z(ti, s))] =: hi(s),

(D.20) (D.21)

where Inequality (D.20) is an equality for s = 0 and s = 1. We now assume that the proposition holds for i + 1 and divide the proof of the induction step into three parts.

(i) Let

i-1
h~i(s) := hi(s) + x(t j, s) f j(x(t0, s), . . . , x(t j, s)).
j=0

(D.22)

We show that if h~i is strictly convex, then Hi is strictly convex and the optimal strategy at time ti is unique. (ii) We define the functions x(t j, ·), y(t j, ·), X(ti, ·) in such a way that x(t j, ·), E[z(t j, ·)] and X(ti, ·) are affine linear; here, we
use the shorthand notation z(ti, s) := z(ti, y(ti, s)). This is needed to carry out step (iii).
(iii) We show that if Hi+1 is strictly convex (induction hypothesis!),

(x(t0), . . . , x(ti-1), X(ti), x(ti), y(ti)) (x~(t0), . . . , x~(ti-1), X~ (ti), x~(ti), y~(ti))

(D.23)

and x(t j, ·), y(t j, ·), X(ti, ·) are defined as in (ii), then h~i is strictly convex in s on [0, 1]. Hence by (i), Hi is strictly convex.

The natural order of the three steps is (ii), (iii), (i). We start by proving (i) in order to motivate the necessity of the steps (ii) and (iii). The second part is the key step in the proof; the proof of the third part is rather extensive.

(i) Let and s  (0, 1). Then

(x(t0), . . . , x(ti-1), X(ti)) (x~(t0), . . . , x~(ti-1), X~ (ti))

(D.24)

Hi((1 - s)x(t0) + sx~(t0), . . . , (1 - s)x(ti-1) + sx~(ti-1), (1 - s)X(ti) + sX~ (ti))

(D.20)


h~ ( s)

= h~i((1 - s) · 0 + s · 1)

< (1 - s)h~i(0) + sh~i(1) = (1 - s)Hi(x(t0), . . . , x(ti-1), X(ti))+ sHi(x~(t0), . . . , x~(ti-1), X~ (ti)),

(D.25) (D.26) (D.27) (D.28)

34

where Equation (D.28) follows from the fact that we have equality in Inequality (D.20) for s = 0 and s = 1. Thus, Hi is strictly convex. For the uniqueness of the optimal strategy, let

(x(t0), . . . , x(ti-1), X(ti)) = (x~(t0), . . . , x~(ti-1), X~ (ti)).

(D.29)

If (x(ti), y(ti)) = (x(ti), y(ti))
are both optimal, then we have (cf. Inequality (D.20))

(x~(ti), y~(ti)) = (x~(ti), y~(ti))

(D.30)

h~i(0) = h~i(1)  h~i(s) for all s  (0, 1),
contradicting the strict convexity of h~i and hence (D.30). (ii) We define the functions x(t j, ·) and X(ti, ·) by the convex combinations

(D.31)

x(t j, s) := (1 - s)x(t j) + sx~(t j) for all 0  j  i, 0  s  1, X(ti, s) := (1 - s)X(ti) + sX~ (ti) for all 0  s  1.

(D.32) (D.33)

Note that if we define y(ti, s) accordingly, the linearity of y(ti, ·) neither carries over to z(ti, s) nor to E[z(ti, s)]. The key step in the proof is to define y(ti, s) in such a way that

s  E[z(ti, s)]

(D.34)

is affine linear. We set y(ti, s) such that

E[z(ti, s)] = (1 - s)E[z(ti)] + sE[z~(ti)].

(D.35)

To this end, we define the function

g(y) := E[z(y)].

It is injective by Definition 2.3 (ii) and continuous. We define

(D.36)

y(ti, s) := g-1 (1 - s)E[z(ti)] + sE[z~(ti)] ,

(D.37)

in particular y(ti, 0) = y(ti), y(ti, 1) = y~(ti) and y(ti, ·) is continuous on [0, 1]. Note that y(ti, ·) is piecewise affine linear but not affine linear in general; also, E[z(ti, ·)] is affine linear but pathwise z(ti, ·) is not affine linear.
(iii) If z(ti, ·) was pathwise affine linear on the whole interval [0, 1], then strict convexity of Hi+1 would directly transfer to strict convexity of h~i by definition of h~i (cf. Inequality (D.20)). As we only have linearity of E[z(ti, ·)], the line of
argument becomes more extensive. The only points where convexity of h~i can break down are the points s j at which the slope changes for yk(ti, ·) for some k = 1, . . . , n (cf. Figure D.15).
We denote the finitely many points at which there is a coordinate k such that

P[-yk(ti, s j) = ak(ti+1)] > 0 or P[yk(ti, s j) = bk(ti+1)] > 0

(D.38)

by 0 < s1 < · · · < sM < 1. We can assume without loss of generality that at each s j there is exactly one coordinate k j
such that (D.38) holds. In the case that there are multiple such k s, an arbitrary small perturbation of a(ti+1) and b(ti+1) removes multiplicity, and a simple approximation argument using the fact that z(ti) is continuous in a(ti+1) and b(ti+1) extends the desired result to full generality. On (s j, s j+1), the strict convexity of h~i is clear since the map

s  (x(t0, s), . . . , x(ti, s), z(ti, s), X(ti, s))

(D.39)

is pathwise affine linear (note that yk(ti, ·) is affine linear on (s j, s j+1)), and thus h~i is strictly convex by the strict convexity of Hi+1.

35

Order-/Trade size zk(ti, s) if bk(ti+1) > yk(ti, s)

yk(ti, s)

zk(ti, s) if bk(ti+1) = yk(ti, s)

s sj Figure D.15: If P[yk(ti, s j) = bk(ti+1)] > 0 for an order yk(ti, s j) > 0, then the slope of yk(ti, ·) can change at s j, and zk(ti, ·) is not pathwise affine linear.

Let therefore j = 1, . . . M and k  {1, . . . , n} such that

P {yk(ti, s j) = -ak(ti+1)}  {yk(ti, s j) = bk(ti+1)} > 0.

(D.40)

We first consider the case

yk(ti, s j) > 0, i.e., P yk(ti, s j) = bk(ti+1) > 0.

(D.41)

Then yk(ti, s) > 0 for all s  (s j-1, s j+1) by Assumption 2.2 (ii). We assume without loss of generality that yk(ti, s j-1) < yk(ti, s j+1) (the proof for the case yk(ti, s j-1) = yk(ti, s j+1) is straightforward) and define

A := {yk(ti, s j)  bk(ti+1)}  .

(D.42)

Let

z¯k(ti,

s)

:=

 E

zk(ti,

zk(ti, s)

s)|A

on A otherwise.

(D.43)

z¯l(ti, s) := zl(ti, s) for l k.

(D.44)

Order-/Trade size y(ti, s j+1)

zk(ti, s) on A2

yk(ti, s) z¯k(ti, s)

y(ti, s j) y(ti, s j-1)

zk(ti, s) on A1

s j-1 s j

s s j+1

Figure D.16: Orders yk(ti, s) and associated trades zk(ti, s) on the interval (s j-1, s j+1). The thin solid line represents the orders yk(ti, s). Note that the slope of yk(ti, s) is larger for s > s j than for s < s j. The dotted lines represent the trades zk(ti, s) on A1 and A2, respectively. The affine linear function z¯(ti, s) defined
in Equation (D.43) is represented by the dashed line.

Note that for l k, zl(ti, s) is pathwise affine linear on the whole interval (s j-1, s j+1). On  \ A, zk(ti, s) is independent of s  (s j-1, s j+1). On A, we have

E zk(ti, s)|A

=1 P(A)

E[zk(ti, s)] - E[1\Azk(ti, s)] .

(D.45)

36

E[zk(ti, s)] is affine linear by construction and E[1\Azk(ti, s)] is independent of s. Therefore, z¯(ti, ·) is pathwise affine linear on the whole interval (s j-1, s j+1). We obtain that

i-1
x(t j, s) f j(x(t0, s), . . . , x(t j, s)) + h¯i(s),
j=0

(D.46)

where

h¯i(s) := x(ti, s) fi(x(t0, s), . . . , x(ti, s)) + X(ti, s) (ti+1)X(ti, s) + (X(ti, s) - x(ti, s)) E[P~(ti) - P~(ti+1)] - E[z¯(ti, s) (P~(ti) - P~(ti+1))] + E[v(ti+1, x(t0, s), . . . , x(ti, s), X(ti, s) - x(ti, s) - z¯(ti, s))]

(D.47)

is strictly convex in s on (s j-1, s j+1) as before by the strict convexity of Hi+1. It is clear that h¯i(s) = hi(s) for s  s j. If

h¯ i(s)  hi(s) for all s  (s j-1, s j+1),

(D.48)

convexity of h~i follows at the point s j. To this end, we observe that for s > s j,

hi(s) - h¯ i(s) = E 1A(zk(ti, s) - z¯k(ti, s)) k(ti+1) + E 1Av(ti+1, x(t0, s), . . . , x(ti, s), X(ti, s) - x(ti, s) - z(ti, s)) - E 1Av(ti+1, x(t0, s), . . . , x(ti, s), X(ti, s) - x(ti, s) - z¯(ti, s))
=: C1 + C2 - C3.

(D.49) (D.50)

By induction hypothesis,

v(ti+1, x(t0, s), . . . , x(ti, s), ·)

is strictly convex, and thus by Jensen's inequality, the disintegration theorem, the definition of z¯k on A and Assumption 2.2 (iv), we have

C2 = E 1Av ti+1, x(t0, s), . . . , x(ti, s), X(ti, s) - x(ti, s) - z(ti, s) = P[A]E v ti+1, x(t0, s), . . . , x(ti, s), X(ti, s) - x(ti, s) - z(ti, s) |A
= P[A] v ti+1, x(t0, s), . . . , x(ti, s), X(ti, s) - x(ti, s) - z(ti, s) P[dz|A]

(D.51) (D.52)
(D.53)

= P[A]

v ti+1, x(t0, s), . . . , x(ti, s), X1(ti, s) - x1(ti, s) - z1(ti, s), . . . , Xn(ti, s) - xn(ti, s) - zn(ti, s)

P[dzk|A, z1, · · · , zk-1, zk+1, · · · , zn]P[d(z1, · · · , zk-1, zk+1, · · · , zn)|A]

(D.54)

 P[A] v ti+1, x(t0, s), . . . , x(ti, s), (X1(ti, s) - x1(ti, s) - z1(ti, s),

. . . , Xk(ti, s) - xk(ti, s) - E[zk(ti, s)|A], . . . , Xn(ti, s) - xn(ti, s) - zn(ti, s)) P[d(z1, · · · , zk-1, zk+1, · · · , zn)|A] = P[A]E[v ti+1, x(t0, s), . . . , x(ti, s), X(ti, s) - x(ti, s) - z¯(ti, s) |A] = E 1Av ti+1, x(t0, s), . . . , x(ti, s), X(ti, s) - x(ti, s) - z¯(ti, s) = C3.

(D.55) (D.56) (D.57) (D.58)

Note that in Inequality D.55 we use that E[zk(ti, s)|A, z1, · · · , zk-1, zk+1, · · · , zn] = E[zk(ti, s)|A], which is an immediate consequence of Assumption 2.2 (iv).
The last step is to show that C1  0. We let m1 be the slope of yk(ti, s) for s < s j and m2 be the slope of yk(ti, s) for s > s j. Note that 0 < m1 < m2. For s  s j, we have yk(ti, s) = z¯k(ti, s) on A. Thus as z¯k(ti, ·) is affine linear, z¯k(ti, ·) has slope m1 on the whole interval (s j-1, s j+1) (cf. Figure D.16).

37

Let now s > s j. For we have on A = A1 A2, More precisely,

A1 := {yk(ti, s j) = b(ti+1)}, A2 := {yk(ti, s j) < b(ti+1)}, z¯k(ti, s) > zk(ti, s) on A1, z¯k(ti, s) < zk(ti, s) on A2.

(D.59) (D.60)

Note that

zk(ti, s) - z¯k(ti, s) = -m1(s - s j) on A1, zk(ti, s) - z¯k(ti, s) = (m2 - m1)(s - s j) on A2.

(D.61) (D.62)

yk(ti, s j) + m1(s - s j) = E[zk(ti, s)|A]

=

1 P[A]

E[1A1 zk(ti, s)] + E[1A2 zk(ti, s)]

=

1 P[A]

P[A1]yk(ti, s j) + P[A2]yk(ti, s)

=

1 P[A]

(P[A] - P[A2])yk(ti, s j) + P[A2](yk(ti, s j) + m2(s -

s j))

.

Equation (D.66) is equivalent to

P[A1]

=

m2 - m1 m2

P[A],

P[A2]

=

m1 m2

P[A].

Therefore, we have

(D.63) (D.64) (D.65) (D.66)
(D.67) (D.68)

C1 = E 1A(zk(ti, s) - z¯k(ti, s)) k(ti+1)

= E 1A1 (zk(ti, s) - z¯k(ti, s)) k(ti+1) + E 1A2 (zk(ti, s) - z¯k(ti, s)) k(ti+1)

(D.62)=,(D.61) -P[A1]m1(s - s j)E k(ti+1)|A1 + P[A2](m2 - m1)(s - s j)E k(ti+1)|A2

=

-

m1(m2 - m2

m1)

P[A](s

-

s

j)E

k(ti+1)|bk(ti+1) = yk(ti, s j)

+

m1(m2 - m2

m1) P[A](s

-

s j)E

k(ti+1)|bk(ti+1) > yk(ti, s j)

 0,

(D.69) (D.70) (D.71)
(D.72) (D.73)

where Inequality (D.73) follows from Assumption 2.2 (iii).

The cases

y(ti, s j) < 0 and y(ti, s j) = 0

(D.74)

follow similarly with straightforward modifications. Combining these observations, we have strict convexity of h~i at all points s j and on all intervals (s j, s j+1), i.e., on the whole interval [0, 1], completing the proof of (iii).

Proof of Theorem 4.2. We prove the theorem by backward induction. Note that C(tN) =  +  is positive definite as  is positive definite,  (as a covariance matrix) is nonnegative definite and   0. Therefore all assertions follow for i = N.
Let now i < N. Due to the linearity of the price impact function, the martingale property and the independence of dark
pool liquidity of future price moves, we obtain the Bellman equation

v(ti,

X(ti))

=

inf
( x,y)Rn ×Rn

x

x +  · X(ti)

X(ti) +

plv(ti+1, X(ti) - x - Zly) ;

yk =0, k>k0

l

(D.75)

38

recall that the optimal strategy must fulfill yk(ti) = 0 for k > k0 almost surely by Assumption 2.3 (ii). By abuse of notation, y denotes simultaneously y  Rk0 and y  Rn with yk = 0 for k > k0, where either way is clear from the context. Using the
induction hypothesis, Equation (D.75) becomes

v(ti,

X(ti))

=

inf
( x,y)Rn ×Rn

x

x + X(ti)

X(ti) +

pl(X(ti) - x - Zly) C(ti+1)(X(ti) - x - Zly) .

yk =0, k>k0

l

The function v~(ti, X(ti), ·) : Rn × Rk0 - R given by

(D.76)

v~(ti, X(ti), x, y) := x x +  · X(ti) X(ti) + pl(X(ti) - x - Zly) C(ti+1)(X(ti) - x - Zly)
l

(D.77)

is a strictly convex linear-quadratic functional as C(ti+1) is positive definite by the induction hypothesis and  is positive definite. Therefore, the unique minimum (x, y) of v~(ti, X(ti), ·) is given by the solution of

xv~(ti, X(ti), x, y) = 0, yv~(ti, X(ti), x, y) = 0.

(D.78)

The System (D.78) is equivalent to

 + C(ti+1) x + C(ti+1)P^ y = C(ti+1)X(ti), P^C(ti+1)x + C(ti+1)y = P^C(ti+1)X(ti),

(D.79)

which in turn is equivalent to

P^C(ti+1)x + C(ti+1)y = P^C(ti+1)X(ti), ( + D(ti+1))x = D(ti+1)X(ti).

(D.80)

Solving System (D.80) for (x, y), yields Equations (B.6) and (B.7). Plugging this into v~(ti, X(ti), ·), we obtain

v(ti, X(ti)) = (A(ti)X(ti)) (A(ti)X(ti)) +  · X(ti) X(ti)

+ pl(X(ti) - A(ti)X(ti) - ZlB(ti)X(ti))
l
C(ti+1)(X(ti) - A(ti)X(ti) - ZlB(ti)X(ti))

(D.81)

= X(ti) A(ti) A(ti) + 

+ pl(I - A(ti) - ZlB(ti)) C(ti+1)(I - A(ti) - ZlB(ti)) X(ti).
l

(D.82)

=:C (ti )

By the induction hypothesis, C(ti) is nonnegative definite. To see that C(ti) is indeed positive definite, let x  Rn, xk 0. If

A(ti)x 0, then

x A(ti) A(ti)x > 0.

(D.83)

In any case, there exists an l such that the kth diagonal element of Zl is 0 and pl > 0 (cf. Assumption 2.2 (ii)). If A(ti)x = 0, then y := (I - A(ti) - ZlB(ti))x 0 and

pl x (I - A(ti) - ZlB(ti)) C(ti+1)(I - A(ti) - ZlB(ti))x = ply C(ti+1)y > 0

(D.84)

by the induction hypothesis. We now set

E(ti+1) := C(ti+1)P^C(ti+1)P^C(ti+1) = C(ti+1) - D(ti+1).

(D.85)

39

Note that C(ti+1) and thus D(ti+1) and E(ti+1) are symmetric due to the symmetry of C(ti+1). Furthermore,
C(ti) = A(ti) A(ti) +  + C(ti+1) - C(ti+1)A(ti) - A(ti) C(ti+1) - C(ti+1)P^ B(ti) - B(ti) P^C(ti+1) + A(ti) C(ti+1)A(ti) + B(ti) Ci+1B(ti) + A(ti) C(ti+1)P^ B(ti) + B(ti) P^C(ti+1)A(ti)
= A(ti) A(ti) +  + C(ti+1) - C(ti+1)A(ti) - A(ti) C(ti+1) - E(ti+1) + A(ti) C(ti+1)A(ti) + E(ti+1)A(ti) + A(ti) E(ti+1) - A(ti) E(ti+1)A(ti)
= A(ti) A(ti) +  + D(ti+1) - D(ti+1)A(ti) - A(ti) D(ti+1) + A(ti) D(ti+1)A(ti)
=  + D(ti+1) - D(ti+1)  + D(ti+1) D(ti+1)

(D.86)
(D.87)
(D.88) (D.89)

as required.

Proof of Proposition 4.3. Note first that for i < N, we have C(ti+1, p) = pC(ti+1, p) and D(ti+1, p) = (1 - p)C(ti+1, p). Thus by Equations (B.6), (B.7) and (B.8),

A(ti,

p)

=

(1 - p)C(ti+1, p) , (1 - p)C(ti+1, p) + 

B(ti,

p)

=

(1

-

 p)C(ti+1,

p)

+



(D.90)

and We therefore define and obtain the following recursion:

C(ti,

p)

=



+ (1 - p)C(ti+1, p)( +  + (1 - p)C(ti+1, p)

) .

uk := C(tN-k, p) > 0, k = 0, . . . , N

(D.91) (D.92)

u0 =  + ,

uk+1

=



+ (1 - p)uk( +  + (1 - p)uk

) .

This recursion can be solved as follows. We set

(D.93) (D.94)

wk :=

1- p 

uk

+

 1- p

.

Since (p) is well-defined and strictly positive as

(D.95)

1- p 2

 

+

1

+

1

1 -

p

1 
2

1- p+

1 > 1, 1- p

(D.96)

we obtain the following modified recursion:

w0 =

1- 

p

 +  +

 1- p

= 2 cosh((p)),

wk+1 = =

1- p 

1

 -

p

+

uk+1

1- p 

1

 -

p

+



+ (1 - p)( + )


1-

p

wk

 + (1 - p)


1- p

wk

-

 1- p

-

 1- p

(D.97) (D.98) (D.99)
(D.100)

40

= 2 cosh((p)) - 1 . wk
This well-known type of recursion (see, e.g., Perron (1954), §12) can be solved explicitly: if

(D.101)

a := (p), b := (k + 2)(p)

(D.102)

and

wk

=

sinh sinh

(k + 2)(p) (k + 1)(p)

,

(D.103)

then

sinh 2(p)

w0 = sinh (p) = 2 cosh (p)

(D.104)

and

wk+1 +

1 wk

= sinh(b + a) sinh(b)

+

sinh(b - a) sinh(b)

= exp(b + a) - exp(-b - a) + exp(b - a) - exp(a - b) exp(b) - exp(-b)

= 2 cosh(a)

(D.105) (D.106) (D.107)

as desired. Equation (55) follows directly. Equations (51) and (52) follow easily by plugging Equation (55) into (D.90). Finally, B(ti, p) < 1 follows directly from
Equation (D.90) and the fact that C(ti+1, p) > 0.

Proof of Corollary 4.4. We prove Equation (57) by forward induction. Equations (59) and (61) then follow as

xne(ti, p) = Xne(ti, p) - Xne(ti+1, p), yne(ti, p) = Xne(ti, p) - xne(ti, p)

(D.108) (D.109)

by Proposition 4.3. The case i = 0 is clear. For i > 0, we use the induction hypothesis and Equation (51) and obtain

Xne(ti+1, p) = Xne(ti, p) - A(ti, p)Xne(ti, p)

=

sinh((p)(N + 1 - i)) 1 - pi sinh((p)(N + 1)) X(t0)

sinh((p)(N - i)) - 1-
1 - p sinh((p)(N + 1 - i))

=

sinh((p)(N - i)) 1 - pi+1 sinh((p)(N + 1)) X(t0)

sinh((p)(N + 1 - i)) X(t0)
1 - pi sinh((p)(N + 1))

(D.110)
(D.111) (D.112)

as required.

For the Proof of Proposition 4.5 we require the following Lemma.

Lemma Appendix D.1. (i) Let 0 < a < b, x > 0. Then

0 > d sinh(ax) > (a - b) sinh(ax) .

dx sinh(bx)

sinh(bx)

(ii) Let p  (0, 1). Then

 (p) =

(1 - p)-3/2 4 sinh((p))

p - (1 - p)

,

(D.113) (D.114)

41

in particular Furthermore, Proof. (i) Note first that

 (p) < 0 on

0,

  +



and  (p) > 0 on

  +



,

1

.

| (p)|  1 . 2(1 - p)

(D.115) (D.116)

d dx

sinh(ax) sinh(bx)

=

a cosh(ax) sinh(bx) - b cosh(bx) sinh(ax) sinh2(bx)

=

sinh(ax)

cosh(ax) a

-

cosh(bx) b

sinh(bx) sinh(ax) sinh(bx)

(D.117) (D.118)

and

d cosh(ax) cosh(bx) a -b
dx sinh(ax) sinh(bx)

=

b2 sinh2(bx)

-

a2 sinh2(ax)

<

0

as

0

<

sinh(cx) c

=

 i=0

x2i+1c2i (2i + 1)!

increases strictly in c > 0. We obtain

(D.119) (D.120)

0=

lim

a

cosh(at)

-

cosh(bt) b

t0+ sinh(at) sinh(bt)

>

cosh(ax) cosh(bx) a -b

sinh(ax) sinh(bx)

> lim

a

cosh(at)

-

cosh(bt) b

= a - b.

t sinh(at) sinh(bt)

(D.121) (D.122) (D.123)

Inequality (D.122) directly implies the first inequality in (D.113) (cf. Equation (D.118)). The second inequality in

(D.113) follows from Equation (D.118) and Inequality (D.123).

(ii) We have

2 sinh((p)) (p) = 2

d

cosh((p)) = (1 - p)-3/2

(1 - p)-1/2 -

dp 2 2

 

+

1

(D.124)

and thus

 (p) =

(1 - p)-3/2 4 sinh((p))

p - (1 - p)

.

(D.125)

Furthermore,

sinh2((p)) = cosh2((p)) - 1 =

1- p 4

 

+

1

+

1

1 -

p

2
-1

(D.126)

= 1-p 4

1

1 -

p

+

1

2

-

1

4 -

p

+

22 2

+

2

1

1 -

p

+

1

 

(D.127)

=

p 1- p

2

1- p 
4

 

+

1

1 -

p

-

1

2
.



p 1- p

(D.128)

Therefore,

sinh((p))  1 p + (1 - p)  1 |p - (1 - p) ,

2 1 - p

2 1 - p

hence (cf. Equation (D.114))

|

( p)|

=

(1

- p)-3/2 4

|p - (1 - p)| sinh(( p))



1 2(1 -

. p)

(D.129) (D.130)

42

Proof of Proposition 4.5. Let 0 < a < b. By Lemma Appendix D.1, we obtain

 sinh(a(p)) p sinh(b(p))

=



( p)

 

sinh(a( p)) sinh(b( p))

< b - a sinh(a(p)) . 2(1 - p) sinh(b(p))

Therefore,

 b-a sinh(a(p)) p (1 - p) 2 sinh(b(p))

=

b -

- 2

a (1

-

p)

b-a 2

-1

sinh(a( p)) sinh(b( p))

+

(1

-

b-a
p) 2

 p

sinh(a( p)) sinh(b( p))

(D.131)
<

b -

- 2

a (1

-

p)

b-a 2

-1

sinh(a( sinh(b(

p)) p))

+

b

- 2

a (1

-

p)

b-a 2

-1

sinh(a( p)) sinh(b( p))

=0

(D.131)
(D.132) (D.133) (D.134)

and similarly



(1

-

p)-

b-a 2

sinh(a( p))

=

b-a (1 -

p)-

b-a 2

-1

sinh(a(

p))

+ (1 -

p)-

b-a 2

 sinh(a(p))

p

sinh(b( p))

2

sinh(b( p))

p sinh(b(p))

(D.131)
>

b-a (1 -

p)-

b-a 2

-1

sinh(a(

p))

-

b-a (1 -

p)-

b-a 2

-1

sinh(a(

p))

2 sinh(b(p)) 2 sinh(b(p))

= 0.

(D.135) (D.136) (D.137)

We can directly deduce the two assertions. Let i > 0 and set a = N + 1 - i and b = N + 1, thus yielding b - a = i. By Equation (57) and Inequality (D.137), we obtain

 p

Xne(ti,

p)

=

 X(t0) p

(1 -

p)-

i 2

sinh(a( p)) sinh(b( p))

> 0.

(D.138)

By Equation (63) and Inequality (D.134), we obtain

 p Ep X(ti)

=

 X(t0) p

(1 -

i sinh(a(p)) p) 2 sinh(b(p))

< 0.

(D.139)

Proof of Proposition 4.6. (i) We prove the first assertion by backward induction using the recursion formula for C given in

Equation (D.91):

C(ti,

p)

=



+

(1 - p)C(ti+1, p) .  + (1 - p)C(ti+1, p)

(D.140)

This implies C(ti, p) > 0 for i = 0, . . . , N by backward induction; recall that C(tN, p) =  +  > 0 is independent of p < 1. Let now i < N. By the induction hypothesis, we have

C p

(ti+1,

p)



0.

(D.141)

By Equation (D.140), we obtain

C p

(ti,

p)

=

 p

 +

(1 - p)C(ti+1, p)  + (1 - p)C(ti+1, p)

=

2

(1

-

p)

C p

(ti+1,

p)

-

C(ti+1,

 + (1 - p)C(ti+1, p) 2

p)

<0

(D.142) (D.143) (D.144)

as desired.

43

(iii) Applying the optimal strategy, we obtain

E X(ti)2

= (1 - p)iXne(ti, p)2 =

sinh((p)(N + 1 - i)) sinh((p)(N + 1))

2 X (t0 )2

(D.145)

by

Equation

(57).

By

Lemma

Appendix

D.1,

this

term

is

strictly

increasing

for

p



(0,

 +

)

and

strictly

decreasing

for

p



(

 +

,

1).

(ii)

Assertions (i) and (iii) imply that the impact costs are strictly decreasing for p



(0,

 +

).

We can thus limit our

attention

to

p



(

 +

,

1),

in

particular



( p)

>

0

by

(D.115).

We

obtain

E[x(ti)2] = (1 - p)i xne(ti, p)2

=1 1- p

1-

p

sinh((p)(N + 1 - i)) - sinh((p)(N sinh((p)(N + 1))

- i))

2 X (t0 )2

(D.146) (D.147)

by Equation (59). For i = 0, . . . , N, we set a = N + 1 - i, b = N + 1 and define the function

sinh((a + 1)(p)) - 1 sinh(a(p))

1- p

gi(p) :=

sinh(b( p))

.

(D.148)

As in the proof of Proposition 4.5, we obtain (cf. Inequality (D.129)) sinh((p))  p . 2 1-p

(D.149)

Using the addition formulae for hyperbolic functions and the definition of (p), we deduce

sinh((a + 1)(p)) - 1 sinh(a(p)) 1- p

= sinh(a(p)) cosh((p)) + cosh(a(p)) sinh((p)) - 1 sinh(a(p)) 1- p

= sinh(a(p)) cosh((p)) - 1 + cosh(a(p)) sinh((p))

1- p

 p  2 1-p



1- 2

p

(1+

1 1-

p

)-

1 =
1- p

-p
2 1-p

 p (cosh(a(p)) - sinh(a(p))) > 0. 2 1-p

(D.150) (D.151)
(D.152)

To finish the proof, it is thus sufficient to show that

d d p gi(p)  0

for all i

and

d dp

gi0

( p)

>

0

for at least one i0.

(D.153)

We compute

d d p gi(p)

=

- 2(1

1 -

p)

3 2

sinh(a( p)) sinh(b( p))

+  (p) 1- p

 sinh((a + 1)(p))  sinh(a(p)) 1 - p  sinh(b(p)) -  sinh(b(p))

.

=:hi ( p)

(D.154)

Let us first assume that

sinh(a( p)) -





sinh(a(p)) .

sinh(b(p))  sinh(b(p))

(D.155)

44

For i 0, we have

 

sinh(a( p)) sinh(b( p))

<

0

and

by Lemma Appendix D.1 (recall  (p) > 0) and therefore

 (p) < 1

1- p

2(1

-

p)

3 2

 (p) hi ( p)
1- p

<

1 -
2(1 -

p)

3 2

 

sinh(a( p)) sinh(b( p))



1 2(1 -

p)

3 2

sinh(a( sinh(b(

p)) p))

,

hence

d dp

gi ( p)

<

0.

For i = 0, we have a = b,

 

sinh(a( p)) sinh(b( p))

=

0

and thus

d dp

gi ( p)



0.

We can therefore assume that

- sinh(a(p)) sinh(b( p))

>

 

sinh(a( p)) sinh(b( p))

from now on. Using the addition formulae for hyperbolic functions, we obtain

hi(p) = = =

 sinh(a(p)) cosh((p)) + cosh(a(p)) sinh(a(p))

1 - p 

sinh(b( p))

-  sinh(a(p))  sinh(b(p))

 1 - p 

cosh((p)) + sinh((p)) -

1 sinh(a(p)) 1 - p sinh(b(p))

+

cosh(a(p)) - sinh(a(p))

sinh(( p)) sinh(b( p))

1 - p cosh((p)) + sinh((p)) -

1  sinh(a(p)) 1 - p  sinh(b(p))

>0

<-

sinh(a( sinh(b(

p)) p))

+

1-

p

cosh((p)) + sinh((p))

sinh(a( p)) sinh(b( p))

+ 1 - p cosh(a(p)) - sinh(a(p))

 sinh((p))  sinh(b(p))

>0 <0 by Lemma Appendix D.1

+a

1- p

sinh(a(p)) - cosh(a(p))

sinh(( p)) sinh(b( p))

<0

<

sinh(a( sinh(b(

p)) p))

.

We note again that and deduce by Equation (D.154) that

0<

 (p) < 1

1- p

2(1

-

p)

3 2

d dp

gi ( p)

<

0,

45

(D.156) (D.157) (D.158) (D.159) (D.160) (D.161)
(D.162) (D.163)
(D.164) (D.165) (D.166) (D.167)

finishing the proof.

We postpone the proof of Theorem 5.2 and prove Theorem 5.3 first. To this end, we require preliminary considerations which we split up into several lemmata. As a by-product of these lemmata, we obtain a proof of Proposition 5.4. The main building block for the proof of Theorem 5.3 is Lemma Appendix D.3, where recursions for the value function and the optimal liquidation strategy are obtained. The proof of Theorem 5.2 can then be deduced from this.

Lemma Appendix D.2. Let i = 0, . . . , N. (i) v(ti, ·) is symmetric and monotone in the following sense: v(ti, -X(ti)) = v(ti, X(ti)) and |X(ti)|  |Y(ti)|  v(ti, X(ti))  v(ti, Y(ti)). (ii) For X(ti) > 0, we have x(ti, X(ti)), y(ti, X(ti))  0 and x(ti, X(ti)) + y(ti, X(ti))  X(ti).
(iii) (x(ti, ·), y(ti, ·)) is continuous. Proof. The Optimization Problem (OPT-ADV) yields the Bellman equation

(D.168) (D.169)

v(ti,

X(ti))

=

inf
(x,y)R×R

x2 + X(ti)2 + p|y| + pv(ti+1, X(ti) - x - y)

+ (1 - p)v(ti+1, X(ti) - x) .

We define the function v~(X(ti), ·) : R2 - R by

v~(X(ti), x, y) = x2 + X(ti)2 + p|y| + pv(ti+1, X(ti) - x - y) + (1 - p)v(ti+1, X(ti) - x).

(D.170) (D.171)

(i) Symmetry can be shown by a straightforward backward induction on i  N. We also prove monotonicity by backward
induction. The case i = N is clear, and we set i < N. We can assume without loss of generality that 0  X(ti)  Y(ti) by symmetry. For any admissible pair of orders (x(ti), y(ti))  R2 we define

x~(ti)

:=

 

x(ti)

X(ti)

if X(ti) - x(ti)  0 else,

y~(ti) := 0yX((ttii)) - x(ti)

if X(ti) - x(ti), X(ti) - x(ti) - y(ti)  0 if X(ti) - x(ti)  0, X(ti) - x(ti) - y(ti) < 0 else.

(D.172) (D.173)

In all three possible cases a simple argument using the induction hypothesis establishes

v~(X(ti), x~(ti), y~(ti))  v~(Y(ti), x(ti), y(ti)),

(D.174)

finishing the proof. (ii) Let (x(ti), y(ti))  R2 be any admissible pair of orders not satisfying (D.169). We define

x~(ti) := 0Xx((ttii))

if x(ti)  0, x(ti, X(ti))  X(ti) if x(ti)  0, x(ti, X(ti)) > X(ti) else,

y~(ti) := 0yX((ttii)) - x~(ti)

if 0  y(ti)  X(ti) - x~(ti) if y(ti) > X(ti) - x~(ti) else.

(D.175) (D.176)

46

For v~ as in Equation (D.171) the Bellman Equation (D.170) and (i) yield

v~(X(ti), x~(ti), y~(ti)) < v~(Y(ti), x(ti), y(ti))

(D.177)

for all possible cases, finishing the proof. (iii) Let X  R and consider a sequence of real numbers (Xk)k such that

lim Xk = X  R.
k

(D.178)

By (i), the sequences (x(ti, Xk))k and (y(ti, Xk))k are bounded and therefore there exist convergent subsequences (x(ti, Xkl ))l, (y(ti, Xkl ))l such that

lim
l

x(ti,

Xkl )

=

x0



R,

lim
l

y(ti,

Xkl )

=

y0



R.

(D.179)

Assume that (x0, y0) (x(ti, X), y(ti, X)). By the uniqueness of the optimal trading strategy and the continuity of v(ti, ·) and v~(·) as in Equation (D.171), we obtain

a contradiction.

v~(X,

x0,

y0)

>

v~(X,

x(ti,

X),

y(ti,

X))

=

v(ti,

X)

=

lim
l

v(ti,

Xkl

)

=

lim
l

v~(Xkl

,

x(ti,

Xkl

),

y(ti,

Xkl

))

=

v~(X,

x0,

y0),

(D.180) (D.181)

Lemma Appendix D.3. The value function v(ti, ·) of the Optimization Problem (OPT-ADV) is a piecewise quadratic polynomial and the optimal strategy (x(ti, ·), y(ti, ·)) at time ti is piecewise affine linear.
More precisely, let X(ti) be the asset position at time ti.

(i) There exist

0 =: X¯ (ti, ti) < · · · < X¯ (ti, tN+1) := 

(D.182)

such that for

X(ti)  [X¯ (ti, t j), X¯ (ti, t j+1)),

(D.183)

the unique optimal strategy and the value function are given by

x(ti, X(ti)) = A1(ti, t j)X(ti) + A2(ti, t j), y(ti, X(ti)) = B1(ti, t j)X(ti) + B2(ti, t j), v(ti, X(ti)) = C1(ti, t j)X(ti)2 + C2(ti, t j)X(ti) + C3(ti, t j).

(D.184) (D.185) (D.186)

The functions

A1, A2, B1, B2, C1, C2, C3 : (t, s)  R2 | t, s  {t0, . . . tN}, t  s - R

are given recursively by

(D.187)

for i = 0, . . . , N and

C1(ti, ti) = C(ti, 0), C2(ti, ti) = C3(ti, ti) = 0, A1(ti, ti) = A(ti, 0), A2(ti, ti) = 0, B1(ti, ti) = B2(ti, ti) = 0

C1(ti, t j)

=



+ (1 - p)C1(ti+1, t j)( + C1(ti+1, t j)(1 - p) + 

) ,

C2(ti, t j)

=

((1 - p)C2(ti+1, t j) + p) (1 - p)C1(ti+1, t j) + 

,

(D.188) (D.189) (D.190)
(D.191) (D.192)

47

C3(ti,

tj)

=

(1

-

p)C3(ti+1,

tj)

-

2 p 4C(ti+1,

0)

-

(1 - p)C2(ti+1, t j 4((1 - p)C1(ti+1,

) t

+ j) +

p2 )

,

A1(ti, t j)

=

(1 (1 -

- p)C1(ti+1, t j) , p)C1(ti+1, t j) + 

A2(ti, t j)

=

(1 - p)C2(ti+1, t j) + p , 2((1 - p)C1(ti+1, t j) + )

B1(ti, t j)

=

(1

-

 p)C1(ti+1, t j)

+

, 

B2(ti,

tj)

=

- (1-p)C(ti+1,0)C2(ti+1,t j)+ (1-p)C1(ti+1,t j)+C(ti+1,0)p+
2C(ti+1,0)(C1(ti+1,t j)(1-p)+)

for i = 0, . . . , N - 1, j = i + 1, . . . , N.
The function X¯ : (t, s)  R2 | t, s  {t0, . . . tN}, t < s - R,

is given recursively by for i = 0, . . . , N - 1 and

X¯ (ti, ti+1)

=

(C(ti+1, 0) + ) 2C(ti+1, 0)

X¯ (ti, t j)

=

C2(ti+1, t j-1)(1

-

p)

+

p

+

2(C1(ti+1, t j-1)(1 2

-

p)

+

)X¯ (ti+1, t j)

for i = 0, . . . , N - 2 and j = i + 2, ..., N. (ii) For X(ti) < 0, the optimal strategy and the value function are given by

x(ti, X(ti)) = -x(ti, -X(ti)), y(ti, X(ti)) = -y(ti, -X(ti)), v(ti, X(ti)) = v(ti, -X(ti)).

(D.193) (D.194) (D.195) (D.196) (D.197)
(D.198) (D.199)
(D.200)
(D.201) (D.202) (D.203)

Proof. We prove (i). Assertion (ii) follows directly by Lemma Appendix D.2 (i). Let therefore i = 0, . . . N and X(ti)  0. By Lemma Appendix D.2 (ii), we know that the optimal asset position at time t j fulfills X(t j)  0 for all j  i.
We proceed by backward induction. For i = N there is only one admissible strategy and all the properties are satisfied. For the induction step we assume that all properties are valid for time ti+1 (i < N). By Lemma Appendix D.2 (ii), the Bellman Equation (D.170) becomes

v(ti,

X(ti))

=

min
x,y0

x2 + X(ti)2 + py + pv(ti+1, X(ti) - x - y) + (1 - p)v(ti+1, X(ti) - x)

.

(D.204)

(i) As a first step we prove the assertion for j = i, i.e., the case where the initial asset position is below the boundary X¯ (ti, ti+1) and we expect that the use of the dark pool is not optimal:

0  X(ti) < X¯ (ti, ti+1).

(D.205)

The recursion formula for C(ti, 0), Equation (D.91), implies

C(ti+1, 0) < C(ti+2, 0)

(D.206)

and therefore we know by Equation (D.199) that

X¯ (ti+1, ti+2)

=

(C(ti+2, 0) + ) 2C(ti+2, 0)

<

(C(ti+1, 0) + ) 2C(ti+1, 0)

=

X¯ (ti, ti+1).

Assume for now that

0  X(ti) < X¯ (ti+1, ti+2) < X¯ (ti, ti+1).

(D.207) (D.208)

48

This implies

0  X(ti) - x(ti, X(ti)) - y(ti, X(ti))  X(ti) - x(ti, X(ti)) < X¯ (ti+1, ti+2)

by Lemma Appendix D.2 (ii). We define the set

(D.209)

A¯(X(ti)) := (x, y)  R2|x, y  0, X(ti) - x - y  0

(D.210)

and obtain by the backward induction hypothesis that

v(ti, X(ti)) = min x2 + X(ti)2 + py
( x,y)A¯ (X (ti ))
+ p C1(ti+1, ti+1)(X(ti) - x - y)2 + C2(ti+1, ti+1)(X(ti) - x - y) + C3(ti+1, ti+1)

+ (1 - p) C1(ti+1, ti+1)(X(ti) - x)2 + C2(ti+1, ti+1)(X(ti) - x) + C3(ti+1, ti+1)

(D.=188) min
( x,y)A¯ (X (ti ))

x2 + X(ti)2 + py + pC(ti+1, 0)(X(ti) - x - y)2

+ (1 - p)C(ti+1, 0)(X(ti) - x)2 .

(D.211) (D.212)

Let v¯(X(ti), ·) : R2 - R be given by
v¯(X(ti), x, y) := x2 + X(ti)2 + py + pC(ti+1, 0)(X(ti) - x - y)2 + (1 - p)C(ti+1, 0)(X(ti) - x)2.

(D.213)

In order to minimize v¯(X(ti), ·), we consider the first order condition for minimality

 x

v¯(X(ti),

x,

y)

=

0,

 y

v¯(X(ti),

x,

y)

=

0.

(D.214)

This system of linear equations has the unique solution (x¯i, y¯i) given by

x¯i

=

C(ti+1, 0)(1 C(ti+1, 0)(1 -

- p) p) +  X(ti)

+

p 2(C(ti+1, 0)(1

-

p)

+

) ,

y¯i

=

 C(ti+1, 0)(1 -

p)

+

 X(ti)

-

(C(ti+1, 0) + ) 2C(ti+1, 0)(C(ti+1, 0)(1 -

p)

+

. )

(D.215) (D.216)

An elementary calculation shows that the Hessian of v¯(X(ti), ·) is positive definite. Thus, (x¯i, y¯i) is the global minimum of v¯(X(ti), ·). However,

y¯i

<

 C(ti+1, 0)(1 -

p)

+

 X(ti)X¯ (ti+1, ti+2)

-

(C(ti+1, 0) + ) 2C(ti+1, 0)(C(ti+1, 0)(1 -

p)

+

)

(D.=199) 0.

(D.217) (D.218)

Therefore, v¯(X(ti), ·) is minimal for y = 0 on A¯(X(ti)). Hence y(ti, X(ti)) = 0, and x(ti, X(ti)) can be obtained by

minimizing

x2 + X(ti)2 + C(ti+1, 0)(X(ti) - x)2.

(D.219)

Thus,

x(ti, X(ti))

=

C(ti+1, C(ti+1, 0)

0) +



X

(ti)

=

A(ti, 0)X(ti).

As X(ti) - x(ti, X(ti)) and y(ti, X(ti)) are continuous in X(ti) (Lemma Appendix D.2 (iii)),

(D.220)

(A(ti, 0)X(ti), 0)

(D.221)

is the optimal strategy at time ti as long as y¯i < 0 and X(ti) - A(ti, 0)X(ti) < X¯ (ti+1, ti+2),

(D.222)

49

which is equivalent to Plugging this into (D.219), we obtain

0  X(ti) < X¯ (ti, ti+1).

(D.223)

v(ti, X(ti))

=



+ C(ti+1, 0)( C(ti+1, 0) + 

+

)

X(ti

)2

=

C(ti, 0)X(ti)2,

completing the proof for j = i.

We will now show the assertion for j = i + 1, . . . , N by forward induction on j.

(ii) For the induction basis j = i + 1 let

X(ti)  [X¯ (ti, ti+1), X¯ (ti, ti+2)).

For X(ti) = X¯ (ti, ti+1), the case j = i proven above and the continuity of the optimal strategy imply

X(ti) - x(ti, X(ti)) = X(ti) - A(ti, 0)X(ti)

(D.90)=,(D.199)

 2C(ti+1, 0)

<

(C(ti+2, 0) + ) 2C(ti+2, 0)

(D.=199) X¯ (ti+1, ti+2),

(D.224)
(D.225) (D.226) (D.227) (D.228) (D.229)

where Inequality (D.228) follows form (D.91) as  > 0:

 2C(ti+1, 0)

=

( + C(ti+2, 0)) 2( + C(ti+2, 0)( + ))

<

(C(ti+2, 0) + ) . 2C(ti+2, 0)

(D.230)

Again by continuity of the optimal strategy, we obtain that the Bellman equation is given by (D.212) in some neighborhood (X¯ (ti, ti+1), X¯ (ti, ti+1) + ). We consider the first order conditions of optimality again and obtain that the global minimum (x¯i, y¯i) of v¯(X(ti), ·) is as given in Equations (D.215) and (D.216) by the positive definiteness of the Hessian
as before. This time we have x¯i > 0, y¯i  0, and by Equations (D.194) - (D.197), x¯i and y¯i are of the required form:

x¯i = A1(ti, ti+1)X(ti) + A2(ti, ti+1), y¯i = B1(ti, ti+1)X(ti) + B2(ti, ti+1).

(D.231) (D.232)

Using the continuity of (x(ti, ·), y(ti, ·)) again, we deduce that (x¯i, y¯i) is the optimal strategy as long as y¯i  0 and X(ti) - x¯i < X¯ (ti+1, ti+2).

(D.233)

A straightforward calculation shows that (D.233) is equivalent to

X(ti)



(C(ti+1, 0) + ) 2C(ti+1, 0)

=

X¯ (ti, ti+1)

and

X(ti) < X¯ (ti, ti+2).

Plugging (x¯i, y¯i) into v¯(X(ti), ·), we obtain

v(ti, X(ti)) = C1(ti, ti+1)X(ti)2 + C2(ti, ti+1)X(ti) + C3(ti, ti+1),

(D.234) (D.235)

with C1, C2 and C3 according to Equations (D.191) - (D.193), which finishes the proof of the induction basis for the forward induction.

(iii) For the induction step, we assume that the assertion is true for some

j = i + 1, . . . N - 1 and let

X(ti)  [X¯ (ti, t j+1), X¯ (ti, t j+2)).

(D.236)

50

By the induction hypothesis, the continuity of x(ti, ·) and y(ti, ·) and Equations (D.194) - (D.197), we have

X¯ (ti, t j+1) - x(ti, X¯ (ti, t j+1)) = X¯ (ti, t j+1) - A1(ti, t j)X¯ (ti, t j+1) - A2(ti, t j)

(D.194)=,(D.196) B1(ti, t j)X¯ (ti, t j+1) - A2(ti, t j)

(D.=200) X¯ (ti+1, t j+1), X¯ (ti, t j+1) - x(ti, X¯ (ti, t j+1)) - y(ti, X¯ (ti, t j+1))
= X¯ (ti, t j+1) - A1(ti, t j)X¯ (ti, t j+1) - A2(ti, t j) - B1(ti, t j)X¯ (ti, t j+1) - B2(ti, t j)

(D.194)=,(D.196) -A2(ti, t j) - B2(ti, t j)

(D.195)=,(D.197)

 2C(ti+1, 0)

(D.237) (D.238) (D.239)
(D.240) (D.241) (D.242)

and

y(ti, X¯ (ti, t j+1)) > 0.

(D.243)

Thus, again by continuity of x(ti, ·) and y(ti, ·), there exists an > 0 such that for X(ti)  (X¯ (ti, t j+1), X¯ (ti, t j+1) + ),

y(ti, X(ti)) > 0, X(ti) - x(ti, X(ti)) < X¯ (ti+1, t j+2), X(ti) - x(ti, X(ti)) > X¯ (ti+1, t j), X(ti) - x(ti, X(ti)) - y(ti, X(ti)) < X¯ (ti+1, ti+2).

(D.244) (D.245) (D.246) (D.247)

In order to apply the backward induction hypothesis, we want to ensure that the optimal asset position at time ti+1, provided the dark pool order has not been executed, fulfills

X(ti) - x(ti, X(ti))  [X¯ (ti+1, t j+1), X¯ (ti+1, t j+2));

(D.248)

notice that Inequalities (D.245) and (D.246) only imply

X(ti) - x(ti, X(ti))  (X¯ (ti+1, t j), X¯ (ti+1, t j+2)).

(D.249)

To this end, assume that X(ti) - x(ti, X(ti)) < X¯ (ti+1, t j+1). For this case the backward induction hypothesis would imply

v(ti, X(ti)) = min x2 + X(ti)2 + py + pC(ti+1, 0)(X(ti) - x - y)2
A (X (ti ))
+ (1- p) C1(ti+1, t j)(X(ti)- x)2 + C2(ti+1, t j)(X(ti)- x) + C3(ti+1, t j) ,

(D.250)

where

A(X(ti)) := (x, y)  R2|x, y  0, X¯ (ti+1, t j)  X(ti) - x  X¯ (ti+1, t j+1), 0  X(ti) - x - y  X¯ (ti+1, ti+2) .

(D.251)

A simple calculation shows that this minimization problem has the unique solution

xi = A1(ti, t j)X(ti) + A2(ti, t j), yi = B1(ti, t j)X(ti) + B2(ti, t j)

(D.252) (D.253)

for A1, . . . , B2 according to Equations (D.194) - (D.197). This implies
X(ti) - xi (D.194)=,(D.196) B1(ti, t j)X(ti) - A2(ti, t j) > B1(ti, t j)X¯ (ti+1, t j) - A2(ti, t j)

(D.254) (D.255)

51

(D.=200) X¯ (ti+1, t j+1),

(D.256)

a contradiction. Therefore,

X(ti) - x(ti, X(ti))  X¯ (ti+1, t j+1) for X(ti)  (X¯ (ti, t j+1), X¯ (ti, t j+1) + ).

(D.257)

By the backward induction hypothesis, the Bellman Equation (D.170) becomes

where

v(ti, X(ti)) = min x2 + X(ti)2 + py + pC(ti+1, 0)(X(ti) - x - y)2 + (1 - p)
A^ (X (ti ))
C1(ti+1, t j+1)(X(ti)- x)2 + C2(ti+1, t j+1)(X(ti)- x) + C3(ti+1, t j+1) . =: min v^(X(ti), x, y),
A^ (X (ti ))

(D.258) (D.259)

A^(X(ti)) := (x, y)  R2|x, y  0, X¯ (ti+1, t j+1)  X(ti) - x  X¯ (ti+1, t j+2), 0  X(ti) - x - y  X¯ (ti+1, ti+2) .

(D.260)

Again, the Hessian of v^(X(ti), ·) is positive definite and the gradient equals zero for (x^i, y^i) such that

x^i

=

C1(ti+1, t j+1)(1 C1(ti+1, t j+1)(1 -

- p) p) +  X(ti)

+

C2(ti+1, t j+1)(1 - p) + p 2(C1(ti+1, t j+1)(1 - p) + )

(D.194)=,(D.195) A1(ti, t j+1)X(ti) + A2(ti, t j+1),

y^i

=

 C1(ti+1, t j+1)(1

-

p)

+

 X(ti)-

C(ti+1, 0)C2(ti+1, t j+1)(1 - p) + (C1(ti+1, t j+1)(1 - p) + C(ti+1, 0)p + )

2C(ti+1, 0)(C1(ti+1, t j+1)(1 - p) + )

(D.196)=,(D.197) B1(ti, t j+1)X(ti) + B2(ti, t j+1),

(D.261) (D.262)
(D.263) (D.264)

i.e., x^i and y^i are of the required form. Again, by continuity of (x(ti, ·), y(ti, ·)), (x^i, y^i) defines the optimal strategy as

long as

X¯ (ti+1, t j+1)  X(ti) - x^i  X¯ (ti+1, t j+2) and y^i > 0;

(D.265)

notice that

X(ti) - x^i - y^i (D.194)=,(D.196) -A2(ti, t j+1) - B2(ti, t j+1)

(D.195)=,(D.197)

 2C(ti+1, 0)

< X¯ (ti+1, ti+2).

(D.266) (D.267) (D.268)

Hence, (x^i, y^i) is the optimal strategy as long as

X(ti)



X¯ (ti+1, t j+1) + A2(ti, t j+1) B1(ti, t j+1)

(D.195),(D.=196),(D.200)

X¯ (ti, t j+2)

as desired. Plugging (x^i, y^i) into v^(X(ti), ·), we obtain

v(ti, X(ti)) = C1(ti, t j+1)X(ti)2 + C2(ti, t j+1)X(ti) + C3(ti, t j+1),

(D.269) (D.270)

which finishes the proof.

52

As a by-product, we obtain a proof of Proposition 5.4. Proposition 5.4 is also needed for the proof of Theorem 5.3.

Proof of Proposition 5.4. Assertion (i) follows directly from Lemma Appendix D.3.
Note that the recursions for C1(·, tN), A1(·, tN) and B1(·, tN) given by Equations (D.191), (D.194) and (D.196) are the same as the recursions for C(·, p), A(·, p) and B(·, p) given by (D.90) and (D.91). The fact that

C(tN, p) = C(tN, tN)

(D.271)

thus establishes (ii). Due to the strict convexity of v(tk, ·), k = i, . . . , N (cf. Proposition 3.3 (i)), we have
C1(tk, t j) > 0, k = i, . . . , N,

(D.272)

and thus by Equations (D.194) and (D.196) that

A1(ti, t j) > 0 and B1(ti, t j) > 0.

(D.273)

Therefore, x(ti, X(ti)) and y(ti, X(ti)) are strictly increasing in X(ti). Strict monotonicity of X(ti) - x(ti, X(ti)) follows from

the fact that

X(ti) - x(ti, X(ti)) = B1(ti, t j)X(ti) - A2(ti, t j).

(D.274)

Using Equation (D.194) - (D.197), we obtain

X(ti) - x(ti, X(ti)) - y(ti, X(ti)) = -A2(ti, t j) - B2(ti, t j)

=

 2C(ti+1, 0)

< (C(ti+2, 0) + ) 2C(ti+2, 0)

= X¯ (ti+1, ti+2),

(D.275) (D.276)
(D.277) (D.278)

where Inequality (D.277) follows from the fact that

C(ti+1,

0)

=



+

C(ti+2, 0)  + C(ti+2, 0)

by Equation (D.91), which finishes the proof of (iii). For (iv), let X  (X¯ (ti, t j-1), X¯ (ti, t j)) and note that X - x(ti, X) is strictly increasing in X. Then

X - x(ti, X) = B1(ti, t j-1)X - A2(ti, t j-1).

(D.279) (D.280)

The assertion follows as

lim
XX¯ (ti,t j)-

X

-

x(ti,

X)

=

X¯ (ti+1,

tj)

(D.281)

by Equations (D.195), (D.196) and (D.200). Assertions (v) and (vi) follow by straightforward backward inductions using the respective recursions from Lemma Ap-
pendix D.3.

Lemma Appendix D.4. Let j = 1, . . . , N and X(t0) = X¯ (t0, t j). For an admissible liquidation strategy (x~, y~)  A(t0, X(t0)), we define the trading trajectory for the scenario, where no dark pool orders are executed by

X~ (ti), i = 0, . . . , N.

(D.282)

Let (x~, y~) be optimal. If no dark pool order is executed before t j-2, then

(i)

X~ (t j-1)

=

X¯ (t j-1, t j)

=

(C(t j, 0) + ) , 2C(t j, 0)

(D.283)

53

(ii)
(iii)
for i = 0, . . . , j - 2, and (iv)

X~ (t j)

=

, 2C(t j, 0)

X~ (ti) -

x~(ti) -

y~(ti)

=

 2C(t j+1, 0)

x~(ti) = A(ti, 0)X~ (ti), y~(ti) = 0

for i  j.

If a dark pool order is executed at time tk, k = 0, . . . , j - 2, then (v) the optimal strategy without dark pool is applied at trading times tk+1, . . . , tN.

Proof. Let Xne(ti) be defined recursively by

Xne(t0) = X(t0) and Xne(ti) = Xne(ti-1) - x(ti, Xne(ti-1)) for i > 0.

(D.284) (D.285) (D.286)
(D.287)

By Lemma Appendix D.3, the optimal strategy (x~, y~) must satisfy

X~ (ti) = Xne(ti)

(D.288)

for all i = 0, . . . , N. We have

Xne(ti) = X¯ (ti, t j)

for i = 0, . . . , j - 1 by Proposition 5.4 (iv), in particular

(D.289)

Xne(t j-1)

=

X¯ (t j-1, t j)

=

(C(t j, 0) + ) 2C(t j, 0)

,

(D.290)

and (i) follows. Assertion (ii) follows as

Xne(t j) = Xne(t j-1) - x(t j-1, Xne(t j-1)) = (1 - A(t j-1, 0))Xne(t j-1)

=

. 2C(t j, 0)

(D.291) (D.292)

Assertion (iii) follows from Proposition 5.4 (iii), Assertions (iv) and (v) follow directly from Proposition 5.4 (i) and (iii).
We denote the set of admissible strategies satisfying (i) - (v) by A¯ (t0, X(t0)). Finally, we are able to prove Theorem 5.3.

Proof of Theorem 5.3. Let j = 2, . . . , N and X(t0) = X¯ (t0, t j). Define Xne(ti) as in (D.287) and consider the cost functional J(t0, X(t0), ·) : A(t0, X(t0)) - R given by

NN
J(t0, X(t0), (x, y)) := E x(t j)2 + p|y(t j)| + E X(t j)2 .
j=0 j=0

(D.293)

By Lemma Appendix D.4, we can replace A by A¯ :

v(t0,

X(t0))

=

inf
( x,y)A(t0 ,X (t0 ))

J(t0,

X(t0),

(x,

y))

=

inf
(x,y)A¯ (t0,X(t0))

J(t0,

X(t0),

(x,

y)).

Let now (x~, y~)  A¯ (t0, X(t0)) and define X~ (ti) as in Lemma Appendix D.4. By the definition of A¯ , we have

X~ (t0) = X(t0),

X~ (t j-1)

=

(C(t j, 0) + ) 2C(t j, 0)

,

X~ (t j)

=

2C

 (t j+1

,

0)

.

(D.294) (D.295)

54

The costs of the strategy (x~, y~) are given by

j-2

J(t0, X(t0), (x~, y~)) =

(1 -

p)i

(X~ (ti) -

X~ (ti+1))2

+ X~ (ti)2

+

p

X~ (ti+1) -

 2C (ti+1 ,0)

i=0

j-2

+

(1 - p)i pC(ti+1, 0)

 2C (ti+1 ,0)

2

i=0

+ (1 -

p) j-1

(X~ (t j-1) - X~ (t j))2 + X~ (t j-1)2 + C(t j, 0)

 2C(t j,0)

2

=: U(X~ (t1), . . . , X~ (t j-2)).

(D.296) (D.297)

Let us briefly comment on the terms in Equation (D.296).

(i) The terms

(X~ (ti) - X~ (ti+1))2,

(X~ (ti))2,

p

X~ (ti+1) -

 2C(ti+1, 0)

,

i = 0, . . . , j - 2,

(D.298)

reflect the impact, risk respectively adverse selection costs at time ti in the scenarios where no dark pool order is executed before time ti (cf. Lemma Appendix D.4 (iii) for the adverse selection costs). This happens with probability (1 - p)i.

(ii) The term

C(ti+1, 0)

 2C (ti+1 ,0)

2
,

i = 0, . . . , j - 2,

(D.299)

reflects the costs for the remainder of the trading horizon (times ti+1, . . . , tN) in the scenarios, where the dark pool order is executed at time ti; the corresponding scenarios have probability p(1 - p)i.

(iii) The terms

(X~ (t j-1) - X~ (t j))2 + X~ (t j-1)2,

C(t j, 0)

 2C(t j,0)

2

(D.300)

reflect the costs at time t j-1 respectively for the remainder of the trading horizon (times t j, . . . , tN) in the scenarios, where no dark pool order is executed until time t j-1. This happens with probability (1 - p) j-1.

The optimal strategy (x, y) minimizes J(t0, X0, ·) uniquely. Therefore,

(Xne(t1), . . . , Xne(t j-2))

(D.301)

minimizes U uniquely and solves the system of linear equations

U xi

(X~ (t1),

.

.

.

,

X~ (t

j-2))

=

0,

This is equivalent to the inhomogeneous linear difference equation

i = 1, . . . , j - 2.

(D.302)

X~ (ti)

1

+

1

1 -

p

+

 

+

p 2(1 - p)

=

X~ (ti+1) +

1 1-

p X~ (ti-1).

(D.303)

By standard methods we compute a special solution of Equation (D.303):

X(1)(ti)

=

- p 2(1 - p)

(D.304)

and two linearly independent solutions of the corresponding homogeneous linear difference equation:

X(2)(ti)

=

exp((p)( j - 1 1 - pi

-

i)) ,

X(3)(ti)

=

exp(-(p)( j 1-

-1 pi

-

i)) .

(D.305)

Consequently, the solutions of Equation (D.303) are given by

X(1)(ti) + aX(2)(ti) + bX(3)(ti)

(D.306)

55

for a, b  R. Xne(ti) = X¯ (ti, t j) is the unique solution of Equation (D.303) satisfying the boundary conditions

X~ (t j-1)

=

(C(t j, 0) + ) 2C(t j, 0)

,

X~ (t j)

=

 2C(t j,

0)

.

Elementary but tedious algebraic manipulations confirm Equation (C.7). We deduce closed form solutions for the coefficients A1, . . . , C3 as follows. By Proposition 5.4 (iv), we have

X¯ (ti, t j) - A1(ti, t j)X¯ (ti, t j) - A2(ti, t j) = X¯ (ti+1, t j), X¯ (ti, t j+1) - A1(ti, t j)X¯ (ti, t j+1) - A2(ti, t j) = X¯ (ti+1, t j+1)

(D.307)
(D.308) (D.309)

for i = 0, . . . , N - 2, j = i + 1, . . . , N - 1. Here, we defined by abuse of notation

X¯ (ti+1, ti+1)

:=

 2C(ti+2, 0)

0.

(D.310)

Solving this system of linear equations in A1(ti, t j) and A2(ti, t j) yields Equations (C.12) and (C.13). Equations (C.14) - (C.17) follow from that directly with the corresponding recursions from Lemma Appendix D.3. Equations (C.18), (C.20) and (C.22) follow from Proposition 5.4 (ii). Therefore, Equation (C.19) follows as

X¯ (ti, tN ) - A1(ti, tN )X¯ (ti, tN ) -A2(ti, tN ) = X¯ (ti+1, tN ).

(D.311)

=B1(ti,tN )X¯ (ti,tN )

Equation (C.21) follows from Proposition 5.4 (iv) (recall that A(ti, p) + B(ti, p) = 1), and Equation (C.23) follows from Equation (D.195). Finally, Equation (C.24) follows by a backward induction on i  N - 1 from Equations (D.188) and (D.193).

Proof of Theorem 5.2. The result can be proven by the same line of reasoning as in the proof of Theorem 5.3 with appropriate modifications. Alternatively we can prove the result by taking the limit   0 in the closed form solutions for X¯ (ti, t j),
j = i + 1, . . . , N, Equation (C.7), from Theorem 5.3

Proof of Corollary 5.5. (i) Note first that C1 is independent of  by Equations (D.188) and (D.191). By backward induction on i using Equation (D.192), we deduce that for i = 0, . . . , N - 1 and j = i + 1, . . . , N, C2(ti, t j, ·) is strictly increasing in . The assertion follows by another backward induction on i using Equation (D.200).
(ii) For  < 0, adverse selection is small enough to ensure that

X(ti)

>

(C(ti+1, 0) + ) 2C(ti+1, 0)

(D.312)

and thus

y(ti, X(ti), ) > 0.

(D.313)

Applying the strategy (x(ti, X(ti), ), y(ti, X(ti), )) to a setting with adverse selection ~ <  generates hence strictly less costs. This implies by backward induction that

v(ti, X(ti), ~ ) < v(ti, X(ti), ).

(D.314)

(iii) Note first that A1 is independent of  by Equation (D.188) and (D.194) (recall that C1 is independent of ). As C2(ti, t j, ·)
is strictly increasing in  (cf. the proof of (i)), A2(ti, t j) is strictly increasing in  for i = 0, . . . , N - 1, j = i + 1, . . . , N by Equation (D.195). Let now ~ <  < 0 and assume that

X(ti)  [X¯ (ti, t j, ), X¯ (ti, t j+1, )) for j  {i + 1, . . . , N}.

(D.315)

By (i), we have X(ti)  [X¯ (ti, th, ~ ), X¯ (ti, th+1), ~ ) for h  j. Therefore (and by the monotonicity of A2), x(ti, X(ti), ~ ) = A1(ti, th, ~ )X(ti) + A2(ti, th, ~ )

(D.316)

56

 A1(ti, t j, ~ )X(ti) + A2(ti, t j, ~ ) < A1(ti, t j, )X(ti) + A2(ti, t j, ) = x(ti, X(ti), ),

(D.317) (D.318) (D.319)

where Inequality (D.317) follows from the concavity of x(ti, ·, ~ ) (cf. Proposition 5.4 (vi)). (iv) By Corollary 5.4 (iii),
x(ti, X(ti), ·) + y(ti, X(ti), ·)
is strictly decreasing in , and hence y(ti, X(ti), ) is strictly decreasing in  by (iii). (v) Let ~ <  < 0. By forward induction on j, we deduce from (iii) that for j > i,

(D.320)

Xne(t j, ) = Xne(ti-1, ) - x(ti-1, Xne(ti-1, ), )  Xne(ti-1, ~ ) - x(ti, Xne(ti-1, ~ ), ) < Xne(ti-1, ~ ) - x(ti, Xne(ti-1, ~ ), ~ ) = Xne(ti, ~ ),

(D.321) (D.322) (D.323) (D.324)

where (D.322) follows from the induction hypothesis and the fact that X(ti) - x(ti, X(ti)) is strictly increasing in X(ti) (cf. Corollary 5.4 (iii)).

Proof of Theorem 7.2. Direct consequence of the preceding example of a market manipulating strategy.

Proof of Proposition 7.4. The same line of argument as in the proof of Proposition 3.2 establishes the existence of optimal strategies since dark pool liquidity is limited.
Consider the optimal strategy for an initial asset position of X(t0). Assume that at any time ti an asset position of X(ti) is being held and orders of x(ti) and y(ti) are optimal. By our requirements for admissible strategies, we know that

|y(ti)|  L

(D.325)

(cf. Definition 2.3 (ii)). We first assume that

sign(x(ti))

The expected cost of trading at time ti and thereafter are

sgn(y(ti)).

x(ti)2 + (1 - p)v¯(ti+1, X(ti) - x(ti)) + p v¯(ti+1, X(ti) - x(ti) - y(ti)) + (x(ti) +  sgn(y(ti)))y(ti) .

(D.326) (D.327)

A direct calculation shows that if

v¯(ti+1, X(ti) - x(ti)) < v¯(ti+1, X(ti) - x(ti) - y(ti)) + (x(ti) +  sgn(y(ti)))y(ti)

(D.328)

then orders of x~(ti) = x(ti) and y~(ti) = 0 result in lower costs; otherwise, x~(ti) = x(ti) + y(ti) and y~(ti) = 0 result in lower costs due to Condition (146). In both cases a contradiction is established. Hence the optimal strategy satisfies

sgn(x(ti)) = sgn(y(ti))

(D.329)

at all times ti. Given that sgn(x(ti)) = sgn(y(ti)), it is obvious that an optimal strategy cannot have

sgn(x(ti)) = sgn(y(ti)) sgn(X(ti)),

(D.330)

i.e., cannot be market manipulating.

57

References
Abramowitz, P., 2006. Tool of the trade. Institutional Investor's Alpha Magazine6, 41­4.
Alfonsi, A., Fruth, A., Schied, A., 2010a. Optimal execution strategies in limit order books with general shape functions. Quantitative Finance10, 143­57.
Alfonsi, A., Schied, A., 2010. Optimal trade execution and absence of price manipulations in limit order book models. SIAM Journal on Financial Mathematics1, 490­522.
Alfonsi, A., Schied, A., Slynko, A., 2010b. Order book resilience, price manipulation, and the positive portfolio problem. Preprint.
Almgren, R., 2003. Optimal execution with nonlinear impact functions and trading-enhanced risk. Applied Mathematical Finance10, 1­18.
Almgren, R., Chriss, N., 2001. Optimal execution of portfolio transactions. Journal of Risk3, 5­39.
Almgren, R., Lorenz, J., 2007. Adaptive arrival price. Algorithmic Trading III: Precision, Control, Execution, 59­66.
Almgren, R., Thum, C., Hauptmann, E., Li, H., 2005. Direct estimation of equity market impact. Risk18, 57­62.
Ben-Israel, A., Greville, T.N.E., 2003. Generalized inverses: Theory and applications. Springer, New York.
Bertsimas, D., Lo, A., 1998. Optimal control of execution costs. Journal of Financial Markets1, 1­50.
Butler, G., 2007. Liquidity aggregation: What institutional investors need to know. Algorithmic Trading III: Precision, Control, Execution.
Carlin, B.I., Sousa Lobo, M., Viswanathan, S., 2007. Episodic liquidity crises: Cooperative and predatory trading. Journal of Finance65, 2235­74.
Conrad, J., Johnson, K.M., Wahal, S., 2003. Institutional trading and alternative trading systems. Journal of Financial Econonomics70, 99­134.
Degryse, H., Van Achter, M., Wuyts, G., 2009a. Dynamic order submission strategies with competition between a dealer market and a crossing network. Journal of Financial Economics91, 319­38.
Degryse, H., Van Achter, M., Wuyts, G., 2009b. Shedding light on dark liquidity pools. The Institutional Investor2009, 147­55.
Dönges, J., Heinemann, F., 2006. Crossing network versus dealer market: Unique equillibria in the allocation of order flow. Preprint.
Duffie, D., 2010. Presidential address: Asset price dynamics with slow-moving capital. Journal of Finance65, 1237­67.
Fong, K., Madhavan, A., Swan, P.L., 2004. Upstairs, downstairs: Does the upstairs market hurt the downstairs? Preprint.
Ganchev, K., Kearns, M., Nevmyvaka, Y., Wortman Vaughan, J., 2010. Censored exploration and the dark pool problem. Communications of the ACM53, 99­107.
Gatheral, J., 2010. No-dynamic-arbitrage and market impact. Quantitative Finance10, 749­59.
Glosten, L.R., Milgrom, P.R., 1985. Bid, ask and transaction prices in a specialist market with heterogeneously informed traders. Journal of Financial Economics14, 71­100.
Grossman, S.J., Miller, M.H., 1988. Liquidity and market structure. Journal of Finance43, 617­37.
Hendershott, T., Mendelson, H., 2000. Crossing networks and dealer markets: Competition and performance. Journal of Finance55, 2071­115.
58

Huberman, G., Stanzl, W., 2004. Price manipulation and quasi-arbitrage. Econometrica72, 1247­75. Kissell, R., Glantz, M., 2003. Optimal Trading Strategies: Quantitative Approaches for Managing Market Impact and Trading
Risk. AMACOM Inc., New York. Klöck, F., Schied, A., Sun, Y., 2011. Existence and absence of price manipulation in a market impact model with dark pool.
Preprint. Kraus, A., Stoll, H.R., 1972. Price impacts of block trading on the New York Stock Exchange. Journal of Finance27, 569­88. Kyle, A.S., 1985. Continuous auctions and insider trading. Econometrica53, 1315­36. Laruelle, S., Lehalle, C.A., Pagès, G., 2009. Optimal split of orders across liquidity pools: A stochastic algorithm approach.
Preprint. Leinweber, D., 2007. Algo vs. algo. Institutional Investor's Alpha Magazine2, 44­51. Mittal, H., 2008. Are you playing in a toxic dark pool? A guide to preventing information leakage. Journal of Trading, 20­33. Næs, R., Ødegaard, B.A., 2006. Equity trading by institutional investors. To cross or not to cross? Journal of Financial
Markets9, 79­99. Næs, R., Skjeltorp, J.A., 2003. Equity trading by institutional investors: Evidence on order submission strategies. Journal of
Banking & Finance27, 1779­817. Obizhaeva, A., Wang, J., 2006. Optimal trading strategy and supply/demand dynamics. Preprint. Perold, A.F., 1988. The implementation shortfall: Paper versus reality. Journal of Portfolio Management14, 4­9. Perron, O., 1954. Die Lehre von den Kettenbrüchen. Bd I. Elementare Kettenbrüche. Teubner, Stuttgart. Ready, M.J., 2010. Determinants of volume in dark pools. Preprint. Rogers, L.C.G., Singh, S., 2010. The cost of illiquidity and its effects on hedging. Mathematical Finance20, 597 ­ 615. Schack, J., 2004. The orders of battle. Institutional Investor11, 77­84. Schied, A., Schöneborn, T., 2009. Risk aversion and the dynamics of optimal liquidation strategies in illiquid markets. Finance
and Stochastics. Schied, A., Schöneborn, T., Tehranchi, M., 2010. Optimal basket liquidation for CARA investors is deterministic. Applied
Mathematical Finance17, 471­89. Schöneborn, T., Schied, A., 2009. Liquidation in the face of adversity: Stealth vs. sunshine trading. Preprint. Sofianos, G., Jeria, D., 2008a. Quantifying the Sigma X crossing benefit. Equity Execution Strategies: Street Smart31.
Goldman Sachs. Sofianos, G., Jeria, D., 2008b. Quantifying the Sigma X crossing benefit: The sequel. Journal of Trading, 84­91. Walia, N., 2006. Senior thesis. Master's thesis. Princeton University. Zhu, H., 2011. Do Dark Pools Harm Price Discovery? Technical Report. Stanford University.
59

SFB 649 Discussion Paper Series 2011
For a complete list of Discussion Papers published by the SFB 649, please visit http://sfb649.wiwi.hu-berlin.de.
001 "Localising temperature risk" by Wolfgang Karl Härdle, Brenda López Cabrera, Ostap Okhrin and Weining Wang, January 2011.
002 "A Confidence Corridor for Sparse Longitudinal Data Curves" by Shuzhuan Zheng, Lijian Yang and Wolfgang Karl Härdle, January 2011.
003 "Mean Volatility Regressions" by Lu Lin, Feng Li, Lixing Zhu and Wolfgang Karl Härdle, January 2011.
004 "A Confidence Corridor for Expectile Functions" by Esra Akdeniz Duran, Mengmeng Guo and Wolfgang Karl Härdle, January 2011.
005 "Local Quantile Regression" by Wolfgang Karl Härdle, Vladimir Spokoiny and Weining Wang, January 2011.
006 "Sticky Information and Determinacy" by Alexander Meyer-Gohde, January 2011.
007 "Mean-Variance Cointegration and the Expectations Hypothesis" by Till Strohsal and Enzo Weber, February 2011.
008 "Monetary Policy, Trend Inflation and Inflation Persistence" by Fang Yao, February 2011.
009 "Exclusion in the All-Pay Auction: An Experimental Investigation" by Dietmar Fehr and Julia Schmid, February 2011.
010 "Unwillingness to Pay for Privacy: A Field Experiment" by Alastair R. Beresford, Dorothea Kübler and Sören Preibusch, February 2011.
011 "Human Capital Formation on Skill-Specific Labor Markets" by Runli Xie, February 2011.
012 "A strategic mediator who is biased into the same direction as the expert can improve information transmission" by Lydia Mechtenberg and Johannes Münster, March 2011.
013 "Spatial Risk Premium on Weather Derivatives and Hedging Weather Exposure in Electricity" by Wolfgang Karl Härdle and Maria Osipenko, March 2011.
014 "Difference based Ridge and Liu type Estimators in Semiparametric Regression Models" by Esra Akdeniz Duran, Wolfgang Karl Härdle and Maria Osipenko, March 2011.
015 "Short-Term Herding of Institutional Traders: New Evidence from the German Stock Market" by Stephanie Kremer and Dieter Nautz, March 2011.
016 "Oracally Efficient Two-Step Estimation of Generalized Additive Model" by Rong Liu, Lijian Yang and Wolfgang Karl Härdle, March 2011.
017 "The Law of Attraction: Bilateral Search and Horizontal Heterogeneity" by Dirk Hofmann and Salmai Qari, March 2011.
018 "Can crop yield risk be globally diversified?" by Xiaoliang Liu, Wei Xu and Martin Odening, March 2011.
019 "What Drives the Relationship Between Inflation and Price Dispersion? Market Power vs. Price Rigidity" by Sascha Becker, March 2011.
020 "How Computational Statistics Became the Backbone of Modern Data Science" by James E. Gentle, Wolfgang Härdle and Yuichi Mori, May 2011.
021 "Customer Reactions in Out-of-Stock Situations ­ Do promotion-induced phantom positions alleviate the similarity substitution hypothesis?" by Jana Luisa Diels and Nicole Wiebach, May 2011.
SFB 649, Spandauer Str. 1, D-10178 Berlin http://sfb649.wiwi.hu-berlin.de
This research was supported by the Deutsche Forschungsgemeinschaft through the SFB 649 "Economic Risk".

SFB 649 Discussion Paper Series 2011
For a complete list of Discussion Papers published by the SFB 649, please visit http://sfb649.wiwi.hu-berlin.de.
022 "Extreme value models in a conditional duration intensity framework" by Rodrigo Herrera and Bernhard Schipp, May 2011.
023 "Forecasting Corporate Distress in the Asian and Pacific Region" by Russ Moro, Wolfgang Härdle, Saeideh Aliakbari and Linda Hoffmann, May 2011.
024 "Identifying the Effect of Temporal Work Flexibility on Parental Time with Children" by Juliane Scheffel, May 2011.
025 "How do Unusual Working Schedules Affect Social Life?" by Juliane Scheffel, May 2011.
026 "Compensation of Unusual Working Schedules" by Juliane Scheffel, May 2011.
027 "Estimation of the characteristics of a Lévy process observed at arbitrary frequency" by Johanna Kappus and Markus Reiß, May 2011.
028 "Asymptotic equivalence and sufficiency for volatility estimation under microstructure noise" by Markus Reiß, May 2011.
029 "Pointwise adaptive estimation for quantile regression" by Markus Reiß, Yves Rozenholc and Charles A. Cuenod, May 2011.
030 "Developing web-based tools for the teaching of statistics: Our Wikis and the German Wikipedia" by Sigbert Klinke, May 2011.
031 "What Explains the German Labor Market Miracle in the Great Recession?" by Michael C. Burda and Jennifer Hunt, June 2011.
032 "The information content of central bank interest rate projections: Evidence from New Zealand" by Gunda-Alexandra Detmers and Dieter Nautz, June 2011.
033 "Asymptotics of Asynchronicity" by Markus Bibinger, June 2011. 034 "An estimator for the quadratic covariation of asynchronously observed
Itô processes with noise: Asymptotic distribution theory" by Markus Bibinger, June 2011. 035 "The economics of TARGET2 balances" by Ulrich Bindseil and Philipp Johann König, June 2011. 036 "An Indicator for National Systems of Innovation - Methodology and Application to 17 Industrialized Countries" by Heike Belitz, Marius Clemens, Christian von Hirschhausen, Jens Schmidt-Ehmcke, Axel Werwatz and Petra Zloczysti, June 2011. 037 "Neurobiology of value integration: When value impacts valuation" by Soyoung Q. Park, Thorsten Kahnt, Jörg Rieskamp and Hauke R. Heekeren, June 2011. 038 "The Neural Basis of Following Advice" by Guido Biele, Jörg Rieskamp, Lea K. Krugel and Hauke R. Heekeren, June 2011. 039 "The Persistence of "Bad" Precedents and the Need for Communication: A Coordination Experiment" by Dietmar Fehr, June 2011. 040 "News-driven Business Cycles in SVARs" by Patrick Bunk, July 2011. 041 "The Basel III framework for liquidity standards and monetary policy implementation" by Ulrich Bindseil and Jeroen Lamoot, July 2011. 042 "Pollution permits, Strategic Trading and Dynamic Technology Adoption" by Santiago Moreno-Bromberg and Luca Taschini, July 2011. 043 "CRRA Utility Maximization under Risk Constraints" by Santiago MorenoBromberg, Traian A. Pirvu and Anthony Réveillac, July 2011.
SFB 649, Spandauer Str. 1, D-10178 Berlin http://sfb649.wiwi.hu-berlin.de
This research was supported by the Deutsche Forschungsgemeinschaft through the SFB 649 "Economic Risk".

SFB 649 Discussion Paper Series 2011
For a complete list of Discussion Papers published by the SFB 649, please visit http://sfb649.wiwi.hu-berlin.de.
044 "Predicting Bid-Ask Spreads Using Long Memory Autoregressive Conditional Poisson Models" by Axel Groß-Klußmann and Nikolaus Hautsch, July 2011.
045 "Bayesian Networks and Sex-related Homicides" by Stephan Stahlschmidt, Helmut Tausendteufel and Wolfgang K. Härdle, July 2011.
046 "The Regulation of Interdependent Markets", by Raffaele Fiocco and Carlo Scarpa, July 2011.
047 "Bargaining and Collusion in a Regulatory Model", by Raffaele Fiocco and Mario Gilli, July 2011.
048 "Large Vector Auto Regressions", by Song Song and Peter J. Bickel, August 2011.
049 "Monetary Policy, Determinacy, and the Natural Rate Hypothesis", by Alexander Meyer-Gohde, August 2011.
050 "The impact of context and promotion on consumer responses and preferences in out-of-stock situations", by Nicole Wiebach and Jana L. Diels, August 2011.
051 "A Network Model of Financial System Resilience", by Kartik Anand, Prasanna Gai, Sujit Kapadia, Simon Brennan and Matthew Willison, August 2011.
052 "Rollover risk, network structure and systemic financial crises", by Kartik Anand, Prasanna Gai and Matteo Marsili, August 2011.
053 "When to Cross the Spread: Curve Following with Singular Control" by Felix Naujokat and Ulrich Horst, August 2011.
054 ,,TVICA - Time Varying Independent Component Analysis and Its Application to Financial Data" by Ray-Bing Chen, Ying Chen and Wolfgang K. Härdle, August 2011.
055 ,,Pricing Chinese rain: a multi-site multi-period equilibrium pricing model for rainfall derivatives" by Wolfgang K. Härdle and Maria Osipenko, August 2011.
056 ,,Limit Order Flow, Market Impact and Optimal Order Sizes: Evidence from NASDAQ TotalView-ITCH Data" by Nikolaus Hautsch and Ruihong Huang, August 2011
057 "Optimal Display of Iceberg Orders" by Gökhan Cebirolu and Ulrich Horst, August 2011
058 "Optimal liquidation in dark pools" by Peter Kratz and Torsten Schöneborn, September 2011
SFB 649, Spandauer Str. 1, D-10178 Berlin http://sfb649.wiwi.hu-berlin.de
This research was supported by the Deutsche Forschungsgemeinschaft through the SFB 649 "Economic Risk".

