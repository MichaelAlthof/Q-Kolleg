BERLIN

SFB 6 4 9 E C O N O M I C R I S K

SFB 649 Discussion Paper 2010-009
Predicting extreme VaR: Nonparametric
quantile regression with refinements from
extreme value theory
Julia Schaumburg*
* Humboldt-Universit‰t zu Berlin, Germany
This research was supported by the Deutsche Forschungsgemeinschaft through the SFB 649 "Economic Risk".
http://sfb649.wiwi.hu-berlin.de ISSN 1860-5664
SFB 649, Humboldt-Universit‰t zu Berlin Spandauer Straﬂe 1, D-10178 Berlin

Predicting extreme VaR: Nonparametric quantile regression with refinements from
extreme value theory
Julia Schaumburg,
January 30, 2010
Abstract This paper studies the performance of nonparametric quantile regression as a tool to predict Value at Risk (VaR). The approach is flexible as it requires no assumptions on the form of return distributions. A monotonized double kernel local linear estimator is applied to estimate moderate (1%) conditional quantiles of index return distributions. For extreme (0.1%) quantiles, where particularly few data points are available, we propose to combine nonparametric quantile regression with extreme value theory. The out-of-sample forecasting performance of our methods turns out to be clearly superior to different specifications of the Conditionally Autoregressive VaR (CAViaR) models. Keywords: Value at Risk, nonparametric quantile regression, risk management, extreme value theory, monotonization, CAViaR JEL classification: C14, C22, C52, C53
I would like to thank Melanie Schienle, Nikolaus Hautsch and Vladimir Spokoiny for their instructive and helpful comments on this project. The support from the Deutsche Forschungsgemeinschaft via SFB 649 '÷konomisches Risiko', Humboldt-Universit‰t zu Berlin, is gratefully acknowledged.
Humboldt-Universit‰t zu Berlin, School of Business and Economics, Institute of Statistics and Econometrics, Chair of Econometrics. Address: Spandauer Str. 1, 10178 Berlin, Germany. Email: julia.schaumburg@wiwi.hu-berlin.de.
1

1 INTRODUCTION

1

1 Introduction
Risk management regulations require banks to estimate market risk measures based on quantiles of loss distributions. According to the Market Risk Amendment to the Basel II Capital Accord of 2004, issued by the Bank for International Settlements, Value at Risk (VaR) is to be calculated daily, using a '99th percentile, one-tailed confidence interval'.1 Banks are free to choose which VaR model they use, but the recent turbulences on financial markets raise the question to what extent conventional VaR models, e.g. based on historical simulation or estimates of variance-covariance matrices of asset returns, are appropriate. The aim of this paper is to assess the performance of nonparametric quantile regression as a tool for VaR estimation. The approach requires no assumptions on the form of financial return distributions. We show that in terms of outof-sample forecasting performance, a monotonized double kernel local linear estimator clearly outperforms competing models on the 1% VaR level. Our benchmarks are different specifications of the Conditionally Autoregressive Value at Risk (CAViaR) models of Engle and Manganelli (2004). By refining nonparametric quantile regression methods with extreme value theory (EVT), we are able to model extreme quantiles (0.1%) accurately. Several studies exist that compare the forecast performances of different VaR models. See, among others, Kuester et al. (2006), Manganelli and Engle (2001) and Nieto and Ruiz (2008). They take into account a broad variety of models, but nonparametric quantile regression as a tool for VaR estimation is rarely considered. One reason might be the fact that due to regulatory requirements and internal risk management purposes, quantiles associated with low probabilities such as p = 0.01 and below are of particular practical interest. For fully nonparametric models, however, the number of data points available to estimate tail quantiles is often not sufficient. Cai and Wang (2008) suggest to estimate VaR and Expected Shortfall using a new nonparametric VaR estimator, combining the Weighted Nadaraya Watson (WNW) estimator of Cai (2002) and the Double Kernel Local Linear (DKLL) estimator of Yu and Jones (1998). In the empirical application, however, only 5% quantile curves are estimated
1Amendment to the Capital Accord to incorporate market risks, paragraph B.4(b).

1 INTRODUCTION

2

and no forecasts are computed. Chen and Tang (2005) investigate nonparametric VaR estimation, when no regressors are present. Taylor (2008) proposes to combine double kernel quantile regression with exponential smoothing of the dependent variable in the time domain. 1% and 99% VaRs are predicted from the model along with some benchmarks, but extreme quantiles are not considered. Within the framework presented here, nonparametric regression can be utilized to estimate VaR on any probability level of interest. In recent years, computing power has increased substantially. Thus, estimating nonparametric quantile models induces only little higher computation costs compared to parametric models. But the gain in flexibility is substantial, because nonparametric estimates can also be used as benchmarks to parametric models, which may help to reduce model risk. Therefore, we argue that, also in practice, nonparametric quantile regression should be considered as a serious alternative to common VaR estimation approaches. Generally, the price to be paid for the flexibility of nonparametric models is slower convergence than in the case of parametric regression. Therefore, when using nonparametric methods to estimate VaR, one major concern is data sparseness in the tails of the return distribution. We address this issue by combining three techniques. Firstly, the nonparametric technique of double smoothing is applied, i.e. estimation of a distribution by localizing both regressor- and dependent variable observations in order to ease distortions arising from data sparseness. Two candidate double kernel estimators are available, which have similar asymptotic properties. On the basis of a small simulation study, the Double Kernel Local Linear (DKLL) estimator is chosen for the VaR application. However, investigating in-sample fits obtained from the DKLL estimator, reveals that despite the double smoothing, not all distortions can be eliminated, so that curves that should be smoothly increasing are nonmonotone and have bumps. Therefore, secondly, we adapt the method of monotonization by rearrangement, which has been proposed by Chernozhukov et al. (2009a). To the best of our knowledge, implementing this method is new to the VaR literature. The theoretical finding, that rearrangement weakly improves nonmonotone estimates of monotone functions, is confirmed by our VaR estimation and forecasting results.

2 QUANTILE REGRESSION APPROACHES TO VAR ESTIMATION

3

Thirdly, since data sparseness is even more severe in case of extreme quantiles, e.g. corresponding to a probability of p = 0.001, we apply EVT to estimate quantiles of the standardized nonparametric quantile residuals. The estimation performance of the model on our data set is promising. In a small simulation study, we confirm that the procedure leads to accurate VaR estimates. The remainder of the paper is structured as follows. Section 2 briefly describes the basic setup of conditional quantile models, including CAViaR models. A new CAViaR specification is introduced, which is directly motivated from the GARCH literature. Section 3.1 outlines the two candidate double kernel estimators. Their finite sample fits are compared via simulation in 3.2. Section 3.3 contains the modelling idea for extreme quantiles, combining nonparametric quantile regression and EVT. The investigated data sets and the backtesting method are summarized in section 4. The empirical results on 1% and 0.1% VaR of four time series of index returns are summarized in section 5. Section 6 concludes.

2 Quantile regression approaches to VaR estimation

2.1 Conditional quantiles
Let {Yt}nt=1 be a strictly stationary time series of portfolio returns and let Xt be a d-dimensional vector of regressors. The pth conditional quantile of Yt, denoted by qp(x), is defined as

qp(x) = inf {y  R : F (y|x)  p}  F -1(p|x),

(2.1)

or, equivalently, as the argument that solves

min E p - I(Yt < q(Xt)) Yt - q(Xt) |Xt = x .
q(Xt)

(2.2)

Both formulations are widely used in the literature. In the seminal paper by Koenker and Bassett (1978) a sample equivalent of (2.2) where q(Xt) = Xt , also including the special case Xt = 1, is established.  is a vector of unknown parameters and has dimension d + 1. The linear quantile model is extended to conditionally heteroskedastic processes in Koenker and Zhao (1996). In En-

2 QUANTILE REGRESSION APPROACHES TO VAR ESTIMATION

4

gle and Manganelli (2004) conditionally autoregressive quantile functions are estimated using (2.2) with q(Xt) possibly being nonlinear in parameters, see section 2.2 for some examples. In a number of papers, localized kernel versions of (2.2) are estimated, leading to a nonparametric fit: Yu and Jones (1997) compare the goodness of fit of local constant and local linear models. A varying coefficients and a partially varying coefficients approach are covered in Cai and Xu (2008). On the other hand, Cai (2002), Yu and Jones (1998), Cai and Wang (2008) propose nonparametric methods to estimate the distribution function in (2.1), which, in a second step, is inverted. Section 3.1 contains more details on the three approaches. Wu et al. (2007) model (2.1) without regressors, and Chernozhukov and Umantsev (2001) operationalize a linear version of (2.1). Following the convention of expressing VaR as a positive number, it is defined as
V aRpt (∑) = -qpt (∑),
where qpt is the quantile of the return distribution corresponding to probability p, at time t. V aRpt denotes a generic VaR measure which may depend on x and/or a vector of parameters . To simplify notation, index t is suppressed in contexts where it does not cause confusion.

2.2 Conditionally autoregressive VaR (CAViaR) Models
The class of Conditional Autoregressive Value at Risk (CAViaR) models, first introduced by Engle and Manganelli (2004), is used to benchmark the forecast performance of the nonparametric VaR estimators considered here. Several comparison studies have done so, for example Kuester et al. (2006) or Taylor (2008). CAViaR models are dynamic VaR models describing the quantile of a random variable at time t, e.g. the return on a financial portfolio, as possibly nonlinear function of its own lags and, in addition, of a vector of observable variables, Xt:
r1 r2
V aRpt (, Xt) = 0 + iV aRpt-i(, Xt-i) + jf (Xt-j),
i=1 j=1

2 QUANTILE REGRESSION APPROACHES TO VAR ESTIMATION

5

where r = r1 + r2 + 1 is the dimension of , the parameter vector that solves

min


1 n

n t=1

p-I

Yt < -V aRpt (, Xt)

(Yt + V aRpt (, Xt)).

(2.3)

To simplify notation, the Xt in parentheses will be dropped in the following. A straightforward choice for Xt is lagged returns. Following the original article, the specifications used here include the first lagged value of V aRp(∑) and the first lagged value of Yt, therefore Xt = Yt-1. Well-known stylized facts on asset returns are, firstly, that they exhibit volatil-

ity clustering. It carries over to VaR: if high variation is observed in returns

of the recent past, it is likely to continue, and risk is therefore high as well.

Secondly, quantiles (or volatility) might react differently according to the sign

of past returns. This possibility is captured by the Asymmetric Slope specifi-

cation

V aRpt () = 1 + 2V aRpt-1() + 3(Yt-1)+ + 4(Yt-1)-,

(2.4)

where (x)+ = max(x, 0) and (x)- = - min(x, 0), but not by the Indirect GARCH(1,1) specification

V aRpt () = 1 + 2(V aRpt-1)2() + 3Yt2-1.

(2.5)

On the other hand, the Asymmetric Slope CAViaR imposes a piecewise linear structure on VaR, although the true functional form might be nonlinear. As pointed out in Kuester et al. (2006), financial returns may also have an autoregressive mean, which is neglected by the above CAViaR specifications. For these reasons we introduce a new specification, called Indirect Autoregressive Threshold GARCH (AR-TGARCH(1,1)) CAViaR:

1
V aRpt () = 1Yt-1 + 2 + 3(V aRpt-1)2() + 4Yt2-1 + 5(Yt-1)2I(Yt-1 < 0) 2 , (2.6)
Including the AR term introduces the possibility for a nonzero autoregressive mean, asymmetry is present if 5 = 0 and the square root allows for a nonlinear functional form.

3 NONPARAMETRIC VAR MODELS

6

3 Nonparametric VaR models

3.1 Modelling 1% VaR

In general, estimating nonparametric models requires large amounts of data.

Since VaR corresponds to a quantile at the tail of the return distribution, suit-

able nonparametric quantile estimators should be able to deal with areas where

data are sparse. Therefore, from the variety of nonparametric quantile estima-

tors, the Double Kernel Local Linear (DKLL) estimator of Yu and Jones (1998)

and the Weighted Double Kernel Local Linear (WDKLL) estimator introduced

by Cai and Wang (2008) are considered for the VaR application, because they

localize the data in both x- and y-direction, which leads to smoother estimates.

For more details, regularity assumptions and asymptotic properties, see the

original articles by Cai and Wang (2008) and Yu and Jones (1998).

For notational convenience, observations {(Xt, Yt)}nt=1 are assumed to be drawn from underlying bivariate distribution F (x, y) with density f (x, y). The ex-

tension to the multivariate case is straightforward, but requires more tedious

notation. Both estimators are defined as inverses of conditional distribution

functions as in (2.1). Throughout this section, quantiles of return distributions

are discussed, so that VaR corresponds to the negative quantile.

A generic nonparametric method of estimating a conditional distribution F (y|x)

is

n

F(y|x) = wt(x)I(Yt  y),

(3.1)

t=1

where I(A) denotes the indicator on the set A and the weights wt(x) are positive and sum up to one. Choosing equal weights w = 1/n yields the empirical

distribution function. Using instead a kernel function with bandwidth param-

eter h, in the following sometimes abbreviated by Kh(∑)

=

1 h

K

(∑/h),

which

is often chosen to be a symmetric probability density function, results in the

Nadaraya Watson estimator for conditional distribution

n
FNW (y|x) =
t=1

Kh(x - Xt)

n t=1

Kh

(x

-

Xt

)

I (Yt



y)

wt(x)

3 NONPARAMETRIC VAR MODELS

7

see for example Li and Racine (2007). It attaches a smooth set of weights to the

data, and is known to be monotone increasing and bounded between zero and

one. However, it suffers from boundary distortion, as shown by Fan and Gij-

bels (1996). They advocate the use of local polynomial estimators, the simplest

of which is the local linear estimator.

One way to reduce distortions that arise due to a limited number of observa-

tions is to smooth not only the observations of the regressor variable Xt, but

also the observations of the dependent variable Yt. This requires the intro-

duction of a second symmetric kernel Wh2(∑). Its kernel distribution, which is

defined by

y
Wh2(Yt - u)du = 
-

y - Yt h2

,

(3.2)

with h2 < h1, can be viewed as a smooth, differentiable version of the indicator function.

In case of the DKLL estimator, as a next step, the conditional distribution value

of y is approximated by a linear Taylor expansion around x. The estimate

F~(y|x) = ^0 is obtained from

n
(^0, ^1) = arg min
0,1 t=1



y - Yt h2

2
- 0 - 1(Xt - x) Kh1 (x - Xt) .

(3.3)

Solving for ^0 yields the explicit expression for the conditional distribution function estimator,

n
F~(y|x) =
t=1

Kh1 (x

n t=1

Kh1

- Xt) [S2 - (x (x - Xt) [S2 -

- Xt)S1] (x - Xt)S1]



wt(x)

y - Yt h2

,

(3.4)

where

n
Sl = K
i=1

x - Xt h1

(x - Xi)l,

l = 1, 2.

(3.4) is a version of (3.1) where the kernel distribution function (∑) in (3.2) re-

places the indicator. The DKLL quantile estimator q~p(x), the sample analogue to (2.1), is then defined by

q~p(x) = inf y   : F~(y|x)  p  F~-1(p|x).

(3.5)

3 NONPARAMETRIC VAR MODELS

8

with F~ from (3.4). In finite samples, F~(y|x) might not always be monotonically increasing. In such cases, however, the inverse is not defined. Yu and Jones (1998) suggest the following implementation scheme: For q~1/2(x), any value satisfying (3.5) is chosen; for p > 1/2, the largest, and for p < 1/2, the smallest solutions to (3.5) are taken as quantile estimates. In this paper, a stronger procedure is applied, avoiding to delete estimated values. Chernozhukov et al. (2009a) show that any nonmonotone estimate of a monotone function can be improved in terms of common metrics, such as the Lp-norm, by rearranging. For the case of a monotone increasing (decreasing) function, the point estimates are sorted in ascending (descending) order. Making use of the results derived in Chernozhukov et al. (2009a), nonmonotone distribution estimates are rearranged before inverting. We will utilize this useful method more extensively in section 5.2 to monotonize conditional VaR curves. In the present context of monotonizing the estimated distribution function, a further effect is that quantile crossing is circumvented, as pointed out in Chernozhukov et al. (2009b). Estimated values greater than one are discarded. The Weighted Double Kernel Local Linear (WDKLL) of Cai and Wang (2008) estimator is a combination of the DKLL estimator and the Weighted Nadaraya Watson (WNW) estimator of Cai (2002). The indicator in (3.1) is replaced by distribution function (3.2). Additionally, in order to avoid boundary distortions known to occur for standard Nadaraya Watson type estimators, a set of weight functions pt(x) is multiplied to the kernel values. The weight functions depend on the data X1, ..., Xn and on locations x. Here they are chosen to fulfill the discrete moment conditions of the simplest local polynomial estimator, the local linear, which are

n
pt(x) = 1 and
t=1

n
pt(x)(Xt - x)Kh(Xt - x) = 0.
t=1

(3.6)

Fan and Gijbels (1996) show that as a consequence of these conditions, design dependent local polynomial estimators automatically adjust at the boundary of the support of x, and that they can adapt to different designs. Functions pt(x) fulfilling (3.6) are not unique. One possibility to identify them is to use the idea underlying empirical likelihood: The product, or equivalently

3 NONPARAMETRIC VAR MODELS

9

the sum of the logarithms of all pt(x) is maximized subject to the constraints (3.6). The corresponding (Lagrange) objective function is

n
L = log [pt(x)] + 1
t=1

n
pt(x) - 1
t=1

+ 2

n
(Xt - x)pt(x)Kh(x - Xt) .
n=1
(3.7)

By taking derivatives and solving the first order conditions, pt(x; ) can be derived as

pt(x; ) = n-1 [1 + (Xt - x)Kh(x - Xt)]

(3.8)

Plugging (3.8) back into the objective function gives

L

=

1 nh

n

log [1 + (Xt - x)Kh(x - Xt] ,

t=1

(3.9)

which is maximized by finding the root of L() = 0 numerically, e.g. by Newton's Method. The obtained parameter 0 is used in (3.8), which gives the unique weights. Putting everything together, the WDKLL conditional distribution estimator is defined by

n
F^ (y|x) =
t=1

pt(x)Kh1 (Xt - x)

n t=1

pt(x)Kh1

(Xt

-

x)



y - Yt h2

,

(3.10)

and the corresponding WDKLL estimate of the pth conditional quantile func-

tion is

q^p(x) = inf{y   : F^(y|x)  p}  F^-1(p|x)

(3.11)

It always exists because F^(y|x) is, by construction, between zero and one and monotone in y (see Cai (2002)). In Cai and Wang (2008) it is shown that both conditional distribution and quantile estimators are design adaptive, a feature that is not shared by ordinary Nadaraya Watson type estimators. In particular, no boundary correction is necessary. The replacement of the indicator entails additional smoothness, especially at the outer regions of the support.

3 NONPARAMETRIC VAR MODELS

10

3.2 Comparing DKLL and WDKLL estimator
From a theoretical point of view, the WDKLL estimator is slightly superior to the DKLL estimator, because it ensures monotonicity and does not require rearrangement. Furthermore, it is explicitly set up for time series data. Still, since the aim of this paper is to find the estimator which is best suited for estimation of VaR, i.e. tail quantiles, a small simulation is carried out comparing DKLL and WDKLL estimators. An ARCH(1) process with starting value 0 is generated according to

Yt = -0.4Xt +

0.4(1 + Xt2) t,
(Xt)

(3.12)

where Xt = Yt-1, and the error term t  iidN (0, 1). Conditional quantiles are estimated using both WDKLL (q^(x)) and DKLL (q~(x)) estimators for three different sample sizes, n = 200, n = 500 and n = 1000, conditional on two values of Xt, x = -0.75 and x = 1.25. For both local constant fit of the WDKLL estimator and local linear fit of the DKLL estimator, the Gaussian kernel is used, while the uniform kernel is used for smoothing the dependent variable.
Table 3.1 contains results on estimates of the Integrated Square Error (ISE)

x = -0.75
WDKLL DKLL

5% ISE
0.009 0.014

25% ISE
0.012 0.018

Median ISE
0.015 0.021

75% ISE
0.018 0.024

95% ISE
0.024 0.032

x = 1.25
WDKLL DKLL

5% ISE 25% ISE Median ISE 75% ISE 95% ISE

0.033 0.048

0.059

0.074 0.100

0.025 0.035

0.043

0.053 0.070

Table 3.1: Quantiles of ISE for n = 1000.

as goodness of fit measure, which is defined for some function f (x) and an

estimate f^(x), as

ISE =

f^(x) - f (x)

2
dx.

Here, ISE measures the squared distance between estimate and true quan-

3 NONPARAMETRIC VAR MODELS

11

tile curve. It can be estimated by discretizing the integral using the trapezoid formula

ISE

=

m-1
(f^(xi)-f

(xi))2+

1

(f^(x1)-f

(x1))2+

1

(f^(xm)-f

(xm))2,

(3.13)

22

i=2

where x1 < ... < xm is a grid of x-values and  = xi - xi-1 is the same for all i = 2, ...m. Here, median, 5%, 25%, 75% and 95% quantiles of ISE are computed. All results are derived using 500 replications. Interestingly, for the grid point relatively close to the process mean, x = -0.75, the WDKLL estimator has smaller ISE, but for = 1.25, where less data are available, the fit of the DKLL estimator is slightly better. As the differences are small, both estimators are considered to be well suited for our application. However, based on the simulation result we choose the DKLL estimator for the estimation of index return VaR in section 5.2.

3.3 Modelling 0.1% VaR
For extreme quantiles, usually very few data points are available, so that fully nonparametric regression does not yield reliable estimates. Extreme value theory (EVT) is an alternative to model extreme quantiles. In the following a method of incorporating extreme value theory into CAViaR models, which was introduced by Manganelli and Engle (2001), is adapted to obtain VaR estimates for p = 0.001 from a nonparametric model. The strategy is to first calculate the standardized quantile residuals,

^t q^t

=

Yt - q^t q^t

=

Yt q^t

- 1.

Under the assumption that the implemented model is correct, they should be i.i.d., which is a necessary condition for applying standard extreme value estimators. McNeil and Frey (2000) employ a similar technique to estimate VaR for p = 0.01 from a GARCH residual series. p denotes the (very low) probability of interest, and  corresponds to a moderately low probability for which the quantile can be estimated nonparametrically, for example  = 0.01 or  = 0.05. Reformulating the definition of the pth quantile of portfolio returns in terms of

3 NONPARAMETRIC VAR MODELS

12

the th quantile yields

P [Yt < qpt ] = P Yt < qt - qt + qpt

=

P

Yt qt

-1

>

qpt qt

-1

= p.

The inequality sign is switched assuming that qpt is a negative number. Let

qpt qt

-

1



zp

denote the pth quantile of the standardized residuals. Finally, the pth quantile of the original time series of portfolio returns can be estimated with EVT:

q^pt q^t

-

1

=

z^p



q^pt = q^t (z^p + 1).

(3.14)

with EVT methods, and some rearranging.

Again,

V

t
aRp

=

-q^pt .

In

the

remainder

of

this

section,

the

basic

idea

of

the

stan-

dard peaks over threshold (POT) method, which is used to obtain z^p in (3.14),

is described very briefly, following Embrechts et al. (1997).

Large observations which exceed a high threshold can be approximated rea-

sonably well by the generalized Pareto distribution with distribution function

G,(x) =

-(1 + x/)1/ for  = 0

1 - ex/

for  = 0

(3.15)

with shape parameter  and scale parameter  > 0. The support is x  0

when 



0 and 0



x



-

 

if 

<

0.

The parameters can be consistently

estimated if the threshold exceedances are independent, regardless of the true

underlying distribution, see Smith (1987). In general, given a high threshold

u and a random variable Y , the probability of Y exceeding u at most by x is

given by

Fu(x) = P [Y

- u  x|Y

> u] =

F

(x + u) - F 1 - F (u)

(u)

.

(3.16)

4 DATA AND BACKTESTING METHOD

13

Balkema and de Haan (1974) and Pickands (1975) show that for a large class of distribution functions F it is possible to find a positive function (u) such that

lim sup
uy0 0x<y0-u

Fu(x) - G,(u)(x)

=0

(3.17)

with y0 corresponding to the right endpoint of F . Rearranging (3.16) and using Fu(∑)  G,(∑), it holds that

1 - F (u + x)  [1 - F (u)][1 - G,(x)].

Then, 1 - G,(x) can be obtained by estimating the GPD parameters by maxi-

mum likelihood. Let Nu denote the number of exceedances over threshold u. A

common way of estimating S(u) := 1-F (u) is to use the empirical distribution

function

Nu n

.

Subsituting

the

estimates,

S(u

+

x)

=

Nu n

1 + ^

x ^

-

1 ^

.

(3.18)

The quantile can be estimated by inverting (3.18), employing a change of variables y = u + x and fixing the distribution value at the probability of interest: F (y) = p. Therefore, the quantile estimator q^p is obtained from

1

-

p

=

Nu n

1 + ^

y-u ^

-

1 ^

 q^p = u +

(1

-

p)

Nu n

-^
-1

∑ ^^.

(3.19)

4 Data and backtesting method
We analyze four data sets of daily index returns. The longest available time series of each are used to compute in-sample fits, leaving out 1000 observations for out-of-sample forecasting. Table 4 summarizes the data. The end date of the in-sample period is 04/05/2004.
Realizations of quantiles cannot be observed. Therefore, backtesting of the models is carried out using the dynamic quantile (DQ) out-of-sample test developed in Engle and Manganelli (2004) to test and compare the performance

4 DATA AND BACKTESTING METHOD

14

start date no. of observations mean median 0.5% quantile 99.5% quantile skewness kurtosis

DAX
01/05/1965 9954 0.0167 0
-4.0200 3.6530 -0.41 11.28

FTSE 100
01/03/1984 4999 0.0259 0.0195
-3.4698 3.2573 -0.79 13.57

EuroSTOXX
01/02/1987 4216 0.0205 0.0567
-4.9243 4.1567 -0.33
8.41

S&P 500
06/26/1969 8787 0.0246 0.0019 -3.003 3.2247 -1.41 38.21

Table 4.1: Data summary. All returns in percent.

of CAViaR models. Define the hit function

Hitt  I(Yt < -V aRpt ) - p

(4.1)

which equals -p if the return is below the forecasted quantile and (1 - p) if VaR is exceeded. If the chosen model is correct,

1. E[Hitt|t] = 0, where t is any information known at t, and consequently,

2. Hitt is uncorrelated with its own lags and
3. P (Yt < -V aRpt ) = p, i.e. the unconditional probability of VaR exceedance equals p.

Thus, VaR is estimated correctly, if for each day independently, the probability of exceeding it equals p. For the DQ test, a regression equation

Hitt = Xt  + ut, ut =

-p with prob. 1 - p 1 - p with prob. p

(4.2)

is estimated, where Xt is an r-dimensional vector containing any variables potentially correlated with Hitt. The null hypothesis

H0 : 1 = ... = r = 0

5 APPLICATION TO STOCK INDEX RETURNS

15

can be tested by a Wald test for joint significance. Therefore, the test statistic is

DQ

=

1 n

∑

HitX[XX]XHit p(1 - p)



r2

as

n, nIS



,

where n denotes the number of out-of sample forecasts, nIS is the number of observations used for estimating the model, and Hit and X are the vectors containing observations of the dependent variable and the regressor matrix, respectively. Following, for example, Engle and Manganelli (2004), Kuester et al. (2006) and Taylor (2008), the information set consists of a constant, four lagged values of Hitt and the respective estimate of V aRpt-1.

5 Application to stock index returns
5.1 1% CAViaR
For estimating the parameters of the CAViaR models, an algorithm similar to the one proposed in the original paper is applied, see Engle and Manganelli (2004). A grid search is conducted by generating a large number of random vectors, the dimension of which corresponds to the number of model parameters. The five vectors which lead to the lowest values of the objective function (2.3) are selected and fed into a simplex optimization algorithm. The final parameter vector is chosen to be the one minimizing (2.3). Table 5.1 reports the results on the evaluation of the Asymmetric Slope, GARCH and AR-TGARCH CAViaR models. They perform similarly. All in-sample coverages, i.e. the shares of VaR exceedances in the estimation period, are very close to 1%. This is not surprising since the objective function ensures that the parameters are chosen in this way. Except for the DAX, out-of-sample coverages are in an acceptable range as well. However, almost all p-values of the DQ test are close to zero, i.e. the null hypothesis of independent VaR exceedances has to be rejected on common significance levels in almost all cases. Comparing forecast accuracy, it turns out that the the results obtained from the new AR-TGARCH CAViaR model are similar to the results from the Asymmetric Slope model. However, the news impact curves shown in figure 5.1, i.e. the

5 APPLICATION TO STOCK INDEX RETURNS

16

in-sample (%) out-of sample (%) DQ p-value

DAX
Asymmetric Slope 0.995 5.0 0.0

GARCH 1.025 5.3 0.0

AR-TGARCH 0.975 05.1 0.0

in-sample (%) out-of sample (%) DQ p-value

FTSE 100
Asymmetric Slope 1.020 1.0 0.0

GARCH 1.000 0.8 0.0

AR-TGARCH 0.980 1.1 0.0

in-sample (%) out-of sample (%) DQ p-value

EuroSTOXX 50
Asymmetric Slope
0.997 1.8 0.000061

GARCH
1.020 1.7 0.021

AR-TGARCH
0.996 1.9 0.000067

in-sample (%) out-of sample (%) DQ p-value

S&P 500
Asymmetric Slope
1.002 0.6 0.000029

GARCH
1.013 0.7 0.0022

AR-TGARCH
1.001 0.6 0.000027

Table 5.1: DQ test results for CAViaR models as well as in-sample and out-of sample share (coverage) of VaR exceedances (in percent).

reactions of VaR to different magnitudes of the lagged return, reveal that the new specification resembles the nonparametric VaR estimate better than the other two models. Nevertheless, from the DQ test results it must be concluded that none of the considered CAViaR specifications captures the dynamics underlying the VaR processes.

5 APPLICATION TO STOCK INDEX RETURNS
S&P 500: AR-TGARCH CAViaR vs. DKLL

17

VaR 2.2 2.4 2.6 2.8 3.0 3.2
VaR 2.0 2.5 3.0 3.5 4.0 4.5 5.0 VaR 2.2 2.4 2.6 2.8 3.0

-4 -2

0

2

lagged return

S&P 500: Asymm. Slope CAViaR

4 S&P 500: GARCH CAViaR

-4 -2

0

2

lagged return

4

-4 -2

0

2

lagged return

4

Figure 5.1: News impact curves of TGARCH(1,1) CAViaR (green) together with DKLL estimate (blue), of Asymmetric Slope and GARCH(1,1) CAViaR, for S&P 500

5.2 Nonparametric 1% VaR
When forecasting from a nonparametric model, one has to balance two effects occuring at the boundary areas: The support from which predictions of the dependent variable can be computed is limited to the range in which the estimated function is located. This means that for outlying lagged returns, which are not in the support of the estimated curve, no forecasts for VaR exist. On the other hand, often only few data points are available at boundary areas, so that outliers have more influence and the resulting curve may show distortions. Therefore, one has to decide carefully about the range of the grid at which the

5 APPLICATION TO STOCK INDEX RETURNS

18

function is evaluated, balancing possible distortions against a limited range of regressor values to compute forecasts from. For forecasting 1% quantiles of a conditional distribution, the DKLL estimator is used due to its double smoothing property, which eases distortions and leads to smoother quantile curves. Furthermore, in our simulation, it obtained a slightly superior finite sample fit compared to the WDKLL estimator (see section 3.1). However, the performance of the DKLL estimator can be improved even further by making use of the monotonization method proposed by Chernozhukov et al. (2009a). Whenever curves are not monotonically decreasing on the left of the minimum and monotonically increasing on the right, estimated values are rearranged in descending and ascending order, respectively. Chernozhukov et al. (2009a) shows that this procedure of rearranging point estimates weakly reduces the estimation error for any nonmonotone estimate of a monotone function. To illustrate possible changes in the in-sample fit, figures 5.2 and 5.3

DKLL estimate of 1% DAX VaR

Rearranged DKLL estimate of 1% DAX VaR

VaR 345678
VaR 345678

-4 -2

0

2

lagged return

4

-4 -2

0

2

lagged return

4

Figure 5.2: Original and rearranged DKLL estimates of 1% conditional DAX VaR curve
show the original as well as the rearranged 1% VaR curves of DAX and Eurostoxx. All curves cover 99% of the data. The backtesting results of original DKLL and rearranged DKLL estimates are summarized in table 5.2. It reports in-sample and out-of-sample coverages, i.e. the shares of VaR exceedances in the estimation and forecasting periods, respectively, as well as the p-value of the out-of-sample DQ test described in

5 APPLICATION TO STOCK INDEX RETURNS

19

subsection 4. Whenever values in the columns are different, they are superior for the rearranged estimates: In-sample and out-of-sample coverages are closer to 1% in case of the FTSE return series. Furthermore, the DQ test pvalue is higher, indicating that the null hypothesis of independent hits is further away from rejection than for the original DKLL model. For EuroSTOXX, in-sample coverage is closer to 1% as well. The results for DAX and S&P 500, on the other hand, were not affected by the rearrangement. Therefore, our estimation results confirm the findings of Chernozhukov et al. (2009a). The conclusions drawn from backtesting the nonparametric model are simi-

DKLL estimate of 1% Eurostoxx VaR

Rearranged DKLL estimate of 1% Eurostoxx VaR

VaR 3.0 3.5 4.0 4.5 5.0 5.5 6.0
VaR 3.0 3.5 4.0 4.5 5.0 5.5 6.0

-4 -2

0

2

lagged return

4

-4 -2

0

2

lagged return

4

Figure 5.3: Original and rearranged DKLL estimates of 1% conditional Eurostoxx VaR curve
lar for FTSE, EuroSTOXX and S&P 500. Table 5.2 reveals that there seems to be a slight tendency to overestimate VaR, so that exceedances stay below the expected amount. The DQ test p-values, on the other had, indicate that no severe clustering of exceedances is present. The large number of observations justifies the choice of a test significance level of 1%, so that the null hypothesis of independent hits is not rejected even for S&P 500. The picture is different in the case of DAX VaR. Table 5.3 contains a direct comparison of results obtained from the rearranged DKLL model and, due to their similarity, from only two of the CAViaR specifications. The two CAViaR models clearly underestimate VaR in the forecasting period, and the null hypothesis of independent hits has to be rejected on any significance level. The latter is true for the rearranged DKLL model, too, although the p-value is slightly

5 APPLICATION TO STOCK INDEX RETURNS

20

in-sample (%) out-of-sample (%) DQ p-value

DAX
DKLL orig. 0.804 1.2 0.00014

DKLL rearr. 0.804 1.2 0.00014

FTSE
DKLL orig. 0.900 0.4 0.10

DKLL rearr. 0.940 0.5 0.48

in-sample (%) out-of-sample (%) DQ p-value

EuroSTOXX
DKLL orig. 0.807 0.5 0.53

DKLL rearr. 0.830 0.5 0.53

S&P500
DKLL orig. 0.945 0.3 0.012

DKLL rearr. 0.945 0.3 0.012

Table 5.2: DQ test results for original and rearranged DKLL models as well as in-sample and out-of sample share (coverage) of VaR exceedances (in percent).

greater than zero. However, the out-of-sample coverage obtained by the model is close to 1%. Thus, the model fits obtained from the rearranged DKLL estimator are clearly superior to the results from the different CAViaR models.

in-sample (%) out-of-sample (%) DQ p-value

DKLL rearr.
0.804 1.2 0.00014

A.S. CAV.
0.995 5.0 0.0

GARCH CAV.
1.025 5.3 0.0

Table 5.3: DAX: DQ test results as well as in-sample and out-of sample share (coverage) of VaR exceedances (in percent).

5.3 Nonparametric EVT-augmented 0.1% VaR estimates
Following the procedure described in section 3.3, standardized residuals are computed from the rearranged DKLL estimate and the time-varying 0.1% quantile of time series Yt is calculated according to (3.14). For completeness, the results from the EVT-augmented Asymmetric Slope- and GARCH CAViaR specifications are computed as well, following Manganelli and Engle (2001).
Table 5.4 contains both in-sample and out-of-sample share of DAX-VaR exceedances for the four considered models. The choice of DAX is motivated by the fact that forecasts of DAX VaR in the investigated time period seems to be

5 APPLICATION TO STOCK INDEX RETURNS

21

DKLL & EVT DKLL EVT-A.S.-CAV. EVT-GARCH-CAV.

in-sample (%)

0.13 0.09

0.10

0.16

out-of sample (%)

0.1

0

1.4

1.9

Table 5.4: In-sample and out-of sample shares (coverages) of VaR exceedances for 0.1% VaR (in percent).

particularly challenging, as it turned out in section 5.2. Only the DKLL estimator achieved the correct out-of-sample coverage, but the DQ test indicated that it failed to produce a time series of independent VaR exceedances. Table 5.4 shows that the model performances are similar to the results on 1% VaR forecasting: The CAViaR models underestimate VaR. This finding is not surprising, as for computation of the standardized residuals the quantile residuals from the 1% VaR model are used. Therefore, the goodness of fit of the model corresponding to the 'moderate' probability carries over to the extreme quantile. On the other hand, the fractions of VaR exceedances are very close to the underlying probabilities for both pure and EVT-augmented DKLL estimates. This similarity of results is surprising. One would expect more stable results for the EVT-augmented estimates, because only few observations are available in the extreme tails. Due to the shortness of the time horizon, no DQ test p-values are reported.2 In order to assess whether the EVT-augmented DKLL model leads to an improved forecast performance over the basic DKLL model, a small simulation is done where 60000 observations are generated from the ARCH(1) model

Yt = 0.1Yt-1 + 10-7 + 0.3t2-1 ∑ t, t  t(4).
Each model is estimated using the first 10000 observations. Two forecast horizons N =20000 and N =50000 are considered. Table 5.5 contains the results on coverage and DQ test p-values. In case of the shorter forecasting period both models perform similarly, but the p-value obtained for the extended forecast horizon clearly indicates that the EVT-augmented DKLL estimator describes the extreme conditional VaR more accurately than the basic DKLL estimator.
2In case of the DKLL estimate, no exceedances are achieved, so that there is no variation in one column of the regressor matrix, and the p-value is not defined.

6 CONCLUSION

22

In-sample Out-of sample DQ p-value

N =20000
DKLL & EVT
0.11 0.115 0.0000088

DKLL
0.1 0.125 0.000002

N =50000
DKLL & EVT
0.08 0.08 0.85

DKLL
0.1 0.12 7.3 ∑ 10-12

Table 5.5: Backtesting results: 0.1% VaR forecasts for simulated time series (in percent). N corresponds to the number of forecast periods.

Thus, it can be concluded that the combination of standardized nonparametric residuals and extreme value theory forms a solid alternative to estimate extreme VaRs. The method is therefore a valuable complement to the rearranged DKLL estimator which we suggest to use for quantiles corresponding to moderately low probabilities such as p = 0.01.

6 Conclusion
In this paper, we propose a way to nonparametrically estimate conditional Value at Risk that is associated with very small probabilities such as p = 0.01 and p = 0.001. A rearranged Double Kernel Local Linear VaR estimator as well as a version of the latter augmented by extreme value theory are investigated and applied to index return time series. Forecasts are benchmarked against the widely used CAViaR models. In terms of generating a conditionally independent sequence of VaR exceedances over the forecasting period, the performance of all considered CAViaR models is poor, while the rearranged DKLL estimates performs well. Furthermore, refining nonparametric quantile regression by extreme value theory yields promising results.

REFERENCES

23

References
Balkema, A. A. and L. de Haan (1974). Residual life time at great age. The Annals of Probability 2, 792≠804.
Cai, Z. (2002). Regression quantiles for time series. Econometric Theory 18, 169≠ 192.
Cai, Z. and X. Wang (2008). Nonparametric estimation of conditional var and expected shortfall. Journal of Econometrics 147, 120≠130.
Cai, Z. and X. Xu (2008). Nonparametric quantile estimations for dynamic smooth coefficient models. Journal of the American Statistical Association 103, 1595≠1608.
Chen, S. X. and C. Y. Tang (2005). Nonparametric inference of value-at-risk for dependent financial returns. Journal of Financial Econometrics 3, 227≠255.
Chernozhukov, V., I. Fernandez-Val, and A. Galichon (2009a). Improving point and interval estimates of monotone functions by rearrangement. Biometrika 96, 559≠575.
Chernozhukov, V., I. Fernandez-Val, and A. Galichon (2009b). Quantile and probability curves without crossing. Econometrica (forthcoming).
Chernozhukov, V. and L. Umantsev (2001). Conditional value-at-risk: Aspects of modelling and estimation. Empirical Economics 26, 271≠292.
Embrechts, P., C. Kl¸ppelberg, and T. Mikosch (1997). Modelling Extremal Events. Springer.
Engle, R. F. and S. Manganelli (2004). Caviar: Conditional autoregressive value at risk by regression quantiles. Journal of Business & Economic Statistics 22, 367≠381.
Fan, J. and I. Gijbels (1996). Local Polynomial Modelling and Its Applications. Monographs on Statistics and Applied Probability 66. Chapman & Hall.
Koenker, R. and G. Bassett (1978). Regression quantiles. Econometrica 46, 33≠50.

REFERENCES

24

Koenker, R. and Q. Zhao (1996). Conditional quantile estimation and inference for arch models. Econometric Theory 12, 793≠813.
Kuester, K., S. Mittnik, and M. S. Paolella (2006). Value-at-risk prediction: A comparison of alternative strategies. Journal of Financial Econometrics 4, 53≠ 89.
Li, Q. and J. S. Racine (2007). Nonparametric Econometrics. Princeton University Press.
Manganelli, S. and R. F. Engle (2001). Value at risk models in finance. ECB Working Paper Series Working Paper No. 75.
McNeil, A. and R. Frey (2000). Estimation of tail-related risk measures for heteroscadastic financial time series: an extreme value approach. Journal of Empirical Finance 7, 271≠300.
Nieto, M. R. and E. Ruiz (2008). Measuring financial risk: Comparison of alternative procedures to measure var and es. Universidad Carlos III de Madrid Working Paper No. 08-73.
Pickands, J. (1975). Statistical inference using extreme order statistics. The Annals of Statistics 3, 119≠131.
Smith, R. L. (1987). Estimating the tails of probability distributions. The Annals of Statistics 15, 1174≠1207.
Taylor, J. W. (2008). Using exponentially weighted quantile regression to estimate value at risk and expected shortfall. Journal of Financial Econometrics 6, 382≠406.
Wu, W. B., K. Yu, and G. Mitra (2007). Kernel conditional quantile estimation for stationary processes with application to value at risk. Journal of Financial Econometrics, 1≠18.
Yu, K. and M. Jones (1997). A comparison of local constant and local linear regression quantile estimators. Computational Statistics and Data Analysis 25, 159≠166.

REFERENCES

25

Yu, K. and M. C. Jones (1998). Local linear quantile regression. Journal of the American Statistical Association 93, 228≠237.

SFB 649 Discussion Paper Series 2010
For a complete list of Discussion Papers published by the SFB 649, please visit http://sfb649.wiwi.hu-berlin.de.
001 "Volatility Investing with Variance Swaps" by Wolfgang Karl H‰rdle and Elena Silyakova, January 2010.
002 "Partial Linear Quantile Regression and Bootstrap Confidence Bands" by Wolfgang Karl H‰rdle, Ya'acov Ritov and Song Song, January 2010.
003 "Uniform confidence bands for pricing kernels" by Wolfgang Karl H‰rdle, Yarema Okhrin and Weining Wang, January 2010.
004 "Bayesian Inference in a Stochastic Volatility Nelson-Siegel Model" by Nikolaus Hautsch and Fuyu Yang, January 2010.
005 "The Impact of Macroeconomic News on Quote Adjustments, Noise, and Informational Volatility" by Nikolaus Hautsch, Dieter Hess and David Veredas, January 2010.
006 "Bayesian Estimation and Model Selection in the Generalised Stochastic Unit Root Model" by Fuyu Yang and Roberto Leon-Gonzalez, January 2010.
007 "Two-sided Certification: The market for Rating Agencies" by Erik R. Fasten and Dirk Hofmann, January 2010.
008 "Characterising Equilibrium Selection in Global Games with Strategic Complementarities" by Christian Basteck, Tijmen R. Daniels and Frank Heinemann, January 2010.
009 "Predicting extreme VaR: Nonparametric quantile regression with refinements from extreme value theory" by Julia Schaumburg, February 2010.

