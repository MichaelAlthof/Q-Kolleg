BERLIN

SFB 6 4 9 E C O N O M I C R I S K

SFB 649 Discussion Paper 2016-032
Specification Testing in Nonparametric
Instrumental Quantile Regression
Christoph Breunig*
* Humboldt-Universit‰t zu Berlin,, Germany This research was supported by the Deutsche Forschungsgemeinschaft through the SFB 649 "Economic Risk".
http://sfb649.wiwi.hu-berlin.de ISSN 1860-5664
SFB 649, Humboldt-Universit‰t zu Berlin Spandauer Straﬂe 1, D-10178 Berlin

Specification Testing in Nonparametric Instrumental Quantile Regression 
Christoph Breunig
Humboldt-Universit®at zu Berlin
August 27, 2016
There are many environments in econometrics which require nonseparable modeling of a structural disturbance. In a nonseparable model, key conditions are validity of instrumental variables and monotonicity of the model in a scalar unobservable. Under these conditions the nonseparable model is equivalent to an instrumental quantile regression model. A failure of the key conditions, however, makes instrumental quantile regression potentially inconsistent. This paper develops a methodology for testing the hypothesis whether the instrumental quantile regression model is correctly specified. Our test statistic is asymptotically normally distributed under correct specification and consistent against any alternative model. In addition, test statistics to justify model simplification are established. Finite sample properties are examined in a Monte Carlo study and an empirical illustration.
Keywords: Nonparametric quantile regression, instrumental variable, specification test, local alternative, nonlinear inverse problem.
1. Introduction
Regression models that involve instrumental variables are widely used in economics to overcome endogeneity problems. In these models, assuming additive separable structural disturbances can often not be justified by the data. This is why their nonseparable extension has been studied extensively recently. Under certain key conditions the nonseparable model is
This paper derives from my doctoral dissertation, completed under the guidance of Enno Mammen. I would like to thank Liangjun Su and three anonymous referees for excellent comments and suggestions that greatly improved the paper. I also thank seminar participants at Boston College, Bristol, Mannheim, Toulouse School of Economics, University College London, WIAS Berlin, and Yale. This work was supported by the DFG-SNF research group FOR916. I am also grateful for support and hospitality of the Cowles Foundation.
Department of Economics, Humboldt-Universita®t zu Berlin, Spandauer Straﬂe 1, 10178 Berlin, Germany, e-mail: christoph.breunig@hu-berlin.de
1

equivalent to an instrumental quantile regression model. Key conditions are validity of instruments and monotonicity of the model in a scalar unobservable. If one of these conditions is violated, however, the quantile regression representation is misspecified. In this paper, we propose a specification test of the instrumental quantile regression model

Y = (Z, q) + U (q) where P(U (q) 0|W ) = q

(1.1)

for each 0 < q < 1, where Y is a scalar dependent variable, Z a vector of potentially endogenous regressors, W a vector of instruments, and U (q) an unobservable disturbance.1 This quantile regression model is equivalent to a nonseparable model (cf. Horowitz and Lee [2007]) given by

Y = (Z, V )

(1.2)

with

(a.1) the instrumental variable W is independent of V ,

(a.2) the function  is strictly monotonic increasing in the scalar disturbance V , and (a.3) V  U(0, 1).

Condition (a.3) can be assumed without loss of generality if V is continuously distributed with positive density on its support which we assume to hold true throughout the paper. The quantile regression model (1.1) for all 0 < q < 1 is thus misspecified if in its nonseperable version (1.2) the instrument is not valid, that is, W is not independent of V , or the function  is not monotonic in V . Specification testing in instrumental variable models is a subject of considerable literature. In the context of nonparametric instrumental mean regression Y = g(Z) + U with E[U |W ] = 0, tests for correct specification have been proposed by Gagliardini and Scaillet [2007], Horowitz [2012], and Breunig [2015]. These tests are, however, not robust against potential nonseparability of the structural disturbance. On the other hand, by considering the nonseparable model (1.2) with conditions (a.1)≠(a.3) not only a failure of the exclusion restriction of the instruments might lead to a misspecified model. Indeed, as argued by Hoderlein and Mammen [2007], in certain applications, such as consumer demand, the monotonicity restriction (a.2) might be highly unrealistic. As such, providing a specification test of model (1.2) together with conditions (a.1)≠(a.3) seems paramount but, as far as we know, has not yet been addressed in the literature. Research on identification and estimation in nonparametric instrumental quantile regression has been active in the last decade. Chesher [2003] investigated nonparametric identification of derivatives of the unknown functions in a triangular array structure. Chernozhukov and Hansen [2005] and Chernozhukov et al. [2007] give identification conditions and develop a nonparametric minimum distance estimator. Sufficient conditions for local identification are given by Chen et al. [2014]. Horowitz and Lee [2007] propose an estimator based on Tikhonov regularization, Chen and Pouzo [2012] study penalized sieve minimum distance estimator, and Dunker et al. [2013] consider an iteratively regularized Gauﬂ-Newton method. Further, Gagliardini and Scaillet [2012] obtain asymptotic distribution results of a Tikhonov
1Since conditional expectations are defined only up to equality a.s., all (in)equalities with conditional expectations and/or random variables are understood as (in)equalities a.s., even if we do not say so explicitly.

2

regularized estimator. There is also a large literature on testing quantile regression models with exogenous covariates. In this context particularly relevant is quantile regression testing using an infinite number of quantiles for parametric functions, see Escanciano and Velasco [2010] and, in the nonparametric context, Escanciano and Goh [2014]. In instrumental quantile regression (1.1) for a fixed quantile 0 < q < 1, Horowitz and Lee [2009] established a test of parametric specification of . Chen and Pouzo [2015] consider functionals of semi/nonparametric conditional moment restrictions with possibly nonsmooth generalized residuals. A test of monotonicity in unobservables of  has been proposed by Hoderlein et al. [2011] but requires conditional exogeneity of Z and hence, is not related to instrumental variables methodology. Recently and independently of this paper, F`eve et al. [2012] developed a test of whether Z is independent of the nonseparable disturbance V in the model (1.2). Our test statistic is based on the L2≠norm of the empirical conditional quantile restriction and involves sieve methodology. The sieve approach makes the statistic easy to implement and further, is convenient to impose additional constraints on the structural function . As an example, we discuss a test of additivity of  with respect to the vector of regressors Z. In addition, we establish a test statistic for testing exogeneity which is robust against nonseparability. More precisely, we establish a test of exogeneity of the regressors Z at some quantile 0 < q < 1, that is, whether P(Y (Z, q)|Z) = q. This extends the results on nonparametric test of exogeneity in mean regression suggested by Blundell and Horowitz [2007] and Breunig [2015] to the quantile regression case. It should also be noted that the test proposed in this paper is a joint test of monotonicity and instrument validity. This is the nature of many nonparametric tests, see, for instance, Chiappori et al. [2015] or Lewbel et al. [2015]. On the other hand, we show in this paper that if the quantile restriction is strictly negative then validity of the instrumental variables fails. As such, in many cases it is possible to detect the cause of a rejection of our test. We establish the asymptotic distribution of our test statistic under the null hypothesis and its consistency against fixed alternatives. We study the power of our test against a sequence of local alternatives. By Monte Carlo simulations we demonstrate the power properties of our test in finite samples. As an empirical illustration, we study a nonseparable model of the effects of class size on test scores of 4th grade students in Israel. We reject the hypothesis of exogeneity of class size but fail to reject the instrumental variable model. The remainder of this work is organized as follows. In Section 2, we propose a test statistic and obtain its asymptotic distribution. We further establish consistency of our test. The power of the test is judged by considering a sequence of local alternatives. Section 3 gives several extensions of the previous results. In Section 4 and 5 we study the finite sample properties of our test and give an empirical illustration. All proofs can be found in the appendix.
2. The test statistic and its asymptotic properties
This section begins with the definition of the test statistic and states assumptions required to obtain its asymptotic distribution under the null hypothesis. Moreover, we study power and consistency properties of our test.
3

2.1. Definition of the test statistic

The quantile regression model (1.1) leads to a nonlinear operator equation, as we see in the

following. Let  be a Banach space endowed with the norm  Z,p := (E |(Z)|p)1/p for some

integer p > 0 and if p =  then  Z, := supz |(z)|. For simplicity let  Z :=  Z,2.

Further, let us introduce the Hilbert space LW2 := { :



2 W

:= E |(W )|2

< }.

We

define a nonlinear operator T :   L2W with

T  := E[1 {Y (Z)}|W ]

(2.1)

for any    where 1 denotes the indicator function. Thereby, model (1.1) can be rewritten
as the operator equation T q = q with q(∑) := (∑, q) for all 0 < q < 1. In many economic applications, for instance when estimating a demand function or Engel
curves, the structural function of interest may be assumed to be smooth. This a priori knowledge is captured by a set B   which we introduce below. The set B may also contain
constraints on the function q such as monotonicity, concavity/convexity or additivity (see also Section 3.2). Let us introduce the set B(0,1) = { : (∑, q)  B for all q  (0, 1)}. We
consider the null hypothesis

H0 : there exists a function   B(0,1) such that T q = q for all q  (0, 1).

(2.2)

The alternative is that there exists no function   B(0,1) solving T q = q for all q  (0, 1). We construct in the following a test statistic based on the L2 distance. Throughout the
paper, we assume that an independent and identically distributed n-sample of (Y, Z, W ) is available. Let {fj}j 1 be a sequence of approximating functions in LW2 . Then, for any integer k 1 we denote fk(∑) = (f1(∑), . . . , fk(∑))t and Wk = fk(W1), . . . , fk(Wn) t which
is a n ◊ k matrix. A series least square estimator of E[1 {Y (Z)} - q|W = ∑] then writes

n
fln (∑)t(Wltn Wln )- (1 {Yi
i=1

(Zi)} - q)fln(Wi)

where (∑)- denotes a general inverse. Further, we define the sieve least square estimator of q by

n

qn = arg min

(1 {Yi

Bkn

i=1

(Zi )}-q)fln (Wi )

t(Wltn Wln )-

n
(1 {Yi

i=1

(Zi )}-q)fln (Wi ) (2.3)

where Bkn is a kn≠dimensional sieve space that becomes dense in B as the sample size n tends to infinity. If B contains additional constraints then these are imposed in Bkn on the finite dimensional functions. Here, kn and ln grow with sample size n. Clearly, kn ln for each n is required and in our simulations we choose ln = Ckn for some constant C > 1 (see also Chen and Christensen [2015] in case of nonparametric instrumental mean regression).
The estimator qn is a simplified version of the penalized sieve minimum distance estimator suggested by Chen and Pouzo [2012].
The test statistic is then given by

1n

Sn =

(1 {Yi

0 i=1

qn(Zi)}-q)fmn (Wi)

t(Wmt n Wmn )-

n
(1 {Yi

i=1

qn(Zi)}-q)fmn (Wi)dq

4

(2.4)
where mn grows with sample size n. As the test is one sided, we reject the null hypothesis at level  when the standardized version of Sn is larger than the (1 - )≠quantile of N (0, 1). The asymptotic distribution of Sn is derived below under mild restrictions on the dimension parameters kn, ln, and mn. We require that the number of unconditional moment restrictions determined by mn is asymptotically larger than the dimension of the sieve space Bkn. This corresponds to the test of overidentifying restrictions in parametric models. In contrast to the parametric setting, however, also the number of unconditional moment restrictions used to construct the estimator (determined by ln) must be asymptotically smaller than the number of moment restrictions used for the test statistic. This ensures that the estimation error in the test statistic becomes asymptotically negligible as we see below. Our test statistic builds on the nonparametric specification test in instrumental mean regression suggested by Breunig [2015]. Testing in instrumental quantile regression, on the other hand, requires a different methodology. First, the test statistic is a discontinuous function of the unknown structural effect q. Second, instrumental quantile regression leads a nonlinear inverse problem and hence estimation of q is more challenging. Third, to verify the conditional moment restrictions for all quantiles we need to integrate over them. In the appendix, we show that the mapping q  q is continuous under mild assumptions. This justifies the use of our L2 type testing procedure rather than a sup norm statistic.

2.2. Assumptions and notation.

In order to obtain our asymptotic result we state the following assumptions. Our first assumption gathers conditions which we require for the basis functions {fj}j 1. In the following, the supports Z of Z and W of W are assumed to be bounded below. The probability density function (p.d.f.) of W , denoted by pW , is assumed to be uniformly bounded from above and away from zero.
Assumption 1. (i) There exists a constant C > 0 and a sequence of positive integers (mn)n 1 satisfying supwW fmn(w) 2 Cmn. (ii) The smallest eigenvalue of the matrix E[fm(W )fm(W )t] is bounded away from zero uniformly in m.
Assumption 1 (i) holds for sufficiently large C if the basis {fj}j 1 is satisfied by trigonometric basis functions, B-splines, or wavelets. In the following, for any   B(0,1) we denote q(∑) := (∑, q) for all 0 < q < 1. In the following, we denote the Fr¥echet derivative of T at q by

Tq := E pY |Z,W (Z, q), Z, W (Z) W

where pY |Z,W denotes the density of Y conditional on (Z, W ). In the following, we denote

 Z,p =

1 0

(∑, q) pZ,pdq 1/p and

 W=

1 0

(∑, q)

2 W

dq

1/2

for

functions

(∑, q)



 and (∑, q)  L2W for all q  (0, 1).

Assumption 2. (i) If

T-T

2 W

=

0

for

some

function





B(0,1)

then

it

holds

-



2 Z,p

=

0.

(ii) There exists some constant 0 <  < 1 such that for all 0 < q < 1 and all

functions   {  B :  - q Z,p } for some  > 0 it holds

T  - T q - Tq( - q) W  Tq( - q) W .

(2.5)

Assumption 2 (i) ensures identification of q for almost all 0 < q < 1 on the set B which we introduce below. Assumption 2 (ii) specifies an upper bound on the Taylor remainder

5

of T in a small neighborhood around q. It is also known as the tangential cone condition and frequently used in the analysis of nonlinear operator equations (cf. Hanke et al. [1995] or Dunker et al. [2013] in case of instrumental variable estimation). We provide sufficient conditions for the tangential cone condition in Example 2.1 below and refer to Chen et al. [2014] for further discussions.
Assumption 3. There exists a sequence (rn)n 1 with rn = o(1) such that for constants C > 0 and   (0, 1] it holds

max E
1 j mn

1
sup 1{Y
0 Bn

(Z, q)} - 1{Y

(Z, q)} 2dq fj2(W )

C rn2

(2.6)

where Bn := {  B(0,1) :

-

2 Z,p

rn2 }.

Assumption 3 states that the function q  (1{Y (Z, q)} - q)fj(W ), 1 j mn,

is locally uniformly L2W continuous for almost all 0 < q < 1. This condition has also

been exploited by Chen et al. [2003] (Theorem 3), Chen [2007] (Lemma 4.2 (i)) or Chen

and Pouzo [2012] (Remark c.1). Example 2.2 below gives primitive conditions under which

Assumption 3 holds true.

Let Z have support Z  Rdz and for any vector of nonnegative integers k = (k1, . . . , kdz )

define |k| =

dz j=1

kj

and Dk

= |k|/(z1k1 . . . zdkzdz ).

For

some

integer

p > 0 we define the

norms

 ,p =

Dk(z) pdz

1/p
,

|k| +0 Z

 , = max sup Dk(z)
|k|  zZ

where  and 0 are positive integers. We denote the Sobolev spaces associated with the norm ∑ ,p by

W ,p := { : Z  R :  ,p < }.

(2.7)

For some constant  > 0, define B as the Sobolev ellipsoid of radius  given by

B := {  W ,p :  ,p }.

(2.8)

As such, the set of structural functions B is compact and thus, penalization is not necessary for consistent estimation (see also Chen and Pouzo [2012]). Also additional constraints such as monotonicity can be imposed by B = {  W ,p :  ,p , infzZ  (z) > 0} for scalar z. Such a monotonicty constraint does not necessarily lead to faster rates of convergence, in contrast to an additivity restriction on q. Consequently, we do not treat shape restrictions like monotonicty explicitly but only discuss a test of additivity in Section 3.2. In this context, we also refer to Chetverikov and Wilhelm [2015] for using shape restriction for sieve estimation in instrumental mean regression. The following assumption gathers regularity conditions imposed on the structural functions  and the supports Z of Z and W of W .
Assumption 4. (i) Let 0 > dz/p and  > dz/. (ii) Z is bounded, convex and satisfies a uniform cone property. (iii) W is bounded. (iv) The marginal density of W, denoted by pW , is bounded from above and uniformly bounded away from zero on W. (v) pY |Z,W (∑, Z, W ) is bounded from above.

6

Assumption 4 (i) requires  to be large if (2.6) holds only for small  > 0 or the dimension dz is large. Assumption 4 (ii) imposes a weak regularity condition on the shape of Z. For the
uniform cone property see, for instance, Paragraph 4.4 in Adams and Fournier [2003]. This
property was also used by Santos [2012]. Assumption 4 (v) ensures that Tq W C  Z for all   L2Z and some constant C > 0.

Example 2.1. Let  coincide with the Hilbert space L2Z := { :  Z < }. If for any

0 < q < 1 the operator by {ej}j 1 satisfying

Tq is Tq 

compact then there exists an

2 W

=

 j=1

s2qj

E[(Z )ej (Z )]2

orthonormal basis in LZ2 where (sqj)j 1 are the

denoted singular

values of Tq. If





 B  Bsource,q :=   L2Z :

s-qj2

E[((Z )

-

(Z,

q))ej (Z )]2

<

 c0

 j=1



for some constant c0 > 0 then under mild assumptions on the joint distribution of (Y, Z, W ) function q is identified on B (cf. Theorem 6 of Chen et al. [2014]). A similar restriction was also imposed by Horowitz and Lee [2007]. If B  q(0,1) Bsource,q then Assumption 2 (i) holds true. Under further assumptions, imposing bounds on the generalized Fourier
coefficients is equivalent to imposing smoothness restrictions. In this sense, Bsource,q links the smoothness of  - q to the degree of ill-posedness determined by the degree of decay of (sqj)j 1, which is also known as a so-called source condition (cf. Chen and Reiﬂ [2011] or Dunker et al. [2013] for a further discussion).
Under the singular value decomposition of Tq it is also possible to provide primitive conditions for the tangential cone condition (2.5). Assume that the conditional p.d.f. of Y given
(Z, W ), denoted by pY |Z,W , is continuously differentiable with |pY |Z,W (∑, Z, W )/y| c1 and the conditional p.d.f. of Z given W satisfies pZ|W (∑, W ) c2pZ(∑), for some constants c1, c2 > 0. Then by Theorem 6 of Chen et al. [2014] it holds

T  - T q - Tq( - q) W

c1 c2

 - q

2 Z

.

(2.9)

We further obtain for all   Bsource,q by making use of the Cauchy-Schwarz inequality

-q

2 Z

=

 j=1

sqj sqj

E[((Z )

-

(Z, q))ej(Z)]2

 sq-j2 E[((Z) - (Z, q))ej(Z)]2 1/2
j=1

c10/2 Tq( - q) W .

 s2qj E[((Z) - (Z, q))ej(Z)]2 1/2
j=1

Consequently, the tangential cone condition (2.5) is satisfied if we assume c01/2 c1 c2 < 1. We also note that for our test of exogeneity in Section 3.1 only the weaker condition (2.9)
is required.

Example 2.2. Let FY |ZW denote the cumulative distribution function of Y given (Z, W ) and assume that it is Lipschitz continuous with constant CL > 0, that is, |FY |ZW (y) - FY |ZW (y )| CL|y - y | for all (y, y ). Due to Assumption 4 the Sobolev space W ,p can be embedded in W , (cf. Theorem 6 of Adams and Fournier [2003]). In particular,
the supremum norm is bounded on B and moreover, Assumption 3 holds true. Indeed,

7

1 0

q - q

2dq

rn2 implies q - q 

c rn for almost all 0 < q < 1 and some

constant c > 0. Hence, (Z, q) - c rn (Z, q) (Z, q) + c rn for almost all 0 < q < 1

and following Chen et al. [2003] (page 1599 ≠ 1600) we observe

1
E max 1{Y (Z, q)} - 1{Y (Z, q)} 2dq W 0 Bn
1
E 1 Y (Z, q) + c rn - 1 Y (Z, q) - c rn W dq
0 1
= E FY |ZW (Z, q) + c rn - FY |ZW (Z, q) - c rn W dq
0
CL c rn

which implies Assumption 3 with  = 1/2.

Notation For any   B we introduce a finite dimensional function kn  Bkn satisfying kn -  Z,p = o(1). Further, we define

n = max n-1ln, max E[(T (W ) - q)fj(W )]2,
Bkn j>ln

T∑(kn  - )

2 W

.

Following Chen and Pouzo [2012] we introduce the sieve measure of local ill-posedness by

kn

:=

max
Akn

-

2 Z,p

T∑( - )

2 W

where Akn =

  Bk(0n,1) :

T∑( - )

2 W

>

0

.

We write an  bn when there exist con-

stants c, c > 0 such that cbn an c bn for sufficiently large n.

2.3. Asymptotic distribution under the null hypothesis

The following theorem establishes asymptotic normality of the test statistic Sn after standardization under the null hypothesis H0.
Theorem 2.1. Let Assumptions 1≠4 be satisfied. Assume that

mn-1 = o(1), mn = o(n1/2)

(2.10)

and in addition 
nn = o( mn) and

kn  - 

2 Z,p

+kn n

=o

m-n (1+ )/

(2.11)

for some > 0. Then we have under H0

3 5/mn Sn - mn/6 d N (0, 1).

To motivate the constants in the asymptotic mean and variance, respectively, we observe

11
E[(1{Y (Z, q)} - q)2|W ]dq = q(1 - q)dq = 1/6
00

8

and

1
E[(1 {Y
0

(Z, q)} - q)(1 Y

(Z, q ) - q )|W ]d(q, q )
1 = 2 (min(q, q ) - qq )2d(q, q ) = 1/(3 5),
0

see also the proof of Lemma A.3. The required rate imposed in (2.10) on mn is milder than the rate requirement mn = o(n1/3) imposed by Breunig [2015] in case nonparametric
instrumental mean regression. This is due to the fact that in the latter case we do not

have a lower bound for the asymptotic variance in general, while in case of quantile regression the asymptotic variance formula is mn within a positive constant. This can be exploited to weaken rate restrictions on mn. Further, note that restriction (2.11) implies kn = o( mn) (by using that ln kn). This requirement essentially determines the degree of overidentification required for inference.

In the following, we want to illustrate that condition (2.11) is satisfied under common

smoothness restrictions on  and mapping requirements of the Fr¥echet derivative Tq.

Remark 2.1. Consider the Hilbert space case  = L2Z and let {ej}j 1 be an orthonormal

basis in L2Z . In this case, kn =

kn j=1

E[(Z

)ej

(Z

)]ej

.

Let us assume

the

following two

conditions.

(i) Sieve Approximation Error: kn -  Z = O(kn-/dz ) for all   B.

(ii) Link condition:

1 0

Tq(kn  - )

2 W

dq

j 1 j E[(kn - )(Z)ej(Z)]2 for all

  B and some positive nonincreasing sequence (j)j 1.

If the p.d.f. pZ of Z  [0, 1]dz is bounded then it is well known that the sieve approximation

error condition holds for splines, wavelets, and Fourier series bases. Due to Assumption

4 (v) the link condition is always satisfied with j = 1 for all j 1. The link condition

implies an upper bound for the sieve measure of ill-posedness; that is, kn Ckn for some constant C > 0 and all n 1 (cf. Lemma B.2 of Chen and Pouzo [2012]). Consequently,

the first part of condition (2.11) simplifies to

max ln, n ln-2/dw , nkn kn-2/dz

 = o( mn)

if {T  :   Bkn} belongs to a Ho®lder space with H®older parameter . In addition, in the setting of Example 2.2, the second part of condition (2.11) simplifies to

m1n+ max n-1ln, ln-2/dw , kn-2/dz = o(1)

for some > 0.

In the following example, we illustrate different mapping properties of the operator Tq which are usually studied in the literature.

Example 2.3. Consider the Hilbert space setting of Remark 2.1 with conditions (i) and (ii).

In addition assume that the reverse link condition

1 0

Tq 

2 W

dq

c

j 1 j E[(Z)ej(Z)]2

for   B and some constant c > 0 is satisfied. In the setting of Example 2.1, we have

1 0

sq2j

dq

>

j

for

all

j

1 implying that Tq is nonsingular for almost all 0 < q < 1 (since

any countable union of null sets is null). For simplicity, let Z and W be scalars. Further,

let max n-1ln, ln-2  n-1kn and kn  n for some constant  > 0 which is specified in

the following two cases.

9

(i) Mildly ill-posed case: If kn  kn-2 for some  0 then in order for (2.11) to hold we require mn  n with 0 <  < 1/3 and

(1 - /2)/(2 + 2) <  < /2.

Further,

1 0

kn q - q

2 Z

dq

+

kn n

=

O(kn-2

+ kn2+1n-1)

which

is

o(m-n 2/)

if

/() <  < (1 - 2/)/(2 + 1). Thus, condition (2.11) is satisfied if

max (1 - /2)/(2 + 2), /() <  < min /2, (1 - 2/)/(2 + 1) .

(ii) Severely ill-posed case: If kn  exp

- kn2

for some  > 0 then

1 0

kn q -

q

2 Z

dq

+

kn n

=

O(kn-2

+

exp(kn2 )knn-1).

Thereby, condition (2.11) is satisfied if,

for example, mn = o (log n)/ and kn  (log n)1/ .

In both situations we conclude that the dimension parameter mn is required to be larger than the dimension kn of the sieve space for n sufficiently large. Roughly speaking we require more moment restrictions implied by the instrument than parameters we want to
estimate. This corresponds to the test of overidentification in the parametric framework.

In contrast to a test integrated over all quantiles, one might be interested to check model (1.1) for one specific quantile. In this case, we consider the test statistic

n

Sn(q) =

(1 {Yi

i=1

qn(Zi)}-q)fmn (Wi)

t(Wmt n Wmn )-

n
(1 {Yi

i=1

qn(Zi)}-q)fmn (Wi) (2.12)

If Sn(q) becomes too large then we reject, in particular, the null hypothesis H0. The derivation of the asymptotic behavior of Sn(q) is similar as in Theorem 2.1. Indeed, only the Lebesgue measure over (0, 1) has to be replaced by the Dirac measure which has its mass at the quantile of interest.
Corollary 2.2. Let Assumptions 1 and 4 be satisfied. Further, let Assumption 2, 3, and condition (2.10) and (2.11) hold true for a fixed quantile q  (0, 1). If there exists a function q  B with T q = q then

(2mn)-1/2

q(1

1 -

q)

Sn(q)

-

mn

d N (0, 1).

In addition, one might be interested in certain regions of quantile functions. Let µ denote any measure on (0, 1). Again, the next result is a direct implication of Theorem 2.1 and hence we omit its proof.
Corollary 2.3. Let Assumptions 1 and 4 be satisfied. Further, let Assumption 2, 3, and condition (2.10) and (2.11) hold true. If there exists a function   B with |T q - q|dµ(q) = 0 then

2mn

1
(min(q, q )-qq )2dµ(q)dµ(q )

-1/2

11
Sn(q)dµ(q)-mn q(1-q)dµ(q) d N (0, 1).

0 00

As mentioned in the introduction, our test is joint test of instrument validity and monotonicity of  in its second entry. The following remark illustrates how the test statistic Sn(q) integrated over a subset of (0, 1) can be useful to detect which kind of deviation exists.

10

Remark 2.2 (Detecting the Kind of Deviation). Suppose that the structural function is strictly monotonically increasing in its second entry for values q  (0, q ) given some q  (0, 1) (can be checked using Corollary 2.3). Further, let q  (∑, q) be either nonincreasing or decreasing on (q , q ). This can be assured by letting q close to q and assuming that  does not oscillate for q q . If W is a valid instrument, employing model equation (1.2) and V  U(0, 1) yields
P(Y (Z, q)|W ) = P((Z, V ) (Z, q)|W ) P(V q|W )
=q
for all q q and q sufficiently close to q . The last inequality holds regardless whether the function q  (∑, q) is strictly monotone or not. Consequently, if infwW P(Y (Z, q)|W = w) > q for some q  (q , q ) we may conclude that W is not a valid instrument. The analysis of a one sided test based on this inequality lies beyond the scope of this paper. On the other hand, we can check the kind of deviation by using the estimator
infwW fmn(w)t n-1 ni=1(1 {Yi qn(Zi)} - q)fmn(Wi) . Further, confidence statements
can be achieved by using resampling methods.

2.4. Consistency against a fixed alternative

Let us first establish consistency when H0 does not hold, that is, there exists no function  belonging to B(0,1) which solves T q = q for all 0 < q < 1. The following proposition
shows that our test has the ability to reject a false null hypothesis with probability 1 as the

sample size grows to infinity. In the following analysis of the asymptotic power of our testing

procedure we let q = arg minB

T  - q W . So if H0 is false then

1 0

T q - q

2 W

dq

>

0

since pW is uniformly bounded from below.

Proposition 2.4. Assume that H0 does not hold. Let Assumptions 1≠4 be satisfied. Consider a sequence (n)n 1 satisfying n = o(n/ mn). If conditions (2.10) and (2.11) hold we have

P 3 5/mn Sn - mn/6 > n = 1 + o(1).

2.5. Limiting behavior under local alternatives

In the following, we study the power of the test, that is, the probability to reject a false

hypothesis against a sequence of linear local alternatives that tends to zero as the sample

size tends to infinity. We proceed similarly as Ait-Sahalia et al. [2001] (Section 3.3). More

precisely, let

T q

2 W

dq

=

(qn)n 1 o( mn)

be a sequence of (nonstochastic) where q = arg minB T  - q

functions W . Then

satisfying n we consider

1 0

T qn -

alternative

models defined by qn with

1

T qn - q - nq

2 W

dq

=

o(n2 )

where

n2

=

 mn/(3 5

n).

0

(2.13)

Here, q  L2W is a function satisfying

1 0

q

2 W

dq

>

0.

The next result establishes asymp-

totic normality for the standardized test statistic Sn.

11

Proposition 2.5. Let

and n

1 0

T qn - T q

Assumptions 1≠4

2 W

dq

=

 o( mn).

be satisfied. Assume that (qn)n 1 satisfies (2.13) If conditions (2.10) and (2.11) hold true we have

1

3 5/mn Sn - mn/6 d N

E[q(W )fj(W )]2dq, 1 .

j=1 0

From Proposition 2.5 we see that our test can detect local linear alternatives at the rate n. If {fj}j 1 forms an orthonormal basis in LW2 then n coincides with mn1/4n-1/2 within a constant. Hence, our test has the same power against local linear alternatives as the test
of Hong and White [1995] who consider parametric specification testing.

3. Extensions
As we see in this section, our testing procedure can potentially be applied to a much wider range of situations. We now discuss corollaries that generalize the previous results in different ways. For the following analysis we focus on a fixed quantile q  (0, 1).

3.1. Testing exogeneity

Falsely assuming exogeneity of the regressors leads to inconsistent estimators while on the other hand treating exogenous regressors as if they were endogenous can lower rate of convergence dramatically. In this subsection, we develop a nonparametric test of exogeneity that is robust against possible nonseparability of unobservables. The test statistic is similar to the statistic Sn(q) given in (2.12) but where qn is replaced by an estimator of the quantile function conditional on regressors Z. In contrast to the previous section, we assume that a function q exists such that T q = q. We propose a test whether the vector of regressors Z is exogenous at a quantile q  (0, 1), that is,

H0e : P(Y (Z, q)|Z) = q.

Let us introduce the conditional quantile function qe defined by P(Y qe(Z)|Z) = q. The null hypothesis H0e holds true if and only if q = eq. Further, due to nonsingularity of the operator T , hypothesis H0e is equivalent to

T eq = q.

(3.1)

Our test of exogeneity, which we propose below, is based on this equation or equivalently on
P(Y eq(Z)|W ) = q. More precisely, to test exogeneity we replace in the statistic Sn(q) given in (2.12) the estimator of q by an estimator of qe. Let us now propose an estimator for the conditional quantile function eq. For each k 1 let ek(∑) be a k≠dimensional vector with entries ej(∑) for 1 j k. Let {ej}j 1 be B-spline basis functions. Then an estimator of qe is given by

n

eqn = arg min

q Yi - ekn (Zi)t

Bkn i=1

(3.2)

where q(u) = |u| - (2q - 1)u is the check function and here, Bkn =   B : (∑) =

kn j=1

j

ej

(∑)

.

This estimator was

studied by He

and

Shi [1994].

In the

following,

let

pZ

and pZ|W denote the marginal density of Z and the conditional density of Z given W ,

respectively.

12

Assumption 5. (i) There exists a function q  B such that T q = q. (ii) Z is scalar and continuously distributed with Z  [0, 1] and  = LZ2 . (iii) pZ is bounded from above and uniformly bounded away from zero on Z. (iv) Y - (Z, q) has a density function which is strictly positive at zero. (v) pY |Z,W (∑, Z, W ) is continuously differentiable, |pY |Z,W (∑, Z, W )/y| C and pZ|W (∑, W ) CpZ (∑) for some constant C > 0.
Section 2 provides a test for Assumption 5 (i). For a relaxation of Assumption 5 (ii) see
Remark 3.1 below. Assumption 5 (iii) and (iv) are rather technical. Due to Assumption
5 (v) we do not require Assumption 2 (ii) but can rather rely on an upper bound of the Taylor reminder of T obtained by Chen et al. [2014]. In this sense, the test of exogeneity presented below requires weaker restrictions on the local curvature of T than specification
testing. For a test of the null hypothesis H0e we replace in the definition of Sn(q) given in (2.12) the estimator qn by qen. That is,

n

Sne (q) =

(1{Yi

i=1

qen(Zi)}-q)fmn (Wi)

t(Wmt n Wmn )-

n
(1{Yi

i=1

qen(Zi)}-q)fmn (Wi)

We reject the hypothesis H0e if Sne (q) becomes too large. The next result establishes asymptotic normality of our test statistic Sne (q) under the null hypothesis.

Corollary 3.1. Let Assumptions 1, 2 (i), and 3≠5 hold true. Let mn satisfy condition (2.10). Consider the estimator qen given in (3.2) where kn satisfies

 kn = o( mn),

n=o

kn2r

 mn

,

mn2/kn = o(n) and mn = o knr

(3.3)

where r =  - 1/2. Then we have under H0e

 2mn

-1

q(1

1 -

q)

Sne (q)

-

mn

d N (0, 1).

Example 3.1. Let us illustrate when condition (3.3) holds true. Let mn  n with 0 <  < 1/3. Then for (3.3) to hold let kn  n where  > 0 satisfies

1 - /2  max ,

<  < min

 ,1

-

2

.

2r r

2

Hence, we require r > 2/ which is a slightly stronger restriction than Assumption 4 (i).

Remark 3.1 (Multivariate Extension). Horowitz and Lee [2005] estimate the conditional
quantile function in the case of multivariate Z by assuming an additive quantile regression model. The rate of convergence in probability of the components is n-r/(2r+1) (cf. Theorem
1 in Horowitz and Lee [2005]) which holds independently of the dimension dz and which is the same rate obtain for eqn obtained by He and Shi [1994] in the scalar case. Consequently, under a modification of assumptions our test of exogeneity can be extended to multivariate
additive quantile regression.

3.2. Testing additivity
The test statistic given in (2.4) is also convenient to check additional restrictions on the structural effect q for 0 < q < 1. These additional restrictions can be easily imposed

13

by constraints on the functions of the sieve space Bkn. For instance, one may impose an additive structure of the quantile structural effects.
By assuming an additive structure of q one might reduce the effect of dimensionality of the regressors on the convergence rate of an estimator (cf. Chen and Pouzo [2012] in case of
instrumental quantile regression). Applying this structure leads, however, to inconsistent
estimators in general if the function q does not obey an additive form. Our aim in the following is to test whether

H0add : there exist functions q1, q2  B such that P(Y q1(Z ) + q2(Z )|W ) = q.

Similarly as above we obtain the test statistic

Snadd(q) =

n
(1{Yi
i=1

aqndd(Zi)}-q)fmn (Wi)

t(Wmt n Wmn )-

n
(1{Yi

i=1

aqndd(Zi)}-q)fmn (Wi)

Here the estimator qandd = (q1n, q2n) of q = (1q, q2) is given by (2.3) where the sieve basis is a tensor product of basis functions that depend either on Z or Z . For a more detailed discussion we refer to Section 6 of Chen and Pouzo [2012]. The next asymptotic normality result is a direct consequence of Corollary 2.2 and hence its proof is omitted.
Corollary 3.2. Given the conditions of Corollary 2.2 we have under H0add

 2mn

-1

q(1

1 -

q)

Snadd(q)

-

mn

d N (0, 1).

4. Monte Carlo simulation
In this section, we study the finite-sample performance of our test by presenting the results of a Monte Carlo investigation. The sample size is 1000 and there are 1000 Monte Carlo replications in each experiment. Results are presented for the nominal levels 0.05. Let  denote the cumulative standard normal. Throughout this simulation study, realizations (Z, W ) were generated by Z =   + 1 - 2  and W = () where  is independent of  and ,   N (0, 1). Here, the constant  > 0 determines the degree of correlation between Z and W and is varied in the experiments.

4.1. Testing a Nonparametric Specification
We begin with the finite-sample analysis of our test statistics in case of nonparametric specification testing. To analyze the finite sample power we distinguish in the following between a failure of the null hypothesis caused either by a lack of instrument validity or by non-monotonicity of the structural function in unobservables.

Failure of instrument validity. Under the null hypothesis H0: there exists a differentiable function 1 such that P(Y 1(Z)|W ) = q for all q  (0, 1) we generate realizations of Y from the additive model

Y = 1(Z) + cV V

(4.1)



where V =   + 1 - 2 with independent of  and  N (0, 1). Let us choose

cV = 0.2 and  = 0.7. We further consider the function 1(z) =

 j=1

j-4 cos(jz).

14

1(z)
-1.0 -0.5 0.0 0.5 1.0 1.5
2(z)
0.0 0.2 0.4 0.6 0.8 1.0 1.2 1.4

0.0 0.2 0.4 0.6 0.8 1.0 z

0.0 0.2 0.4 0.6 0.8 1.0 z

Figure 1: Graphs of 1 and 2

For computational reasons we truncate the infinite sum at 100. The resulting function is
displayed in Figure 1. If H0 is false, then P(Y 1(Z)|W ) = q + (W ) for some function . In our experiments, we let (W ) = -P(1(Z) < Y 1(Z) + (Z)|W ) for some function  which we specify below. The definition of  implies P(Y 1(Z) + (Z)|W ) = q. Consequently, when H0 is

Model
H0 true 1 2 3 3
H0 true 1 2 3 3

kn = 4 kn = 5

Empirical Rejection probability with

mn = 25 0.034 0.509 0.776 0.971 0.998

mn = 30 0.024 0.431 0.705 0.961 0.998

mn = 35 0.025 0.379 0.637 0.945 0.997

0.089 0.542 0.601 0.461 0.673

0.083 0.473 0.532 0.422 0.640

0.073 0.405 0.470 0.395 0.607

Table 1: Empirical Rejection probabilities for the standardized test statistic 3 5/mn Sn - mn/6 with varying dimension parameters kn and mn with ln = 2kn.

false we generate realizations of Y from

Y = 1(Z) + j(Z) + cV V

(4.2)

where j(z) = 10 j (z 1{z 0.25} + (z - 1) 1{z > 0.25}) for j = 1, 2 and j(z) = (x/2cj) 1{0.5 - cj z < 0.5 + cj} for j = 3, 4, with c3 = 0.1 and c4 = 0.05. Here, the
disturbance V is generated as in (4.1) and again cV = 0.2. In this sense, we follow Horowitz
[2011] by modeling invalidity of instruments by highly irregular structural functions.

15

For each quantile 0 < q < 1, we estimate the structural function using estimator qn given in (2.3) with B-splines as approximation basis functions. More precisely, for the sieve space Bkn we use B-splines of order 2 with 1 knot or 2 knots (hence kn = 4 or kn = 5) and for the criterion function we use B-splines of order 2 with 5 knots or 7 knots (hence ln = 2kn), respectively. We thus follow Chen and Christensen [2015] and choose ln to be a constant multiple of kn. Also for the vector of basis functions fmn, used to construct the test statistic, we use B-spline basis of order 2 with knots varying between 22, 27 or 32 (hence mn = 25, mn = 30 or mn = 35). We vary among different dimension parameters kn and mn such that the rate requirement from our theory, that is, kn ln = o(mn1/2) and mn = o(n1/2), are approximately satisfied. The empirical rejection probabilities of our standardized test statistic 3 5/mn Sn - mn/6 at nominal level 0.05 are shown in Table 1. As we see from Table 1, our test is less sensitive with respect to the choice of mn than to the choice of kn, which is not surprising and well known from nonparametric instrumental variable estimation problems, see also Chen and Pouzo [2015]. If (4.1) is the true model, a choice of small dimension kn leads to smaller empirical rejection probabilities. The situation is reversed if (4.2) is the true model. This is not surprising, as the discontinuouities in the alternative model require a larger number of knots for our approximating basis functions. As we fixed the dimension parameter ln = 2kn, two dimension parameters remain to be chosen by the econometrician, namely, kn and mn. Intuitively, we want to choose kn such that we have a good model fit, i.e., a small value of test statistic, and mn to have a good power properties, i.e., a large value of the test statistics. This leads a parameter choice for the test statistics via the minimum-maximum principle. That is, if {s(kn, mn)} denotes the standardized value of our test Sn with dimension parameters kn and mn then choose these parameters such that
min max {s(kn, mn)}.
kn<n1/4/2 kn2 <mn<n1/2
Such a rule, however, does not prevent to choose kn to large in the severely ill-posed case. To avoid this, we could calculate the sieve measure of ill-posedness as in Chen and Pouzo [2012].

Failure of monotonicity in unobservables. In the following, we generate Y directly from a nonseparable model of the form Y = (Z, V ). We study the finite sample power of our test when  is not strictly monotonic in the structural disturbance V . Realizations of Y were generated from

Y = (Z + V )V 2 
where V =  0.2(  + 1 - 2 ) with we generate

(4.3)  N (0, 1) and where  = 0.8. When H0 is false

Y = (Z + V )(V - 0.5)2j

(4.4)

or Y = (Z + V )-2j(V )

(4.5)

for j = 1, 2. In the alternative models, the structural disturbance enters the model in a nonmonotonic way. Under the maintained hypothesis, the instrument W was generated as

16

Model
(4.3) (4.4) with j=1 (4.4) with j=2 (4.5) with j=1 (4.5) with j=2
(4.3) (4.4) with j=1 (4.4) with j=2 (4.5) with j=1 (4.5) with j=2

kn = 4 kn = 5

Empirical Rejection probabilities

mn = 25 0.055 0.375 0.991 0.568 0.999

mn = 30 0.046 0.334 0.982 0.497 0.998

mn = 35 0.046 0.289 0.976 0.439 0.997

0.043 0.189 0.835 0.334 0.936

0.041 0.163 0.792 0.283 0.910

0.040 0.146 0.748 0.240 0.878

Table 2: Empirical Rejection probabilities for the standardized test statistic 3 5/mn Sn - mn/6 with varying dimension parameters kn and mn with ln = 2kn.
in the previous paragraph and hence, satisfies independence to the structural disturbance V . We construct the statistic Sn as described in the previous paragraph. Table 2 illustrates the power of our test against these alternative models (4.4) and (4.5). Again we observe that our test is not very sensitive to the choice of the dimension parameter mn. Our test becomes somewhat less powerful for large kn. But in contrast to the alternatives involving discontinuous functions, the choice of kn is not as sensitive.

17

4.2. Testing exogeneity

The realizations Y were generated as in model (4.1) with cV = 0.5 and structural effect 2(z) = j=1(-1)j+1 j-2 sin(jz). Again, for computational reasons we truncate the infinite sum at 100. The resulting function is displayed in Figure 1. Note that  determines
the degree of endogeneity of Z and is varied among the experiments. The null hypothesis H0 : P(Y 2(Z)|Z) = q holds true if  = 0 and is false otherwise. In the following, we perform a test at the median q = 0.5. As our test relies on the equation P(Y 2(Z)|W ) = q we expect our test to have low power if W strongly related to Z.
The test statistic is implemented as described in Section 3.2. To estimate the structural effect we make use of the estimator qen of He and Shi [1994] given in (3.2). Here, we use B-splines of order 2 with 5 knots (hence kn = 8) or 7 knots (hence kn = 10). We emphasize that the dimension parameter kn can be chosen larger as it is not affected by the ill-posedness of the underlying inverse problem. As above, the vector of basis functions
fmn is also constructed with B-spline basis of order 2 with knots varying between 22, 27 or 32 (hence mn = 25, mn = 30 or mn = 35). Table 3 depicts the empirical rejection probabilities with varying number of basis functions.
As we see from Table 3, our test becomes more powerful for larger ; that is, for instruments
with a stronger correlation to the covariates Z. From Table 3 we see that the test of
exogeneity becomes somewhat less powerful for larger values of mn. On the other hand, the test seems not to be too sensitive with respect to the choice of the dimension parameters
kn and mn. Similarly as above, a guideline for smoothing parameter choice in practice is given by the following minimum-maximum principle. That is, if sqe(kn, mn) denotes the standardized value of our test Sne (q) with dimension parameters kn and mn then choose these parameters such that

min max
kn<n1/4 kn2 <mn<n1/2

sqe(kn, mn) .

Again this criterion takes the rate condition for the asymptotic theory into account. In particular, we may minimize the dimension parameter kn over a larger set of integers.

5. An empirical illustration

To illustrate our testing procedure, we present an empirical application concerning estimation of the effects of class size on students' performances on standardized tests. Angrist and Lavy [1999] studied the effects of class size on test scores of 4th and 5th grade students in Israel. In this empirical illustration, we focus on 4th grade reading comprehension which was also considered by Horowitz [2011]. In this empirical example we study the model

Ysc = (Zsc, Vsc) + Dsc (Vsc)

(5.1)

where Ysc is the average reading comprehension test score of 4th grade students in class c of school s, Zsc is the number of students in class c of school s, Dsc is the fraction of disadvantaged students in class c of school s with unknown scalar function , Vsc = Us + sc where Us is an unobserved school-specific random effect, and sc is an unobserved, independently over classes and schools distributed random variable.

18



Empirical Rejection probability with

mn = 25

0.4 0.0 kn = 8

0.050

0.3 0.239

0.35 0.351

0.4 0.527

0.45 0.696

0.7 0.0

0.045

0.3 0.463

0.35 0.709

0.4 0.893

0.45 0.979

0.4 0.0 kn = 10

0.043

0.3 0.241

0.35 0.365

0.4 0.517

0.45 0.711

0.7 0.0

0.043

0.3 0.455

0.35 0.711

0.4 0.884

0.45 0.977

mn = 30 0.048 0.217 0.322 0.465 0.640 0.043 0.411 0.626 0.847 0.963 0.046 0.217 0.321 0.454 0.640 0.042 0.405 0.627 0.846 0.965

mn = 35 0.045 0.195 0.282 0.418 0.589 0.041 0.364 0.573 0.788 0.942 0.051 0.189 0.297 0.422 0.582 0.041 0.357 0.577 0.791 0.943

Table

3:

Em2pmirnica-l1

Rejection probabilities for the standardized test 4 Sne (0.5) - mn with varying dimension parameters kn and

statistic mn.

The class size Zsc may be endogenous, for instance, due to the socioeconomic background of the students. To identify the causal effect of class size on scholar achievement Angrist and Lavy [1999] use Maimonides' rule as instruments. According to this administrative rule, maximum class size is given by 40 pupils and will be split if the number of enrolled students exceeds this number. More precisely, assuming that cohorts are divided into classes of equal size, Maimonides rule is described by
Wsc = Es/ 1 + (Es - 1)/40
where Es denotes enrollment in school s and x denotes the largest integer less or equal to x. Note that Horowitz [2011] could show that a linear relation between class size and scholar achievement as used by Angrist and Lavy [1999] is misspecified. To apply our tests, we consider a subsample where only one representative class per school is considered. By doing so, we avoid that rejection of a hypothesis may be caused by within class correlation. Moreover, only schools with at least two classes are considered which leads to a sample size of 707. In the following, we want to test nonparametrically whether class size is endogenous at the 0.5≠quantile. The null hypothesis is that P(Ysc (Zsc, q) + Dsc (q)|Zsc) = q where q = 0.5. The value of our test statistic Sne (0.5) = (2mn)-1/2 4 Sne (0.5) - mn is given

19

test scores 65 70 75 80 85

test scores 65 70 75 80 85

by 2.115. For the choice of smoothing parameters kn and mn we applied the minimummaximum principle as described in Section 4.2. We thus, reject the hypothesis of exogeneity at the 0.05 nominal level. In particular, in model (5.1) under conditions (a.1)≠(a.3) we conclude that Zsc is not independent of Vsc. We now perform test whether the model (5.1) with conditions (a.1)≠(a.3) is correctly specified. We construct our test statistic using B-splines as described in Section 4.1. For the choice of smoothing parameters kn and mn we applied the minimum-maximum principle as described in Section 4.2. As in the Monte Carlo section we choose ln = 2kn. Our test statistic attains the value 1.4152 and thus fails to reject the nonseparable model (5.1) with conditions (a.1)≠(a.3) at the 0.05 nominal level. For the fixed quantile q = 0.5, we also performed a test of P(Ysc (Zsc, q) + Dsc (q)|Wsc) = q. In this case, our test statistic attains the value 0.981 and again fails to reject the hypothesis.2
20 25 30 35 40 class size
20 25 30 35 40 class size
20 25 30 35 40 class size
Figure 2: Estimated structural effects (thick line) for q  {0.25, 0.5, 0.75} and 90% confidence intervals (blue lines)
For the full sample, Figure 2 depicts estimators of the structural effect q for the quantiles q  {0.25, 0.5, 0.75} where the number of disadvantaged students is smaller than 15% (in this case n = 688). The solid black line are the estimators and the blue lines are the 90% pointwise bootstrap confidence bands (we account within in school correlation by using
2This is not the case if kn is chosen too small or too large. For instance if kn = 4 or kn = 9, respectively, then the value of the test statistic is 2.064 or 3.420 (as aboved maximized of mn and ln = 2kn).
20

test scores 65 70 75 80 85

schools as the bootstrap sampling units, see also Horowitz [2011]). We can see that the confidence bands are tight enough to reject the hypothesis that the quantile structural effects are overall upward sloping. In particular, we see that the effect of class size variation on test scores is more severe for lower performing classes.

6. Conclusion
In this paper, we developed a nonparametric specification test for the quantile regression model (1.1). The test statistic is easy to implement and a natural extension of specification testing in parametric framework. We established the asymptotic distribution of our test under the null hypothesis. Our test is consistent against a fixed alternative and we study its power properties by considering a sequence of local alternatives. We also provided extensions of our test theory concerning model simplification. We demonstrated via a Monte Carlo simulation study that our testing procedure performs well in finite samples. The usefulness of our testing procedure is illustrated by an empirical example.

A. Appendix

A.1. Proofs of Section 3.

In the appendix, fmn denotes a mn dimensional vector with entries fj for 1 j mn. Moreover, ∑ is the usual Euclidean norm. For ease of notation, let Xi = (Yi, Zi, Wi) for
1 i n with realizations x = (y, z, w)  Y ◊ Z ◊ W. Let H be a class of measurable functions with a measurable envelope function H. Then N (, H, LX2 ) and N[ ](, H, L2X ), respectively, denote the covering and bracketing numbers for the set H. In addition, let J[ ](1, H, LX2 ) denote a bracketing integral of H, that is,

1

J[ ](1, H, LX2 ) =

1 + log N[ ]( H X , H, L2X )d.

0

Throughout the proofs, we will use C > 0 to denote a generic finite constant that may be

different in different uses. Further, for ease of notation we write

for

1 0

,

i for

n i=1

,

and

i <i for

n i=1

ii-=11. For any ,   L2W , the inner product in L2W is denoted by ,  W =

E[(W )(W )] and further, let Fmn =

mn j=1

, fj

W fj .

In the following, we denote

Qn = n-1 i fmn(Wi)fmn(Wi)t. By Assumption 1, the eigenvalues of E[fmn(W )fmn(W )t]

are bounded away from zero and hence, it may be assumed that E[fmn(W )fmn(W )t] = Imn

where Imn denotes the mn dimensional identity matrix (cf. Newey [1997], p. 161).

In the following result, we establish continuity of the mapping q  (∑, q) under the tan-

gential cone condition and a mild assumption on the sieve approximation error for q.

Lemma A.1. Let Assumption 2 be satisfied. Assume for almost all q  (0, 1) there exists a function q with T q = q and q - kq Z = o(1) as k  . Then the mapping q  (∑, q) is continuous.

Proof. Let {sqj, ej, fj}j 1 be a singular value decomposition of the linear operator Tq for some q  (0, 1). For any  > 0 and k sufficiently large, let us define  = (1 - )  sqk/3. We consider q  (0, 1) such that |q - q | < . Since q, q satisfy the quantile restriction we have

21

T q - T q W < . Let us further denote rk(q) = kq - q W . We have rk(q) /6 by assumption for all q. By Assumption 2 (ii) and the triangular inequality it holds
T q-T q W (1 - ) Tq(q - q ) W = (1 - ) Tqk(q - q ) - Tq(kq - q) + Tq(kq - q ) W (1 - ) Tqk(q - q ) W - Tq(kq - q) W - Tq(kq - q ) W
(1 - ) sqk k(q - q ) Z - rk(q) - rk(q )
(1 - ) sqk q - q Z - 2rk(q) - 2rk(q ) ,

using that (sqj)j 1 is a zero sequence. This implies

q - q Z

(1 - )-1 sq-k1  + 2rk(q) + 2rk(q ) (1 - )-1 sq-k1  + 2 /3
,

which proves the result.

Proof of Theorem 2.1. Since we have Qn - Imn 2 = op(m2n/n) it is sufficient to prove

that 3 5/mn

mn j=1

|n-1/2

i(1 {Yi

qn(Zi)} - q)fj(Xi)|2 - mn/6 d N (0, 1). The

proof is based on the decomposition

mn
n-1 (1 {Yi qn(Zi)} - q)fj(Wi) 2dq

j=1 i

mn
=

n-1 (1 {Yi (Zi, q)} - q)fj(Wi) 2dq

j=1 i

2 mn - n2
j=1

(1 {Yi (Zi, q)} - q)fj(Wi)
i

mn
+
j=1

n-1
i

1{Yi

◊ 1{Yi qn(Zi)} - 1{Yi (Zi, q)} fj(Wi) dq
i
qn(Zi)}-1{Yi (Zi, q)} fj(Wi) 2dq = In-2IIn+IIIn.
(A.1)

Consider In. We calculate further

m-n 1/2 nIn - mn/6 1 mn
+ mnn i=i j=1

1 mn =
mnn i j=1

|(1 {Yi

1 {Yi (Zi, q)} - q 1 {Yi

(Zi, q)} - q)fj(Wi)|2dq - 1/6 (Zi , q)} - q fj(Wi)fj(Wi )dq

where the first summand tends in probability to zero as n  . Indeed,we have

E |(1{Y (Z, q)} - q)fj(W )|2dq = E[fj2(W )] q(1 - q)dq = 1/6

22

for all j 1 and hence,

1 mn

E

 mnn

i

j=1

|(1 {Yi (Zi, q)} - q)fj(Wi)|2dq - 1/6 2

1 mnn

mn
E |(1 {Y
j=1

(Z, q)}-q)fj(W )|2 -E |(1{Y

(Z, q)}-q)fj(W )|2

2
dq

1 sup
mnn wW

fmn (w) 4

E | 1 {Y

(Z, q)} - q|4dq

O(mn/n) = o(1)

by using supwW fmn(w) 2 Cmn. Therefore, to establish 3 5/mn(nIn - mn/6) d N (0, 1) it is sufficient to show

 35

mn



mnn i=i j=1

1 {Yi (Zi, q)}-q 1 {Yi (Zi , q)}-q fj(Wi)fj(Wi )dq d N (0, 1).

This follows from Lemma A.3. Consider IIIn. Let us denote Bn := {  B(0,1) :  -



2 Z,p

m-n (1+c)/} for some constant c > 0 and Bqn := {q :   Bn}  B. Further, we

denote for 1 j mn and 1 i n

hqj(Xi, q) = 1{Yi (Zi, q)} - 1 {Yi (Zi, q)} fj(Wi)

and the classes Hqjn = {hqj(∑, q) : q  Bqn} and Hqj = {hqj(∑, q) : q  B}. We observe

mn

IIIn =

n-1 hqj (Xi, qn) 2dq

j=1 i

mn

2p

T ∑n - T 

2 W

+2

j=1

n-1 hqj(Xi, qn) - T qn - T q, fj W 2dq.
i

 TFromW2 (A=.4o)p(inmLenm).mFaurAt.h2ert,owgeethoebrsewrvitehfocronedveitriyonqnnB=qnot(hamt n) we deduce n

T ∑n -

hqj(Xi, q) 2

max 1{Yi
q Bqn

(Zi, q)} - 1 {Yi

(Zi, q)} fj(Wi) 2 =: Hq2j(Xi)

and hence, Hqj is an envelope function of the class Hqjn and due to Assumption 3 we have E[ Hq2j(X)dq] Cmn-(1+c). Moreover, (A.5) in Lemma A.2 together with condition (2.11)

23

implies

∑n - 

2 Z,p

= op

mn-(1+c)/

and thereby

mn
P
j=1

n-1 hqj(Xi, qn) - T qn - T q, fj W 2dq > 
i

mn
-1 E sup
j=1 Bn

n-1/2

2
hqj(Xi, q) - E hqj(X, q) dq + o(1)

i

mn
-1
j=1

E max n-1/2

2
hqj(Xi, q) - E hqj(X, q) dq + o(1)

q Bqn

i

mn
-1
j=1

E max n-1/2

hqj(Xi, q)-E hqj(X, q) +

E |Hqj(X)|2

1/2

2
dq+o(1)

q Bqn

i

where the last inequality is due to Theorem 2.14.5 of van der Vaart and Wellner [2000]. We further conclude by applying the last display of Theorem 2.14.2 of van der Vaart and Wellner [2000]

E max n-1/2 hqj(Xi, q) - E hqj(X, q)

q Bqn

i

CJ[ ](1, Hqjn, LX2 ) E |Hqj(X)|2 1/2

for all 0 < q < 1. Now since max1 j mn E |Hqj(X)|2dq Cm-n (1+c) for n sufficiently large it is sufficient to show that max1 j mn J[ ](1, Hqjn, L2X) < C for all 0 < q < 1. From Lemma
4.2 (i) of Chen [2007] we deduce

N[ ]( E |Hqj (X)|2 1/2, Hqjn, L2X)

N[ ] , E |Hqj (X)|2 -1/2 Hqjn, LX2

N[ ] , Hqj , LX2

N

 2C

2/
, B,

∑

Z,p

N

 2C

2/
, B,

∑

.

Employing condition 0 > dz/p and Theorem 6.2 Part II of Adams and Fournier [2003] yields that W ,p is compactly embedded in W ,. Thereby, B  W ,p is totally bounded in W , which implies  , C for all   B. Let WC, := {W , : q , C}.
Now Theorem 2.7.1 of van der Vaart and Wellner [2000] gives

log N 2/, B, ∑  log N 2/, WC,, ∑  C-2dz/()

where to see

C depends that max1

on the diameter j mn J[ ](1, Hqjn,

of Z L2X)

. Now due to Assumption 4 < C and hence, nIIIn = op

(i) it is ( mn).

straightforward

24

Consider IIn. We observe

mn
nIIn =

(1 {Yi (Zi, q)} - q)fj(Wi) n-1 hqj(Xi, qn) dq

j=1 i

i

mn
=
j=1

(1 {Yi (Zi, q)}-q)fj(Wi) n-1 hqj(Xi, qn)- T qn-T q, fj W dq
ii

mn
+
j=1

(1 {Yi (Zi, q)} - q)fj(Wi) T qn - T q, fj W dq
i

= Cn1 + Cn2.

The Cauchy Schwarz inequality implies for all  > 0

 P(|Cn1| >  mn)

 ( mn

)-1

1/2
q(1 - q)dq

mn
◊
j=1

E max n-1/2

hqj(Xi, q) - E hqj(X, q) 2dq

1/2
+ o(1)

q Bqn

i

= o(1)  where the last equality follows similarly to the proof of nIIIn = op( mn). Consider Cn2. Let us introduce the function for 1 j mn and 1 i n

tqn(Xi, q) := 1 {Yi (Zi, q)} - q FmnT q - FmnT q (Wi)

and the sets Dn :=

  B(0,1) : n

T-T

2 W

 mn

,

Dqn

:=

{q :   Dn}



B,

Gq := {tqn :   B}, and Gqn := {tqn :   Dqn}. We calculate

 P |Cn2| >  mn

 n( mn

)-1

E

max 1 qDqn n

i

tqn(Xi, q) dq + o(1).

Since pW is uniformly bounded away from zero, n

T -T 

2 W

 mn, and

Fmn (T q -

T q) W C T q - T q W for all   Dn we have |Fmn(T q - T q)(w)| C mn1/4n-1/2

for almost all 0 < q < 1 and pW ≠almost all w. Consequently, tqn(x, q) C mn1/4n-1/2

pW ≠almost surely. We conclude by again applying the last display of Theorem 2.14.2 of

van der Vaart and Wellner [2000]

E max
q Dqn

1 n

i

tqn(Xi, q)

CJ[ ](1, Gqn, LX2 ) mn1/4n-1/2.

As above it can be seen that J[ ](1, Gqn, LX2 ) < C for all 0 < q < 1. Indeed, from Assumption 2 (ii) we conclude T  - T q W (1 + ) Tq( - q) W and further, Assumption 4 (v)
yields Fmn(T  - T q) W C(1 + )p  - q Z . Hence, the mapping   FmnT  is
Lipschitz continuous at q and we may apply Theorem 2.7.11 of van der Vaart and Wellner

[2000] which yields

N[ ]( n-1mn 1/2, Gn, LX2 ) N[ ](, Gq, L2X)

N[ ] , {Fmn T  - Fmn T q :   B}, L2W



N

, B, 2C

∑

.



Thereby, Cn2 = op( mn), which completes the proof.

25

In the following we make use of the notation gqj(Xi, ) := (1{Yi
1 j mn, 1 i n, for any   B.

(Zi)} - q)fj(Wi),

Proof of Proposition 2.4. For the proof it is sufficient to show n-1Sn

T q -

q

2 W

dq/2+op(1).

Since

n-1 i(1 {Yi

qn(Zi)}-1 {Yi q(Zi)})fmn(Wi) 2dq = op(1)

(cf. proof of Theorem 2.1 together with Lemma A.2) we obtain

n-1 (1 {Yi
i

q(Zi)} - q)fmn (Wi) 2dq = E[((T q)(W ) - q)fmn(W )] 2dq + op(1)

T q - q

2 W

dq/2

+

op(1),

which proves the result.

Proof of Proposition 2.5. Since q = arg minB T  - q W we obtain as in the proof of Theorem 2.1 by employing the results of Lemma A.2 that

mn
Sn =
j=1

n-1/2

2 gqj(Xi, q) dq + op( mn).

i

Further, we calculate

mn

n-1/2

2 mn
gqj(Xi, q) dq =

n-1/2

2
gqj(Xi, q) - E gqj(Xi, ) dq

j=1 i

j=1 i

mn
+2

n-1/2

 gqj(Xi, q) - E gqj(X, q) n E gqj(X, q)dq

j=1 i

mn
+n

2
E gqj(X, q) dq

j=1

= In + IIn + IIIn.

We have 3 5/mn In - mn/6 d N (0, 1). Further, since E[(1{Y
we obtain

E |IIn|2 n E

(1{Y

mn
(Z, q)} - q) E gqj(X, q) 2dq
j=1
mn 2
n E gqj(X, q) dq n
j=1

(Z, q)} - q)2|W ] 1

T q - q

2 W

dq

(A.2)

and hence IIn = Op((n

T q - q

2 W

dq)1/2).

Moreover, since n

T qn - T q

2 W

dq

=

o( mn) and by employing relation (2.13) it is easily seen that



3 5n

3 5n

 mn

I I In

=

 mn



T qn - q - nq

2 W

dq

+

j=1

E[q(W )fj(W )]2dq + o(1),

which proves the result.

26

Proof n T qen

of -

TCoqroW2 ll=aroyp(3.1m. nI)n.

light Due

of to

the proof of Assumption

Theorem 2.1 is 5 (v) we obtain

sufficient to prove as in the proof of

Theorem 6 of Chen et al. [2014] that

T qen - T q - Tq(qen - q) W

C

eqn - q

2 Z

and consequently,

T qen - T q W

C

Tq(qen - q) W +

qen - q

2 Z

.

Moreover, by applying supy pY |Z,W (y, Z, W ) C and Jensen's inequality we have

Tq(eqn - q)

2 W

=

| pY |Z,W ((z, q), z, w)(eqn - q)(z)pZ|W (z, w)dz|2pW (w)dw

WZ

C

qen - q

2 Z

.

Under the conditions of Assumption 5, He and Shi [1994] (proof of Theorem 2.1 equation

(3.11)

q )

2 W

a=ndO(p3(.k1n2)+) ensktan-b2lri)sh=thopa(tmeqnn)-, wqhicZ2h=prOovp(ens -th1kena+ssken-rt2iro)n. .Consequently,

n

T (eqn -

A.2. Technical assertions.

We can not apply the consistency and rate of convergence results of Chen and Pouzo [2012] when the null hypothesis H0 fails. The following Lemma extends their results to possibly misspecified instrumental quantile regression. Recall that under misspecification q = arg minB T  - q W does not satisfy T q = q.
Lemma A.2. Let Assumptions 1≠4 hold true. Then

∑n - 

2 Z,p

=

op(1),

T ∑n - T 

2 W

=

Op

n +

T q - q

2 W

dq

,

(A.3) (A.4)

∑n - 

2 Z,p

=

Op

kn  - 

2 Z,p

+kn

n +

T q - q

2 W

dq

.

(A.5)

Proof. Proof of (A.3). We define Rn := max n-1ln, maxBkn j>ln E[(T (W )-q)fj(W )]2 . From the proof of Proposition 2.4 we have that

ln

E max n-1 1{Yi

j=1 Bkn

i

(Zi)}fj(Wi) - E[1{Y

(Z)}fj(W )] 2 = O(n-1ln). (A.6)

Consequently, we observe

n-1 (1{Yi kn q(Zi)} - q)fln (Wi) 2dq 2
i

T kn q - q

2 W

dq

+

Op(Rn).

Further, using the elementary inequality (a - b)2 a2/2 - b2 and again applying relation

27

(A.6) gives

n-1 (1{Yi q(Zi)} - q)fln(Wi) 2dq

Fln (T q - q)

2 W

dq/2

i

ln

- max n-1 1{Yi

j=1 Bkn

i

(Zi)}fj(Wi) - E 1{Y

2
(Z)}fj(W )

C

T q - q

2 W

dq

-

Op(Rn).

Let us denote Akn = {  Bk(0n,1) :

-

2 Z,p

} for some  > 0. Since T is continuous

and q = arg minB T -q W is unique we have that minAkn

T q -q

2 W

dq

is

strictly

positive for all n 1. Therefore, we obtain

P

∑n - 

2 Z,p



P min
Akn

(1{Yi
i

(Zi, q)} - q)fln(Wi) 2dq
(1{Yi kn(Zi, q)} - q)fln(Wi) 2dq
i

P min
Akn

T q - q

2 W

dq

T kn q - q

2 W

dq

+

Op(Rn)

= o(1)

since

T kn q

-q

2 W

dq

=

T q

-q

2 W

dq

+

o(1),

Rn

=

o(1),

and

making

use

of

minAkn

T q - q

2 W

dq

>

T q - q

2 W

dq

+

o(1).

Proof

of

(A.4).

For

some

>0

let

us denote Dkn = {  Bk(0n,1) :

T-T

2 W

n}. Therefore, we obtain as above

P

T ∑n - T 

2 W

n

Further, it holds obtain

P min
Dkn

T q - q

2 W

dq

T kn q - q

2 W

dq

+

Op(Rn)

.

T kn q - q

2 W

dq

2 T kn - T  W +2

T q - q

2 W

dq.

We thus

P

T ∑n - T 

2 W

 n

P min
Dkn

T q -q

2 W

dq

2

T kn -T 

2 W

+2

T q -q

2 W

dq

+Op(Rn)

.

For all   Dkn and 0 < q < 1 we have

T q - q

2 W

T q - q

2 W

T q - T q

2 W

/2

-

T q - q

2 W

and hence,

T q - q

2 W

T q - T q

2 W

/4.

Thereby, we obtain

P

T ∑n - T 

2 W

 n

1

P

min 4 Dkn

T-T

2 W

2

T kn  - T 

2 W

+2

T q - q

2 W

dq

+

Op(Rn)

 P 4 n 2

Tq(kn q - q)

2 W

dq

+

2

T q - q

2 W

dq

+

Op(Rn)

28

which goes to zero for all n 1 as   . Proof of (A.5). Note that Tq( - q) W (1 - )-1 T  - T q W for all  in a sufficiently small neighborhood around q. Thereby,
due to (A.3) we obtain

∑n - 

2 Z,p

=

Op

kn  - 

2 Z,p

+kn

T ∑n - T 

2 W

.

Hence, the result follows by applying (A.4).

The following lemma is similar to Lemma A.2 of Breunig [2015]. In the following, however,

we provide the proof for the sake of completeness. For all   B recall the definition

gXji(iX:=i, 3)=5/((1{mYin

(Zi)}

n)

mn j=1

- q)fj(Wi) for all 1 j gj(Xi, q)gj(Xi , q)dq

mn and

and

1

i

n. Let us introduce

Qni :=

i-1 l=1

Xli

,

0,

for i = 2, . . . , n, for i = 1 and i > n.

(A.7)

Then clearly

 3 5/( mnn)

mn
gj(Xi, q)gj(Xi , q)dq

i=i j=1

 = 6 5/( mnn)

mn
gj(Xi, q)gj(Xi , q)dq =

n
Xii = Qni.

i<i j=1

i<i i=1

Let Bni := B((Z1, Y1, W1), . . . , (Zi, Yi, Wi)), 1 i n, n 1, be the -algebra generated

by (Z1, Y1, W1), . . . , (Zi, Yi, Wi). Since gj(Xi, q), 1 i n, are centered random vari-

ables it follows that {(

i i

=1

Qni

,

Bni),

i

1} is a Martingale for each n

1 and hence

{(Qni, Bni), i 1} is a Martingale difference array for each n 1.

Lemma A.3. Let Qni be defined as in (A.7). Let Assumption 1 and condition (2.10) be

satisfied. Then, we have

 i=1

Qni

d

N (0,

1).

Proof. For the proof we have to show that the Martingale difference array {(Qni, Bni), i 1}, n 1, satisfies the conditions


E |Qni|2 1 for all n
i=1 
Qn2i = 1 + op(1),
i=1
sup |Qni| = op(1).
i1

1,

(A.8) (A.9) (A.10)

Then the result follows by Awad [1981]. Proof of (A.8). Since E[(1 {Y (Z, q)} - q)(1 {Y (Z, q )} - q )|W ] = min(q, q ) - qq we have

2
E gj(X, q)gj (X, q ) d(q, q ) =

(min(q, q ) - qq )2d(q, q ) 1{j=j } = 1{j=j } /90.

29

since E[fj(W )fj (W )]2 = 1{j=j } and

(min(q, q ) - qq )2d(q, q ) = 2
= 3

q
(q - qq )2dq +
0
q3(1 - q)2dq

= 1/90.

1
(q - qq )2dq
q

dq

Observe that E[X1iX1i ] = 0 for i = i and thus, for i = 2, . . . , n we have

E |Qni|2 = E |X1i + ∑ ∑ ∑ + Xi-1,i|2 = (i - 1) E |X12|2

 6 5(i - 1)

mn

=

n2mn

E
j=1

gj(X1, q)gj(X2, q)dq 2

 6 5(i - 1)

mn

= n2mn j,j =1

E[gj(X, q)gj

(X, q

)]

2d(q, q

)

=

2(i - 1) n2 .

Thereby, we conclude

n

E |Qni|2

=

2 n2

n-1
i

=

n(n - n2

1)

=

1

-

1 n

i=1 i=1

which proves (A.8). Proof of (A.9). Using relation (A.11) we observe

(A.11)

nn
E Q2ni - 1 2 = E Qn4i + 2

E Q2niQ2ni - 1 + o(1) =: In + IIn - 1 + o(1).

i=1 i=1 i<i

Consider In. Observe that

i-1

E |Qni|4 = E

Xi i 4

i =1

 65

mn

i-1

4

E

 n mn

gj(Xi, q)
j=1 i

gj (Xi
=1

, q)

dq

C

n4m2n

sup
wW

fmn (w) 4

(i - 1) E

fmn(W ) 4 + 3(i - 1)(i - 2)(E

fmn (W ) 2)2

where we used that E[gj(X, q)] = 0 for 0 < q < 1. Since

n i=1

3(i-1)(i-2)

=

n(n-1)(n-2)

we conclude

In

C

n(n - 1) 2n4 E

fmn (W )

4

+

n(n

-

1)(n n4

-

2) (E

fmn (W ) 2)2

= o(1)

since (E fmn(W ) 2)2 E fmn(W ) 4 Cmn2 . We calculate for i < i

Q2niQ2ni =

i-1
Xk2i
k=1

i -1

i-1

Xk2i +

Xk2i

k=1 k=1

i -1
Xki Xk i
k=k

i-1
+ XkiXk i
k=k

i -1

i-1

Xk2i +

XkiXk i

k=1 k=k

i -1
Xki Xk i
k=k

=: Aii + Bii + Cii + Dii .

30

Consider Aii . Exploiting relation (A.11) and using i<i (i - 1) = in=1(i - 1)(i - 2)/2 =

n(n - 1)(n - 2)/6 and further

i<i (i - 1)(i - 3) =

n i =1

(i

- 3)(i

- 2)(i

- 1)/2

=

n(n - 1)(n - 2)(n - 3)/8 we obtain

2 E Aii = 4 E X122X223 (i - 1) + 2(E X122)2 (i - 1)(i - 3) + o(1)

i<i i<i i<i

n(n - 1)(n - 2) mn C n4m2n j,l=1

E gj2(X, q)gl2(X, q ) d(q, q )

n(n - 1)(n - 2)(n - 3) + n4 + o(1)

since E[gj(X, q)gj (X, q )]d(q, q ) = 1{j = j }/90. Moreover, applying Cauchy Schwarz's
inequality twice gives

mn j,l=1

E gj2(X, q)gl2(X, q ) d(q, q )

sup fmn (w) 4
wW

Cmn2 .

Thereby, it holds 2 i<i E Aii = 1 + o(1). Now consider Bii . Since {fl}l 1 forms an orthonormal basis on the support of W we obtain

i-1
E Xk2i

i -1

i-1

Xki Xk i = 2 E Xk2iXki X∏ ii

k=1 k=k

k=1

C(i - 1) mn n4m2n j,j =1

E gj(X1, q)gj (X1, q)gj(X2, q)gj (X2, q )

mn
◊ q(1 - q) gl2(X1, q) d(q, q , q )

l=1

C(i - 1) mn n4mn j,j =1

E |gj(X, q)gj (X, q)|2d(q, q )

C

(i

- 1)mn n4

.

This, together with relation (A.11), yields i<i E Bii = o(1). Further, it is easily seen that

31

i<i E Cii = o(1). Consider Dii . Using twice the law of iterated expectation gives

i-1 i -1

i-1

E Dii = E

XkiXk i

Xki Xk i = 4 E XkiXk iXki Xk i

k=k k=k

k<k

i-1

= 4 E XkiXk i E[Xki Xk i |(Yk, Zk, Wk), (Yk , Zk , Wk ), (Yi, Zi, Wi)]

k<k

C i-1 n2mn k<k E

E[XkiXk i|(Yk, Zk, Wk), (Yk , Zk , Wk )]

mn
◊

E[gj(X, q)gj (X, q )]gj(Xk, q)gj (Xk , q )d(q, q )

j,j =1

C n4mn2

mn 2
E E[gj(X, q)gj (X, q )]gj(X1, q)gj (X2, q ) d(q, q )(i - 1)(i - 2)
j,j =1

C n4mn

(i

-

1)(i

-

2).

again using that E[gj(X, q)gj (X, q )] is only different from zero whenever j = j . Consequently, we obtain

E Dii
i<i

C C n(n - 1)(n - 2)(n - 3)

n4mn i<i (i - 1)(i - 2) =

mnn4

= o(1)

and hence 2 i<i E Q2niQ2ni = 1 + o(1). Proof of (A.10). Note that P supi 1 |Qni| > 
assertion follows from the Markov inequality.

n
i=1 P

Q2ni

>

2

and, hence the

References
R. A. Adams and J. J. Fournier. Sobolev Spaces, volume 140 of Pure and Applied Mathematics. Elsevier/Academic Press, Amsterdam, 2003.
Y. Ait-Sahalia, P. J. Bickel, and T. M. Stoker. Goodness-of-fit tests for kernel regression with an application to option implied volatilities. Journal of Econometrics, 105(2):363≠ 412, 2001.
J. D. Angrist and V. C. Lavy. Using maimonides' rule to estimate the effect of class size on scholastic achievement. The Quarterly Journal of Economics, 114(2):533≠575, 1999.
A. M. Awad. Conditional central limit theorems for martingales and reversed martingales. The Indian Journal of Statistics, Series A, 43:10≠106, 1981.
R. Blundell and J. Horowitz. A nonparametric test of exogeneity. Review of Economic Studies, 74(4):1035≠1058, Oct 2007.
C. Breunig. Goodness-of-fit tests based on series estimators in nonparametric instrumental regression. Journal of Econometrics, 184(2):328≠346, 2015.

32

X. Chen. Large sample sieve estimation of semi-nonparametric models. Handbook of Econometrics, 2007.
X. Chen and T. Christensen. Optimal sup-norm rates, adaptivity and inference in nonparametric instrumental variables estimation. 2015.
X. Chen and D. Pouzo. Estimation of nonparametric conditional moment models with possibly nonsmooth generalized residuals. Econometrica, 80(1):277≠321, 01 2012.
X. Chen and D. Pouzo. Sieve wald and qlr inferences on semi/nonparametric conditional moment models. Econometrica, 83(3):1013≠1079, 2015.
X. Chen and M. Reiﬂ. On rate optimality for ill-posed inverse problems in econometrics. Econometric Theory, 27(03):497≠521, 2011.
X. Chen, O. Linton, and I. Van Keilegom. Estimation of semiparametric models when the criterion function is not smooth. Econometrica, 71:1591≠1608, 2003.
X. Chen, V. Chernozhukov, S. Lee, and W. K. Newey. Local identification of nonparametric and semiparametric models. Econometrica, 82(2):785≠809, 2014.
V. Chernozhukov and C. Hansen. An iv model of quantile treatment effects. Econometrica, 73:245≠261, 2005.
V. Chernozhukov, G. Imbens, and W. K. Newey. Instrumental variable estimation of nonseparable models. Journal of Econometrics, 139(1):4≠14, 2007.
A. Chesher. Identification in nonseparable models. Econometrica, 71(5):1405≠1441, 2003.
D. Chetverikov and D. Wilhelm. Nonparametric instrumental variable estimation under monotonicity. arXiv preprint arXiv:1507.05270, 2015.
P.-A. Chiappori, I. Komunjer, and D. Kristensen. Nonparametric identification and estimation of transformation models. Journal of Econometrics, 188(1):22≠39, 2015.
F. Dunker, J.-P. Florens, T. Hohage, J. Johannes, and E. Mammen. Iterative estimation of solutions to noisy nonlinear operator equations in nonparametric instrumental regression. Journal of Econometrics, 2013.
J. C. Escanciano and S.-C. Goh. Specification analysis of linear quantile models. Journal of Econometrics, 178:495≠507, 2014.
J. C. Escanciano and C. Velasco. Specification tests of parametric dynamic conditional quantiles. Journal of Econometrics, 159(1):209≠221, 2010.
F. F`eve, J.-P. Florens, I. Van Keilegom, et al. Estimation of conditional ranks and tests of exogeneity in nonparametric nonseparable models. Technical report, UCL, 2012.
P. Gagliardini and O. Scaillet. A specification test for nonparametric instrumental variable regression. Swiss Finance Institute Research Paper No. 07-13, 2007.
P. Gagliardini and O. Scaillet. Nonparametric instrumental variable estimation of structural quantile effects. Econometrica, 80(4):1533≠1562, 2012.
33

M. Hanke, A. Neubauer, and O. Scherzer. A convergence analysis of the Landweber iteration for nonlinear ill-posed problems. Numerische Mathematik, 72(1):21≠37, Nov. 1995.
X. He and P. Shi. Convergence rate of b-spline estimators of nonparametric conditional quantile functions. Journal of Nonparametric Statistics, 3(3-4):299≠308, 1994.
S. Hoderlein and E. Mammen. Identification of marginal effects in nonseparable models without monotonicity. Econometrica, 75(5):1513≠1518, 2007.
S. Hoderlein, L. Su, and H. White. Specification testing for nonparametric structural models with monotonicity in unobservables. UCSD Department of Economics Working Paper, 2011.
Y. Hong and H. White. Consistent specification testing via nonparametric series regression. Econometrica, 63:1133≠1159, 1995.
J. L. Horowitz. Specification testing in nonparametric instrumental variables estimation. Journal of Econometrics, 167:383≠396, 2012.
J. L. Horowitz. Applied nonparametric instrumental variables estimation. Econometrica, 79(2):347≠394, 2011.
J. L. Horowitz and S. Lee. Nonparametric instrumental variables estimation of a quantile regression model. Econometrica, 75:1191≠1208, 2007.
J. L. Horowitz and S. Lee. Testing a parametric quantile-regression model with an endogenous explanatory variable against a nonparametric alternative. Journal of Econometrics, 152(2):141≠152, 2009.
J. L. Horowitz and S. Lee. Nonparametric estimation of an additive quantile regression model. Journal of the American Statistical Association, 100(472):1238≠1249, 2005.
A. Lewbel, X. Lu, and L. Su. Specification testing for transformation models with an application to generalized accelerated failure-time models. Journal of Econometrics, 184 (1):81≠96, 2015.
W. K. Newey. Convergence rates and asymptotic normality for series estimators. Journal of Econometrics, 79(1):147≠168, 1997.
A. Santos. Inference in nonparametric instrumental variables with partial identification. Econometrica, 80(1):213≠275, 2012.
A. van der Vaart and J. Wellner. Weak Convergence and Empirical Processes: With Applications to Statistics (Springer Series in Statistics). Springer, corrected edition, Nov. 2000.
34

SFB 649 Discussion Paper Series 2016
For a complete list of Discussion Papers published by the SFB 649, please visit http://sfb649.wiwi.hu-berlin.de.

001
002 003
004 005 006
007 008 009 010
011 012
013 014
015 016 017
018 019 020

"Downside risk and stock returns: An empirical analysis of the long-run and short-run dynamics from the G-7 Countries" by Cathy Yi-Hsuan Chen, Thomas C. Chiang and Wolfgang Karl H‰rdle, January 2016. "Uncertainty and Employment Dynamics in the Euro Area and the US" by Aleksei Netsunajev and Katharina Glass, January 2016. "College Admissions with Entrance Exams: Centralized versus Decentralized" by Isa E. Hafalir, Rustamdjan Hakimov, Dorothea K¸bler and Morimitsu Kurino, January 2016. "Leveraged ETF options implied volatility paradox: a statistical study" by Wolfgang Karl H‰rdle, Sergey Nasekin and Zhiwu Hong, February 2016. "The German Labor Market Miracle, 2003 -2015: An Assessment" by Michael C. Burda, February 2016. "What Derives the Bond Portfolio Value-at-Risk: Information Roles of Macroeconomic and Financial Stress Factors" by Anthony H. Tu and Cathy Yi-Hsuan Chen, February 2016. "Budget-neutral fiscal rules targeting inflation differentials" by Maren Brede, February 2016. "Measuring the benefit from reducing income inequality in terms of GDP" by Simon Voigts, February 2016. "Solving DSGE Portfolio Choice Models with Asymmetric Countries" by Grzegorz R. Dlugoszek, February 2016. "No Role for the Hartz Reforms? Demand and Supply Factors in the German Labor Market, 1993-2014" by Michael C. Burda and Stefanie Seele, February 2016. "Cognitive Load Increases Risk Aversion" by Holger Gerhardt, Guido P. Biele, Hauke R. Heekeren, and Harald Uhlig, March 2016. "Neighborhood Effects in Wind Farm Performance: An Econometric Approach" by Matthias Ritter, Simone Pieralli and Martin Odening, March 2016. "The importance of time-varying parameters in new Keynesian models with zero lower bound" by Julien Albertini and Hong Lan, March 2016. "Aggregate Employment, Job Polarization and Inequalities: A Transatlantic Perspective" by Julien Albertini and Jean Olivier Hairault, March 2016. "The Anchoring of Inflation Expectations in the Short and in the Long Run" by Dieter Nautz, Aleksei Netsunajev and Till Strohsal, March 2016. "Irrational Exuberance and Herding in Financial Markets" by Christopher Boortz, March 2016. "Calculating Joint Confidence Bands for Impulse Response Functions using Highest Density Regions" by Helmut L¸tkepohl, Anna StaszewskaBystrova and Peter Winker, March 2016. "Factorisable Sparse Tail Event Curves with Expectiles" by Wolfgang K. H‰rdle, Chen Huang and Shih-Kang Chao, March 2016. "International dynamics of inflation expectations" by Aleksei Netsunajev and Lars Winkelmann, May 2016. "Academic Ranking Scales in Economics: Prediction and Imdputation" by Alona Zharova, Andrija Mihoci and Wolfgang Karl H‰rdle, May 2016.

SFSBF6B4694, 9S,pSapnadnaduaeureSrtrSatﬂraeﬂ1e, 1D,-D10-1107187B8eBrleinrlin htthpt:t/p/:/s/fbs6fb4694.w9.iwwiiw.hiu.h-bue-brleinrl.idne.de
ThTishrisesreasercahrcwhawsassupsuppoprtoerdtebdybtyhethDeeDuetsucthseche ForFsocrhsuchnugnsgesgmeeminesicnhsachftatfht rtohuroguhgthhethSeFSBF6B4694"9Ec"oEnconmoimc RicisRki"s.k".

SFB 649 Discussion Paper Series 2016
For a complete list of Discussion Papers published by the SFB 649, please visit http://sfb649.wiwi.hu-berlin.de.

021 022
023 024
025
026 027
028 029 030
031
032

"CRIX or evaluating blockchain based currencies" by Simon Trimborn and Wolfgang Karl H‰rdle, May 2016. "Towards a national indicator for urban green space provision and environmental inequalities in Germany: Method and findings" by Henry W¸stemann, Dennis Kalisch, June 2016. "A Mortality Model for Multi-populations: A Semi-Parametric Approach" by Lei Fang, Wolfgang K. H‰rdle and Juhyun Park, June 2016. "Simultaneous Inference for the Partially Linear Model with a Multivariate Unknown Function when the Covariates are Measured with Errors" by Kun Ho Kim, Shih-Kang Chao and Wolfgang K. H‰rdle, August 2016. "Forecasting Limit Order Book Liquidity Supply-Demand Curves with Functional AutoRegressive Dynamics" by Ying Chen, Wee Song Chua and Wolfgang K. H‰rdle, August 2016. "VAT multipliers and pass-through dynamics" by Simon Voigts, August 2016. "Can a Bonus Overcome Moral Hazard? An Experiment on Voluntary Payments, Competition, and Reputation in Markets for Expert Services" by Vera Angelova and Tobias Regner, August 2016. "Relative Performance of Liability Rules: Experimental Evidence" by Vera Angelova, Giuseppe Attanasi, Yolande Hiriart, August 2016. "What renders financial advisors less treacherous? On commissions and reciprocity" by Vera Angelova, August 2016. "Do voluntary payments to advisors improve the quality of financial advice? An experimental sender-receiver game" by Vera Angelova and Tobias Regner, August 2016. "A first econometric analysis of the CRIX family" by Shi Chen, Cathy YiHsuan Chen, Wolfgang Karl H‰rdle, TM Lee and Bobby Ong, August 2016. "Specification Testing in Nonparametric Instrumental Quantile Regression" by Christoph Breunig, August 2016.

SFSBF6B4694, 9S,pSapnadnaduaeureSrtrSatﬂraeﬂ1e, 1D,-D10-1107187B8eBrleinrlin htthpt:t/p/:/s/fbs6fb4694.w9.iwwiiw.hiu.h-bue-brleinrl.idne.de
ThTishrisesreasercahrcwhawsassupsuppoprtoerdtebdybtyhethDeeDuetsucthseche ForFsocrhsuchnugnsgesgmeeminesicnhsachftatfht rtohuroguhgthhethSeFSBF6B4694"9Ec"oEnconmoimc RicisRki"s.k".

